{"version":3,"sources":["app.min.js"],"names":["getImageLightness","imageSrc","deferred","$","Deferred","img","document","createElement","src","style","display","body","appendChild","colorSum","onload","canvas","width","this","height","ctx","getContext","drawImage","r","g","b","avg","imageData","getImageData","data","x","len","length","Math","floor","brightness","resolve","remove","onerror","console","log","fail","promise","guid","s4","random","toString","substring","countDown","params","timer","diff","duration","Date","now","start","minutes","seconds","showMinutes","text","clearInterval","interval","afterFinish","time","setInterval","getNumEnding","iNumber","aEndings","sEnding","i","lang","basketProductAddError","basketProductAddSuccess","basketProductClear","basketProductClearError","basketRequestDelete","buttonTextInBasket","product","currencySymbol","DeliveryDate","DeliveryFormattedString","morning","afternoon","evening","creditcardquestdelete","creditcardNotFound","dialogChangePhoneAlert","dialogEditButton","dialogDismissButton","dialogDeleteButton","dialogCloseButton","deliveryaddressrequestdelete","deliveryaddressNotFound","processCallbackTitle","processPhoneCheck","processConfirmCheck","processSave","processAuthorization","loading","bouquet","bouquetNotFound","bouquetInBasketPopupCart","app","ajaxloader","settings","device","$w","window","env","loadBouquets","imageBouquetsBrightnessThreshold","timeoutResendConfirmPhoneCode","init","moment","locale","getInfo","layout","initStyle","content","bind","forms","buttons","sidebar","widgets","load","checkout","ob","orientation","hasClass","removeClass","addClass","type","subtype","windowHeight","windowWidth","resize","popup","isOpened","hide","calendar","loaded","setPosition","scroll","ready","mask","keyup","e","keyCode","swipe","swipeRight","event","direction","distance","fingerCount","target","is","closest","show","swipeLeft","tooltipster","animation","on","order","magnificPopup","close","preventDefault","stopPropagation","basket","add","clear","open","items","removalDelay","showCloseBtn","callbacks","beforeOpen","st","mainClass","midClick","title","modal","dialog","yes","class","action","lastConfirmed","no","opened","_this","sidebarObj","one","offset","outerHeight","find","top","css","bottom","sh","posB","position","delay","fadeIn","orderred","zindex","appendTo","attr","trigger","initialized","fadeOut","off","_buttons","tmpId","buttonHTML","template","id","indexOf","html","each","name","obj","tmpl","getElementById","innerHTML","afterRender","eq","form","beforeAction","bouquets","get","defaults","to","limit","after","response","options","extend","self","setTimeout","bouquetsList","call","buildListHtml","list","isEmptyObject","emptyData","append","lastItem","key","value","item","imgSrc","done","lightness","render","store","$this","currentTarget","bid","productObi","Error","filter","count","indexes","map","index","push","saveBasket","updateHtml","productcart","openedObj","delivery","step","destroyBasket","JSON","stringify","basketButton","productInBasket","productId","getProductFromBasket","removeProductFromBasket","callback","splice","error","getBasketData","getDeliveryDate","price","availableData","label","size","dia","composition","info","date","Cookies","timeofday","datetimepicker","removeAttr","getDateString","save","for","status","paymentUrl","cleared","button","_w","_h","button_offset","right","left","outerWidth","setLocale","format","timepicker","inline","todayButton","prevButton","nextButton","scrollMonth","dayOfWeekStart","yearStart","yearEnd","minDate","maxDate","onChangeDateTime","dp","$input","widget","parents","onGenerate","ct","process","undefined","val","path","_str","String","toLowerCase","capitalizeFirstLetter","transition","y","complete","serializeObject","set","expires","startPosition","startTitle","hashProcess","when","then","hash","Hash","anchor","location","toggleClass","fadeToggle","indexed","gallery","w","h","delegate","closeOnContentClick","closeBtnInside","fixedContentPos","image","verticalFit","margin","lazyLoad","loop","autoplay","autoplayTimeout","autoplayHoverPause","element","owlCarousel","loadStep3","ceil","focus","history","pushState","pathname","inBasket","_str2","spinner","newVal","oldVal","currentLayout","setStyleLayout","container","loadLayout","newH","owl","current","parent","autoHeight","URLhashListener","animateOut","smartSpeed","animateIn","afterInit","elem","slide","serializeArray","local","finish","reset","auth","auth_form","validateForm","next","targetForm","jQuery","validator","addMethod","regexp","re","RegExp","optional","test","validate","onfocusout","onkeyup","onclick","focusInvalid","submitHandler","authorizationSubmitHandler","rules","required","minlength","phone","email","messages","showErrors","errorMap","errorList","message","authorizationProcess","prepend","fadeTo","icon","profile","submit","personal","input","cardId","cartName","str","creditcard","del","popupClass","validateCreditCard","result","card_type","valid","accept","keypress","which","addressId","address","prev","_data","cardname","cardtype","cardnumber","substr","cardtemplate","li","newId","cnt","slideUp","_checkout","goToStep","loadLastStep",1,"form_step__1","registrationSubmitHandler","registrationProcess",2,"form_step__2","confirmSubmitHander","confirmProcess",3,"map_created","ymaps","loadMap","loadKladr","deliverySubmitHandler","deliveryProcess","dataObj","Map","center","zoom","controls","ZoomLayout","templateLayoutFactory","createClass","build","superclass","zoomInCallback","util","zoomIn","zoomOutCallback","zoomOut","unbind","getData","control","getMap","events","fire","oldZoom","getZoom","newZoom","zoomControl","ZoomControl","geoLayout","geolocation","geolocationControl","GeolocationControl","setLabel","charAt","toUpperCase","mapUpdate","kladr","getAddress","$kladr_form","objs","contentType","region","district","city","street","building","geocode","res","geoObjects","geoObject","geometry","getCoordinates","placemark","Placemark","setCenter","addressUpdate","$region","$district","$city","$street","$building","parentInput","verify","labelFormat","query","typeShort","k","change","openBefore","checkBefore","trim","setValues",4,"userlist","getUserList","selectize","allowEmptyOption","create","plugins","dropdown_footer","valueField","labelField","searchField","addPrecedence","escape","option","caption","onChange","$dropdown_content","slideDown","formObject","dataObject","textValue","submitProcess","getCurrentStep",5,6,7,8,"recipient","who","fromme_to_name","fromme_to_phone","reason","fulladdress","split","strAddress","apartment","join","currentStep","stepItem","splitter","hashes","vars","oldbrowser","decodeURIComponent","pos","href","hasOwnProperty","arguments","replace","prototype","slice","Object","Number","n","s","c","num","toFixed","max","fn","o","v","isArray","concat"],"mappings":"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","file":"app.min.js","sourcesContent":["/*\n * App JS\n */\nvar lang = {\n    basketProductAddError: 'Произошла ошибка. Товар не может быть добавлен в корзину.',\n    basketProductAddSuccess: 'Товар успешно добавлен в корзину.',\n    basketProductClear: 'Корзина очищена',\n    basketProductClearError: 'Произошла ошибка при очистке корзины. Обновите страницу и попробуйте снова.',\n    basketRequestDelete: 'Вы уверены что хотите удалить товар из корзины?',\n    buttonTextInBasket: 'В корзине',\n    product: 'товар',\n    currencySymbol: '&#x20bd;',\n    DeliveryDate: 'Дата доставки',\n    DeliveryFormattedString: 'Доставка на {1} {2}',\n    morning: 'Утро',\n    afternoon: 'День',\n    evening: 'Вечер',\n    creditcardquestdelete: 'Вы уверены что хотите удалить карту \"{1}\"?',\n    creditcardNotFound: 'У вас не привязано ни одной карты',\n    dialogChangePhoneAlert: 'Изменение телефонного номера привяжет вашу историю заказов к новому номеру',\n    dialogEditButton: 'Редактировать',\n    dialogDismissButton: 'Отмена',\n    dialogDeleteButton: 'Удалить',\n    dialogCloseButton: 'Закрыть',\n    deliveryaddressrequestdelete: 'Вы уверены что хотите удалить адрес доставки \"{1}\"?',\n    deliveryaddressNotFound: 'У вас не привязано ни одного адреса доставки. Чтобы привязать адрес вам необходимо создать любой заказ',\n    processCallbackTitle: 'Заказ<br>звонка',\n    processPhoneCheck: 'Проверка<br>номера телефона',\n    processConfirmCheck: 'Проверка<br>кода',\n    processSave: 'Сохранение данных',\n    processAuthorization: 'Пожалуйста подождите',\n    loading: 'Ожидайте',\n    bouquet: 'Букет',\n    bouquetNotFound: 'Доступных букетов не найдено',\n    bouquetInBasketPopupCart: 'В корзине {1} на {2}'\n};\nvar app;\nvar ajaxloader;\nvar settings;\nvar device = {};\n\n$(function() {\n\tvar $w = $(window);\n\tsettings = {\n\t    env: 'dev', // clear to production\n\t    loadBouquets: 6,\n\t    imageBouquetsBrightnessThreshold: 110,\n\t    timeoutResendConfirmPhoneCode: 60 //seconds\n\t}\n\n\tapp = {\n\t\tinit: function() {\n\t\t\tmoment.locale('ru');\n\t\t\tapp.device.getInfo();\n\t\t\tapp.layout.initStyle();\n\t\t\tapp.content.initStyle();\n\n\t\t\tapp.bind.document();\n\t\t\tapp.bind.forms();\n\t\t\tapp.bind.buttons();\n\t\t\tapp.sidebar.init();\n\t\t\tapp.widgets.load();\n\n\t\t\tapp.checkout.load(); // Get Basket info\n\t\t},\n\t\tdevice: {\n\t\t\tgetInfo: function() {\n\t\t\t\tvar ob = $('body');\n\t\t\t\tvar height = $w.height();\n\t\t\t\tvar width = $w.width();\n\t\t\t\tif( width > height ) {\n\t\t\t\t\tdevice.orientation = 'landscape';\n\t\t\t\t\tif (ob.hasClass('portrait')) {\n\t\t\t\t\t\tob.removeClass('portrait').addClass('landscape');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tob.addClass('landscape');\n\t\t\t\t} else {\n\t\t\t\t\tdevice.orientation = 'portrait';\n\t\t\t\t\tif (ob.hasClass('landscape')) {\n\t\t\t\t\t\tob.removeClass('landscape').addClass('portrait');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tob.addClass('portrait');\n\t\t\t\t}\n\n\t\t\t\tif(width >= 1441){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'fullhd';\n\t\t\t\t}\n\n\t\t\t\tif( width >= 1281 && width <= 1440 ){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'hd';\n\t\t\t\t}\n\n\t\t\t\tif( width >= 1024 && width <= 1280 ){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'small';\n\t\t\t\t}\n\n\t\t\t\tif(width >= 768 && width <= 1023)\n\t\t\t\t\tdevice.type = 'planshet';\n\t\t\t\tif(width < 768)\n\t\t\t\t\tdevice.type = 'mobile';\n\t\t\t\tif(width <= 320)\n\t\t\t\t\tdevice.type = 'smallmobile';\n\n\t\t\t\tdevice.windowHeight = height;\n\t\t\t\tdevice.windowWidth = width;\n\n\t\t\t\tif(settings.env  == 'dev') {\n\t\t\t\t\tconsole.log('[DEVICE] Get device data')\n\t\t\t\t\tconsole.log(device);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tresize: function() {\n\t\t\tif(settings.env  == 'dev')\n\t\t\t\tconsole.log('[APP] Window size is changed')\n\n\t\t\tif(app.popup.isOpened())\n\t\t\t\tapp.popup.hide();\n\n\t\t\tapp.device.getInfo();\n\t\t\tapp.sidebar.initStyle();\n\t\t\tapp.content.initStyle();\n\t\t\tapp.layout.initStyle();\n\n\t\t\tif(app.widgets.calendar && app.widgets.calendar.loaded)\n\t\t\t\tapp.widgets.calendar.setPosition();\n\t\t},\n\t\tscroll: function() {\n\n\t\t},\n\t\tbind: {\n\t\t\tdocument: function() {\n\t\t\t\t$(document).ready(function(){\n\t\t\t\t\t$('input[type=\"tel\"]').mask('+7(999)999-9999');\n\t\t\t\t\t$('input[name=\"phone\"]').mask('+7(999)999-9999');\n\t\t\t\t});\n\t\t\t\t$(document).keyup(function(e) {\n\t\t\t\t\tif (e.keyCode == 27 && app.popup.isOpened())\n\t\t\t\t\t\tapp.popup.hide();   // esc\n\t\t\t\t});\n\t\t\t\t$('body').swipe( {\n\t\t\t\t\tswipeRight:function(event, direction, distance, duration, fingerCount) {\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('TouchSwipe Right Event');\n\n\t\t\t\t\t\tvar target = $(event.target);\n\t\t\t\t\t\tif( (device.type == 'desktop' && device.subtype == 'small') || device.type != 'desktop') {\n\t\t\t\t\t\t\t//console.log(target);\n\t\t\t\t\t\t\t//console.log(!target.is('body'));\n\t\t\t\t\t\t\t//console.log(target.closest('div[class^=\"owl-item\"]').length == 0);\n\t\t\t\t\t\t\t//console.log((target.closest('div[class^=\"modal\"]').length == 0 && !target.hasClass('modal')));\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!target.is('body') &&\n\t\t\t\t\t\t\t\ttarget.closest('div[class^=\"owl-item\"]').length == 0 &&\n\t\t\t\t\t\t\t\t(target.closest('div[class^=\"modal\"]').length == 0 && !target.hasClass('modal'))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tapp.popup.show('#sidebar');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t},\n\t\t\t\t\tswipeLeft:function(event, direction, distance, duration, fingerCount) {\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('TouchSwipe Left Event');\n\t\t\t\t\t\tif(app.sidebar.isOpened())\n\t\t\t\t\t\t\tapp.popup.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$('.tooltip').tooltipster({\n\t\t\t\t\tanimation: 'grow'\n\t\t\t\t});\n\n\n\t\t\t\t// Popup\n\t\t\t\t$(document).on('click', '*[data-toggle=\"popup\"]', function(e) {\n\t\t\t\t\tvar order = $(this).data('order') ? $(this).data('order') : false;\n\t\t\t\t\tapp.popup.show($(this).data('target'), order);\n\t\t\t\t});\n\t\t\t\t$(document).on('click', '#popup-bg', function() {\n\t\t\t\t\tapp.popup.hide();\n\t\t\t\t});\n\t\t\t\t$(document).on('click', 'button.popup-close', function() {\n\t\t\t\t\tapp.popup.hide();\n\t\t\t\t});\n\n\t\t\t\t// Modal\n\t\t\t\t$(document).on('click', 'button.modal-close', function(e) {\n\t\t\t\t\tif($.magnificPopup)\n\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t});\n\n\t\t\t\t// Basket\n\t\t\t\t$(document).on('click', 'button[data-toggle=\"to-basket\"]', function(e) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tapp.basket.add(e);\n\t\t\t\t});\n\t\t\t\t$(document).on('click', 'button[data-toggle=\"clear-basket\"]', function() {\n\t\t\t\t\tapp.basket.clear();\n\t\t\t\t});\n\n\n\t\t\t},\n\t\t\tforms: function() {\n\n\t\t\t},\n\t\t\tbuttons: function() {\n\t\t\t\t$('button[data-toggle=\"modal\"]').on('click', function() {\n\t\t\t\t\t$.magnificPopup.open({\n\t\t\t\t\t\ttype:'inline',\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\tsrc: $(this).data('target')\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremovalDelay: 500,\n\t\t\t\t\t\tshowCloseBtn: false,\n\t\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\t\tbeforeOpen: function() {\n\t\t\t\t\t\t\t\tthis.st.mainClass = 'mfp-zoom-in';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmidClick: true\n\t\t\t\t\t});\n\t\t\t\t})\n\n\t\t\t\t$('button[data-toggle=\"dialog\"]').on('click', function() {\n\t\t\t\t\tvar title = ($(this).data('title')?$(this).data('title'):'');\n\t\t\t\t\tvar content = ($(this).data('content')?$(this).data('content'):'');\n\t\t\t\t\tapp.modal.dialog({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\tcontent: content,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tyes: {\n\t\t\t\t\t\t\t\ttitle: 'ОК',\n\t\t\t\t\t\t\t\tclass: 'edit',\n\t\t\t\t\t\t\t\taction: function(){\n\t\t\t\t\t\t\t\t\tif(settings.env == 'dev') console.log('[Dialog (default)] Confirmed');\n\t\t\t\t\t\t\t\t\tapp.modal.lastConfirmed = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tno: {\n\t\t\t\t\t\t\t\ttitle: lang.dialogCloseButton,\n\t\t\t\t\t\t\t\tclass: 'dismiss',\n\t\t\t\t\t\t\t\taction: function(){ if(settings.env == 'dev') console.log('[Dialog (default)] Not confirmed'); app.modal.lastConfirmed = false; }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\tsidebar: {\n\t\t\topened: false,\n\t\t\tisOpened: function() {\n\t\t\t\treturn this.opened;\n\t\t\t},\n\t\t\tinit: function() {\n\t\t\t\tvar _this = this;\n\t\t\t\tvar sidebar;\n\t\t\t\tthis.sidebarObj = sidebar = $('#sidebar');\n\n\t\t\t\tsidebar.on('open', function() {\n\t\t\t\t\t_this.open();\n\t\t\t\t});\n\t\t\t\tsidebar.on('close', function() {\n\t\t\t\t\t_this.close();\n\t\t\t\t});\n\t\t\t\t$('button[data-toggle=\"close-sidebar\"]').on('click', function() {\n\t\t\t\t\t$(this).addClass('closing');\n\t\t\t\t\t$(this).one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\n\t\t\t\t\t});\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t\tapp.sidebar.close();\n\t\t\t\t});\n\n\t\t\t\tthis.initStyle();\n\n\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\tvar offset = 0;\n\t\t\t\t\tvar content = $(\"#bouquet-list\");\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[SIDEBAR] Bouquets new loaded check style sidebar');\n\t\t\t\t\tif(\n\t\t\t\t\t\tcontent.length &&\n\t\t\t\t\t\t(content.outerHeight() + $('#header').height()) < device.windowHeight - sidebar.find('.sidebar-bottom').height()\n\t\t\t\t\t) {\n\t\t\t\t\t\tconsole.log(offset);\n\t\t\t\t\t\toffset = (device.windowHeight - content.height()) - content.offset().top - sidebar.find('.sidebar-bottom').height();\n\t\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: offset});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: 0});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tinitStyle: function() {\n\t\t\t\tvar sidebar = this.sidebarObj;\n\t\t\t\tif(device.type == 'desktop' && (device.subtype == 'hd' || device.subtype == 'fullhd'))\n\t\t\t\t\tsidebar.removeClass('collapsed');\n\t\t\t\telse\n\t\t\t\t\tsidebar.addClass('collapsed');\n\n\t\t\t\tvar sh = sidebar.find('.sidebar-top').outerHeight() + sidebar.find('.sidebar-bottom').height();\n\t\t\t\tvar posB = $w.height() < sh? 'relative': 'absolute';\n\t\t\t\tvar posS = $w.height() < sh? 'absolute': 'fixed';\n\t\t\t\tvar offset = 0;\n\t\t\t\tvar content = $(\"#bouquet-list\"); // mainpage content\n\n\t\t\t\tif(\n\t\t\t\t\tdevice.windowHeight > 1000 &&\n\t\t\t\t\tcontent.length > 0 &&\n\t\t\t\t\tcontent.find('li').length > 0 &&\n\t\t\t\t\t(content.outerHeight() + $('#header').height()) < device.windowHeight - sidebar.find('.sidebar-bottom').height()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\toffset = (device.windowHeight - content.height()) - content.offset().top - sidebar.find('.sidebar-bottom').height();\n\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: offset});\n\t\t\t\t} else {\n\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: 0});\n\t\t\t\t}\n\t\t\t\tsidebar.find('.sidebar-bottom').css({position: posB});\n\t\t\t},\n            open: function() {\n                if(settings.env == 'dev')\n                    console.log('[SIDEBAR] Open navbar');\n                var sidebar = $('#sidebar');\n\n\t\t\t\ttry {\n\t\t\t\t\tsidebar.addClass('open');\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.log('Popup open error: ' + e);\n\t\t\t\t}\n\n\t\t\t\tsidebar.find('.popup-close').hide().delay(200).fadeIn(200, function() {\n\t\t\t\t\t$(this).addClass('closing');\n\t\t\t\t});\n\t\t\t\tsidebar.find('.popup-close').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t});\n\t\t\t\tthis.opened = true;\n            },\n            close: function() {\n                if(settings.env == 'dev')\n                    console.log('[SIDEBAR] Close navbar')\n\t\t\t\tvar sidebar = $('#sidebar');\n\t\t\t\tsidebar.removeClass('open');\n\n\t\t\t\tsidebar.find('.popup-close').addClass('closing');\n\t\t\t\tsidebar.find('.popup-close').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t});\n\t\t\t\t$('button[data-toggle=\"sidebar\"]').removeClass('opened');\n\t\t\t\tthis.opened = false;\n            }\n\t\t},\n\t\tpopup: {\n\t\t\tisOpened: function() {\n\t\t\t\tif(this.opened && this.opened.length)\n\t\t\t\t\treturn true\n\t\t\t\telse\n\t\t\t\t\treturn false\n\t\t\t},\n\t\t\tshow: function(target, orderred) {\n\t\t\t\tif(this.isOpened() && !orderred)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar target = $(target);\n\n\t\t\t\tif(!orderred) {\n\t\t\t\t\tvar zindex = target.css('z-index');\n\t\t\t\t\t$('<div />')\n\t\t\t\t\t\t.appendTo(\"#wrapper\")\n\t\t\t\t\t\t.attr('id', 'popup-bg')\n\t\t\t\t\t\t.addClass((target.hasClass('product-cart') ? 'gray': 'default'))\n\t\t\t\t\t\t.css('z-index', --zindex)\n\t\t\t\t\t\t.fadeIn(200);\n\n\t\t\t\t\t$('body').css('overflow', 'hidden').on('touchmove', function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttarget.trigger('open');\n\t\t\t\t$(document).trigger('popup-show');\n\n\t\t\t\tthis.opened = target;\n\t\t\t\tthis.initialized = true;\n\t\t\t},\n\t\t\thide: function() {\n\t\t\t\tif(this.opened) {\n\t\t\t\t\tthis.opened.trigger('close');\n\t\t\t\t\t$('#popup-bg').fadeOut(200, function() {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t});\n\t\t\t\t\t$('body').css('overflow', 'auto').off('touchmove');\n\t\t\t\t\tdelete this.opened;\n\t\t\t\t\t$(document).trigger('popup-close');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmodal: {\n\t\t\tlastConfirmed: false,\n\t\t\tdialog: function(params) {\n\t\t\t\tthis.lastConfirmed = false;\n\n\t\t\t\tvar _buttons = params.buttons;\n\n\t\t\t\tvar tmpId = 'dialog_' + guid(),\n\t\t\t\t\tbuttonHTML = '',\n\t\t\t\t\ttemplate = '';\n\n\t\t\t\tparams.id = tmpId;\n\n\t\t\t\tif(params.content.indexOf('#') === 0)\n\t\t\t\t\tparams.content = $(params.content).html();\n\n\t\t\t\t$.each(_buttons, function(name,obj){\n\t\t\t\t\tif(!obj.class)\n\t\t\t\t\t\tobj.class = '';\n\n\t\t\t\t\tbuttonHTML += '<button class=\"'+ obj.class +'\">'+ (!obj.title?name:obj.title)+'</button>' + \"\\n\";\n\n\t\t\t\t\tif(!obj.action)\n\t\t\t\t\t\tobj.action = function(){};\n\t\t\t\t});\n\n\t\t\t\tparams.buttons = buttonHTML;\n\n\t\t\t\ttry {\n\t\t\t\t\ttemplate = tmpl(\n\t\t\t\t\t\tdocument.getElementById(\"tmpl-dialog\").innerHTML,\n\t\t\t\t\t\tparams\n\t\t\t\t\t);\n\t\t\t\t\tvar obj = $(template).appendTo('body');\n\n\t\t\t\t\tif(typeof params.afterRender === \"function\")\n\t\t\t\t\t\tparams.afterRender(obj);\n\n\t\t\t\t\tvar buttons = $('#' + tmpId + ' button'),\n\t\t\t\t\t\ti = 0;\n\n\t\t\t\t\t$.each(_buttons, function(name,obj) {\n\t\t\t\t\t\tbuttons.eq(i++).on('click', function(){\n\t\t\t\t\t\t\tif(params.type == 'form') {\n\t\t\t\t\t\t\t\tvar form = $('#' + tmpId).find('form');\n\t\t\t\t\t\t\t\tif(obj.beforeAction && typeof obj.beforeAction === \"function\" ) {\n\t\t\t\t\t\t\t\t\tform.on('submit', function() {\n\t\t\t\t\t\t\t\t\t\tif(obj.beforeAction(form)) {\n\t\t\t\t\t\t\t\t\t\t\tobj.action($(this));\n\t\t\t\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tform.trigger('submit');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tobj.action();\n\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t$.magnificPopup.open({\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\tsrc: '#' + tmpId\n\t\t\t\t\t\t},\n\t\t\t\t\t\tshowCloseBtn: false,\n\t\t\t\t\t\tremovalDelay: 500,\n\t\t\t\t\t\tmainClass: 'mfp-zoom-in',\n\t\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\t\tclose: function() {\n\t\t\t\t\t\t\t\t$('#' + tmpId).remove();\n\t\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\t\tconsole.log('Popup is completely closed');\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttype: 'inline'\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('Template dialog rendering and open failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcontent: {\n\t\t\tinitStyle: function() {\n\t\t\t\t$(\"#content\").css('height', ($w.height() - $('#header').height()) + 'px');\n\t\t\t}\n\t\t},\n\t\tbouquets: {\n\t\t\tdata: [],\n\t\t\tget: function(params) {\n\t\t\t\t$(\"#ajax-loader\").fadeIn(200);\n\t\t\t\tvar defaults = {\n\t\t\t\t\tstart: 0,\n\t\t\t\t\tto: null,\n\t\t\t\t\tlimit: settings.loadBouquets,\n\t\t\t\t\ttype: 'json',\n\t\t\t\t\tafter: function(response) {}\n\t\t\t\t};\n\n\t\t\t\tthis.options = $.extend({}, defaults, params);\n\n\t\t\t\t// Ajax simulation\n\t\t\t\t// example server response = var bouquetsList\n\t\t\t\tvar self = this;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response;\n\t\t\t\t\tapp.bouquets.data = response = bouquetsList;\n\t\t\t\t\t// callback function After\n\t\t\t\t\tself.options.after.call(self, response); // callback\n\t\t\t\t\tapp.bouquets.buildListHtml(bouquetsList);\n                    $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\n\t\t\t\t\t});\n\n\t\t\t\t}, 1000);\n\t\t\t},\n\t\t\tbuildListHtml: function(data) {\n\t\t\t\tvar list = $(\"#bouquet-list\");\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log(\"[FLOWERS] Load flowers\");\n\n\t\t\t\tif(!data || $.isEmptyObject(data)) {\n\t\t\t\t\tvar emptyData = $('<div />').hide().addClass('not-found').html(lang.bouquetNotFound)\n\t\t\t\t\t$('#content').append(emptyData);\n\t\t\t\t\temptyData.fadeIn();\n\t\t\t\t\tconsole.log(\"[FLOWERS] Data is empty\");\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\t$('#content > .not-found').remove();\n\t\t\t\t}\n\t\t\t\tvar lastItem = 0;\n\t\t\t\t$.each(data, function(key, value) {\n\t\t\t\t\tvar item = $('<li />').attr('data-bouquet-id', value.id);\n\n\t\t\t\t\tgetImageLightness(value.imgSrc)\n\t\t\t\t\t\t.done(function(brightness) {\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log(\"[IMAGE => LIGHNESS] Bouquet #\" + value.id );\n\n\t\t\t\t\t\t\tvar lightness = 'dark';\n\n\t\t\t\t\t\t\tif(brightness > settings.imageBouquetsBrightnessThreshold)\n\t\t\t\t\t\t\t\tlightness = 'light';\n\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log(' -> Bouquet #' + value.id + ': ' + value.imgSrc + ': ' + brightness + '(' + lightness + ')');\n\n\t\t\t\t\t\t\tlist.find('li[data-bouquet-id=\"'+ value.id +'\"] > div.bouquet').addClass(lightness);\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\titem.append(app.bouquets.render('tmpl-bouquet-list-item', value));\n\t\t\t\t\titem.append(app.bouquets.render('tmpl-bouquet-list-item-popup', value));\n\t\t\t\t\tlist.append(item);\n\t\t\t\t\tlastItem++;\n\t\t\t\t});\n\t\t\t\tlist.find(\".bouquet\").each(function(i) {\n\t\t\t\t\t$(this).delay(i*100).fadeIn(300, function() {\n\t\t\t\t\t\tif(i==(lastItem-1))\n\t\t\t\t\t\t\t$(document).trigger('raketa.bouquets.loaded');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t},\n\t\t\trender: function(template, data) {\n\t\t\t\tvar item = '';\n\t\t\t\ttry {\n\t\t\t\t\titem = tmpl(\n\t\t\t\t\t\tdocument.getElementById(template).innerHTML,\n\t\t\t\t\t\tdata\n\t\t\t\t\t);\n\t\t\t\t\treturn item;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('Template rendering failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tbasket: {\n\t\t\tstore: [],\n\t\t\tget: function() {\n\n\t\t\t},\n\t\t\tadd: function(e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tvar $this = $(e.currentTarget);\n\n\t\t\t\tvar bid = $this.data('product-id');\n\t\t\t\tvar productObi = $('#bouquet-list li[data-bouquet-id=\"' + bid + '\"]');\n\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[BASKET] Add product with ID #' + bid + ' to basket');\n\n\t\t\t\tif(!productObi.length)\n\t\t\t\t\tthrow Error(\"Невозможно найти DOM объект товара\");\n\n\t\t\t\t$this.addClass('added');\n\t\t\t\t$this.find('span.icon').html(lang.buttonTextInBasket);\n\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[BASKET] [ID #' + bid + '] Get product details');\n\n\t\t\t\tvar product = app.bouquets.data.filter(function (bouquet) { return bouquet.id == bid })[0];\n\t\t\t\tif(product.length == 0)\n\t\t\t\t\tthrow Error(\"Невозможно найти товар c id \" + bid );\n\n\n\t\t\t\tproduct.count = 1;\n\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj.id == product.id) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t{\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('Find in basket product with the same ID');\n\t\t\t\t\tapp.checkout.basket[indexes[0]]['count'] += product.count;\n\t\t\t\t\tproduct.count = app.checkout.basket[indexes[0]]['count'];\n\t\t\t\t} else {\n\t\t\t\t\tapp.checkout.basket.push(product);\n\t\t\t\t}\n\n\t\t\t\tthis.saveBasket();\n\t\t\t\tthis.updateHtml();\n\n\t\t\t\t// Если виджет productcart загружен, есть открытый объект, popup открыт, то проверяем какой шаг открыть\n\t\t\t\tif(app.widgets.productcart\n\t\t\t\t\t&& app.widgets.productcart.openedObj\n\t\t\t\t\t&& app.popup.isOpened())\n\t\t\t\t{\n\t\t\t\t\tif($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t{\n\t\t\t\t\t\t// Не указана дата доставки - открываем шаг 2\n\t\t\t\t\t\tapp.widgets.productcart.step('delivaryDate');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// Указана дата доставки и товар добавлен в корзину\n\t\t\t\t\t\tapp.widgets.productcart.step('orderInfo');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tclear: function() {\n\t\t\t\tif(this.destroyBasket()) {\n\n\n\t\t\t\t} else {\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tdestroyBasket: function() {\n\t\t\t\t// Remove basket from Cookie or session\n\t\t\t\t// Ajax\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tsaveBasket: function() {\n\t\t\t\t// SAVE TO SESSION ? or cookie? Async!\n\t\t\t\tvar data = JSON.stringify(app.checkout.basket); // JSON ???\n\t\t\t\tconsole.log('SAVE data basket');\n\t\t\t\tconsole.log(app.checkout.basket);\n\t\t\t\t// Ajax\n\t\t\t},\n\t\t\tupdateHtml: function() {\n\t\t\t\tvar basketButton = $('#header a.basket');\n\t\t\t\tbasketButton.addClass('notempty').html('<span>' + app.checkout.basket.length + '</span>');\n\t\t\t},\n\t\t\tproductInBasket: function(productId) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t\treturn indexes;\n\t\t\t\telse\n\t\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetProductFromBasket: function(productId) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t\treturn app.checkout.basket[indexes];\n\t\t\t\telse\n\t\t\t\t\treturn false;\n\t\t\t},\n\t\t\tremoveProductFromBasket: function(productId, callback) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log(indexes);\n\t\t\t\t\t\tapp.checkout.basket.splice(indexes[0], 1);\n\t\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Failed to delete product from basket with error: ' + e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcheckout: {\n\t\t\tbasket: [],\n\t\t\tdelivery: {},\n\t\t\tload: function() {\n\t\t\t\tif(this.basket.length && !$.isEmptyObject(this.delivery))\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.getBasketData();\n\t\t\t\tthis.getDeliveryDate();\n\t\t\t},\n\t\t\tgetBasketData: function() {\n\t\t\t\tif(this.basket.length)\n\t\t\t\t\treturn;\n\t\t\t\t// Get basket from cookies or session from server, maybe store in html as JS var\n\t\t\t\t// See app.widget.productcart.hashProcess()\n\t\t\t\t// This deffered object. Ajax must be return \"return ajax({.....}) ...\"\n\t\t\t\t// Ajax Simulation\n\t\t\t\treturn $.Deferred(function() {\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tconsole.log('Get basket from session or cookies');\n\t\t\t\t\tsetTimeout(function() { // <-- example of some async operation\n\t\t\t\t\t\t// Server Response\n\t\t\t\t\t\tvar response = [{\n\t\t\t\t\t\t\tid: 2,\n\t\t\t\t\t\t\tcount: 3,\n\t\t\t\t\t\t\timgSrc: 'img/b2.jpg',\n\t\t\t\t\t\t\tprice: 2800,\n\t\t\t\t\t\t\tname: 'Черничный пирог',\n\t\t\t\t\t\t\tavailableData: 'с 28 октября',\n\t\t\t\t\t\t\tlabel: 'autumn',\n\t\t\t\t\t\t\tsize: {\n\t\t\t\t\t\t\t\tdia: '60 см',\n\t\t\t\t\t\t\t\theight: '30 см'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcomposition: 'Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента',\n\t\t\t\t\t\t\tinfo: 'Диаметр: 60см<br>Высота: 30см<hr><p>Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента</p>'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 3,\n\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t\timgSrc: 'img/b3.jpg',\n\t\t\t\t\t\t\tprice: 1900,\n\t\t\t\t\t\t\tname: 'Свет добра',\n\t\t\t\t\t\t\tavailableData: 'с 14 марта',\n\t\t\t\t\t\t\tsize: {\n\t\t\t\t\t\t\t\tdia: '60 см',\n\t\t\t\t\t\t\t\theight: '30 см'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcomposition: 'Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента',\n\t\t\t\t\t\t\tinfo: 'Диаметр: 60см<br>Высота: 30см<hr><p>Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента</p>'\n\t\t\t\t\t\t}];\n\t\t\t\t\t\tapp.checkout.basket = response;\n\t\t\t\t\t\tapp.basket.updateHtml();\n\t\t\t\t\t\t$(document).trigger('raketa.basket.get-data');\n\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t},500);\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetDeliveryDate: function() {\n\t\t\t\t// Get from cookie\n\t\t\t\tvar date =  Cookies.get('raketa_delivary__date');\n\t\t\t\tvar timeofday =  Cookies.get('raketa_delivary__timeofday');\n\t\t\t\tif(date)\n\t\t\t\t\tthis.delivery.date = date;\n\t\t\t\tif(timeofday)\n\t\t\t\t\tthis.delivery.timeofday = timeofday;\n\n\t\t\t\tif(app.widgets.calendar && app.widgets.calendar.loaded && timeofday && date) {\n\t\t\t\t\tvar obj = $('#widget-calendar');\n\t\t\t\t\tobj.find('.radio-group input[name=\"timeofday\"]:checked').attr('checked', false);\n\t\t\t\t\tobj.find('#tod_' + timeofday).attr('checked', true);\n\t\t\t\t\t$('#delivery-date').datetimepicker({value: date});\n\t\t\t\t\tobj.find('button[type=\"submit\"]').removeAttr('disabled');\n\t\t\t\t\tobj.find('button[data-toggle=\"clear-date\"]').removeAttr('disabled');\n\t\t\t\t\t$('#selectedDate').html(app.widgets.calendar.getDateString());\n\t\t\t\t\t$('button[data-target=\"#widget-calendar\"]').html(app.widgets.calendar.getDateString());\n\t\t\t\t}\n\t\t\t},\n\t\t\tsave: function(callback) {\n\t\t\t\tconsole.log('[FOR DELIVERY] Send form data to server:');\n\n\t\t\t\t//\n\t\t\t\tvar data = {\n\t\t\t\t\tbasket : this.basket,\n\t\t\t\t\tdelivery: this.delivery,\n\t\t\t\t\tfor: this.for\n\t\t\t\t};\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response = {\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tpaymentUrl: 'order_success.html'\n\t\t\t\t\t};\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t},\n\t\twidgets: {\n\t\t\tload: function() {\n\t\t\t\t$.each(this, function(index, value) {\n\t\t\t\t\tif(index !== 'load') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvalue.load();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error('Error loading widget @' + index + ' with error: ' + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tcalendar: {\n\t\t\t\tobj: {},\n\t\t\t\tloaded: false,\n\t\t\t\tcleared: false,\n\t\t\t\topened: false,\n\t\t\t\tposition: {},\n\t\t\t\tsetPosition: function() {\n\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]'); // setting the position relative to the element\n\t\t\t\t\tif(button.length) {\n\t\t\t\t\t\tvar _w = this.obj.width();\n\t\t\t\t\t\tvar _h = this.obj.height() ;\n\t\t\t\t\t\tvar button_offset = button.offset();\n\t\t\t\t\t\tvar right = device.windowWidth - (button_offset.left + button.outerWidth()) - 20;\n\t\t\t\t\t\tthis.obj.css('top', - (_h + 40) + 'px');// box shadow\n\t\t\t\t\t\tthis.obj.css('right', Math.floor(right) + 'px');\n\t\t\t\t\t\tthis.obj.css('height', _h + 'px');\n\t\t\t\t\t\tthis.position.width = _w;\n\t\t\t\t\t\tthis.position.height = _h;\n\t\t\t\t\t\tthis.position.top = - _h;\n\t\t\t\t\t\tthis.position.right = - right;\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tload: function() {\n\t\t\t\t\tthis.obj = $(\"#widget-calendar\");\n\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]');\n\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\t$.datetimepicker.setLocale('ru');\n\t\t\t\t\t$('#delivery-date').datetimepicker({\n\t\t\t\t\t\tformat:'d.m.Y',\n\t\t\t\t\t\tvalue: 0,\n\t\t\t\t\t\ttimepicker:false,\n\t\t\t\t\t\tinline:true,\n\t\t\t\t\t\ttodayButton: false,\n\t\t\t\t\t\tprevButton: false,\n\t\t\t\t\t\tnextButton: false,\n\t\t\t\t\t\tscrollMonth: false,\n\t\t\t\t\t\tdayOfWeekStart: 1,\n\t\t\t\t\t\tyearStart: '2016',\n\t\t\t\t\t\tyearEnd: '2020',\n\t\t\t\t\t\tminDate:new Date(),\n\t\t\t\t\t\tmaxDate: new Date(+new Date + 12096e5), // magic number is 14 days in ms\n\t\t\t\t\t\tonChangeDateTime:function(dp,$input){\n\t\t\t\t\t\t\t_this.obj.find('button[type=\"submit\"]').removeAttr('disabled');\n\t\t\t\t\t\t\t_this.obj.find('input[name=\"timeofday\"]').removeAttr('disabled');\n\t\t\t\t\t\t\tvar widget = $input.parents('.widget');\n\t\t\t\t\t\t\twidget.find('button[data-toggle=\"clear-date\"]').removeAttr('disabled');\n\t\t\t\t\t\t\tvar label = $input.data('targetdate');\n\t\t\t\t\t\t\t$('#'+ label).html(_this.getDateString());\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonGenerate: function(ct) {\n\t\t\t\t\t\t\tvar calendar = $(this).find('.xdsoft_calendar');\n\t\t\t\t\t\t\t//if($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t\t\t//\t$(this).find('.xdsoft_current').removeClass('xdsoft_current');\n\n\t\t\t\t\t\t\t//$.each(calendar.find('tbody tr'), function( index, tr ) {\n\t\t\t\t\t\t\t//\tvar i = 0;\n\t\t\t\t\t\t\t//\tvar $tr = $(tr);\n\t\t\t\t\t\t\t//\t$.each($tr.find('td'), function (index, td) {\n\t\t\t\t\t\t\t//\t\tif($(td).hasClass('xdsoft_disabled'))\n\t\t\t\t\t\t\t//\t\t\ti++;\n\t\t\t\t\t\t\t//\t});\n                            //\n\t\t\t\t\t\t\t//\tif(i == 7)\n\t\t\t\t\t\t\t//\t\t$tr.hide();\n\t\t\t\t\t\t\t//});\n\n\t\t\t\t\t\t\tif(button.length > 0 && (!_this.position.width || !_this.position.height || !_this.position.top || !_this.position.right )) {\n\t\t\t\t\t\t\t\t_this.setPosition();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t//$('#delivery-date').appendDtpicker({\n\t\t\t\t\t//\tinline: true,\n\t\t\t\t\t//\tlocale: \"ru\",\n\t\t\t\t\t//\tfirstDayOfWeek: 1,\n\t\t\t\t\t//\tanimation: false,\n\t\t\t\t\t//\ttodayButton: false,\n\t\t\t\t\t//\tcloseButton: false,\n\t\t\t\t\t//\tdateOnly: true,\n\t\t\t\t\t//\tdateFormat: \"DD.MM.YYYY\",\n\t\t\t\t\t//\tfutureOnly: true,\n\t\t\t\t\t//\tminDate: new Date(),\n\t\t\t\t\t//\tmaxDate: new Date(+new Date + 12096e5),\n\t\t\t\t\t//\tonInit: function() {\n\t\t\t\t\t//\t\tconsole.log('asdasdsa');\n\t\t\t\t\t//\t\tif(button.length > 0 && (!_this.position.width || !_this.position.height || !_this.position.top || !_this.position.right )) {\n\t\t\t\t\t//\t\t\t_this.setPosition();\n\t\t\t\t\t//\t\t}\n                    //\n\t\t\t\t\t//\t\tvar calendar = $('#widget-calendar').find('.datepicker_table');\n\t\t\t\t\t//\t\t//if($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t//\t\t//\t$(this).find('.xdsoft_current').removeClass('xdsoft_current');\n                    //\n\t\t\t\t\t//\t\tvar prevTrMonth = 0;\n\t\t\t\t\t//\t\tvar _prevTrMonth = false;\n\t\t\t\t\t//\t\t$.each(calendar.find('tbody tr'), function( index, tr ) {\n\t\t\t\t\t//\t\t\tvar i = 0;\n\t\t\t\t\t//\t\t\tvar b = 0;\n\t\t\t\t\t//\t\t\tvar $tr = $(tr);\n\t\t\t\t\t//\t\t\tvar trMounth = 12;\n                    //\n\t\t\t\t\t//\t\t\t$.each($tr.find('td'), function (index, td) {\n\t\t\t\t\t//\t\t\t\tvar tdMounth = $(td).data('month');\n\t\t\t\t\t//\t\t\t\t//if(i==0) {\n\t\t\t\t\t//\t\t\t\t//\ttrMounth = tdMounth;\n\t\t\t\t\t//\t\t\t\t//\tb++;\n\t\t\t\t\t//\t\t\t\t//}\n\t\t\t\t\t//\t\t\t\t//else if(i>0 && trMounth == tdMounth){\n\t\t\t\t\t//\t\t\t\t//\tb++;\n\t\t\t\t\t//\t\t\t\t//}\n\t\t\t\t\t//\t\t\t\tif(tdMounth < trMounth)\n\t\t\t\t\t//\t\t\t\t\ttrMounth = tdMounth;\n                    //\n\t\t\t\t\t//\t\t\t\tif($(td).hasClass('out_of_range'))\n\t\t\t\t\t//\t\t\t\t\ti++;\n\t\t\t\t\t//\t\t\t});\n\t\t\t\t\t//\t\t\t//console.log(prevTrMonth == trMounth);\n\t\t\t\t\t//\t\t\tif(index > 0 && prevTrMonth == trMounth) {\n\t\t\t\t\t//\t\t\t\t_prevTrMonth = true;\n\t\t\t\t\t//\t\t\t}\n                    //\n\t\t\t\t\t//\t\t\tprevTrMonth = trMounth;\n                    //\n\t\t\t\t\t//\t\t\tif(b==7 && _prevTrMonth)\n\t\t\t\t\t//\t\t\t\t$tr.prepend('<div class=\"month\">'+trMounth+'</div>');\n\t\t\t\t\t//\t\t\telse\n\t\t\t\t\t//\t\t\t\t$tr.prepend('<div class=\"month\">'+prevTrMonth+'</div>');\n                    //\n\t\t\t\t\t//\t\t\t//if(i == 7)\n\t\t\t\t\t//\t\t\t//\t$tr.hide();\n\t\t\t\t\t//\t\t});\n\t\t\t\t\t//\t},\n\t\t\t\t\t//\tonSelect: function() {\n\t\t\t\t\t//\t\tconsole.log('asdasdsa');\n\t\t\t\t\t//\t\tif(button.length > 0 && (!_this.position.width || !_this.position.height || !_this.position.top || !_this.position.right )) {\n\t\t\t\t\t//\t\t\t_this.setPosition();\n\t\t\t\t\t//\t\t}\n                    //\n\t\t\t\t\t//\t\tvar calendar = $('#widget-calendar').find('.datepicker_table');\n\t\t\t\t\t//\t\t//if($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t//\t\t//\t$(this).find('.xdsoft_current').removeClass('xdsoft_current');\n                    //\n\t\t\t\t\t//\t\tvar prevTrMonth = 0;\n\t\t\t\t\t//\t\tvar _prevTrMonth = false;\n\t\t\t\t\t//\t\t$.each(calendar.find('tbody tr'), function( index, tr ) {\n\t\t\t\t\t//\t\t\tvar i = 0;\n\t\t\t\t\t//\t\t\tvar b = 0;\n\t\t\t\t\t//\t\t\tvar $tr = $(tr);\n\t\t\t\t\t//\t\t\tvar trMounth = 12;\n                    //\n\t\t\t\t\t//\t\t\t$.each($tr.find('td'), function (index, td) {\n\t\t\t\t\t//\t\t\t\tvar tdMounth = $(td).data('month');\n\t\t\t\t\t//\t\t\t\t//if(i==0) {\n\t\t\t\t\t//\t\t\t\t//\ttrMounth = tdMounth;\n\t\t\t\t\t//\t\t\t\t//\tb++;\n\t\t\t\t\t//\t\t\t\t//}\n\t\t\t\t\t//\t\t\t\t//else if(i>0 && trMounth == tdMounth){\n\t\t\t\t\t//\t\t\t\t//\tb++;\n\t\t\t\t\t//\t\t\t\t//}\n\t\t\t\t\t//\t\t\t\tif(tdMounth < trMounth)\n\t\t\t\t\t//\t\t\t\t\ttrMounth = tdMounth;\n                    //\n\t\t\t\t\t//\t\t\t\tif($(td).hasClass('out_of_range'))\n\t\t\t\t\t//\t\t\t\t\ti++;\n\t\t\t\t\t//\t\t\t});\n\t\t\t\t\t//\t\t\t//console.log(prevTrMonth == trMounth);\n\t\t\t\t\t//\t\t\tif(index > 0 && prevTrMonth == trMounth) {\n\t\t\t\t\t//\t\t\t\t_prevTrMonth = true;\n\t\t\t\t\t//\t\t\t}\n                    //\n\t\t\t\t\t//\t\t\tprevTrMonth = trMounth;\n                    //\n\t\t\t\t\t//\t\t\tif(b==7 && _prevTrMonth)\n\t\t\t\t\t//\t\t\t\t$tr.prepend('<div class=\"month\">'+trMounth+'</div>');\n\t\t\t\t\t//\t\t\telse\n\t\t\t\t\t//\t\t\t\t$tr.prepend('<div class=\"month\">'+prevTrMonth+'</div>');\n                    //\n\t\t\t\t\t//\t\t\t//if(i == 7)\n\t\t\t\t\t//\t\t\t//\t$tr.hide();\n\t\t\t\t\t//\t\t});\n\t\t\t\t\t//\t}\n\t\t\t\t\t//});\n\n\t\t\t\t\tthis.obj.find('button[type=\"submit\"]').on('click', function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif(!_this.cleared)\n\t\t\t\t\t\t\t_this.process();\n\t\t\t\t\t\tapp.popup.hide();\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.obj.find('input[name=\"timeofday\"]').on('change', function() {\n\t\t\t\t\t\t$('#selectedDate').html(_this.getDateString());\n\t\t\t\t\t\tif(app.checkout.delivery !== undefined)\n\t\t\t\t\t\t\tbutton.html(_this.getDateString());\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tbutton.html(lang.DeliveryDate);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.obj.find('button[data-toggle=\"clear-date\"]').on('click', function(e) {\n\t\t\t\t\t\t_this.obj.find('#delivery-date').val(new Date());\n\t\t\t\t\t\t_this.obj.find('.xdsoft_current').removeClass('xdsoft_current');\n\t\t\t\t\t\t$('#delivery-date').datetimepicker({value: new Date()});\n\t\t\t\t\t\t$('#' + _this.obj.find('#delivery-date').data('targetdate')).html(lang.DeliveryDate);\n\t\t\t\t\t\tbutton.html(lang.DeliveryDate);\n\t\t\t\t\t\t$(this).attr('disabled', 'disabled');\n\t\t\t\t\t\t_this.obj.find('button[type=\"submit\"]').attr('disabled', 'disabled');\n\t\t\t\t\t\t_this.obj.find('input[name=\"timeofday\"]:checked').attr('checked', false);\n\t\t\t\t\t\t_this.obj.find('input[name=\"timeofday\"]').attr('disabled', 'disabled');\n\t\t\t\t\t\t_this.cleared = true;\n\t\t\t\t\t\tdelete app.checkout.delivery;\n\t\t\t\t\t\tCookies.remove('raketa_delivary__date', { path: '/' });\n\t\t\t\t\t\tCookies.remove('raketa_delivary__timeofday', { path: '/' });\n\t\t\t\t\t\tapp.popup.hide();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('open', \"#widget-calendar\", function() {\n\t\t\t\t\t\t_this.open();\n\t\t\t\t\t});\n\t\t\t\t\t$(document).on('close', \"#widget-calendar\", function() {\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t\tbutton\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.loaded = true;\n\t\t\t\t},\n\t\t\t\tgetDateString: function() {\n\t\t\t\t\tvar _str = lang.DeliveryFormattedString;\n\t\t\t\t\tvar timeofday = this.obj.find('input[name=\"timeofday\"]:checked').val();\n\t\t\t\t\tvar date = this.obj.find('input[name=\"date\"]').val();\n\t\t\t\t\tif(date)\n\t\t\t\t\t\tdate = moment(date, 'DD.MM.YYYY').format('D MMMM');\n\t\t\t\t\telse\n\t\t\t\t\t\tdate = '';\n\t\t\t\t\t_str = String.template(_str, (lang[timeofday] ? lang[timeofday] : ''), date);\n\t\t\t\t\t_str = _str.toLowerCase().capitalizeFirstLetter();\n\t\t\t\t\treturn _str;\n\t\t\t\t},\n\t\t\t\topen: function() {\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Open widget @calendar');\n\n\t\t\t\t\tif($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t\tthis.obj.find('.xdsoft_current').removeClass('xdsoft_current');\n\n\n\t\t\t\t\tthis.obj.addClass('animation');\n\t\t\t\t\tthis.obj.transition({ y: Math.floor(this.obj.height() + 40) }); //box shadow\n\n\t\t\t\t\tvar _this = this;\n\t\t\t\t\tthis.obj.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {\n\t\t\t\t\t\t_this.obj.removeClass('animation').addClass('opened');\n\t\t\t\t\t});\n\n\n\t\t\t\t\t_this.cleared = false;\n\t\t\t\t\t_this.opened = true;\n\t\t\t\t},\n\t\t\t\tclose: function() {\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Close widget @calendar');\n\n\n\t\t\t\t\tthis.obj.removeClass('opened').addClass('animation');\n\t\t\t\t\tthis.obj.transition({ y: this.position.top, complete: function() {\n\t\t\t\t\t\tthis.opened = false;\n\t\t\t\t\t}});\n\n\t\t\t\t},\n\t\t\t\tprocess: function() {\n\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]');\n\t\t\t\t\tvar data = this.obj.find('form').serializeObject();\n\t\t\t\t\tapp.checkout.delivery = data;\n\t\t\t\t\tif(app.checkout.delivery !== undefined)\n\t\t\t\t\t\tbutton.html(this.getDateString());\n\t\t\t\t\telse\n\t\t\t\t\t\tbutton.html(lang.DeliveryDate);\n\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t// Save to cookie or maybe ajax?\n\t\t\t\t\tCookies.set('raketa_delivary__date', data.date, { expires: 1, path: '/' });\n\t\t\t\t\tCookies.set('raketa_delivary__timeofday', data.timeofday, { expires: 1, path: '/' });\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tproductcart: {\n\t\t\t\tloaded: false,\n\t\t\t\tcleared: false,\n\t\t\t\tstartPosition: {},\n\t\t\t\tstartTitle: '',\n\t\t\t\thashProcess: function() {\n\t\t\t\t\t//$('#bouquet-list').on('raketa.bouquets.loaded raketa.basket.get', function() {\n\t\t\t\t\tvar bouquets = $.Deferred(function() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tvar basket = $.Deferred(function() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t$(document).on('raketa.basket.get-data', function() {\n\t\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t$.when(basket, bouquets).then(function() {\n\t\t\t\t\t\tvar hash = Hash.get();\n\t\t\t\t\t\tvar obj;\n\t\t\t\t\t\tif (hash.anchor) {\n\t\t\t\t\t\t\twindow.location.hash = hash.anchor;\n\t\t\t\t\t\t} else if (hash.bouquet) {\n\t\t\t\t\t\t\tobj = $('#bouquet-list li[data-bouquet-id=\"' + hash.bouquet + '\"] > div[data-toggle=\"popup\"]')\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(obj)\n\t\t\t\t\t\t\tobj.trigger('click');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tload: function() {\n\t\t\t\t\tthis.obj = $('.product-cart');\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\tthis.hashProcess();\n\n\t\t\t\t\t$(document).on('open', '.product-cart', function(e) {\n\t\t\t\t\t\t_this.open(e);\n\t\t\t\t\t});\n\t\t\t\t\t$(document).on('close', '.product-cart', function() {\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('click', '.product-cart button[data-toggle=\"show-product-info\"]', function() {\n\t\t\t\t\t\tvar id = $(this).data('product-id');\n\t\t\t\t\t\t$(this).toggleClass('active');\n\t\t\t\t\t\t$('#popup-product-' + id + ' .product-info').fadeToggle(300, function() {\n\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$(document).on('click', '.product-cart button.direction', function(e) {\n\t\t\t\t\t\tvar direction = $(this).data('direction');\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart - change current cart (' + direction + ')');\n\n\t\t\t\t\t\tvar currentIndex = index = _this.openedObj.closest('li[data-bouquet-id]').index();\n\t\t\t\t\t\tconsole.log('Opened index element ' + index);\n\n\t\t\t\t\t\tswitch (direction) {\n\t\t\t\t\t\t\tcase 'prev':\n\t\t\t\t\t\t\t\tindex = (index - 1 < 0 ? $('#bouquet-list li:last-child').index() : index - 1);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'next':\n\t\t\t\t\t\t\t\tindex = (index + 1 > $('#bouquet-list li').length - 1 ? 0 : index + 1);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t\tvar indexed = $('#bouquet-list li').eq(index);\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tindexed.find('div[data-toggle=\"popup\"]').data('order', true).trigger('click');\n\t\t\t\t\t\t}, 300);\n\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\t\tvar gallery = $('.product-cart').find('.gallery-list');\n\t\t\t\t\t\tvar w = $('.product-cart').width();\n\t\t\t\t\t\tvar h = $('.product-cart').height();\n\t\t\t\t\t\tif(gallery.length > 0) {\n\t\t\t\t\t\t\tgallery.css('height', h);\n\t\t\t\t\t\t\tgallery.find('.owl-lazy').css('height', h);\n\t\t\t\t\t\t\tgallery.find('.owl-lazy').css('width', w/2);\n\t\t\t\t\t\t\tgallery.find('.owl-height').css('height', $('.product-cart').height());\n\t\t\t\t\t\t\tgallery.css('width', w/2);\n\n\t\t\t\t\t\t\tgallery.magnificPopup({\n\t\t\t\t\t\t\t\tdelegate: 'a.owl-lazy',\n\t\t\t\t\t\t\t\ttype:'image',\n\t\t\t\t\t\t\t\tmainClass: 'mfp-no-margins mfp-zoom-in',\n\t\t\t\t\t\t\t\tcloseOnContentClick: true,\n\t\t\t\t\t\t\t\tcloseBtnInside: false,\n\t\t\t\t\t\t\t\tfixedContentPos: true,\n\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\tverticalFit: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\titems: 1,\n\t\t\t\t\t\t\t\tmargin: 0,\n\t\t\t\t\t\t\t\tlazyLoad:true,\n\t\t\t\t\t\t\t\tloop:true,\n\t\t\t\t\t\t\t\tautoplay: true,\n\t\t\t\t\t\t\t\tautoplayTimeout: 5000,\n\t\t\t\t\t\t\t\tautoplayHoverPause: true\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart Found gallery in product cart');\n\n\t\t\t\t\t\t\tgallery.on('initialized.owl.carousel', function(event) {\n\t\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tgallery.owlCarousel(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.loaded = true;\n\t\t\t\t},\n\t\t\t\topen: function(e) {\n\t\t\t\t\tvar obj = $(e.target);\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Open widget @productcart with id #' + obj.attr('id'));\n\n\t\t\t\t\t$('#bouquet-list li[data-bouquet-id=\"' + obj.data('product-id') + '\"] > div[data-toggle=\"popup\"]').data('order', false);\n\n\t\t\t\t\t//var height = ($w.height() - $('#header').height()) - 50;\n\t\t\t\t\tvar height = obj.height();\n\t\t\t\t\tvar width = obj.width();\n\t\t\t\t\tobj.css('top', -height).css('visibility', 'visible');\n\t\t\t\t\tthis.startPosition.top = -height;\n\n\t\t\t\t\t// Если этот товар в корзине и указана дата доставки, то шаг 3\n\t\t\t\t\tvar index;\n\t\t\t\t\tif(app.basket.productInBasket(obj.data('product-id')) && !$.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t{\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step 3');\n\n\t\t\t\t\t\tthis.loadStep3(obj, app.basket.productInBasket(obj.data('product-id')));\n\t\t\t\t\t}\n\t\t\t\t\telse if(app.basket.productInBasket(obj.data('product-id')) && $.isEmptyObject(app.checkout.delivery)) // Товар в корзине и дата доставки не указана - шаг 2\n\t\t\t\t\t{\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step 2');\n\t\t\t\t\t\tobj.find('.step').hide().removeClass('active');\n\t\t\t\t\t\tobj.find('.step2').addClass('active').show();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar width = obj.outerWidth();\n\t\t\t\t\tobj.css('margin-left', Math.ceil(-width/2));\n\n\t\t\t\t\tobj.addClass('transition');\n\n\t\t\t\t\tif(device.type == 'desktop' && (device.subtype == 'fullhd' || device.subtype == 'hd'))\n\t\t\t\t\t\tobj.transition({ y: Math.floor(device.windowHeight - (device.windowHeight - height)/2) });\n\t\t\t\t\telse\n\t\t\t\t\t\tobj.transition({ y: Math.floor(height + $('#header').height())});\n\n\t\t\t\t\tobj.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {\n\t\t\t\t\t\tobj.removeClass('transition').addClass('opened');\n\t\t\t\t\t\tobj.find('.bottom button:first-child').focus();\n\t\t\t\t\t});\n\t\t\t\t\t// History add\n\t\t\t\t\tthis.startTitle = document.title;\n\t\t\t\t\tdocument.title = lang.bouquet + ' ' + obj.data('title');\n\t\t\t\t\tHash.add('bouquet', obj.data('product-id'));\n\t\t\t\t\tthis.openedObj = obj;\n\t\t\t\t\tthis.cleared = false;\n\t\t\t\t},\n\t\t\t\tclose: function() {\n\t\t\t\t\tvar obj = this.openedObj;\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Close widget @productcart');\n\n\t\t\t\t\tobj.removeClass('opened').addClass('animation');\n\t\t\t\t\tobj.transition({ y: this.startPosition.top });\n\t\t\t\t\twindow.location.hash = '';\n\t\t\t\t\thistory.pushState('', document.title, window.location.pathname);\n\t\t\t\t\tdocument.title = this.startTitle;\n\t\t\t\t\tdelete this.openedObj;\n\t\t\t\t},\n\t\t\t\tstep: function(step) {\n\t\t\t\t\tif(!step)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step - ' + step);\n\n\t\t\t\t\tvar obj = this.openedObj;\n\t\t\t\t\tswitch (step) {\n\t\t\t\t\t\tcase 'delivaryDate':\n\t\t\t\t\t\t\tconsole.log(obj);\n\t\t\t\t\t\t\tobj.find('.step.active').fadeOut('fast', function() {\n\t\t\t\t\t\t\t\tobj.find('.step.step2').fadeIn('fast');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'orderInfo':\n\t\t\t\t\t\t\tobj.find('.step.active').fadeOut('fast', function() {\n\t\t\t\t\t\t\t\tobj.find('.step.step3').fadeIn('fast');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadStep3: function(obj, index) {\n\t\t\t\t\tobj.find('.step').hide().removeClass('active');\n\t\t\t\t\tobj.find('.step3').addClass('active').show();\n\t\t\t\t\tconsole.log(index);\n\t\t\t\t\tvar inBasket = app.basket.getProductFromBasket(obj.data('product-id'));\n\n\t\t\t\t\tvar _str = lang.bouquetInBasketPopupCart;\n\t\t\t\t\tvar _str2 = inBasket.count + ' ' + lang.bouquet + getNumEnding(inBasket.count, ['', 'а', 'ов']);\n\n\t\t\t\t\tvar price = inBasket.count * inBasket.price;\n\t\t\t\t\tif(price > 10000)\n\t\t\t\t\t\tprice = price.format(0, 3, ' ', '.');\n\n\t\t\t\t\t_str = String.template(_str, _str2.toLowerCase(), price + lang.currencySymbol);\n\n\t\t\t\t\t$('#in-basket-product-' + obj.data('product-id')).html('<span class=\"icon-basket\"></span> ' + _str);\n\t\t\t\t\t$('#p' + obj.data('product-id') + '-count').val(inBasket.count);\n\n\t\t\t\t\t$('[data-trigger=\"spinner\"]')\n\t\t\t\t\t\t.spinner('max', 99)\n\t\t\t\t\t\t.spinner('changing', function(e, newVal, oldVal) {\n\t\t\t\t\t\t\tvar name = $(this).attr('name');\n\n\t\t\t\t\t\t\tif(newVal < 0)\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tapp.checkout.basket[index[0]].count = newVal;\n\n\t\t\t\t\t\t\tvar _str = lang.bouquetInBasketPopupCart;\n\t\t\t\t\t\t\tvar _str2 = newVal + ' ' + lang.bouquet + getNumEnding(inBasket.count, ['', 'а', 'ов']);\n\n\t\t\t\t\t\t\tvar price = newVal * inBasket.price;\n\t\t\t\t\t\t\tif(price > 10000)\n\t\t\t\t\t\t\t\tprice = price.format(0, 3, ' ', '.');\n\n\t\t\t\t\t\t\t_str = String.template(_str, _str2.toLowerCase(), price + lang.currencySymbol);\n\n\t\t\t\t\t\t\t$('#in-basket-product-' + obj.data('product-id')).html('<span class=\"icon-basket\"></span> ' + _str);\n\n\t\t\t\t\t\t\tapp.basket.saveBasket();\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlayout: {\n\t\t\tcurrentLayout: {},\n\t\t\tinitStyle: function() {\n\t\t\t\tif($.isEmptyObject(this.currentLayout)) return;\n\n\t\t\t\tif(settings.env == 'dev') console.log('Set layout('+this.currentLayout.name+') template style');\n\t\t\t\tthis.setStyleLayout(this.currentLayout.name, this.currentLayout.container);\n\t\t\t},\n\t\t\tinit: function(container, callback) {\n\t\t\t\tif(!container)\n\t\t\t\t\tcontainer = $('div[data-layout]');\n\n\t\t\t\tvar layout = container.data('layout');\n\n\t\t\t\tif (!layout){\n\t\t\t\t\tconsole.error('Layout attribute not found');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.currentLayout.name = layout;\n\t\t\t\tthis.currentLayout.container = container;\n\t\t\t\tthis.currentLayout.callback = callback;\n\t\t\t\tif(settings.env == 'dev') console.log('Initialize layout('+layout+')');\n\t\t\t\tthis.loadLayout(layout, container, callback);\n\t\t\t},\n\t\t\tsetStyleLayout: function(layout, container) {\n\t\t\t\tvar currentH = container.outerHeight();\n\t\t\t\tvar newH = ($w.height() - $('#header').height()) - 50;\n\t\t\t\tcontainer.css('height', newH + 'px');\n\t\t\t},\n\t\t\tloadLayout: function(layout, container, callback) {\n\t\t\t\tswitch (layout) {\n\t\t\t\t\tcase 'devided-slider':\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\n\t\t\t\t\t\tvar w = $(\"#content\").width();\n\t\t\t\t\t\tvar owl = $('#slider-content');\n\t\t\t\t\t\towl.css('width', w/2);\n\n\t\t\t\t\t\towl.on('initialized.owl.carousel', function(event) {\n\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\t\t\t\t\t\t\tvar hash = current.data('hash');\n\t\t\t\t\t\t\tcontainer.find('.layout-menu li.active').removeClass('active');\n\t\t\t\t\t\t\tcontainer.find('.layout-menu a[href=\"#' + hash + '\"]').parent().addClass('active');\n\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[OWL Carousel] Event initialized.owl.carousel');\n\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom').hide();\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom[data-to-slide=\"'+ hash +'\"]').fadeIn(200);\n\t\t\t\t\t\t});\n\t\t\t\t\t\towl.on('changed.owl.carousel', function(event) {\n\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\t\t\t\t\t\t\tvar hash = current.data('hash');\n\t\t\t\t\t\t\tcontainer.find('.layout-menu li.active').removeClass('active');\n\t\t\t\t\t\t\tcontainer.find('.layout-menu a[href=\"#' + hash + '\"]').parent().addClass('active');\n\t\t\t\t\t\t\tif(hash)\n\t\t\t\t\t\t\t\twindow.location.hash = hash;\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[OWL Carousel] Event changed.owl.carousel');\n\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom').hide();\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom[data-to-slide=\"'+ hash +'\"]').fadeIn(300);\n\t\t\t\t\t\t});\n\t\t\t\t\t\towl.owlCarousel({\n\t\t\t\t\t\t\tautoHeight: true,\n\t\t\t\t\t\t\titems:1,\n\t\t\t\t\t\t\tURLhashListener:true,\n\t\t\t\t\t\t\tstartPosition: 'URLHash',\n\t\t\t\t\t\t\tanimateOut: 'fadeOut',\n\t\t\t\t\t\t\tsmartSpeed:450,\n\t\t\t\t\t\t\tanimateIn: 'fadeIn',\n\t\t\t\t\t\t\tafterInit: function(elem){\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(\"#content ul.layout-menu a\").on('click', function(e) {\n\t\t\t\t\t\t\tif(!$(this).parent().hasClass('active')) {\n\t\t\t\t\t\t\t\t$(this).parents('.layout-menu').find('li.active').removeClass('active');\n\t\t\t\t\t\t\t\t$(this).parent().addClass('active');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\towl.find('button,input,select').addClass('not-draggable').on(\"touchstart mousedown\", function(e) {\n\t\t\t\t\t\t\t// Prevent carousel swipe\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\towl.parent().find('button[type=\"submit\"]').on('click', function() {\n\t\t\t\t\t\t\tvar slide = owl.find('.item[data-hash=\"' + $(this).data('to-slide') +'\"]');\n\t\t\t\t\t\t\tslide.find('form').trigger('submit');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'default':\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'devided':\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif(typeof callback === 'function')\n\t\t\t\t\tcallback(container);\n\t\t\t}\n\t\t},\n\t\tcallback: {\n\t\t\torder: function(form) {\n\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t\t\t\tvar data = form.serializeArray();\n\t\t\t\tajaxloader.local({\n\t\t\t\t\telement: form,\n\t\t\t\t\tto: '.item[data-hash=\"callback\"]',\n\t\t\t\t\ttitle: lang.processPhoneCheck\n\t\t\t\t});\n\t\t\t\tthis.process(data, function(response) {\n\t\t\t\t\tajaxloader.finish();\n\t\t\t\t\tform.hide();\n\t\t\t\t\t$('#slider-content .owl-height').css('height', $('#support').height());\n\t\t\t\t\t$('#callback-order-success').css('height', $('#support').height()).fadeIn(200);\n\n\t\t\t\t\tcountDown({\n\t\t\t\t\t\ttime: 10, // in seconds\n\t\t\t\t\t\tdisplay:  $('#callback-order-success .timer'),\n\t\t\t\t\t\tafterFinish: function() {\n\t\t\t\t\t\t\t$('#callback-order-success').fadeOut(200, function() {\n\t\t\t\t\t\t\t\tform[0].reset();\n\t\t\t\t\t\t\t\tform.fadeIn(200);\n\t\t\t\t\t\t\t\t$('#slider-content .owl-height').css('height', form.outerHeight());\n\t\t\t\t\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').show();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t},\n\t\t\tprocess: function(data, callback) {\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\n\t\t\t\t\tvar response = [];\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t},\n\t\tauth: {\n\t\t\tinit: function() {\n\t\t\t\tvar auth_form = $('#auth-form');\n\t\t\t\tthis.validateForm(auth_form);\n\t\t\t\tauth_form.find('input').on('keyup', function() {\n\t\t\t\t\t$(this).removeClass('error').parent().removeClass('has-error');\n\t\t\t\t\t$(this).next('i.fa').remove();\n\t\t\t\t});\n\n\t\t\t\tauth_form.closest('.content-panel').find('.bottom button[type=\"submit\"]').on('click', function(e) {\n\t\t\t\t\tvar targetForm = $(this).data('to-form');\n\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('Click bottom button with target form ' + targetForm);\n\t\t\t\t\tif(!targetForm || $(targetForm).length == 0)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tvar form = $(targetForm);\n\t\t\t\t\tform.trigger('submit');\n\t\t\t\t\tform.closest('.static').find('.form-status').remove();\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t},\n\t\t\tvalidateForm: function(form) {\n\t\t\t\tvar _this = this;\n\t\t\t\tjQuery.validator.addMethod(\n\t\t\t\t\t'regexp',\n\t\t\t\t\tfunction(value, element, regexp) {\n\t\t\t\t\t\tvar re = new RegExp(regexp);\n\t\t\t\t\t\treturn this.optional(element) || re.test(value);\n\t\t\t\t\t},\n\t\t\t\t\t\"Please check your input.\"\n\t\t\t\t);\n\t\t\t\tform.validate({\n\t\t\t\t\tonfocusout: false,\n\t\t\t\t\tonkeyup: false,\n\t\t\t\t\tonclick: false,\n\t\t\t\t\tfocusInvalid: false,\n\t\t\t\t\tsubmitHandler: function() {\n\t\t\t\t\t\t_this.authorizationSubmitHandler(form);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\trules: {\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tminlength: 3,\n\t\t\t\t\t\t\tregexp: '^[А-яA-zёЁ\\s-]{3,}$'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tphone: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tminlength: 5,\n\t\t\t\t\t\t\tregexp: '^\\\\+[0-9\\\\+\\\\-()\\s]{14,16}$'\n\t\t\t\t\t\t},\n\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\temail: true\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmessages:{\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\trequired: \"Поле обязательно для заполнения\",\n\t\t\t\t\t\t\tminlength: \"Имя не может быть менее 3 символов\",\n\t\t\t\t\t\t\tregexp: \"Имя указано не верно\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tphone: {\n\t\t\t\t\t\t\trequired: \"Поле обязательно для заполнения\",\n\t\t\t\t\t\t\tminlength: \"Телефон не может сожержать менее 5 символов\",\n\t\t\t\t\t\t\tregexp: \"Телефон указан не верно\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\temail: \"Введите корректный адрес\"\n\t\t\t\t\t},\n\t\t\t\t\tshowErrors: function(errorMap, errorList) {\n\t\t\t\t\t\tif (errorList.length < 1) {\n\t\t\t\t\t\t\tform.removeClass('has-error');\n\t\t\t\t\t\t\tform.find('input').removeClass('error').parent().removeClass('has-error');\n\t\t\t\t\t\t\tform.find('i.fa').remove();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$.each(errorList, function(index, error) {\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').next('i.fa').remove();\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').addClass('error').parent().addClass('has-error');\n\t\t\t\t\t\t\tform.addClass('has-error');\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').after('<i class=\"fa fa-exclamation-triangle tooltip\" data-toggle=\"tooltip\" title=\"' + error.message + '\"></i>');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tauthorizationProcess: function(data,callback) {\n\t\t\t\tconsole.log('[AUTHORIZATION] Send form data to server:');\n\t\t\t\tconsole.log(data);\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response = {\n\t\t\t\t\t\tmessage: 'Неверно указан номер',\n\t\t\t\t\t\tstatus: false, // example phone error\n\t\t\t\t\t};\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 20000);\n\t\t\t},\n\t\t\tauthorizationSubmitHandler: function(form) {\n\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t\t\t\tvar data = form.serializeArray();\n\t\t\t\tvar step = form.closest('.static');\n\t\t\t\tform.css('opacity', 0);\n\t\t\t\tajaxloader.local({\n\t\t\t\t\telement: form,\n\t\t\t\t\tto: '.static',\n\t\t\t\t\ttitle: lang.processAuthorization\n\t\t\t\t});\n\t\t\t\tthis.authorizationProcess(data, function(response) {\n\t\t\t\t\tif(response.status != true)\n\t\t\t\t\t{\n\n\t\t\t\t\t\tvar message = $('<div />').addClass('table form-status')\n\t\t\t\t\t\t\t.css('width', step.outerWidth())\n\t\t\t\t\t\t\t.css('height', step.outerHeight())\n\t\t\t\t\t\t\t.append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t\t\t\t\t\tstep.prepend(message);\n\n\t\t\t\t\t\tajaxloader.finish();\n\n\t\t\t\t\t\tform.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tmessage.css('background-color', 'transparent');\n\t\t\t\t\t\t\tmessage.find('span').addClass('inline');\n\t\t\t\t\t\t\tmessage.transition({\n\t\t\t\t\t\t\t\ty: -250,\n\t\t\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\t\t\tmessage.css('z-index', 0);\n\t\t\t\t\t\t\t\t\tform.fadeTo(200, 1);\n\t\t\t\t\t\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 700)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.location = \"/\";\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t}\n\t};\n\n\n\tajaxloader = {\n\t\tlocal: function(params) {\n\t\t\tif(!params.element)\n\t\t\t\treturn;\n\n\t\t\tvar element = params.element;\n\n\n\t\t\tvar ajaxloader = $('<div />').addClass('ajax-loader-local')\n\t\t\t\t.css('width', element.outerWidth())\n\t\t\t\t.css('height', element.outerHeight());\n\n\t\t\tif(params.title && params.title.length > 0)\n\t\t\t{\n\t\t\t\tvar title = $('<div />').addClass('title').html(params.title);\n\t\t\t\tajaxloader.append(title);\n\t\t\t}\n\n\t\t\tif(params.image && params.image.length > 0)\n\t\t\t{\n\t\t\t\tvar image = $('<img />').addClass('image')\n\t\t\t\t\t.attr('src', params.image);\n\t\t\t\tajaxloader.append(image);\n\t\t\t} else {\n\t\t\t\tvar icon = $('<div />').addClass('icon')\n\t\t\t\t\t.attr('src', params.image);\n\t\t\t\tajaxloader.append(icon);\n\t\t\t}\n\n\t\t\tif(params.to && params.to != '') {\n\t\t\t\tvar to = element.closest(params.to);\n\t\t\t\tajaxloader.css('width', to.outerWidth())\n\t\t\t\t\t.css('height', to.outerHeight());\n\t\t\t\tto.prepend(ajaxloader);\n\t\t\t} else\n\t\t\t\telement.prepend(ajaxloader);\n\t\t\tajaxloader.fadeIn(200);\n\t\t\tthis.ajaxloader = ajaxloader;\n\t\t},\n\t\tfinish: function() {\n\t\t\tif(!this.ajaxloader)\n\t\t\t\treturn\n\t\t\tvar _this = this;\n\t\t\tthis.ajaxloader.fadeOut(200, function() {\n\t\t\t\t_this.ajaxloader.remove();\n\t\t\t});\n\n\t\t}\n\t};\n\n\tapp.profile = {\n\t    init: function() {\n\t        this.bind();\n\t    },\n\t    bind: function() {\n\t        $('#edit-personal-data').submit(function(e) {\n\t            console.log(e);\n\t            e.preventDefault();\n\t            app.profile.personal.save($(this));\n\t            return false;\n\t        });\n\t\n\t        $('#edit-personal-data input[type=\"text\"]').on('keydown', function(e) {\n\t            $('button[data-to-slide=\"personal\"]').removeAttr('disabled');\n\t            var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t            bottom.find('.button-group').removeClass('one-button').addClass('two-button');\n\t            bottom.find('button.btn-dismiss').removeClass('hide');\n\t        });\n\t\n\t        $(document).on('click', 'button[type=\"dismiss\"]', function(e) {\n\t            e.preventDefault();\n\t            var form = $('#edit-personal-data');\n\t            form[0].reset();\n\t            var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t            bottom.find('.button-group').removeClass('two-button').addClass('one-button');\n\t            bottom.find('button.btn-dismiss').addClass('hide');\n\t            var input = form.find('input[name=\"phone\"]');\n\t            input.attr('disabled', 'disabled');\n\t            input.parent().addClass('disabled');\n\t            input.parents('.form-group').find('button.edit-phone').hide();\n\t        });\n\t\n\t        $(document).on('click', 'button[type=\"delete-card\"]', function(e) {\n\t            e.preventDefault();\n\t            var cardId = $(this).parents('li[data-card-id]').data('card-id');\n\t            var cartName = $(this).parents('div.creditcard').find('.creditcard-name').html();\n\t            var str = String.template(lang.creditcardquestdelete, cartName);\n\t            if(cardId) {\n\t                app.modal.dialog({\n\t                    content: str,\n\t                    buttons: {\n\t                        yes: {\n\t                            title: lang.dialogDeleteButton,\n\t                            class: 'delete',\n\t                            action: function(){\n\t                                if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                                app.profile.creditcard.del(cardId);\n\t                            }\n\t                        },\n\t                        no: {\n\t                            title: lang.dialogDismissButton,\n\t                            class: 'dismiss',\n\t                            action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                        }\n\t                    }\n\t                });\n\t            } else {\n\t                console.error('Not found creditcard id');\n\t            }\n\t        });\n\t        $('button[type=\"add-card\"]').on('click', function(e) {\n\t            e.preventDefault();\n\t            var title = ($(this).data('title')?$(this).data('title'):'');\n\t            var content = ($(this).data('content')?$(this).data('content'):'');\n\t            app.modal.dialog({\n\t                title: title,\n\t                content: content,\n\t                type: 'form',\n\t                popupClass: 'add-card-popup',\n\t                afterRender: function(obj) {\n\t                    obj.find('#cardnumber').validateCreditCard(function(result) {\n\t                        $(this).removeClass();\n\t                        if (result.card_type == null)\n\t                            return;\n\t\n\t                        $(this).addClass(result.card_type.name);\n\t                        $(this).closest('form').find('input[name=\"cardtype\"]').val(result.card_type.name);\n\t\n\t                        if (result.valid) {\n\t                            return $(this).addClass('valid');\n\t                        } else {\n\t                            return $(this).removeClass('valid');\n\t                        }\n\t                    }, {\n\t                        accept: ['visa', 'visa_electron', 'mastercard', 'maestro']\n\t                    });\n\t                    obj.find('#cardholder').keypress(function(event){\n\t                        if(!((event.which >= 65 && event.which  <= 90) ||\n\t                            (event.which >= 97 && event.which <= 122) || event.which == 32)) {\n\t                            event.preventDefault();\n\t                        }\n\t                    });\n\t                },\n\t                buttons: {\n\t                    yes: {\n\t                        title: 'Добавить',\n\t                        class: 'edit',\n\t                        beforeAction: function(form) { // jQuery object\n\t                            // validate\n\t                            var valid = true;\n\t                            var data = form.serializeArray();\n\t                            form.find('input').each(function() {\n\t                                if(!$(this).val()) {\n\t                                    valid = false;\n\t                                    console.log('Поле ' + $(this).attr('name') + ' не заполнено');\n\t                                }\n\t                            });\n\t\n\t                            return valid;\n\t                        },\n\t                        action: function(form){ // jQuery object\n\t                            if(settings.env == 'dev') console.log('[Dialog (add credit card)] Confirmed');\n\t                            app.profile.creditcard.add(form);\n\t                        }\n\t                    },\n\t                    no: {\n\t                        title: lang.dialogDismissButton,\n\t                        class: 'dismiss',\n\t                        action: function(){ if(settings.env == 'dev') console.log('[Dialog (add credit card)] Not confirmed');  }\n\t                    }\n\t                }\n\t            });\n\t        });\n\t\n\t        $(document).on('click', 'button[type=\"delete-address\"]', function(e) {\n\t            e.preventDefault();\n\t            var addressId = $(this).parents('li[data-address-id]').data('address-id');\n\t            var address = $(this).prev().html();\n\t            var str = String.template(lang.deliveryaddressrequestdelete, address);\n\t            if(addressId) {\n\t                app.modal.dialog({\n\t                    content: str,\n\t                    buttons: {\n\t                        yes: {\n\t                            title: lang.dialogDeleteButton,\n\t                            class: 'delete',\n\t                            action: function(){\n\t                                if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                                app.profile.delivery.del(addressId);\n\t                            }\n\t                        },\n\t                        no: {\n\t                            title: lang.dialogDismissButton,\n\t                            class: 'dismiss',\n\t                            action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                        }\n\t                    }\n\t                });\n\t            } else {\n\t                console.error('Not found delivery address id');\n\t            }\n\t        });\n\t\n\t        $('button[data-toggle=\"edit-phone\"]').on('click', function() {\n\t            app.modal.dialog({\n\t                content: lang.dialogChangePhoneAlert,\n\t                buttons: {\n\t                    yes: {\n\t                        title: lang.dialogEditButton,\n\t                        class: 'edit',\n\t                        action: function(){\n\t                            if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                            var input = $('#slider-content input[name=\"phone\"]');\n\t                            input.removeAttr('disabled');\n\t                            input.parent().removeClass('disabled');\n\t                            input.parents('.form-group').find('button.edit-phone').hide();\n\t\n\t                        }\n\t                    },\n\t                    no: {\n\t                        title: lang.dialogDismissButton,\n\t                        class: 'dismiss',\n\t                        action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                    }\n\t                }\n\t            });\n\t        });\n\t\n\t        $('.creditcard .tooltip').tooltipster('option', 'position', 'left');\n\t        $('.creditcard .tooltip').tooltipster('option', 'arrow', true);\n\t\n\t    },\n\t    creditcard: {\n\t        obj: {},\n\t        add: function(form) {\n\t            try {\n\t                var _data = form.serializeObject();\n\t\n\t                var tmpId = 'card_' + guid();\n\t                var data = {\n\t                    cardname: _data.cardname,\n\t                    cardtype: _data.cardtype,\n\t                    cardnumber: _data.cardnumber.substr(-4)\n\t                };\n\t\n\t                var cardtemplate = tmpl(\n\t                    document.getElementById(\"tmpl-creditcard\").innerHTML,\n\t                    data\n\t                );\n\t\n\t                var li = $('<li />')\n\t                    .append(cardtemplate)\n\t                    .attr('data-card-id', tmpId).hide(); // After ajax change card-id attribute\n\t\n\t                var list = $('ul.creditcard-list');\n\t                if(list.find('li.notfound').length)\n\t                    list.find('li.notfound').remove();\n\t\n\t                li.find('.creditcard .tooltip').tooltipster({\n\t                    animation: 'grow',\n\t                    position: 'left'\n\t                });\n\t                list.append(li);\n\t\n\t                this.process.add(function(response) {\n\t                    $('#slider-content .owl-height').css('height', list.outerHeight() + li.height());\n\t                    $('ul.creditcard-list li[data-card-id=\"' + tmpId +'\"]').fadeIn(300, 'easeOutQuad', function() {\n\t                        $(this).data('card-id', response.newId).attr('data-card-id', newId);\n\t                    });\n\t                });\n\t\n\t            } catch (e) {\n\t                console.log('Creditcard add failed', e);\n\t            }\n\t        },\n\t        del: function(id) {\n\t            if(settings.env == 'dev')\n\t                console.log('Remove card with id #' + id);\n\t\n\t            this.process.del(function(response) {\n\t                var cnt = $('ul.creditcard-list li').length;\n\t                $('ul.creditcard-list li[data-card-id=\"' + id +'\"]').slideUp(300, 'easeOutQuad', function() {\n\t                    $(this).remove();\n\t                    if(cnt == 0) {\n\t                        $('<li />')\n\t                            .appendTo(\"ul.creditcard-list\")\n\t                            .html(lang.creditcardNotFound)\n\t                            .addClass('notfound')\n\t                            .fadeIn(200);\n\t                    }\n\t                    var list = $('ul.creditcard-list');\n\t                    $('#slider-content .owl-height').css('height', list.outerHeight());\n\t                });\n\t            });\n\t\n\t        },\n\t        process: {\n\t            del: function(callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function () {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function () {\n\t                        var response = [];\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t\n\t                }, 1000);\n\t\n\t            },\n\t            add: function(callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                        var response = {'newId': 4};\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t                }, 1000);\n\t            }\n\t        }\n\t    },\n\t    personal: {\n\t        save: function(form) {\n\t            if(settings.env == 'dev')\n\t                console.log('Save personal data');\n\t\n\t            var data = form.serializeArray();\n\t            this.process(data, function(response) {\n\t                console.log('Personal data saved');\n\t                $('button[data-to-slide=\"personal\"]').attr('disabled', 'disabled');\n\t                var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t                bottom.find('.button-group').removeClass('two-button').addClass('one-button');\n\t                bottom.find('button.btn-dismiss').addClass('hide');\n\t            });\n\t\n\t\n\t        },\n\t        process: function(data, callback) {\n\t            console.log(data);\n\t            $(\"#ajax-loader\").fadeIn(200);\n\t            // Ajax simulation\n\t            setTimeout(function() {\n\t                $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                    var response = [];\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                });\n\t\n\t\n\t\n\t            }, 1000);\n\t        }\n\t    },\n\t    delivery: {\n\t        del: function(addressId) {\n\t            this.process.del(addressId, function(response) {\n\t                var cnt = $('ul.creditcard-list li').length;\n\t                console.log('Address removed');\n\t                $('ul.delivery-list li[data-address-id=\"'+addressId+'\"]').remove();\n\t                if(cnt == 0) {\n\t                    $('<li />')\n\t                        .appendTo(\"ul.delivery-list\")\n\t                        .html(lang.deliveryaddressNotFound)\n\t                        .addClass('notfound')\n\t                        .fadeIn(200);\n\t                }\n\t                var list = $('ul.delivery-list');\n\t                $('#slider-content .owl-height').css('height', list.outerHeight());\n\t            });\n\t        },\n\t        process: {\n\t            del: function(addressId, callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                        $('button[data-to-slide=\"personal\"]').attr('disabled', 'disabled');\n\t                        var response = [];\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t\n\t                }, 1000);\n\t            }\n\t        }\n\t    }\n\t};\n\t\n\tvar _checkout = {\n\t    init: function() {\n\t        var _this = this;\n\t        $('#checkout .content-panel .bottom button[type=\"submit\"]').on('click', function(e) {\n\t            var targetForm = $(this).data('to-form');\n\t\n\t            if(settings.env == 'dev')\n\t                console.log('Click bottom button with target form ' + targetForm);\n\t            if(!targetForm || $(targetForm).length == 0)\n\t                return;\n\t\n\t            var form = $(targetForm);\n\t            form.trigger('submit');\n\t            form.closest('.step1').find('.form-status').remove();\n\t            return false;\n\t        });\n\t\n\t        $('#checkout .content-panel .bottom button[type=\"dismiss\"]').on('click', function(e) {\n\t            _this.goToStep(8); // last step\n\t            return false;\n\t        });\n\t\n\t        $('#checkout-step button[data-toggle=\"gotostep\"]').on('click', function() {\n\t            var step = $(this).data('to-step');\n\t            _this.goToStep(step);\n\t        });\n\t\n\t        if(!app.checkout.loadLastStep())\n\t            app.checkout.goToStep(1);\n\t    },\n\t    step: {\n\t        1: {\n\t            loaded: false,\n\t            load: function() {\n\t                var form_step__1 = $('#checkout-auth');\n\t                this.validateForm(form_step__1);\n\t                form_step__1.find('input').on('keyup', function() {\n\t                    $(this).removeClass('error').parent().removeClass('has-error');\n\t                    $(this).next('i.fa').remove();\n\t                    form_step__1.closest('.step1').find('.form-status').remove();\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t\n\t            },\n\t            validateForm: function(form) {\n\t                var _this = this;\n\t                jQuery.validator.addMethod(\n\t                    'regexp',\n\t                    function(value, element, regexp) {\n\t                        var re = new RegExp(regexp);\n\t                        return this.optional(element) || re.test(value);\n\t                    },\n\t                    \"Please check your input.\"\n\t                );\n\t                form.validate({\n\t                    onfocusout: false,\n\t                    onkeyup: false,\n\t                    onclick: false,\n\t                    focusInvalid: false,\n\t                    submitHandler: function() {\n\t                        _this.registrationSubmitHandler(form);\n\t                        return false;\n\t                    },\n\t                    rules: {\n\t                        name: {\n\t                            required: true,\n\t                            minlength: 3,\n\t                            regexp: '^[А-яA-zёЁ\\s-]{3,}$'\n\t                        },\n\t                        phone: {\n\t                            required: true,\n\t                            minlength: 5,\n\t                            regexp: '^\\\\+[0-9\\\\+\\\\-()\\s]{14,16}$'\n\t                        },\n\t                        email: {\n\t                            required: true,\n\t                            email: true\n\t                        }\n\t                    },\n\t                    messages:{\n\t                        name: {\n\t                            required: \"Поле обязательно для заполнения\",\n\t                            minlength: \"Имя не может быть менее 3 символов\",\n\t                            regexp: \"Имя указано не верно\"\n\t                        },\n\t                        phone: {\n\t                            required: \"Поле обязательно для заполнения\",\n\t                            minlength: \"Телефон не может сожержать менее 5 символов\",\n\t                            regexp: \"Телефон указан не верно\"\n\t                        },\n\t                        email: \"Введите корректный адрес\"\n\t                    },\n\t                    showErrors: function(errorMap, errorList) {\n\t                        if (errorList.length < 1) {\n\t                            form.removeClass('has-error');\n\t                            form.find('input').removeClass('error').parent().removeClass('has-error');\n\t                            form.find('i.fa').remove();\n\t                            return;\n\t                        }\n\t                        $.each(errorList, function(index, error) {\n\t                            form.find('input[name=\"'+error.element.name+'\"]').next('i.fa').remove();\n\t                            form.find('input[name=\"'+error.element.name+'\"]').addClass('error').parent().addClass('has-error');\n\t                            form.addClass('has-error');\n\t                            form.find('input[name=\"'+error.element.name+'\"]').after('<i class=\"fa fa-exclamation-triangle tooltip\" data-toggle=\"tooltip\" title=\"' + error.message + '\"></i>');\n\t                        });\n\t                    }\n\t                });\n\t            },\n\t            registrationProcess: function(data,callback) {\n\t                console.log('[REGISTRATION] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        message: 'Неверно указан номер',\n\t                        status: true, // example phone error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            registrationSubmitHandler: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t                var data = form.serializeArray();\n\t                var step = form.closest('.step1');\n\t                form.css('opacity', 0);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step1',\n\t                    title: lang.processPhoneCheck\n\t                });\n\t                this.registrationProcess(data, function(response) {\n\t                    if(response.status != true)\n\t                    {\n\t\n\t                        var message = $('<div />').addClass('table form-status')\n\t                            .css('width', step.outerWidth())\n\t                            .css('height', step.outerHeight())\n\t                            .append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t                        step.prepend(message);\n\t\n\t                        ajaxloader.finish();\n\t\n\t                        form.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\t\n\t                        setTimeout(function() {\n\t                            message.css('background-color', 'transparent');\n\t                            message.find('span').addClass('inline');\n\t                            message.transition({\n\t                                y: -250,\n\t                                complete: function() {\n\t                                    message.css('z-index', 0);\n\t                                    form.fadeTo(200, 1);\n\t                                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t                                }\n\t                            });\n\t                        }, 700)\n\t                    }\n\t                    else\n\t                    {\n\t\n\t                        app.checkout.goToStep(2);\n\t                    }\n\t                });\n\t            },\n\t        },\n\t        2: {\n\t            loaded: false,\n\t            load: function() {\n\t                var form_step__2 = $('#checkout-auth-confirm-phone');\n\t                var _this = this;\n\t\n\t                form_step__2.find('input').on('keyup', function() {\n\t                    form_step__2.closest('.step2').find('.form-status').remove();\n\t                    $('button[data-to-form=\"#' + form_step__2.attr('id') + '\"]').removeAttr('disabled').removeClass('btn-bordered').addClass('btn-primary');\n\t                });\n\t\n\t                form_step__2.on('submit', function() {\n\t                    _this.confirmSubmitHander($(this));\n\t                    return false;\n\t                });\n\t\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t                countDown({\n\t                    time: settings.timeoutResendConfirmPhoneCode, // in seconds\n\t                    display:  $('#timein span'),\n\t                    showMinutes: true,\n\t                    afterFinish: function() {\n\t                        $('#timein').fadeOut(200, function() {\n\t                            $('#timeout').fadeIn(200);\n\t                        })\n\t                    }\n\t                });\n\t\n\t            },\n\t            confirmProcess: function(data, callback) {\n\t                console.log('[CONFIRM] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        message: 'Неверный код',\n\t                        status: true, // example code error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            confirmSubmitHander: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t                var data = form.serializeArray();\n\t                var step = form.closest('.step2');\n\t                form.css('opacity', 0);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step2',\n\t                    title: lang.processConfirmCheck\n\t                });\n\t                this.confirmProcess(data, function(response) {\n\t                    if(response.status != true)\n\t                    {\n\t\n\t                        var message = $('<div />').addClass('table form-status')\n\t                            .css('width', step.outerWidth())\n\t                            .css('height', step.outerHeight())\n\t                            .append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t                        step.prepend(message);\n\t\n\t                        ajaxloader.finish();\n\t\n\t                        form.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\t\n\t                        setTimeout(function() {\n\t                            message.css('background-color', 'transparent');\n\t                            message.find('span').addClass('inline');\n\t                            message.transition({\n\t                                y: -150,\n\t                                complete: function() {\n\t                                    message.css('z-index', 0);\n\t                                    form.fadeTo(200, 1);\n\t                                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t                                }\n\t                            });\n\t                        }, 700)\n\t                    }\n\t                    else\n\t                    {\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                });\n\t            }\n\t        },\n\t        3: {\n\t            loaded: false,\n\t            map: null,\n\t            map_created: false,\n\t            load: function() {\n\t                $('#map').height($('#checkout .content-panel').height());\n\t                ymaps.ready(this.loadMap);\n\t                this.loadKladr();\n\t\n\t                var _this = this;\n\t\n\t                $('#delivery-address-form').on('submit', function() {\n\t                    _this.deliverySubmitHandler($(this));\n\t                    return false;\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t\n\t            },\n\t            deliveryProcess: function(data, callback) {\n\t                console.log('[DELIVERY ADDRESS] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        status: true, // example code error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 500);\n\t            },\n\t            deliverySubmitHandler: function(form) {\n\t                var data = form.serializeArray();\n\t                var dataObj = form.serializeObject();\n\t                var step = form.closest('.step3');\n\t                this.deliveryProcess(data, function(response) {\n\t                    if (response.status != true) {\n\t                        console.log('Change address error');\n\t                    } else {\n\t                        app.checkout.delivery.address = dataObj;\n\t                        $(document).trigger('raketa.checkout.update');\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                })\n\t            },\n\t            loadMap: function() {\n\t                    if (this.map_created) return;\n\t                    this.map_created = true;\n\t\n\t                    this.map = new ymaps.Map('map', {\n\t                            center: [59.9382558321876,30.308662213671802],\n\t                            zoom: 12,\n\t                            controls: []\n\t                        }),\n\t                        ZoomLayout = ymaps.templateLayoutFactory.createClass(\"<div>\" +\n\t                            \"<div id='zoom-in' class='map-btn zoom-in'></div>\" +\n\t                            \"<div id='zoom-out' class='map-btn zoom-out'></div>\" +\n\t                            \"</div>\", {\n\t\n\t                            build: function () {\n\t                                ZoomLayout.superclass.build.call(this);\n\t                                this.zoomInCallback = ymaps.util.bind(this.zoomIn, this);\n\t                                this.zoomOutCallback = ymaps.util.bind(this.zoomOut, this);\n\t                                $('#zoom-in').bind('click', this.zoomInCallback);\n\t                                $('#zoom-out').bind('click', this.zoomOutCallback);\n\t                            },\n\t                            clear: function () {\n\t                                $('#zoom-in').unbind('click', this.zoomInCallback);\n\t                                $('#zoom-out').unbind('click', this.zoomOutCallback);\n\t                                ZoomLayout.superclass.clear.call(this);\n\t                            },\n\t                            zoomIn: function () {\n\t                                var map = this.getData().control.getMap();\n\t                                this.events.fire('zoomchange', {\n\t                                    oldZoom: map.getZoom(),\n\t                                    newZoom: map.getZoom() + 1\n\t                                });\n\t                            },\n\t                            zoomOut: function () {\n\t                                var map = this.getData().control.getMap();\n\t                                this.events.fire('zoomchange', {\n\t                                    oldZoom: map.getZoom(),\n\t                                    newZoom: map.getZoom() - 1\n\t                                });\n\t                            }\n\t                        }),\n\t                        zoomControl = new ymaps.control.ZoomControl({ options: { layout: ZoomLayout } });\n\t\n\t                    map.controls.add(zoomControl, {\n\t                        position: {\n\t                            left: 10,\n\t                            bottom: 180\n\t                        }\n\t                    });\n\t\n\t                    var geoLayout = ymaps.templateLayoutFactory.createClass(\"<div>\" +\n\t                        \"<div id='geolocation' class='map-btn geo'></div>\" +\n\t                        \"</div>\", {\n\t\n\t                        build: function () {\n\t                            geoLayout.superclass.build.call(this);\n\t                            this.geolocation = ymaps.util.bind(this.geolocation, this);\n\t                            this.zoomOutCallback = ymaps.util.bind(this.zoomOut, this);\n\t                            $('#geolocation').bind('click', this.geolocation);\n\t                            $('#zoom-out').bind('click', this.zoomOutCallback);\n\t                        },\n\t                        clear: function () {\n\t                            $('#zoom-in').unbind('click', this.zoomInCallback);\n\t                            $('#zoom-out').unbind('click', this.zoomOutCallback);\n\t                            geoLayout.superclass.clear.call(this);\n\t                        },\n\t                        geolocation: function () {\n\t                            var map = this.getData().control.getMap();\n\t                            this.events.fire('zoomchange', {\n\t                                oldZoom: map.getZoom(),\n\t                                newZoom: map.getZoom() + 1\n\t                            });\n\t                        }\n\t                    });\n\t\n\t                    var geolocationControl = new ymaps.control.GeolocationControl({\n\t                        options: {\n\t                            //layout: geoLayout\n\t                            //noPlacemark: true\n\t                        }\n\t                    });\n\t\n\t                    map.controls.add(geolocationControl, {\n\t                        position: {\n\t                            left: 10,\n\t                            bottom: 144\n\t                        }\n\t                    });\n\t            },\n\t            loadKladr: function() {\n\t                var $kladr_form = $('#delivery-address-form');\n\t\n\t                $kladr_form.find('input').on('keyup', function() {\n\t                    if($(this).val())\n\t                        $('button[data-to-form=\"#' + $kladr_form.attr('id') + '\"]').removeAttr('disabled').removeClass('white');\n\t                    else\n\t                        $('button[data-to-form=\"#' + $kladr_form.attr('id') + '\"]').attr('disabled','disabled').addClass('white');\n\t                });\n\t\n\t                var $region = $kladr_form.find('[name=\"region\"]'),\n\t                    $district = $kladr_form.find('[name=\"district\"]'),\n\t                    $city = $kladr_form.find('[name=\"city\"]'),\n\t                    $street = $kladr_form.find('[name=\"street\"]'),\n\t                    $building = $kladr_form.find('[name=\"building\"]');\n\t\n\t                $()\n\t                    .add($region)\n\t                    .add($district)\n\t                    .add($city)\n\t                    .add($street)\n\t                    .add($building)\n\t                    .kladr({\n\t                        parentInput: '.kladr-form',\n\t                        verify: true,\n\t                        spinner: false,\n\t                        labelFormat: function (obj, query) {\n\t                            var label = '';\n\t\n\t                            var name = obj.name.toLowerCase();\n\t                            query = query.name.toLowerCase();\n\t\n\t                            var start = name.indexOf(query);\n\t                            start = start > 0 ? start : 0;\n\t\n\t                            if (obj.typeShort) {\n\t                                label += obj.typeShort + '. ';\n\t                            }\n\t\n\t                            if (query.length < obj.name.length) {\n\t                                label += obj.name.substr(0, start);\n\t                                label += '<strong>' + obj.name.substr(start, query.length) + '</strong>';\n\t                                label += obj.name.substr(start + query.length, obj.name.length - query.length - start);\n\t                            } else {\n\t                                label += '<strong>' + obj.name + '</strong>';\n\t                            }\n\t\n\t                            if (obj.parents) {\n\t                                for (var k = obj.parents.length - 1; k > -1; k--) {\n\t                                    var parent = obj.parents[k];\n\t                                    if (parent.name) {\n\t                                        if (label) label += '<small>, </small>';\n\t                                        label += '<small>' + parent.name + ' ' + parent.typeShort + '.</small>';\n\t                                    }\n\t                                }\n\t                            }\n\t\n\t                            return label;\n\t                        },\n\t                        change: function (obj) {\n\t                            if (obj) {\n\t\n\t                                setLabel($(this), obj.type);\n\t                            }\n\t                            addressUpdate();\n\t                            mapUpdate();\n\t                        },\n\t                        openBefore: function () {\n\t                            // Проверяем если выбран пользовательский адрес, прекращаем работу kladr\n\t                            //return false;\n\t                        },\n\t                        checkBefore: function () {\n\t                            var $input = $(this);\n\t\n\t                            if (!$.trim($input.val())) {\n\t\n\t                                addressUpdate();\n\t                                mapUpdate();\n\t                                return false;\n\t                            }\n\t                        }\n\t                    });\n\t\n\t                $street.kladr({\n\t                    labelFormat: function (obj, query) {\n\t                        var label = '';\n\t\n\t                        var name = obj.name.toLowerCase();\n\t                        query = query.name.toLowerCase();\n\t\n\t                        var start = name.indexOf(query);\n\t                        start = start > 0 ? start : 0;\n\t\n\t                        if (obj.typeShort) {\n\t                            label += obj.typeShort + '. ';\n\t                        }\n\t\n\t                        if (query.length < obj.name.length) {\n\t                            label += obj.name.substr(0, start);\n\t                            label += '<strong>' + obj.name.substr(start, query.length) + '</strong>';\n\t                            label += obj.name.substr(start + query.length, obj.name.length - query.length - start);\n\t                        } else {\n\t                            label += '<strong>' + obj.name + '</strong>';\n\t                        }\n\t\n\t                        if (obj.parents) {\n\t                            for (var k = obj.parents.length - 1; k > -1; k--) {\n\t                                var parent = obj.parents[k];\n\t                                if (parent.name && parent.contentType == 'city') {\n\t                                    if (label) label += '<small>, </small>';\n\t                                    label += '<small>' + parent.typeShort + '. ' + parent.name + '</small>';\n\t                                }\n\t                            }\n\t                        }\n\t\n\t                        return label;\n\t                    }\n\t                });\n\t                $region.kladr('type', $.kladr.type.region);\n\t                $district.kladr('type', $.kladr.type.district);\n\t                $city.kladr('type', $.kladr.type.city);\n\t                $street.kladr('type', $.kladr.type.street);\n\t                $building.kladr('type', $.kladr.type.building);\n\t\n\t                $.kladr.setValues({\n\t                    region: 7800000000000,\n\t                    city: 7800000000000\n\t                }, '.kladr-form');\n\t\n\t                // Включаем получение родительских объектов для населённых пунктов\n\t                $city.kladr('withParents', true);\n\t                $street.kladr('withParents', true);\n\t\n\t                // Отключаем проверку введённых данных для строений\n\t                $building.kladr('verify', false);\n\t\n\t                function setLabel($input, text) {\n\t                    text = text.charAt(0).toUpperCase() + text.substr(1).toLowerCase();\n\t                    $input.parent().find('label').text(text);\n\t                }\n\t\n\t                function mapUpdate() {\n\t                    var zoom = 4;\n\t                    var address = $.kladr.getAddress($kladr_form, function (objs) {\n\t                        var result = '';\n\t                        $.each(objs, function (i, obj) {\n\t                            var name = '',\n\t                                type = '';\n\t\n\t                            if ($.type(obj) === 'object') {\n\t                                name = obj.name;\n\t                                type = obj.type + ' ';\n\t\n\t                                switch (obj.contentType) {\n\t                                    case $.kladr.type.region:\n\t                                        zoom = 4;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.district:\n\t                                        zoom = 7;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.city:\n\t                                        zoom = 10;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.street:\n\t                                        zoom = 13;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.building:\n\t                                        zoom = 16;\n\t                                        break;\n\t                                }\n\t                            }\n\t                            else {\n\t                                name = obj;\n\t                            }\n\t\n\t                            if (result) result += ', ';\n\t                            result += type + name;\n\t                        });\n\t\n\t                        return result;\n\t                    });\n\t\n\t                    if (address && this.map_created) {\n\t                        var geocode = ymaps.geocode(address);\n\t                        geocode.then(function (res) {\n\t                            this.map.geoObjects.each(function (geoObject) {\n\t                                map.geoObjects.remove(geoObject);\n\t                            });\n\t\n\t                            var position = res.geoObjects.get(0).geometry.getCoordinates(),\n\t                                placemark = new ymaps.Placemark(position, {}, {});\n\t\n\t                            this.map.geoObjects.add(placemark);\n\t                            this.map.setCenter(position, zoom);\n\t                        });\n\t                    }\n\t                }\n\t\n\t                function addressUpdate() {\n\t                    var address = $.kladr.getAddress($kladr_form);\n\t                    $kladr_form.find('input[name=\"fulladdress\"]').val(address);\n\t                }\n\t            },\n\t\n\t        },\n\t        4: {\n\t            loaded: false,\n\t            load: function(){\n\t                var form = $('#who-delivery-product');\n\t                var userlist = this.getUserList();\n\t\n\t                form.find('select[name=\"who\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                    plugins: {\n\t                        'dropdown_footer': {\n\t                            title: 'Мы можем доставить цветы вам, или поздравить кого-нибудь от вас'\n\t                        }\n\t                    },\n\t                });\n\t                form.find('select[name=\"reason\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                    plugins: {\n\t                        'dropdown_footer': {\n\t                            title: 'Вы можете изменить или добавить новые поводы <a href=\"reasons.html\">здесь</a>'\n\t                        }\n\t                    }\n\t                });\n\t                userlist.done(function(response){\n\t                    console.log('Get user list');\n\t                    console.log(response);\n\t                    form.find('select[name=\"fromme_to_name\"]').selectize({\n\t                        allowEmptyOption: false,\n\t                        valueField: 'id',\n\t                        labelField: 'name',\n\t                        searchField: ['name', 'phone'],\n\t                        options: response,\n\t                        addPrecedence: 'Добавить',\n\t                        render: {\n\t                            item: function(item, escape) {\n\t                                return '<div>' +\n\t                                    (item.name ? '<span class=\"name\">' + escape(item.name) + '</span>' : '')\n\t                                    '</div>';\n\t                            },\n\t                            option: function(item, escape) {\n\t                                var label = item.name || item.phone;\n\t                                var caption = item.name ? item.phone : null;\n\t                                return '<div>' +\n\t                                    '<span class=\"label\">' + escape(label) + '</span>' +\n\t                                    (caption ? ' <span class=\"caption\">' + escape(caption) + '</span>' : '') +\n\t                                    '</div>';\n\t                            }\n\t                        },\n\t                        onChange: function(value) {\n\t                            var dp = this.$dropdown_content.find('[data-value=\"' + value +'\"]');\n\t                            var caption = dp.find('.caption').text();\n\t                            form.find('input[type=\"tel\"]').val(caption);\n\t                        },\n\t                        plugins: {\n\t                            'dropdown_footer': {\n\t                                title: 'Если вы еще никого не поздравляли от своего имени, просто укажите имя получателя'\n\t                            }\n\t                        },\n\t                        create: true,\n\t                    });\n\t                });\n\t\n\t                form.find('select[name=\"who\"]').on('change', function(e) {\n\t                    if($(this).val() == 'fromme')\n\t                    {\n\t                        form.find('.fromme .raketa-select').css('width', form.width());\n\t                        form.find('.fromme').removeClass('hide').hide().slideDown(150);\n\t                    } else {\n\t                        form.find('.fromme').slideUp(200).addClass('hide');\n\t                    }\n\t                });\n\t                form.find('select').on('change', function() {\n\t                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').removeClass('btn-bordered').addClass('btn-primary').removeAttr('disabled');\n\t                });\n\t                var _this = this;\n\t                form.on('submit', function() {\n\t                    var formObject = $(this).serializeObject();\n\t                    var dataObject = {};\n\t                    $.each(formObject, function(index, value) {\n\t                        if(index != 'csrf') {\n\t                            dataObject[index] = {\n\t                                index: index,\n\t                                value: value,\n\t                                textValue: form.find('[name=\"' + index + '\"] option[value=\"' + value +'\"]').text()\n\t                            }\n\t                        }\n\t                    });\n\t                    app.checkout.for = dataObject;\n\t                    _this.submitHandler($(this));\n\t                    return false;\n\t                });\n\t                this.loaded = true;\n\t            },\n\t\n\t            init: function() {\n\t                $('#checkout-step').parent().removeClass('middle');\n\t\n\t            },\n\t            close: function() {\n\t                $('#checkout-step').parent().addClass('middle');\n\t            },\n\t            getUserList: function() {\n\t                return $.Deferred(function () {\n\t                    var self = this;\n\t                    //Ajax simulation\n\t                    var userlist = [];\n\t                    setTimeout(function () {\n\t                        userlist = [\n\t                            {id: 1, name: 'Екатерина', phone: '+7(956)000-0011'},\n\t                            {id: 2, name: 'Мария', phone: '+7(956)111-0022'},\n\t                            {id: 3, name: 'Иван', phone: '+7(956)222-0033'}\n\t                        ];\n\t                        self.resolve(userlist);\n\t                    }, 2000);\n\t                });\n\t            },\n\t            submitProcess: function(data, callback) {\n\t                console.log('[FOR DELIVERY] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        status: true\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            submitHandler: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').closest('.bottom').removeClass('show');\n\t                var data = form.serializeArray();\n\t                var step = app.checkout.getCurrentStep();\n\t                step.closest('.content-panel').addClass('middle');\n\t                form.hide();\n\t                console.log(step);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step4',\n\t                    title: lang.processSave\n\t                });\n\t                this.submitProcess(data, function(response) {\n\t                    ajaxloader.finish();\n\t                    form.show();\n\t                    step.closest('.content-panel').removeClass('middle');\n\t                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').closest('.bottom').addClass('show');\n\t                    if(response.status == true)\n\t                    {\n\t                        $(document).trigger('raketa.checkout.update');\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                });\n\t            },\n\t        },\n\t        5: {\n\t            loaded: false,\n\t            init: function() {\n\t\n\t            }\n\t        },\n\t        6: {\n\t            loaded: false,\n\t            init: function() {\n\t\n\t            }\n\t        },\n\t        7: {\n\t            loaded: false,\n\t            init: function() {\n\t\n\t            }\n\t        },\n\t        8: {\n\t            loaded: false,\n\t            load: function() {\n\t                var _this = this;\n\t                $(document).on('raketa.checkout.update', function() {\n\t                    _this.updateHtml();\n\t                });\n\t\n\t                $('button[type=\"checkout\"]').on('click', function() {\n\t                    ajaxloader.local({\n\t                        element: $('#result'),\n\t                        to: '.step8',\n\t                        title: lang.loading\n\t                    });\n\t                    $(this).hide();\n\t                    app.checkout.save(function(response) {\n\t                        ajaxloader.finish();\n\t                        if(response.status == true)\n\t                        {\n\t                            window.location = response.paymentUrl;\n\t                        }\n\t                        $(this).show();\n\t                    });\n\t                    return false;\n\t                });\n\t\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t                if(\n\t                    app.checkout.basket.length &&\n\t                    app.checkout.delivery.address &&\n\t                    app.checkout.delivery.timeofday &&\n\t                    app.checkout.delivery.date &&\n\t                    app.checkout.for\n\t                )\n\t                {\n\t                    $('button[type=\"checkout\"]').removeAttr('disabled');\n\t                } else {\n\t                    $('button[type=\"checkout\"]').attr('disabled', 'disabled');\n\t                }\n\t\n\t\n\t                this.updateHtml();\n\t            },\n\t            updateHtml: function() {\n\t                var result = $('#result');\n\t\n\t                if(app.checkout.for)\n\t                {\n\t                    var recipient = app.checkout.for;\n\t                    if(recipient.who.value != \"me\") {\n\t                        var text = recipient.fromme_to_name.textValue;\n\t                        var phone = recipient.fromme_to_phone.value;\n\t                        var reason = recipient.reason.textValue;\n\t                        result.find('li.who span').html(text + '<br><b>'+phone+',</b>' + ' <i>' + reason + '</i>');\n\t                    } else {\n\t                        result.find('li.who span').html(app.checkout.for.who.textValue);\n\t                    }\n\t                    console.log(app.checkout.for);\n\t\n\t                }\n\t\n\t\n\t                if(app.checkout.delivery.address)\n\t                {\n\t                    var fulladdress = app.checkout.delivery.address.fulladdress;\n\t                    var address = fulladdress.split(',');\n\t                    console.log(app.checkout.delivery.address);\n\t                    var strAddress = [\n\t                        address[2],\n\t                        (address[3]?address[3]:app.checkout.delivery.address.building),\n\t                        (app.checkout.delivery.address.apartment?'кв ' + app.checkout.delivery.address.apartment:'')\n\t                    ];\n\t                    result.find('li.address span').html(strAddress.join(', ')).parent().removeClass('empty');\n\t                }\n\t                else\n\t                {\n\t                    result.find('li.address span').html('Адрес').parent().addClass('empty');\n\t                }\n\t\n\t\n\t                if(app.checkout.delivery.date &&\n\t                    app.checkout.delivery.timeofday)\n\t                {\n\t                    var date = app.checkout.delivery.date;\n\t                    date = moment(date, 'DD.MM.YYYY').format('D MMMM');\n\t                    var timeofday = lang[app.checkout.delivery.timeofday];\n\t                    result.find('li.delivery-date span').html(timeofday + ' '+date);\n\t                }\n\t            }\n\t        }\n\t    },\n\t    loadLastStep: function() {\n\t        var step = Cookies.get('reketa_checkout__step');\n\t        if(step)\n\t        {\n\t            this.goToStep(step);\n\t            return true\n\t        } else\n\t            return false\n\t    },\n\t    getCurrentStep: function() {\n\t        return this.currentStep;\n\t    },\n\t    goToStep: function(step) {\n\t        Cookies.set('reketa_checkout__step', step, { expires: 365, path: '/' });\n\t        var checkout = $('#checkout-step');\n\t        var currentStep = checkout.find('.step.active');\n\t        if(currentStep.length)\n\t            this.currentStep = currentStep;\n\t        else\n\t            this.currentStep = $('#checkout-step .step[data-step=\"'+ step +'\"]');\n\t\n\t        var stepItem = (currentStep.data('step') ? currentStep.data('step') : step);\n\t        currentStep.trigger('close');\n\t        if(this.step[stepItem] && this.step[stepItem].close)\n\t            this.step[stepItem].close();\n\t        currentStep.removeClass('active');\n\t\n\t        if(settings.env == 'dev')\n\t            console.log('[STEP] Go to checkout step #' + step);\n\t\n\t        checkout.find('.step.step' + step).addClass('active').trigger('open');\n\t        checkout.parent().find('.bottom[data-to-step]').removeClass('show');\n\t        checkout.parent().find('.bottom[data-to-step=\"step' + step + '\"]').addClass('show');\n\t\n\t        if(this.step[step]\n\t            && !this.step[step].loaded\n\t            && (typeof this.step[step].load === \"function\")\n\t        )\n\t            this.step[step].load()\n\t\n\t        if(this.step[step]\n\t            && this.step[step].loaded\n\t            && (typeof this.step[step].init === \"function\")\n\t        )\n\t            this.step[step].init()\n\t    },\n\t};\n\t\n\t$.extend( app.checkout, _checkout );\n\n\n\t$w.scroll(function () {\n\t\tapp.scroll();\n\t});\n\t$w.resize(function () {\n\t\tapp.resize();\n\t});\n\n\tapp.init();\n\n\n\n});\n\n\nHash = {\n\tget: function() {\n\t\tvar vars = {}, hash, splitter, hashes;\n\t\tif (!this.oldbrowser()) {\n\t\t\tvar pos = window.location.href.indexOf('?');\n\t\t\thashes = (pos != -1) ? decodeURIComponent(window.location.href.substr(pos + 1)) : '';\n\t\t\tsplitter = '&';\n\t\t}\n\t\telse {\n\t\t\thashes = decodeURIComponent(window.location.hash.substr(1));\n\t\t\tsplitter = '/';\n\t\t}\n\n\t\tif (hashes.length == 0) {return vars;}\n\t\telse {hashes = hashes.split(splitter);}\n\n\t\tfor (var i in hashes) {\n\t\t\tif (hashes.hasOwnProperty(i)) {\n\t\t\t\thash = hashes[i].split('=');\n\t\t\t\tif (typeof hash[1] == 'undefined') {\n\t\t\t\t\tvars['anchor'] = hash[0];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvars[hash[0]] = hash[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn vars;\n\t},\n\tset: function(vars) {\n\t\tvar hash = '';\n\t\tfor (var i in vars) {\n\t\t\tif (vars.hasOwnProperty(i)) {\n\t\t\t\thash += '&' + i + '=' + vars[i];\n\t\t\t}\n\t\t}\n\n\t\tif (!this.oldbrowser()) {\n\t\t\tif (hash.length != 0) {\n\t\t\t\thash = '?' + hash.substr(1);\n\t\t\t}\n\t\t\twindow.history.pushState(hash, document.title, document.location.pathname + hash);\n\t\t}\n\t\telse {\n\t\t\twindow.location.hash = hash.substr(1);\n\t\t}\n\t},\n\tadd: function(key, val) {\n\t\tvar hash = this.get();\n\t\thash[key] = val;\n\t\tthis.set(hash);\n\t},\n\tremove: function(key) {\n\t\tvar hash = this.get();\n\t\tdelete hash[key];\n\t\tthis.set(hash);\n\t},\n\tclear: function() {\n\t\tthis.set({});\n\t},\n\toldbrowser: function() {\n\t\treturn !(window.history && history.pushState);\n\t},\n};\nfunction getImageLightness(imageSrc) {\n    var deferred = $.Deferred();\n    var img = document.createElement(\"img\");\n    img.src = imageSrc;\n    img.style.display = \"none\";\n    document.body.appendChild(img);\n\n    var colorSum = 0;\n\n    img.onload = function() {\n        // create canvas\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = this.width;\n        canvas.height = this.height;\n\n        var ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(this,0,0);\n\n        var imageData = ctx.getImageData(0,0,canvas.width,canvas.height);\n        var data = imageData.data;\n        var r,g,b,avg;\n\n        for(var x = 0, len = data.length; x < len; x+=4) {\n            r = data[x];\n            g = data[x+1];\n            b = data[x+2];\n\n            avg = Math.floor((r+g+b)/3);\n            colorSum += avg;\n        }\n\n        var brightness = Math.floor(colorSum / (this.width*this.height));\n        deferred.resolve(brightness);\n        this.remove();\n    }\n    img.onerror = function() {\n        console.log('Error loading image: ' + imageSrc);\n        deferred.fail();\n    }\n    return deferred.promise();\n}\n\nString.template = function () {\n    var str = arguments[0];\n    for (var i = 1; i < arguments.length; i++) {\n        str = str.replace(RegExp(\"\\\\{\" + i + \"\\\\}\", \"gm\"), arguments[i]);\n    }\n    return str;\n};\nString.prototype.capitalizeFirstLetter = function() {\n    return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\nObject.size = function(obj) {\n    var size = 0, key;\n    for (key in obj) {\n        if (obj.hasOwnProperty(key)) size++;\n    }\n    return size;\n};\n\n/**\n * Number.prototype.format(n, x, s, c)\n *\n * @param integer n: length of decimal\n * @param integer x: length of whole part\n * @param mixed   s: sections delimiter\n * @param mixed   c: decimal delimiter\n */\nNumber.prototype.format = function(n, x, s, c) {\n    var re = '\\\\d(?=(\\\\d{' + (x || 3) + '})+' + (n > 0 ? '\\\\D' : '$') + ')',\n        num = this.toFixed(Math.max(0, ~~n));\n\n    return (c ? num.replace('.', c) : num).replace(new RegExp(re, 'g'), '$&' + (s || ','));\n};\n\nfunction guid() {\n    function s4() {\n        return Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1);\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n        s4() + '-' + s4() + s4() + s4();\n}\n\nfunction countDown(params) {\n    var duration = params.time;\n    var display = params.display;\n    var showMinutes = params.showMinutes;\n\n    if(!duration)\n        return;\n\n    var start = Date.now(),\n        diff,\n        minutes,\n        seconds;\n\n    function timer() {\n        diff = duration - (((Date.now() - start) / 1000) | 0);\n        minutes = (diff / 60) | 0;\n        seconds = (diff % 60) | 0;\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n        if(display && showMinutes)\n            display.text( minutes + \":\" + seconds);\n        else if(display)\n            display.text((minutes != 0 ? minutes + \":\" : \"\")    + seconds);\n\n        if (diff <= 0) {\n            clearInterval(interval);\n            if(typeof params.afterFinish === 'function' )\n                params.afterFinish();\n        }\n    }\n\n    timer();\n    var interval = setInterval(timer, 1000);\n}\n\n\n(function($,undefined){\n    $.fn.serializeObject = function(){\n        var obj = {};\n\n        $.each( this.serializeArray(), function(i,o){\n            var n = o.name,\n                v = o.value;\n\n            obj[n] = obj[n] === undefined ? v\n                : $.isArray( obj[n] ) ? obj[n].concat( v )\n                : [ obj[n], v ];\n        });\n\n        return obj;\n    };\n})(jQuery);\n\n\nfunction getNumEnding(iNumber, aEndings)\n{\n    var sEnding, i;\n    iNumber = iNumber % 100;\n    if (iNumber>=11 && iNumber<=19) {\n        sEnding=aEndings[2];\n    }\n    else {\n        i = iNumber % 10;\n        switch (i)\n        {\n            case (1): sEnding = aEndings[0]; break;\n            case (2):\n            case (3):\n            case (4): sEnding = aEndings[1]; break;\n            default: sEnding = aEndings[2];\n        }\n    }\n    return sEnding;\n}"],"sourceRoot":"/source/"}