{"version":3,"sources":["app.min.js"],"names":["getImageLightness","imageSrc","deferred","$","Deferred","img","document","createElement","src","style","display","body","appendChild","colorSum","onload","canvas","width","this","height","ctx","getContext","drawImage","r","g","b","avg","imageData","getImageData","data","x","len","length","Math","floor","brightness","resolve","remove","onerror","console","log","fail","promise","guid","s4","random","toString","substring","countDown","params","timer","diff","duration","Date","now","start","minutes","seconds","showMinutes","text","clearInterval","interval","afterFinish","time","setInterval","getNumEnding","iNumber","aEndings","sEnding","i","is_iOS","iDevices","navigator","platform","pop","lang","basketProductAddError","basketProductAddSuccess","basketProductClear","basketProductClearError","basketRequestDelete","buttonTextInBasket","product","currencySymbol","DeliveryDate","DeliveryFormattedString","morning","afternoon","evening","creditcardquestdelete","creditcardNotFound","dialogChangePhoneAlert","dialogEditButton","dialogDismissButton","dialogDeleteButton","dialogCloseButton","deliveryaddressrequestdelete","deliveryaddressNotFound","processCallbackTitle","processPhoneCheck","processConfirmCheck","processSave","processAuthorization","loading","bouquet","bouquetNotFound","bouquetInBasketPopupCart","reasonquestdelete","cardNotApprovedStatus","soldout","soldoutModalTitle","soldoutModalMessage","app","ajaxloader","settings","device","$w","window","env","loadBouquets","imageBouquetsBrightnessThreshold","timeoutResendConfirmPhoneCode","datetimePicker","format","value","timepicker","inline","todayButton","prevButton","nextButton","scrollMonth","dayOfWeekStart","yearStart","defaultSelect","yearEnd","minDate","maxDate","onChangeDateTime","dp","$input","obj","closest","find","removeAttr","html","widgets","calendar","getDateString","datetimepicker","undefined","checkout","delivery","type","hide","removeClass","show","addClass","onGenerate","ct","_month","each","index","tr","$tr","month","td","hasClass","$month","moment","before","calendarInitialized","trigger","init","locale","setLocale","getInfo","layout","initStyle","content","bind","forms","buttons","sidebar","load","ob","orientation","subtype","windowHeight","windowWidth","resize","popup","isOpened","loaded","setPosition","scroll","scrollPos","scrollTop","savedScrollPos","header","ready","mask","keyup","e","keyCode","swipe","swipeRight","event","direction","distance","fingerCount","fingerData","target","is","swipeLeft","allowPageScroll","preventDefaultEvents","tooltipster","animation","on","stopPropagation","status","modal","dialog","title","no","class","action","lastConfirmed","order","magnificPopup","close","preventDefault","basket","add","clear","pid","removeProductFromBasket","productcart","openedObj","step","open","items","removalDelay","showCloseBtn","callbacks","beforeOpen","st","mainClass","midClick","yes","opened","_this","sidebarObj","one","nanoScroller","iOSNativeScrolling","offset","outerHeight","top","css","bottom","sh","posB","position","delay","fadeIn","orderred","zindex","appendTo","attr","initialized","fadeOut","off","_buttons","tmpId","buttonHTML","template","id","indexOf","name","tmpl","getElementById","innerHTML","afterRender","eq","form","beforeAction","bouquets","get","defaults","to","limit","after","response","options","extend","self","setTimeout","bouquetsList","call","buildListHtml","list","isEmptyObject","emptyData","append","lastItem","key","item","imgSrc","done","lightness","render","store","$this","currentTarget","bid","productObi","Error","filter","count","indexes","map","push","saveBasket","updateHtml","destroyBasket","JSON","stringify","basketButton","productInBasket","productId","getProductFromBasket","callback","splice","error","reasons","getBasketData","getDeliveryDate","price","availableData","label","size","dia","composition","info","date","Cookies","timeofday","currentDate","settedDate","isBefore","path","button","save","for","paymentUrl","button_offset","right","left","outerWidth","anotherButton","_w","_h","localInit","formTarget","process","input","val","clearDate","_str","String","toLowerCase","capitalizeFirstLetter","reset","but","pos","transition","y","complete","serializeObject","set","expire","startPosition","startTitle","hashProcess","when","then","hash","Hash","anchor","location","toggleClass","owl","gallery","fadeToggle","indexed","w","h","headerHeight","margin","lazyLoad","loop","autoplay","autoplayTimeout","autoplayHoverPause","element","owlCarousel","first","info_bg","loadStep3","ceil","transEnd","focus","history","pushState","pathname","inBasket","_str2","spinner","newVal","oldVal","currentLayout","setStyleLayout","container","loadLayout","newH","not","visibleHeight","_cont","children","current","parent","URLhashListener","smartSpeed","animateOut","animateIn","afterInit","elem","autoHeight","slide","blur","parents","serializeArray","local","finish","outerHeght","auth","auth_form","validateForm","next","targetForm","jQuery","validator","addMethod","regexp","re","RegExp","optional","test","validate","onfocusout","onkeyup","onclick","focusInvalid","submitHandler","authorizationSubmitHandler","rules","required","minlength","phone","email","messages","showErrors","errorMap","errorList","message","authorizationProcess","prepend","fadeTo","image","icon","profile","submit","personal","cardId","cartName","str","creditcard","del","popupClass","validateCreditCard","result","card_type","valid","accept","keypress","which","addressId","address","prev","_data","cardname","cardtype","cardnumber","substr","cardtemplate","li","newId","cnt","slideUp","_checkout","goToStep","loadLastStep",1,"form_step__1","registrationSubmitHandler","registrationProcess",2,"form_step__2","confirmSubmitHander","resendCode","confirmProcess",3,"map_created","ymaps","loadMap","loadKladr","deliverySubmitHandler","deliveryProcess","dataObj","Map","center","zoom","controls","ZoomLayout","templateLayoutFactory","createClass","build","superclass","zoomInCallback","util","zoomIn","zoomOutCallback","zoomOut","unbind","getData","control","getMap","events","fire","oldZoom","getZoom","newZoom","zoomControl","ZoomControl","geoLayout","geolocation","geolocationControl","GeolocationControl","setLabel","charAt","toUpperCase","mapUpdate","kladr","getAddress","$kladr_form","objs","contentType","region","district","city","street","building","geocode","res","geoObjects","geoObject","geometry","getCoordinates","placemark","Placemark","setCenter","addressUpdate","$region","$district","$city","$street","$building","parentInput","verify","labelFormat","query","typeShort","k","change","openBefore","checkBefore","trim","setValues",4,"userlist","getUserList","selectize","allowEmptyOption","create","dropdownDirection","plugins","dropdown_footer","valueField","labelField","searchField","addPrecedence","escape","option","caption","onChange","$dropdown_content","slideDown","formObject","dataObject","textValue","submitProcess","getCurrentStep",5,6,7,"card","lastdiggit","checkedCardId","cardProcess",8,"recipient","who","fromme_to_name","fromme_to_phone","reason","fulladdress","split","strAddress","apartment","join","row","currentStep","expires","stepItem","_reasons","onboardClosed","defaultStep","$target","parentStep","board","$currentStep","openedStep","newreason","className","parentID","stringTitle","restore_on_backspace","congratulate","photo","repeat","editreason","model","promocode","promo","period","splitter","hashes","vars","oldbrowser","decodeURIComponent","href","hasOwnProperty","arguments","replace","prototype","slice","Object","Number","n","s","c","num","toFixed","max","fn","o","v","isArray","concat"],"mappings":"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","file":"app.min.js","sourcesContent":["/*\n * App JS\n */\nvar lang = {\n    basketProductAddError: 'Произошла ошибка. Товар не может быть добавлен в корзину.',\n    basketProductAddSuccess: 'Товар успешно добавлен в корзину.',\n    basketProductClear: 'Корзина очищена',\n    basketProductClearError: 'Произошла ошибка при очистке корзины. Обновите страницу и попробуйте снова.',\n    basketRequestDelete: 'Вы уверены что хотите удалить товар из корзины?',\n    buttonTextInBasket: 'В корзине',\n    product: 'товар',\n    currencySymbol: '&#x20bd;',\n    DeliveryDate: 'Дата доставки',\n    DeliveryFormattedString: 'Доставка на {1} {2}',\n    morning: 'Утро',\n    afternoon: 'День',\n    evening: 'Вечер',\n    creditcardquestdelete: 'Вы уверены что хотите удалить карту \"{1}\"?',\n    creditcardNotFound: 'У вас не привязано ни одной карты',\n    dialogChangePhoneAlert: 'Изменение телефонного номера привяжет вашу историю заказов к новому номеру',\n    dialogEditButton: 'Редактировать',\n    dialogDismissButton: 'Отмена',\n    dialogDeleteButton: 'Удалить',\n    dialogCloseButton: 'Закрыть',\n    deliveryaddressrequestdelete: 'Вы уверены что хотите удалить адрес доставки \"{1}\"?',\n    deliveryaddressNotFound: 'У вас не привязано ни одного адреса доставки. Чтобы привязать адрес вам необходимо создать любой заказ',\n    processCallbackTitle: 'Заказ<br>звонка',\n    processPhoneCheck: 'Проверка<br>номера телефона',\n    processConfirmCheck: 'Проверка<br>кода',\n    processSave: 'Сохранение данных',\n    processAuthorization: 'Пожалуйста<br>подождите',\n    loading: 'Ожидайте',\n    bouquet: 'Букет',\n    bouquetNotFound: 'Доступных букетов не найдено',\n    bouquetInBasketPopupCart: 'В корзине {1} на {2}',\n    reasonquestdelete: 'Вы уверены что хотите удалить повод?',\n    cardNotApprovedStatus: 'Карта которую вы выбрали не активна. Выберите другую карту.',\n    soldout: 'Полностью распродано',\n    soldoutModalTitle: 'Букет продан',\n    soldoutModalMessage: 'Данный букет был продан. Выберите другой букет.'\n};\nvar app;\nvar ajaxloader;\nvar settings;\nvar device = {};\n\n$(function() {\n\tvar $w = $(window);\n\tsettings = {\n\t    env: 'dev', // clear to production\n\t    loadBouquets: 6,\n\t    imageBouquetsBrightnessThreshold: 110,\n\t    timeoutResendConfirmPhoneCode: 60 //seconds\n\t};\n\t\n\tdatetimePicker = {\n\t    format:'d.m.Y',\n\t    value: 0,\n\t    timepicker:false,\n\t    inline:true,\n\t    todayButton: false,\n\t    prevButton: false,\n\t    nextButton: false,\n\t    scrollMonth: false,\n\t    dayOfWeekStart: 1,\n\t    yearStart: '2016',\n\t    defaultSelect: false,\n\t    yearEnd: '2020',\n\t    minDate:new Date(),\n\t    maxDate: new Date(+new Date + 12096e5), // magic number is 14 days in ms\n\t    onChangeDateTime:function(dp,$input){\n\t        var obj = $input.closest('.widget').length ? $input.closest('.widget') : $input.closest('.product-cart');\n\t        obj.find('input[name=\"timeofday\"]').removeAttr('disabled');\n\t        obj.find('button[data-toggle=\"clear-date\"]').removeAttr('disabled');\n\t        $('#selectedDate').html(app.widgets.calendar.getDateString());\n\t        $('input[name=\"date\"].datetime-picker').datetimepicker({value: dp});\n\t\n\t        if(app.checkout.delivery !== undefined && (device.type == 'smallmobile' || device.type == 'mobile'))\n\t            obj.find('.warning').hide().removeClass('hidden').show().addClass('opened');\n\t\n\t\n\t    },\n\t    onGenerate: function(ct) {\n\t        var calendar = $(this).find('.xdsoft_calendar');\n\t        var _month = 0;\n\t        $.each(calendar.find('tbody tr'), function( index, tr ) {\n\t            var i = 0;\n\t            var $tr = $(tr);\n\t            var month = 0;\n\t            $.each($tr.find('td'), function (index, td) {\n\t                if($(td).hasClass('xdsoft_disabled'))\n\t                    i++;\n\t\n\t                month = $(td).data('month');\n\t            });\n\t\n\t            if(i == 7)\n\t                $tr.hide();\n\t            else if(_month != month){\n\t                var $month = $('<div/>').addClass('month').html(moment(month+1, 'MM').format('MMM'));\n\t                $tr.before($month);\n\t                _month = month;\n\t            }\n\t\n\t        });\n\t\n\t        if(\n\t            $('button[data-target=\"#widget-calendar\"]').length > 0\n\t            && app.widgets.calendar.calendarInitialized == false ) {\n\t            $(document).trigger('init.xdsoft');\n\t        }\n\t    }\n\t}\n\n\tapp = {\n\t\tinit: function() {\n\t\t\tmoment.locale('ru');\n\t\t\t$.datetimepicker.setLocale('ru');\n\n\t\t\tapp.device.getInfo();\n\t\t\tapp.layout.initStyle();\n\t\t\tapp.content.initStyle();\n\n\t\t\tapp.bind.document();\n\t\t\tapp.bind.forms();\n\t\t\tapp.bind.buttons();\n\t\t\tapp.sidebar.init();\n\t\t\tapp.widgets.load();\n\n\t\t\tapp.checkout.load(); // Get Basket info\n\t\t},\n\t\tdevice: {\n\t\t\tgetInfo: function() {\n\t\t\t\tvar ob = $('body');\n\t\t\t\tvar height = $w.height();\n\t\t\t\tvar width = $w.width();\n\t\t\t\tif( width > height ) {\n\t\t\t\t\tdevice.orientation = 'landscape';\n\t\t\t\t\tif (ob.hasClass('portrait')) {\n\t\t\t\t\t\tob.removeClass('portrait').addClass('landscape');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tob.addClass('landscape');\n\t\t\t\t} else {\n\t\t\t\t\tdevice.orientation = 'portrait';\n\t\t\t\t\tif (ob.hasClass('landscape')) {\n\t\t\t\t\t\tob.removeClass('landscape').addClass('portrait');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tob.addClass('portrait');\n\t\t\t\t}\n\n\t\t\t\tif(width >= 1441){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'fullhd';\n\t\t\t\t}\n\n\t\t\t\tif( width >= 1281 && width <= 1440 ){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'hd';\n\t\t\t\t}\n\n\t\t\t\tif( width >= 1024 && width <= 1280 ){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'small';\n\t\t\t\t}\n\n\t\t\t\tif(width >= 768 && width <= 1023)\n\t\t\t\t\tdevice.type = 'planshet';\n\t\t\t\tif(width < 768)\n\t\t\t\t\tdevice.type = 'mobile';\n\t\t\t\tif(width < 320)\n\t\t\t\t\tdevice.type = 'smallmobile';\n\n\t\t\t\tdevice.windowHeight = height;\n\t\t\t\tdevice.windowWidth = width;\n\n\t\t\t\tif(settings.env  == 'dev') {\n\t\t\t\t\tconsole.log('[DEVICE] Get device data')\n\t\t\t\t\tconsole.log(device);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tresize: function() {\n\t\t\tif(settings.env  == 'dev')\n\t\t\t\tconsole.log('[APP] Window size is changed')\n\n\t\t\tif(app.popup.isOpened())\n\t\t\t\tapp.popup.hide();\n\n\t\t\tapp.device.getInfo();\n\t\t\tapp.sidebar.initStyle();\n\t\t\tapp.content.initStyle();\n\t\t\tapp.layout.initStyle();\n\n\t\t\tif(app.widgets.calendar && app.widgets.calendar.loaded)\n\t\t\t\tapp.widgets.calendar.setPosition();\n\t\t},\n\t\tscroll: function() {\n\t\t\tthis.scrollPos = $(document).scrollTop();\n\t\t\tthis.savedScrollPos = this.scrollPos;\n\t\t\tvar header = $('#header');\n\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\tif (header.hasClass('mainpage') && this.scrollPos > 0) {\n\t\t\t\t\theader.addClass('blurred');\n\t\t\t\t} else if (header.hasClass('mainpage') && this.scrollPos == 0) {\n\t\t\t\t\theader.removeClass('blurred');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tbind: {\n\t\t\tdocument: function() {\n\t\t\t\t$(document).ready(function(){\n\t\t\t\t\t$('input[type=\"tel\"]').mask('+7 (999) 999-99-99');\n\t\t\t\t\t$('input[name=\"phone\"]').mask('+7 (999) 999-99-99');\n\t\t\t\t});\n\t\t\t\t$(document).keyup(function(e) {\n\t\t\t\t\tif (e.keyCode == 27 && app.popup.isOpened())\n\t\t\t\t\t\tapp.popup.hide();   // esc\n\t\t\t\t});\n\n\n\t\t\t\t$('body').swipe( {\n\t\t\t\t\tswipeRight:function(event, direction, distance, duration, fingerCount, fingerData) {\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('TouchSwipe Right Event');\n\n\t\t\t\t\t\tvar target = $(event.target);\n\t\t\t\t\t\tconsole.log((device.type == 'desktop' && device.subtype == 'small') || device.type != 'desktop');\n\t\t\t\t\t\tif( (device.type == 'desktop' && device.subtype == 'small') || device.type != 'desktop') {\n\t\t\t\t\t\t\tconsole.log(target);\n\t\t\t\t\t\t\tconsole.log(!target.is('body'));\n\t\t\t\t\t\t\tconsole.log(target.closest('div[class^=\"owl-item\"]').length == 0);\n\t\t\t\t\t\t\tconsole.log((target.closest('div[class^=\"modal\"]').length == 0 && !target.hasClass('modal')));\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!target.is('body') &&\n\t\t\t\t\t\t\t\ttarget.closest('div[class^=\"owl-item\"]').length == 0 &&\n\t\t\t\t\t\t\t\t(target.closest('div[class^=\"modal\"]').length == 0 && !target.hasClass('modal'))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tapp.popup.show('#sidebar');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t},\n\t\t\t\t\tswipeLeft:function(event, direction, distance, duration, fingerCount) {\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('TouchSwipe Left Event');\n\t\t\t\t\t\tif(app.sidebar.isOpened())\n\t\t\t\t\t\t\tapp.popup.hide();\n\t\t\t\t\t},\n\t\t\t\t\tallowPageScroll: 'vertical',\n\t\t\t\t\tpreventDefaultEvents: false\n\t\t\t\t});\n\n\t\t\t\t$('.tooltip').tooltipster({\n\t\t\t\t\tanimation: 'grow'\n\t\t\t\t});\n\n\n\t\t\t\t// Popup\n\t\t\t\t$(document).on('click tap', '*[data-toggle=\"popup\"]', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tvar status = $(this).data('status');\n\t\t\t\t\tif(status == false) {\n\t\t\t\t\t\tapp.modal.dialog({\n\t\t\t\t\t\t\ttitle: lang.soldoutModalTitle,\n\t\t\t\t\t\t\tcontent: lang.soldoutModalMessage,\n\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\tno: {\n\t\t\t\t\t\t\t\t\ttitle: lang.dialogCloseButton,\n\t\t\t\t\t\t\t\t\tclass: 'dismiss',\n\t\t\t\t\t\t\t\t\taction: function(){ if(settings.env == 'dev') console.log('[Dialog (default)] Not confirmed'); app.modal.lastConfirmed = false; }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar order = $(this).data('order') ? $(this).data('order') : false;\n\t\t\t\t\t\tapp.popup.show($(this).data('target'), order);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t\t$(document).on('click tap', '#popup-bg', function() {\n\t\t\t\t\tconsole.log('popup bg click')\n\t\t\t\t\tapp.popup.hide();\n\t\t\t\t});\n\t\t\t\t$(document).on('click tap', 'button.popup-close', function(e) {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t\tapp.popup.hide();\n\t\t\t\t});\n\n\t\t\t\t//Modal\n\t\t\t\t$(document).on('click tap', 'button.modal-close', function(e) {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t\tif($.magnificPopup)\n\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t});\n\n\t\t\t\t// Basket\n\t\t\t\t$(document).on('click tap', 'button[data-toggle=\"to-basket\"]', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tif($(this).data('status') != false)\n\t\t\t\t\t\tapp.basket.add(e);\n\t\t\t\t});\n\t\t\t\t$(document).on('click tap', 'button[data-toggle=\"clear-basket\"]', function(e) {\n\t\t\t\t\tapp.basket.clear();\n\t\t\t\t});\n\n\t\t\t\t$(document).on('click tap', 'button[data-toggle=\"remove-from-basket\"]', function(e) {\n\t\t\t\t\tvar pid = $(this).data('product-id');\n\t\t\t\t\tif(!pid)\n\t\t\t\t\t\treturn;\n\t\t\t\t\tapp.basket.removeProductFromBasket(pid, function() {\n\t\t\t\t\t\tif(app.widgets.productcart\n\t\t\t\t\t\t\t&& app.widgets.productcart.openedObj\n\t\t\t\t\t\t\t&& app.popup.isOpened())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tapp.widgets.productcart.step('cart');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tforms: function() {\n\n\t\t\t},\n\t\t\tbuttons: function() {\n\t\t\t\t$('button[data-toggle=\"modal\"]').on('click tap', function() {\n\t\t\t\t\t$.magnificPopup.open({\n\t\t\t\t\t\ttype:'inline',\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\tsrc: $(this).data('target')\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremovalDelay: 500,\n\t\t\t\t\t\tshowCloseBtn: false,\n\t\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\t\tbeforeOpen: function() {\n\t\t\t\t\t\t\t\tthis.st.mainClass = 'mfp-zoom-in';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmidClick: true\n\t\t\t\t\t});\n\t\t\t\t})\n\n\t\t\t\t$('button[data-toggle=\"dialog\"]').on('click tap', function() {\n\t\t\t\t\tconsole.log('Dialog init');\n\t\t\t\t\tvar title = ($(this).data('title')?$(this).data('title'):'');\n\t\t\t\t\tvar content = ($(this).data('content')?$(this).data('content'):'');\n\t\t\t\t\tapp.modal.dialog({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\tcontent: content,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tyes: {\n\t\t\t\t\t\t\t\ttitle: 'ОК',\n\t\t\t\t\t\t\t\tclass: 'edit',\n\t\t\t\t\t\t\t\taction: function(){\n\t\t\t\t\t\t\t\t\tif(settings.env == 'dev') console.log('[Dialog (default)] Confirmed');\n\t\t\t\t\t\t\t\t\tapp.modal.lastConfirmed = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tno: {\n\t\t\t\t\t\t\t\ttitle: lang.dialogCloseButton,\n\t\t\t\t\t\t\t\tclass: 'dismiss',\n\t\t\t\t\t\t\t\taction: function(){ if(settings.env == 'dev') console.log('[Dialog (default)] Not confirmed'); app.modal.lastConfirmed = false; }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\tsidebar: {\n\t\t\topened: false,\n\t\t\tisOpened: function() {\n\t\t\t\treturn this.opened;\n\t\t\t},\n\t\t\tinit: function() {\n\t\t\t\tvar _this = this;\n\t\t\t\tvar sidebar;\n\t\t\t\tthis.sidebarObj = sidebar = $('#sidebar');\n\n\t\t\t\tsidebar.on('open', function() {\n\t\t\t\t\t_this.open();\n\t\t\t\t});\n\t\t\t\tsidebar.on('close', function() {\n\t\t\t\t\t_this.close();\n\t\t\t\t});\n\t\t\t\t$('button[data-toggle=\"close-sidebar\"]').on('click tap', function() {\n\t\t\t\t\t$(this).addClass('closing');\n\t\t\t\t\t$(this).one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\n\t\t\t\t\t});\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t\tapp.sidebar.close();\n\t\t\t\t});\n\n\t\t\t\tthis.initStyle();\n\n\t\t\t\tsidebar.find('.nano').nanoScroller({\n\t\t\t\t\tiOSNativeScrolling: true\n\t\t\t\t});\n\n\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\tvar offset = 0;\n\t\t\t\t\tvar content = $(\"#bouquet-list\");\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[SIDEBAR] Bouquets new loaded check style sidebar');\n\t\t\t\t\tif(\n\t\t\t\t\t\tcontent.length &&\n\t\t\t\t\t\t(content.outerHeight() + $('#header').height()) < device.windowHeight - sidebar.find('.sidebar-bottom').height()\n\t\t\t\t\t) {\n\t\t\t\t\t\tconsole.log(offset);\n\t\t\t\t\t\toffset = (device.windowHeight - content.height()) - content.offset().top - sidebar.find('.sidebar-bottom').height();\n\t\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: offset});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: 0});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tinitStyle: function() {\n\t\t\t\tvar sidebar = this.sidebarObj;\n\t\t\t\tif(device.type == 'desktop' && (device.subtype == 'hd' || device.subtype == 'fullhd'))\n\t\t\t\t\tsidebar.removeClass('collapsed');\n\t\t\t\telse\n\t\t\t\t\tsidebar.addClass('collapsed');\n\n\t\t\t\tvar sh = sidebar.find('.sidebar-top').outerHeight() + sidebar.find('.sidebar-bottom').height() + $('#header').height();\n\n\t\t\t\tvar posB = $w.height() < sh? 'relative': 'absolute';\n\t\t\t\tvar posS = $w.height() < sh? 'absolute': 'fixed';\n\t\t\t\tconsole.log(sh);\n\t\t\t\tvar offset = 0;\n\t\t\t\tvar content = $(\"#bouquet-list\"); // mainpage content\n\n\t\t\t\tif(\n\t\t\t\t\tdevice.windowHeight > 1000 &&\n\t\t\t\t\tcontent.length > 0 &&\n\t\t\t\t\tcontent.find('li').length > 0 &&\n\t\t\t\t\t(content.outerHeight() + $('#header').height()) < device.windowHeight - sidebar.find('.sidebar-bottom').height()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\toffset = (device.windowHeight - content.height()) - content.offset().top - sidebar.find('.sidebar-bottom').height();\n\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: offset});\n\t\t\t\t} else {\n\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: 0});\n\t\t\t\t}\n\t\t\t\tsidebar.find('.sidebar-bottom').css({position: posB});\n\t\t\t},\n\t\t\topen: function() {\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[SIDEBAR] Open navbar');\n\t\t\t\tvar sidebar = $('#sidebar');\n\n\t\t\t\ttry {\n\t\t\t\t\tsidebar.addClass('open');\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.log('Popup open error: ' + e);\n\t\t\t\t}\n\n\t\t\t\tsidebar.find('.popup-close').hide().delay(200).fadeIn(200, function() {\n\t\t\t\t\t$(this).addClass('closing');\n\t\t\t\t});\n\t\t\t\tsidebar.find('.popup-close').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t});\n\t\t\t\tthis.opened = true;\n\t\t\t},\n\t\t\tclose: function() {\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[SIDEBAR] Close navbar')\n\t\t\t\tvar sidebar = $('#sidebar');\n\t\t\t\tsidebar.removeClass('open');\n\n\t\t\t\tsidebar.find('.popup-close').addClass('closing');\n\t\t\t\tsidebar.find('.popup-close').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t});\n\t\t\t\t$('button[data-toggle=\"sidebar\"]').removeClass('opened');\n\t\t\t\tthis.opened = false;\n\t\t\t}\n\t\t},\n\t\tpopup: {\n\t\t\tisOpened: function() {\n\t\t\t\tif(this.opened && this.opened.length)\n\t\t\t\t\treturn true\n\t\t\t\telse\n\t\t\t\t\treturn false\n\t\t\t},\n\t\t\tshow: function(target, orderred) {\n\t\t\t\tif(this.isOpened() && !orderred)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar target = $(target);\n\n\t\t\t\tif(!orderred) {\n\t\t\t\t\tvar zindex = target.css('z-index');\n\t\t\t\t\t$('<div />')\n\t\t\t\t\t\t.appendTo(\"#wrapper\")\n\t\t\t\t\t\t.attr('id', 'popup-bg')\n\t\t\t\t\t\t.addClass((target.hasClass('product-cart') ? 'gray': 'default'))\n\t\t\t\t\t\t.css('z-index', --zindex)\n\t\t\t\t\t\t.fadeIn(200);\n\n\t\t\t\t\t$('body').css('overflow', 'hidden').on('touchmove', function(e) {\n\t\t\t\t\t\tvar target = $(e.target);\n\t\t\t\t\t\tif(!target.is('.nano') && !target.closest('.nano'))\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttarget.trigger('open');\n\t\t\t\t$(document).trigger('popup-show');\n\t\t\t\tthis.opened = target;\n\t\t\t\tthis.initialized = true;\n\t\t\t},\n\t\t\thide: function() {\n\t\t\t\tconsole.log('Hide popup');\n\t\t\t\tif(this.opened) {\n\t\t\t\t\tthis.opened.trigger('close');\n\t\t\t\t\t$('#popup-bg').fadeOut(200, function() {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t});\n\t\t\t\t\t$('body').css('overflow', 'auto').off('touchmove');\n\t\t\t\t\tdelete this.opened;\n\t\t\t\t\t$(document).trigger('popup-close');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmodal: {\n\t\t\tlastConfirmed: false,\n\t\t\tdialog: function(params) {\n\t\t\t\tthis.lastConfirmed = false;\n\n\t\t\t\tvar _buttons = params.buttons;\n\n\t\t\t\tvar tmpId = 'dialog_' + guid(),\n\t\t\t\t\tbuttonHTML = '',\n\t\t\t\t\ttemplate = '';\n\n\t\t\t\tparams.id = tmpId;\n\n\t\t\t\tif(params.content.indexOf('#') === 0)\n\t\t\t\t\tparams.content = $(params.content).html();\n\n\t\t\t\t$.each(_buttons, function(name,obj){\n\t\t\t\t\tif(!obj.class)\n\t\t\t\t\t\tobj.class = '';\n\n\t\t\t\t\tbuttonHTML += '<button class=\"'+ obj.class +'\">'+ (!obj.title?name:obj.title)+'</button>' + \"\\n\";\n\n\t\t\t\t\tif(!obj.action)\n\t\t\t\t\t\tobj.action = function(){};\n\t\t\t\t});\n\n\t\t\t\tparams.buttons = buttonHTML;\n\n\t\t\t\ttry {\n\t\t\t\t\ttemplate = tmpl(\n\t\t\t\t\t\tdocument.getElementById(\"tmpl-dialog\").innerHTML,\n\t\t\t\t\t\tparams\n\t\t\t\t\t);\n\t\t\t\t\tvar obj = $(template).appendTo('body');\n\n\t\t\t\t\tif(typeof params.afterRender === \"function\")\n\t\t\t\t\t\tparams.afterRender(obj);\n\n\t\t\t\t\tvar buttons = $('#' + tmpId + ' button'),\n\t\t\t\t\t\ti = 0;\n\n\n\n\t\t\t\t\t$.magnificPopup.open({\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\tsrc: '#' + tmpId\n\t\t\t\t\t\t},\n\t\t\t\t\t\tshowCloseBtn: false,\n\t\t\t\t\t\tremovalDelay: 500,\n\t\t\t\t\t\tmainClass: 'mfp-zoom-in',\n\t\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\t\tclose: function() {\n\t\t\t\t\t\t\t\t$('#' + tmpId).remove();\n\t\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\t\tconsole.log('Popup is completely closed');\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttype: 'inline'\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$.each(_buttons, function(name,obj) {\n\t\t\t\t\t\tbuttons.eq(i++).on('click', function(){\n\t\t\t\t\t\t\tif(params.type == 'form') {\n\t\t\t\t\t\t\t\tvar form = $('#' + tmpId).find('form');\n\t\t\t\t\t\t\t\tif(obj.beforeAction && typeof obj.beforeAction === \"function\" ) {\n\t\t\t\t\t\t\t\t\tform.on('submit', function() {\n\t\t\t\t\t\t\t\t\t\tif(obj.beforeAction(form)) {\n\t\t\t\t\t\t\t\t\t\t\tobj.action($(this));\n\t\t\t\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tform.trigger('submit');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tobj.action();\n\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('Template dialog rendering and open failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcontent: {\n\t\t\tinitStyle: function() {\n\t\t\t\tif(device.type != 'smallmobile' && device.type != 'mobile')\n\t\t\t\t\t$(\"#content\").css('min-height', ($w.height() - $('#header').height()) + 'px');\n\t\t\t}\n\t\t},\n\t\tbouquets: {\n\t\t\tdata: [],\n\t\t\tget: function(params) {\n\t\t\t\t$(\"#ajax-loader\").fadeIn(200);\n\t\t\t\tvar defaults = {\n\t\t\t\t\tstart: 0,\n\t\t\t\t\tto: null,\n\t\t\t\t\tlimit: settings.loadBouquets,\n\t\t\t\t\ttype: 'json',\n\t\t\t\t\tafter: function(response) {}\n\t\t\t\t};\n\n\t\t\t\tthis.options = $.extend({}, defaults, params);\n\n\t\t\t\t// Ajax simulation\n\t\t\t\t// example server response = var bouquetsList\n\t\t\t\tvar self = this;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response;\n\t\t\t\t\tapp.bouquets.data = response = bouquetsList;\n\t\t\t\t\t// callback function After\n\t\t\t\t\tself.options.after.call(self, response); // callback\n\t\t\t\t\tapp.bouquets.buildListHtml(bouquetsList);\n\t\t\t\t\t$(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\n\t\t\t\t\t});\n\n\t\t\t\t}, 1000);\n\t\t\t},\n\t\t\tbuildListHtml: function(data) {\n\t\t\t\tvar list = $(\"#bouquet-list\");\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log(\"[FLOWERS] Load flowers\");\n\n\t\t\t\tif(!data || $.isEmptyObject(data)) {\n\t\t\t\t\tvar emptyData = $('<div />').hide().addClass('not-found').html(lang.bouquetNotFound)\n\t\t\t\t\t$('#content').append(emptyData);\n\t\t\t\t\temptyData.fadeIn();\n\t\t\t\t\tconsole.log(\"[FLOWERS] Data is empty\");\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\t$('#content > .not-found').remove();\n\t\t\t\t}\n\t\t\t\tvar lastItem = 0;\n\t\t\t\tvar soldout = false;\n\t\t\t\t$.each(data, function(key, value) {\n\t\t\t\t\tvar item = $('<li />').attr('data-bouquet-id', value.id);\n\n\t\t\t\t\tgetImageLightness(value.imgSrc)\n\t\t\t\t\t\t.done(function(brightness) {\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log(\"[IMAGE => LIGHNESS] Bouquet #\" + value.id );\n\n\t\t\t\t\t\t\tvar lightness = 'dark';\n\n\t\t\t\t\t\t\tif(brightness > settings.imageBouquetsBrightnessThreshold)\n\t\t\t\t\t\t\t\tlightness = 'light';\n\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log(' -> Bouquet #' + value.id + ': ' + value.imgSrc + ': ' + brightness + '(' + lightness + ')');\n\n\t\t\t\t\t\t\tlist.find('li[data-bouquet-id=\"'+ value.id +'\"] > div.bouquet').addClass(lightness);\n\t\t\t\t\t\t\tlist.find('li[data-bouquet-id=\"'+ value.id +'\"] > div.product-cart').addClass(lightness);\n\t\t\t\t\t\t\tlist.find('li[data-bouquet-id=\"'+ value.id +'\"] > div.product-cart').data('lightness', lightness).attr('data-lightness', lightness);\n\t\t\t\t\t\t});\n\n\n\n\t\t\t\t\titem.append(app.bouquets.render('tmpl-bouquet-list-item', value));\n\t\t\t\t\titem.append(app.bouquets.render('tmpl-bouquet-list-item-popup', value));\n\n\t\t\t\t\tif(value.status == 'soldout')\n\t\t\t\t\t{\n\t\t\t\t\t\tlist.append($('<li />').addClass('soldout-group').html(lang.soldout));\n\t\t\t\t\t}\n\t\t\t\t\tlist.append(item);\n\t\t\t\t\tlastItem++;\n\t\t\t\t});\n\t\t\t\tlist.find(\".bouquet\").each(function(i) {\n\t\t\t\t\t$(this).delay(i*100).fadeIn(300, function() {\n\t\t\t\t\t\tif(i==(lastItem-1))\n\t\t\t\t\t\t\t$(document).trigger('raketa.bouquets.loaded');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t},\n\t\t\trender: function(template, data) {\n\t\t\t\tvar item = '';\n\t\t\t\ttry {\n\t\t\t\t\titem = tmpl(\n\t\t\t\t\t\tdocument.getElementById(template).innerHTML,\n\t\t\t\t\t\tdata\n\t\t\t\t\t);\n\t\t\t\t\treturn item;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('Template rendering failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tbasket: {\n\t\t\tstore: [],\n\t\t\tget: function() {\n\n\t\t\t},\n\t\t\tadd: function(e) {\n\t\t\t\tvar $this = $(e.currentTarget);\n\n\t\t\t\tvar bid = $this.data('product-id');\n\t\t\t\tvar productObi = $('#bouquet-list li[data-bouquet-id=\"' + bid + '\"]');\n\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[BASKET] Add product with ID #' + bid + ' to basket');\n\n\t\t\t\tif(!productObi.length)\n\t\t\t\t\tthrow Error(\"Невозможно найти DOM объект товара\");\n\n\t\t\t\t$this.addClass('added');\n\t\t\t\t$this.find('span.icon').html(lang.buttonTextInBasket);\n\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[BASKET] [ID #' + bid + '] Get product details');\n\n\t\t\t\tvar product = app.bouquets.data.filter(function (bouquet) { return bouquet.id == bid })[0];\n\t\t\t\tif(product.length == 0)\n\t\t\t\t\tthrow Error(\"Невозможно найти товар c id \" + bid );\n\n\n\t\t\t\tproduct.count = 1;\n\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj !== undefined && obj.id == product.id) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t{\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('Find in basket product with the same ID');\n\t\t\t\t\tapp.checkout.basket[indexes[0]]['count'] += product.count;\n\t\t\t\t\tproduct.count = app.checkout.basket[indexes[0]]['count'];\n\t\t\t\t} else {\n\t\t\t\t\tapp.checkout.basket.push(product);\n\t\t\t\t}\n\n\t\t\t\tthis.saveBasket();\n\t\t\t\tthis.updateHtml();\n\n\t\t\t\t// Если виджет productcart загружен, есть открытый объект, popup открыт, то проверяем какой шаг открыть\n\t\t\t\tif(app.widgets.productcart\n\t\t\t\t\t&& app.widgets.productcart.openedObj\n\t\t\t\t\t&& app.popup.isOpened())\n\t\t\t\t{\n\t\t\t\t\tif($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t{\n\t\t\t\t\t\t// Не указана дата доставки - открываем шаг 2\n\t\t\t\t\t\tapp.widgets.productcart.step('delivaryDate');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// Указана дата доставки и товар добавлен в корзину\n\t\t\t\t\t\tapp.widgets.productcart.step('orderInfo');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tclear: function() {\n\t\t\t\tif(this.destroyBasket()) {\n\t\t\t\t\tif(app.widgets.productcart\n\t\t\t\t\t\t&& app.widgets.productcart.openedObj\n\t\t\t\t\t\t&& app.popup.isOpened())\n\t\t\t\t\t{\n\t\t\t\t\t\tapp.popup.hide();\n\t\t\t\t\t}\n\t\t\t\t\tthis.updateHtml();\n\t\t\t\t} else {\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tdestroyBasket: function() {\n\t\t\t\t// Remove basket from Cookie or session\n\t\t\t\t// Ajax\n\t\t\t\tthis.store = [];\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tsaveBasket: function() {\n\t\t\t\t// SAVE TO SESSION ? or cookie? Async!\n\t\t\t\tvar data = JSON.stringify(app.checkout.basket); // JSON ???\n\t\t\t\tconsole.log('SAVE data basket');\n\t\t\t\tconsole.log(app.checkout.basket);\n\t\t\t\t// Ajax\n\t\t\t},\n\t\t\tupdateHtml: function() {\n\t\t\t\tvar basketButton = $('#header a.basket');\n\t\t\t\tbasketButton.addClass('notempty').html('<span>' + app.checkout.basket.length + '</span>');\n\t\t\t},\n\t\t\tproductInBasket: function(productId) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj !== undefined && obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t\treturn indexes;\n\t\t\t\telse\n\t\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetProductFromBasket: function(productId) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj !== undefined && obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t\treturn app.checkout.basket[indexes];\n\t\t\t\telse\n\t\t\t\t\treturn false;\n\t\t\t},\n\t\t\tremoveProductFromBasket: function(productId, callback) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj !== undefined && obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log(indexes);\n\t\t\t\t\t\tapp.checkout.basket.splice(indexes[0], 1);\n\t\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\tapp.basket.saveBasket();\n\t\t\t\t\t\tapp.basket.updateHtml();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Failed to delete product from basket with error: ' + e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treasons: {},\n\t\tcheckout: {\n\t\t\tbasket: [],\n\t\t\tdelivery: {},\n\t\t\tload: function() {\n\t\t\t\tif(this.basket.length && !$.isEmptyObject(this.delivery))\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.getBasketData();\n\t\t\t\tthis.getDeliveryDate();\n\t\t\t},\n\t\t\tgetBasketData: function() {\n\t\t\t\tif(this.basket.length)\n\t\t\t\t\treturn;\n\t\t\t\t// Get basket from cookies or session from server, maybe store in html as JS var\n\t\t\t\t// See app.widget.productcart.hashProcess()\n\t\t\t\t// This deffered object. Ajax must be return \"return ajax({.....}) ...\"\n\t\t\t\t// Ajax Simulation\n\t\t\t\treturn $.Deferred(function() {\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tconsole.log('Get basket from session or cookies');\n\t\t\t\t\tsetTimeout(function() { // <-- example of some async operation\n\t\t\t\t\t\t// Server Response\n\t\t\t\t\t\tvar response = [{\n\t\t\t\t\t\t\tid: 5,\n\t\t\t\t\t\t\tcount: 3,\n\t\t\t\t\t\t\timgSrc: 'img/b2.jpg',\n\t\t\t\t\t\t\tprice: 2800,\n\t\t\t\t\t\t\tname: 'Черничный пирог',\n\t\t\t\t\t\t\tavailableData: 'с 28 октября',\n\t\t\t\t\t\t\tlabel: 'autumn',\n\t\t\t\t\t\t\tsize: {\n\t\t\t\t\t\t\t\tdia: '60 см',\n\t\t\t\t\t\t\t\theight: '30 см'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcomposition: 'Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента',\n\t\t\t\t\t\t\tinfo: 'Диаметр: 60см<br>Высота: 30см<hr><p>Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента</p>'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\t//{\n\t\t\t\t\t\t\t//\tid: 5,\n\t\t\t\t\t\t\t//\tcount: 1,\n\t\t\t\t\t\t\t//\timgSrc: 'img/b3.jpg',\n\t\t\t\t\t\t\t//\tprice: 1900,\n\t\t\t\t\t\t\t//\tname: 'Свет добра',\n\t\t\t\t\t\t\t//\tavailableData: 'с 14 марта',\n\t\t\t\t\t\t\t//\tsize: {\n\t\t\t\t\t\t\t//\t\tdia: '60 см',\n\t\t\t\t\t\t\t//\t\theight: '30 см'\n\t\t\t\t\t\t\t//\t},\n\t\t\t\t\t\t\t//\tcomposition: 'Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента',\n\t\t\t\t\t\t\t//\tinfo: 'Диаметр: 60см<br>Высота: 30см<hr><p>Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента</p>'\n\t\t\t\t\t\t\t//}\n\t\t\t\t\t\t\t ];\n\t\t\t\t\t\tapp.checkout.basket = response;\n\t\t\t\t\t\tapp.basket.updateHtml();\n\t\t\t\t\t\t$(document).trigger('raketa.basket.get-data');\n\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t},500);\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetDeliveryDate: function() {\n\t\t\t\t// Get from cookie\n\t\t\t\tvar date =  Cookies.get('raketa_delivary__date');\n\t\t\t\tvar timeofday =  Cookies.get('raketa_delivary__timeofday');\n\t\t\t\tif(date)\n\t\t\t\t\tthis.delivery.date = date;\n\t\t\t\tif(timeofday)\n\t\t\t\t\tthis.delivery.timeofday = timeofday;\n\n\t\t\t\tif(date && timeofday) {\n\t\t\t\t\tvar currentDate = new Date();\n\t\t\t\t\tcurrentDate = moment(currentDate).format('YYYY-MM-DD');\n\t\t\t\t\tvar settedDate = moment(date, \"DD.MM.YYYY\").format('YYYY-MM-DD');\n\n\t\t\t\t\tif (moment(settedDate).isBefore(currentDate)) {\n\t\t\t\t\t\tdelete app.checkout.delivery;\n\t\t\t\t\t\tCookies.remove('raketa_delivary__date', { path: '/' });\n\t\t\t\t\t\tCookies.remove('raketa_delivary__timeofday', { path: '/' });\n\t\t\t\t\t} else if (app.widgets.calendar && app.widgets.calendar.loaded) {\n\t\t\t\t\t\tvar obj = $('#widget-calendar');\n\t\t\t\t\t\t$('.radio-group input[name=\"timeofday\"]').removeAttr('disabled');\n\t\t\t\t\t\t$('.radio-group input[name=\"timeofday\"]:checked').attr('checked', false);\n\t\t\t\t\t\t$('.radio-group input[value=\"' + timeofday + '\"]').attr('checked', true);\n\t\t\t\t\t\t$('input[name=\"date\"].datetime-picker').datetimepicker({value: date});\n\t\t\t\t\t\tobj.find('button[type=\"submit\"]').removeAttr('disabled');\n\t\t\t\t\t\tobj.find('button[data-toggle=\"clear-date\"]').removeAttr('disabled');\n\t\t\t\t\t\t$('#selectedDate').html(app.widgets.calendar.getDateString());\n\t\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]');\n\t\t\t\t\t\tif(button.data('label-to'))\n\t\t\t\t\t\t\tbutton = $(button.data('label-to'));\n\t\t\t\t\t\tbutton.html(app.widgets.calendar.getDateString());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tsave: function(callback) {\n\t\t\t\tconsole.log('[FOR DELIVERY] Send form data to server:');\n\n\t\t\t\t//\n\t\t\t\tvar data = {\n\t\t\t\t\tbasket : this.basket,\n\t\t\t\t\tdelivery: this.delivery,\n\t\t\t\t\tfor: this.for\n\t\t\t\t};\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response = {\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tpaymentUrl: 'order_success.html'\n\t\t\t\t\t};\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t},\n\t\twidgets: {\n\t\t\tload: function() {\n\t\t\t\t$.each(this, function(index, value) {\n\t\t\t\t\tif(index !== 'load') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvalue.load();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error('Error loading widget @' + index + ' with error: ' + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tcalendar: {\n\t\t\t\tobj: {},\n\t\t\t\tloaded: false,\n\t\t\t\topened: false,\n\t\t\t\tcalendarInitialized: false,\n\t\t\t\tposition: {},\n\t\t\t\tsetPosition: function() {\n\t\t\t\t\tvar button = $('#header button[data-target=\"#widget-calendar\"]'); // setting the position relative to the element\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tbutton = $('#footer button[data-target=\"#widget-calendar\"]');\n\t\t\t\t\tvar obj = $('#widget-calendar');\n\n\t\t\t\t\tapp.popup.hide();\n\n\t\t\t\t\tif(button.length) {\n\t\t\t\t\t\tvar button_offset = button.offset();\n\t\t\t\t\t\tvar right = device.windowWidth - (button_offset.left + button.outerWidth()) - 20;\n\t\t\t\t\t} else  {\n\t\t\t\t\t\tvar anotherButton = $('#header .buttons .basket').offset();\n\t\t\t\t\t\tvar right = device.windowWidth - (anotherButton.left + $('#header .buttons .basket').outerWidth() - 40);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar _w = obj.width();\n\t\t\t\t\tvar _h = obj.height() ;\n\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\tobj.css('top', 'auto');\n\t\t\t\t\t\tobj.css('right', 'auto');\n\t\t\t\t\t\tobj.css('bottom', - (_h + 40) + 'px');// box shadow\n\t\t\t\t\t\tobj.css('transform', '');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.css('bottom', 'auto');\n\t\t\t\t\t\tobj.css('top', - (_h + 40) + 'px');// box shadow\n\t\t\t\t\t\tobj.css('right', Math.floor(right) + 'px');\n\t\t\t\t\t}\n\n\t\t\t\t\t//obj.css('height', _h + 'px');\n\t\t\t\t\tthis.position.width = _w;\n\t\t\t\t\tthis.position.height = _h;\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tthis.position.bottom = 0;\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.position.top = - _h;\n\t\t\t\t\tthis.position.right = - right;\n\n\t\t\t\t},\n\t\t\t\tlocalInit: function(obj) {\n\t\t\t\t\tthis.obj = obj;\n\t\t\t\t},\n\t\t\t\tload: function() {\n\t\t\t\t\tthis.obj = $(\"#widget-calendar\");\n\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]');\n\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\t$('input[name=\"date\"].datetime-picker').each(function() {\n\t\t\t\t\t\t$(this).datetimepicker(datetimePicker)\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\t\t$('input[name=\"date\"].datetime-picker').each(function() {\n\t\t\t\t\t\t\t$(this).datetimepicker('destroy');\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$('input[name=\"date\"].datetime-picker').each(function() {\n\t\t\t\t\t\t\t$(this).datetimepicker(datetimePicker);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('click tap', 'button[data-toggle=\"setDelivaryDate\"]', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif($(this).attr('disabled'))\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tvar formTarget = $(this).data('to-form');\n\t\t\t\t\t\tvar form = $(formTarget);\n\t\t\t\t\t\t_this.process(form);\n\t\t\t\t\t\tif($(this).data('hide') == true)\n\t\t\t\t\t\t\tapp.popup.hide();\n\n\t\t\t\t\t\t// Если виджет productcart загружен, есть открытый объект, popup открыт, то проверяем какой шаг открыть\n\t\t\t\t\t\tif(app.widgets.productcart\n\t\t\t\t\t\t\t&& app.widgets.productcart.openedObj\n\t\t\t\t\t\t\t&& app.popup.isOpened())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tapp.widgets.productcart.step('orderInfo');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('change', 'form.set-delivery-date input', function() {\n\t\t\t\t\t\tif(_this.obj && _this.obj.hasClass('widget'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log('change delivery date');\n\n\t\t\t\t\t\t\tvar form = $(this).closest('form.set-delivery-date');\n\t\t\t\t\t\t\tvar i = 0;\n\t\t\t\t\t\t\tform.find('input').each(function(index, value) {\n\t\t\t\t\t\t\t\t//console.log(value);\n\t\t\t\t\t\t\t\tvar input = $(value);\n\n\t\t\t\t\t\t\t\tswitch (input.attr('name')) {\n\t\t\t\t\t\t\t\t\tcase 'date':\n\t\t\t\t\t\t\t\t\t\tif(input.val() != '' || input.val() !== undefined)\n\t\t\t\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'timeofday':\n\t\t\t\t\t\t\t\t\t\tif(input.is(':checked'))\n\t\t\t\t\t\t\t\t\t\t\ti++\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif(i == 2)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$('button[data-toggle=\"setDelivaryDate\"]').each(function() {\n\t\t\t\t\t\t\t\t\t$(this).removeAttr('disabled').removeClass('btn-bordered').addClass('btn-primary')\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('button[data-toggle=\"setDelivaryDate\"]').each(function() {\n\t\t\t\t\t\t\t\t\t$(this).attr('disabled', 'disabled').removeClass('btn-primary').addClass('btn-bordered')\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif($(this).is('[name=\"timeofday\"]')) {\n\t\t\t\t\t\t\t\t$('#selectedDate').html(_this.getDateString());\n\t\t\t\t\t\t\t\tif(button.data('thischange') === undefined || button.data('thischange') == true) {\n\t\t\t\t\t\t\t\t\tif(app.checkout.delivery !== undefined)\n\t\t\t\t\t\t\t\t\t\tbutton.html(_this.getDateString());\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tbutton.html(lang.DeliveryDate);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('click tap', 'button[data-toggle=\"clear-date\"]', function(e) {\n\t\t\t\t\t\t$(this).attr('disabled', 'disabled');\n\t\t\t\t\t\t_this.clearDate($(this));\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('open', \"#widget-calendar\", function() {\n\t\t\t\t\t\t_this.open();\n\t\t\t\t\t});\n\t\t\t\t\t$(document).on('close', \"#widget-calendar\", function() {\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('init.xdsoft', function() {\n\t\t\t\t\t\t_this.setPosition();\n\t\t\t\t\t\t_this.calendarInitialized = true;\n\t\t\t\t\t});\n\n\t\t\t\t\t$('#widget-calendar form').on('submit', function(e) {\n\t\t\t\t\t\treturn false; // safari ios hook?\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.loaded = true;\n\t\t\t\t},\n\t\t\t\tgetDateString: function() {\n\t\t\t\t\tvar _str = lang.DeliveryFormattedString;\n\t\t\t\t\t//if(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t//\t_str = '{1} {2}';\n\t\t\t\t\tvar timeofday = this.obj.find('input[name=\"timeofday\"]:checked').val();\n\t\t\t\t\tvar date = this.obj.find('input[name=\"date\"]').val();\n\t\t\t\t\tif(date)\n\t\t\t\t\t\tdate = moment(date, 'DD.MM.YYYY').format('D MMMM');\n\t\t\t\t\telse\n\t\t\t\t\t\tdate = '';\n\t\t\t\t\t_str = String.template(_str, (lang[timeofday] ? lang[timeofday] : ''), date);\n\t\t\t\t\t_str = _str.toLowerCase().capitalizeFirstLetter();\n\t\t\t\t\treturn _str;\n\t\t\t\t},\n\t\t\t\tclearDate: function(button) {\n\t\t\t\t\tvar form = button.closest('form');\n\t\t\t\t\tform.find('.xdsoft_current').removeClass('xdsoft_current');\n\t\t\t\t\tform.find('input[name=\"date\"].delivery-date').val(new Date());\n\t\t\t\t\tform[0].reset();\n\t\t\t\t\t$('#selectedDate').html(lang.DeliveryDate);\n\t\t\t\t\tvar but = $('button[data-target=\"#widget-calendar\"]');\n\n\t\t\t\t\tif(!but.data('thischange'))\n\t\t\t\t\t\tbut.html(lang.DeliveryDate);\n\n\t\t\t\t\t$('button[data-toggle=\"setDelivaryDate\"]').attr('disabled', 'disabled').removeClass('btn-primary').addClass('btn-bordered');\n\t\t\t\t\tform.find('input[name=\"timeofday\"]:checked').attr('checked', false);\n\t\t\t\t\tform.find('input[name=\"timeofday\"]').attr('disabled', 'disabled');\n\t\t\t\t\tdelete app.checkout.delivery;\n\t\t\t\t\tCookies.remove('raketa_delivary__date', { path: '/' });\n\t\t\t\t\tCookies.remove('raketa_delivary__timeofday', { path: '/' });\n\t\t\t\t\tapp.popup.hide();\n\t\t\t\t},\n\t\t\t\topen: function() {\n\t\t\t\t\tthis.obj = $(\"#widget-calendar\");\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Open widget @calendar');\n\n\t\t\t\t\tif($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t\tthis.obj.find('.xdsoft_current').removeClass('xdsoft_current');\n\n\t\t\t\t\tthis.obj.addClass('animation');\n\n\t\t\t\t\tvar pos = this.obj.height() + 40;\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tpos = - this.obj.height() - 40;\n\n\t\t\t\t\tthis.obj.transition({ y: Math.floor(pos) }); //box shadow\n\n\t\t\t\t\tvar _this = this;\n\t\t\t\t\tthis.obj.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {\n\t\t\t\t\t\t_this.obj.removeClass('animation').addClass('opened');\n\t\t\t\t\t});\n\n\t\t\t\t\t_this.opened = true;\n\t\t\t\t},\n\t\t\t\tclose: function() {\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Close widget @calendar');\n\n\t\t\t\t\tthis.obj.removeClass('opened').addClass('animation');\n\t\t\t\t\tvar pos = this.position.top;\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tpos = this.position.bottom;\n\n\t\t\t\t\tthis.obj.find('.warning').removeClass('opened');\n\n\t\t\t\t\tthis.obj.transition({ y: pos, complete: function() {\n\t\t\t\t\t\tthis.opened = false;\n\t\t\t\t\t}});\n\n\t\t\t\t},\n\t\t\t\tprocess: function(form) {\n\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]');\n\t\t\t\t\tvar data = form.serializeObject();\n\t\t\t\t\tapp.checkout.delivery = data;\n\t\t\t\t\tif(button.data('label-to'))\n\t\t\t\t\t\tbutton = $(button.data('label-to'));\n\n\t\t\t\t\tif(app.checkout.delivery !== undefined)\n\t\t\t\t\t\tbutton.html(this.getDateString());\n\t\t\t\t\telse\n\t\t\t\t\t\tbutton.html(lang.DeliveryDate);\n\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t// Save to cookie or maybe ajax?\n\t\t\t\t\tCookies.set('raketa_delivary__date', data.date, { expire: 14, path: '/' });\n\t\t\t\t\tCookies.set('raketa_delivary__timeofday', data.timeofday, { expire: 14, path: '/' });\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tproductcart: {\n\t\t\t\tloaded: false,\n\t\t\t\tstartPosition: {},\n\t\t\t\tstartTitle: '',\n\t\t\t\thashProcess: function() {\n\t\t\t\t\t//$('#bouquet-list').on('raketa.bouquets.loaded raketa.basket.get', function() {\n\t\t\t\t\tvar bouquets = $.Deferred(function() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tvar basket = $.Deferred(function() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t$(document).on('raketa.basket.get-data', function() {\n\t\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t$.when(basket, bouquets).then(function() {\n\t\t\t\t\t\tvar hash = Hash.get();\n\t\t\t\t\t\tvar obj;\n\t\t\t\t\t\tif (hash.anchor) {\n\t\t\t\t\t\t\twindow.location.hash = hash.anchor;\n\t\t\t\t\t\t} else if (hash.bouquet) {\n\t\t\t\t\t\t\tobj = $('#bouquet-list li[data-bouquet-id=\"' + hash.bouquet + '\"] > div[data-toggle=\"popup\"]')\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(obj)\n\t\t\t\t\t\t\tobj.trigger('click');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tload: function() {\n\t\t\t\t\tthis.obj = $('.product-cart');\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\tthis.hashProcess();\n\n\t\t\t\t\t$(document).on('open', '.product-cart', function(e) {\n\t\t\t\t\t\t_this.open(e);\n\t\t\t\t\t});\n\t\t\t\t\t$(document).on('close', '.product-cart', function() {\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t});\n\n\t\t\t\t\t// Show product info\n\t\t\t\t\t$(document).on('click tap', '.product-cart button[data-toggle=\"show-product-info\"]', function() {\n\t\t\t\t\t\tvar id = $(this).data('product-id');\n\t\t\t\t\t\t$(this).toggleClass('active');\n\t\t\t\t\t\t$('#header').toggleClass('transparent');\n\t\t\t\t\t\t// uncomment to support light\\dark product cart color information\n\t\t\t\t\t\t//if($('#popup-product-' + id).data('lightness') == 'light')\n\t\t\t\t\t\t//\t$('#popup-product-' + id).toggleClass('light');\n\t\t\t\t\t\tvar owl = _this.gallery;\n\t\t\t\t\t\tif($(this).hasClass('active'))\n\t\t\t\t\t\t\towl.trigger('stop.owl.autoplay');\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\towl.trigger('play.owl.autoplay');\n\t\t\t\t\t\t$('#popup-product-' + id + ' .product-info').fadeToggle(300, function() {\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t});\n\n\t\t\t\t\t// Open next/prev product cart\n\t\t\t\t\t$(document).on('click tap', '.product-cart button.direction', function(e) {\n\t\t\t\t\t\tvar direction = $(this).data('direction');\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart - change current cart (' + direction + ')');\n\n\t\t\t\t\t\tvar currentIndex = index = _this.openedObj.closest('li[data-bouquet-id]').index();\n\t\t\t\t\t\tconsole.log('Opened index element ' + index);\n\n\t\t\t\t\t\tswitch (direction) {\n\t\t\t\t\t\t\tcase 'prev':\n\t\t\t\t\t\t\t\tindex = (index - 1 < 0 ? $('#bouquet-list li:last-child').index() : index - 1);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'next':\n\t\t\t\t\t\t\t\tindex = (index + 1 > $('#bouquet-list li').length - 1 ? 0 : index + 1);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t\tvar indexed = $('#bouquet-list li').eq(index);\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tindexed.find('div[data-toggle=\"popup\"]').data('order', true).trigger('click');\n\t\t\t\t\t\t}, 300);\n\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\t\tvar gallery = $('.product-cart').find('.gallery-list');\n\t\t\t\t\t\tvar w = $('.product-cart').width();\n\t\t\t\t\t\tvar h = $('.product-cart').height();\n\t\t\t\t\t\tif(gallery.length > 0) {\n\n\n\t\t\t\t\t\t\tif(device.type != 'smallmobile' && device.type != 'mobile') {\n\t\t\t\t\t\t\t\tgallery.css('height', h);\n\t\t\t\t\t\t\t\tgallery.find('.slide').css('height', h);\n\t\t\t\t\t\t\t\t$('.product-cart').find('.gallery .slide').css('height', h);\n\t\t\t\t\t\t\t\tgallery.find('.owl-height').css('height', h);\n\t\t\t\t\t\t\t\tgallery.find('.owl-lazy').css('width', w/2);\n\t\t\t\t\t\t\t\tgallery.css('width', w/2);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar headerHeight =  $('#header').height();\n\t\t\t\t\t\t\t\tgallery.css('height', device.windowHeight - headerHeight);\n\t\t\t\t\t\t\t\tgallery.find('.slide').css('height', device.windowHeight - headerHeight);\n\t\t\t\t\t\t\t\t$('.product-cart').find('.gallery .slide').css('height', device.windowHeight - headerHeight);\n\t\t\t\t\t\t\t\tgallery.find('.owl-height').css('height', device.windowHeight - headerHeight);\n\t\t\t\t\t\t\t\tgallery.find('.owl-lazy').css('width', w);\n\t\t\t\t\t\t\t\tgallery.css('width', w);\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\titems: 1,\n\t\t\t\t\t\t\t\tmargin: 0,\n\t\t\t\t\t\t\t\tlazyLoad:false,\n\t\t\t\t\t\t\t\tloop:true,\n\t\t\t\t\t\t\t\tautoplay: true,\n\t\t\t\t\t\t\t\tautoplayTimeout: 4000,\n\t\t\t\t\t\t\t\tautoplayHoverPause: true\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart Found gallery in product cart');\n\n\t\t\t\t\t\t\tgallery.on('initialized.owl.carousel', function(event) {\n\t\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\n\t\t\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\t\t\t\tvar img = element.find('.owl-item').eq(item).find('.slide');\n\t\t\t\t\t\t\t\t\tvar info = element.closest('.content');\n\t\t\t\t\t\t\t\t\tinfo.find('.cart .product-info > .bluredBg').css('background-image', img.css('background-image'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tgallery.on('changed.owl.carousel', function(event) {\n\t\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\t\t\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\t\t\t\tvar img = element.find('.owl-item').eq(item).find('.slide');\n\t\t\t\t\t\t\t\t\tvar info = element.closest('.content');\n\t\t\t\t\t\t\t\t\tinfo.find('.cart .product-info > .bluredBg').css('background-image', img.css('background-image'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tgallery.find('.owl-lazy').on('click tap', function() {\n\t\t\t\t\t\t\t\tgallery.trigger('next.owl.carousel');\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tgallery.owlCarousel(params);\n\t\t\t\t\t\t\t_this.gallery = gallery;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\t$('button[data-toggle=\"close-widget\"]').on('click tap', function(e) {\n\t\t\t\t\t\t\tapp.popup.hide();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.loaded = true;\n\t\t\t\t},\n\t\t\t\topen: function(e) {\n\t\t\t\t\tvar obj = $(e.target);\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Open widget @productcart with id #' + obj.attr('id'));\n\n\t\t\t\t\t$('#bouquet-list li[data-bouquet-id=\"' + obj.data('product-id') + '\"] > div[data-toggle=\"popup\"]').data('order', false);\n\n\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\tobj.css('height', device.windowHeight - $('#header').height());\n\t\t\t\t\t\t$('#header button.navbar-toggle').hide();\n\t\t\t\t\t\t$('#header button.mobile.back').show();\n\n\t\t\t\t\t\tvar img = obj.find('.gallery .slide').first();\n\t\t\t\t\t\tvar info_bg = obj.find('.cart .product-info > .bluredBg');\n\t\t\t\t\t\tif (info_bg.css('background-image') == 'none')\n\t\t\t\t\t\t\tinfo_bg.css('background-image', img.css('background-image'));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar height = obj.height();\n\t\t\t\t\tvar width = obj.width();\n\n\t\t\t\t\tobj.find('.bottom').hide();\n\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\tobj.css('top', 'auto');\n\t\t\t\t\t\tobj.css('bottom', -height).css('visibility', 'visible');\n\t\t\t\t\t\tthis.startPosition.bottom = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.css('top', -height).css('visibility', 'visible');\n\t\t\t\t\t\tthis.startPosition.top = -height;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Если этот товар в корзине и указана дата доставки, то шаг 3\n\t\t\t\t\tvar index;\n\t\t\t\t\tif(app.basket.productInBasket(obj.data('product-id')) && !$.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t{\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step 3');\n\t\t\t\t\t\tif (device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\t\tobj.find('.gallery').css('opacity', 0.2);\n\t\t\t\t\t\tthis.loadStep3(obj, app.basket.productInBasket(obj.data('product-id')));\n\t\t\t\t\t}\n\t\t\t\t\telse if(app.basket.productInBasket(obj.data('product-id')) && $.isEmptyObject(app.checkout.delivery)) // Товар в корзине и дата доставки не указана - шаг 2\n\t\t\t\t\t{\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step 2');\n\t\t\t\t\t\tapp.widgets.calendar.localInit(obj.find('.step2'));\n\t\t\t\t\t\tif($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t\t\tobj.find('.xdsoft_current').removeClass('xdsoft_current');\n\n\t\t\t\t\t\tif (device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\t\tobj.find('.gallery').css('opacity', 0.2);\n\n\t\t\t\t\t\tobj.find('.step').hide().removeClass('active');\n\t\t\t\t\t\tobj.find('.step2').addClass('active').show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.find('.step.active').removeClass('active');\n\t\t\t\t\t\tobj.find('.step1').addClass('active').show();\n\t\t\t\t\t}\n\n\n\n\t\t\t\t\tvar width = obj.outerWidth();\n\t\t\t\t\tobj.css('margin-left', Math.ceil(-width/2));\n\n\t\t\t\t\tobj.addClass('transition');\n\n\t\t\t\t\tvar transEnd = function() {\n\t\t\t\t\t\tobj.removeClass('transition').addClass('opened');\n\t\t\t\t\t\tobj.find('.bottom button:first-child').focus();\n\t\t\t\t\t\tobj.find('.bottom').fadeIn(100);\n\t\t\t\t\t}\n\t\t\t\t\tif(device.type == 'desktop' && (device.subtype == 'fullhd' || device.subtype == 'hd'))\n\t\t\t\t\t\tobj.transition({ y: Math.floor(device.windowHeight - (device.windowHeight - height)/2), complete: transEnd});\n\t\t\t\t\telse if (device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\tobj.transition({ y: Math.floor(- height), complete: transEnd});\n\t\t\t\t\t} else\n\t\t\t\t\t\tobj.transition({ y: Math.floor(height + $('#header').height()), complete: transEnd});\n\n\t\t\t\t\t// History add\n\t\t\t\t\tthis.startTitle = document.title;\n\t\t\t\t\tdocument.title = lang.bouquet + ' ' + obj.data('title');\n\t\t\t\t\tHash.add('bouquet', obj.data('product-id'));\n\t\t\t\t\tthis.openedObj = obj;\n\t\t\t\t},\n\t\t\t\tclose: function() {\n\t\t\t\t\tvar obj = this.openedObj;\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Close widget @productcart');\n\n\t\t\t\t\tif (device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tobj.find('.gallery').css('opacity', 1);\n\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\t//$('#header button[data-target=\"#widget-calendar\"]').slideDown(200);\n\t\t\t\t\t\t$('#content .mobile.notify').removeClass('open');\n\t\t\t\t\t\t$('#header button[data-toggle=\"close-widget\"]').hide();\n\t\t\t\t\t\t$('#header button.navbar-toggle').show();\n\t\t\t\t\t}\n\n\t\t\t\t\tobj.removeClass('opened').addClass('animation');\n\t\t\t\t\tvar pos = this.startPosition.top;\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tpos = this.startPosition.bottom;\n\t\t\t\t\tobj.transition({ y: pos });\n\t\t\t\t\twindow.location.hash = '';\n\t\t\t\t\thistory.pushState('', document.title, window.location.pathname);\n\t\t\t\t\tdocument.title = this.startTitle;\n\t\t\t\t\tdelete this.openedObj;\n\t\t\t\t},\n\t\t\t\tstep: function(step) {\n\t\t\t\t\tif(!step)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step - ' + step);\n\n\t\t\t\t\tvar obj = this.openedObj;\n\t\t\t\t\tswitch (step) {\n\t\t\t\t\t\tcase 'cart':\n\t\t\t\t\t\t\tobj.find('.step.active').fadeOut('fast', function() {\n\t\t\t\t\t\t\t\t$(this).removeClass('active');\n\t\t\t\t\t\t\t\tobj.find('.step.step1').fadeIn('fast').addClass('active');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\t\t\tobj.find('.gallery').css('opacity', 1);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'delivaryDate':\n\t\t\t\t\t\t\tobj.find('.step.active').fadeOut('fast', function() {\n\t\t\t\t\t\t\t\t$(this).removeClass('active');\n\t\t\t\t\t\t\t\tobj.find('.step.step2').fadeIn('fast').addClass('active');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\t\t\tobj.find('.gallery').css('opacity', 0.2);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'orderInfo':\n\t\t\t\t\t\t\tthis.loadStep3(obj, app.basket.productInBasket(obj.data('product-id')));\n\t\t\t\t\t\t\tif (device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\t\t\tobj.find('.gallery').css('opacity', 0.2);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadStep3: function(obj, index) {\n\t\t\t\t\tobj.find('.step').hide().removeClass('active');\n\t\t\t\t\tobj.find('.step3').addClass('active').show();\n\t\t\t\t\t$('#content .mobile.notify').addClass('open');\n\t\t\t\t\tvar inBasket = app.basket.getProductFromBasket(obj.data('product-id'));\n\n\t\t\t\t\tvar _str = lang.bouquetInBasketPopupCart;\n\t\t\t\t\tvar _str2 = inBasket.count + ' ' + lang.bouquet + getNumEnding(inBasket.count, ['', 'а', 'ов']);\n\n\t\t\t\t\tvar price = inBasket.count * inBasket.price;\n\t\t\t\t\tif(price > 10000)\n\t\t\t\t\t\tprice = price.format(0, 3, ' ', '.');\n\n\t\t\t\t\t_str = String.template(_str, _str2.toLowerCase(), price + lang.currencySymbol);\n\n\t\t\t\t\t$('#in-basket-product-' + obj.data('product-id')).html('<span class=\"icon-basket\"></span> ' + _str);\n\t\t\t\t\t$('#p' + obj.data('product-id') + '-count').val(inBasket.count);\n\n\t\t\t\t\t$('[data-trigger=\"spinner\"]')\n\t\t\t\t\t\t.spinner('changing', function(e, newVal, oldVal) {\n\t\t\t\t\t\t\tvar name = $(this).attr('name');\n\n\t\t\t\t\t\t\tif(newVal < 0)\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tif(app.checkout.basket[index[0]])\n\t\t\t\t\t\t\t\tapp.checkout.basket[index[0]].count = newVal;\n\n\t\t\t\t\t\t\tif(newVal == 0)\n\t\t\t\t\t\t\t\tdelete app.checkout.basket[index[0]];\n\n\t\t\t\t\t\t\tvar _str = lang.bouquetInBasketPopupCart;\n\t\t\t\t\t\t\tvar _str2 = newVal + ' ' + lang.bouquet + getNumEnding(inBasket.count, ['', 'а', 'ов']);\n\n\t\t\t\t\t\t\tvar price = newVal * inBasket.price;\n\t\t\t\t\t\t\tif(price > 10000)\n\t\t\t\t\t\t\t\tprice = price.format(0, 3, ' ', '.');\n\n\t\t\t\t\t\t\t_str = String.template(_str, _str2.toLowerCase(), price + lang.currencySymbol);\n\n\t\t\t\t\t\t\t$('#in-basket-product-' + obj.data('product-id')).html('<span class=\"icon-basket\"></span> ' + _str);\n\n\t\t\t\t\t\t\tapp.basket.saveBasket();\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlayout: {\n\t\t\tcurrentLayout: {},\n\t\t\tinitStyle: function() {\n\t\t\t\tif($.isEmptyObject(this.currentLayout)) return;\n\n\t\t\t\tif(settings.env == 'dev') console.log('Set layout('+this.currentLayout.name+') template style');\n\t\t\t\tthis.setStyleLayout(this.currentLayout.name, this.currentLayout.container);\n\t\t\t},\n\t\t\tinit: function(container, callback) {\n\t\t\t\tif(!container)\n\t\t\t\t\tcontainer = $('div[data-layout]');\n\n\t\t\t\tvar layout = container.data('layout');\n\n\t\t\t\tif (!layout){\n\t\t\t\t\tconsole.error('Layout attribute not found');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.currentLayout.name = layout;\n\t\t\t\tthis.currentLayout.container = container;\n\t\t\t\tthis.currentLayout.callback = callback;\n\t\t\t\tif(settings.env == 'dev') console.log('Initialize layout('+layout+')');\n\t\t\t\tthis.loadLayout(layout, container, callback);\n\t\t\t},\n\t\t\tsetStyleLayout: function(layout, container) {\n\t\t\t\t//if(layout != 'devided-slider' && (device.type == 'smallmobile' || device.type == 'mobile'))\n\t\t\t\t//\treturn;\n\t\t\t\tvar currentH = container.outerHeight();\n\t\t\t\tvar newH = Math.ceil(($w.height() - $('#header').outerHeight()) - 50);\n\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\tnewH += 50;\n\n\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\tswitch(layout) {\n\t\t\t\t\t\tcase 'devided-slider':\n\t\t\t\t\t\t\tcontainer.find('.menu-wrapper').css('height', newH + 'px');\n\t\t\t\t\t\t\tcontainer.find('.content-panel').css('height', newH + 'px');\n\t\t\t\t\t\t\tcontainer.find('.owl-item').css('height', newH + 'px');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'devided':\n\t\t\t\t\t\t\tcontainer.not('.authorization').find('.menu-wrapper').css('min-height', newH + 'px');\n\t\t\t\t\t\t\tcontainer.not('.checkout.checkout-basket').find('.content-panel').css('min-height', newH + 'px');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcontainer.css('min-height', newH + 'px');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar visibleHeight = 0;\n\t\t\t\t\tswitch(layout) {\n\t\t\t\t\t\tcase 'devided':\n\t\t\t\t\t\t\t// prority of content-panel block\n\t\t\t\t\t\t\tvar _cont = container.find('.content-panel');\n\t\t\t\t\t\t\t_cont.children().each(function() {\n\t\t\t\t\t\t\t\tconsole.log($(this).outerHeight(true));\n\t\t\t\t\t\t\t\tvisibleHeight += $(this).outerHeight(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconsole.log(visibleHeight);\n\t\t\t\t\t\t\tif(visibleHeight > device.windowHeight - $('#header').outerHeight())\n\t\t\t\t\t\t\t\tcontainer.css('min-height', visibleHeight + 'px');\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tcontainer.css('height', newH + 'px');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'default':\n\t\t\t\t\t\t\tcontainer.children().each(function() {\n\t\t\t\t\t\t\t\tvisibleHeight += $(this).outerHeight(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconsole.log(visibleHeight);\n\t\t\t\t\t\t\tif(visibleHeight > device.windowHeight - $('#header').outerHeight())\n\t\t\t\t\t\t\t\tcontainer.css('min-height', newH + 'px');\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tcontainer.css('height', newH + 'px');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tcontainer.css('height', newH + 'px');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tloadLayout: function(layout, container, callback) {\n\t\t\t\tswitch (layout) {\n\t\t\t\t\tcase 'devided-slider':\n\n\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile'){\n\t\t\t\t\t\t\t$('.layout-menu li.active').removeClass('active');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar w = $(\"#content\").width();\n\t\t\t\t\t\tvar owl = $('#slider-content');\n\t\t\t\t\t\tif(device.type != 'smallmobile' && device.type != 'mobile')\n\t\t\t\t\t\t\towl.css('width', w/2);\n\n\t\t\t\t\t\towl.on('initialized.owl.carousel', function(event) {\n\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\t\t\t\t\t\t\tvar hash = current.data('hash');\n\t\t\t\t\t\t\tif(device.type != 'smallmobile' && device.type != 'mobile') {\n\t\t\t\t\t\t\t\tcontainer.find('.layout-menu li.active').removeClass('active');\n\t\t\t\t\t\t\t\tcontainer.find('.layout-menu a[href=\"#' + hash + '\"]').parent().addClass('active');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[OWL Carousel] Event initialized.owl.carousel');\n\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom').hide();\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom[data-to-slide=\"'+ hash +'\"]').fadeIn(200);\n\t\t\t\t\t\t});\n\t\t\t\t\t\towl.on('changed.owl.carousel', function(event) {\n\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\t\t\t\t\t\t\tvar hash = current.data('hash');\n\n\t\t\t\t\t\t\tif((device.type == 'smallmobile' || device.type == 'mobile') && hash) {\n\t\t\t\t\t\t\t\tvar title = container.find('.layout-menu li a[href=\"#' + hash + '\"]').text();\n\t\t\t\t\t\t\t\t$('#header .mobile.title').html(title);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcontainer.find('.layout-menu li.active').removeClass('active');\n\t\t\t\t\t\t\t\tcontainer.find('.layout-menu a[href=\"#' + hash + '\"]').parent().addClass('active');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(hash)\n\t\t\t\t\t\t\t\twindow.location.hash = hash;\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[OWL Carousel] Event changed.owl.carousel #' + hash);\n\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom').hide();\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom[data-to-slide=\"'+ hash +'\"]').fadeIn(300);\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\titems:1,\n\t\t\t\t\t\t\tURLhashListener:true,\n\t\t\t\t\t\t\tstartPosition: 'URLHash',\n\t\t\t\t\t\t\tsmartSpeed:450,\n\t\t\t\t\t\t\tanimateOut:'fadeOut',\n\t\t\t\t\t\t\tanimateIn: 'fadeIn',\n\t\t\t\t\t\t\tafterInit: function(elem){\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif(device.type != 'smallmobile' && device.type != 'mobile'){\n\t\t\t\t\t\t\tparams.autoHeight = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\towl.owlCarousel(params);\n\n\t\t\t\t\t\towl.find('button,input,select').addClass('not-draggable').on(\"touchstart mousedown\", function(e) {\n\t\t\t\t\t\t\t// Prevent carousel swipe\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\towl.parent().find('button[type=\"submit\"]').on('click', function() {\n\t\t\t\t\t\t\tvar slide = owl.find('.item[data-hash=\"' + $(this).data('to-slide') +'\"]');\n\t\t\t\t\t\t\tslide.find('form').trigger('submit');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\n\t\t\t\t\t\t// Load mobile binds\n\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\t\t//container.find('.content-panel').hide();\n\t\t\t\t\t\t\tvar hash = window.location.hash;\n\t\t\t\t\t\t\tif(hash){\n\t\t\t\t\t\t\t\tcontainer.find('.content-panel').fadeIn(200);\n\t\t\t\t\t\t\t\t$('.layout.devided-slider .menu-wrapper').transition({ x: -device.windowWidth, complete: function() {\n\t\t\t\t\t\t\t\t\t$(window).scrollTop(0);\n\t\t\t\t\t\t\t\t}});\n\t\t\t\t\t\t\t\t$('#header .navbar-toggle').hide();\n\t\t\t\t\t\t\t\t$('#header .back').show();\n\n\t\t\t\t\t\t\t\tvar title = $('#content ul.layout-menu a[href=\"'+hash+'\"]').text();\n\t\t\t\t\t\t\t\t$('#header .mobile.title').html(title);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$('button[data-toggle=\"devided-slider-back\"]').on('click tap', function(e) {\n\t\t\t\t\t\t\t\t$(this).hide();\n\t\t\t\t\t\t\t\t$('#header .navbar-toggle').show();\n\t\t\t\t\t\t\t\t$('#header .mobile.title').html($('title').text());\n\t\t\t\t\t\t\t\twindow.location.hash = '';\n\t\t\t\t\t\t\t\t$('.layout.devided-slider .menu-wrapper').transition({ x: 0, complete: function() {\n\t\t\t\t\t\t\t\t\t$(window).scrollTop(0);\n\t\t\t\t\t\t\t\t\tcontainer.find('.content-panel').hide();\n\t\t\t\t\t\t\t\t}});\n\t\t\t\t\t\t\t\tcontainer.find('input').blur();\n\t\t\t\t\t\t\t\tcontainer.find('textarea').blur();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(\"#content ul.layout-menu a\").on('click', function(e) {\n\t\t\t\t\t\t\tif(!$(this).parent().hasClass('active')) {\n\t\t\t\t\t\t\t\t$(this).parents('.layout-menu').find('li.active').removeClass('active');\n\t\t\t\t\t\t\t\t$(this).parent().addClass('active');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile'){\n\t\t\t\t\t\t\t\t$('.layout.devided-slider .menu-wrapper').transition({ x: -device.windowWidth, complete: function() {\n\n\t\t\t\t\t\t\t\t}});\n\t\t\t\t\t\t\t\tcontainer.find('.content-panel').show();\n\t\t\t\t\t\t\t\t$('#header .navbar-toggle').hide();\n\t\t\t\t\t\t\t\t$('#header .back').show();\n\t\t\t\t\t\t\t\tvar title = $(this).text();\n\t\t\t\t\t\t\t\t$('#header .mobile.title').html(title);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'default':\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'devided':\n\n\n\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile' && container.hasClass('reasons') || container.hasClass('promocodes')){\n\n\t\t\t\t\t\t\t$('button[data-toggle=\"devided-slider-back\"]').on('click tap', function(e) {\n\t\t\t\t\t\t\t\tHash.clear();\n\t\t\t\t\t\t\t\tcontainer.find('.menu-wrapper').show();\n\t\t\t\t\t\t\t\tcontainer.find('.menu-wrapper').transition({ x: 0, complete: function() {\n\t\t\t\t\t\t\t\t\t$(window).scrollTop(0);\n\t\t\t\t\t\t\t\t}});\n\t\t\t\t\t\t\t\tcontainer.find('input').blur();\n\t\t\t\t\t\t\t\tcontainer.find('textarea').blur();\n\t\t\t\t\t\t\t\t$('#header .back').hide();\n\t\t\t\t\t\t\t\t$('#header .mobile.title').html($('title').text());\n\t\t\t\t\t\t\t\t$('#header .navbar-toggle').show();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif(typeof callback === 'function')\n\t\t\t\t\tcallback(container);\n\t\t\t}\n\t\t},\n\t\tcallback: {\n\t\t\torder: function(form) {\n\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t\t\t\tvar data = form.serializeArray();\n\t\t\t\tajaxloader.local({\n\t\t\t\t\telement: form,\n\t\t\t\t\tto: '.item[data-hash=\"callback\"]',\n\t\t\t\t\ttitle: lang.processPhoneCheck\n\t\t\t\t});\n\t\t\t\tthis.process(data, function(response) {\n\t\t\t\t\tajaxloader.finish();\n\t\t\t\t\tform.hide();\n\t\t\t\t\t$('#slider-content .owl-height').css('height', $('#support').height());\n\t\t\t\t\t$('#callback-order-success').css('height', $('#support').height()).fadeIn(200);\n\n\t\t\t\t\tcountDown({\n\t\t\t\t\t\ttime: 10, // in seconds\n\t\t\t\t\t\tdisplay:  $('#callback-order-success .timer'),\n\t\t\t\t\t\tafterFinish: function() {\n\t\t\t\t\t\t\t$('#callback-order-success').fadeOut(200, function() {\n\t\t\t\t\t\t\t\tform[0].reset();\n\t\t\t\t\t\t\t\tform.fadeIn(200);\n\t\t\t\t\t\t\t\t$('#slider-content .owl-height').css('height', form.outerHeght());\n\t\t\t\t\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').show();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t},\n\t\t\tprocess: function(data, callback) {\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\n\t\t\t\t\tvar response = [];\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t},\n\t\tauth: {\n\t\t\tinit: function() {\n\t\t\t\tvar auth_form = $('#auth-form');\n\t\t\t\tthis.validateForm(auth_form);\n\t\t\t\tauth_form.find('input').on('keyup', function() {\n\t\t\t\t\t$(this).removeClass('error').parent().removeClass('has-error');\n\t\t\t\t\t$(this).next('i.fa').remove();\n\t\t\t\t});\n\n\t\t\t\tauth_form.closest('.content-panel').find('.bottom button[type=\"submit\"]').on('click', function(e) {\n\t\t\t\t\tvar targetForm = $(this).data('to-form');\n\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('Click bottom button with target form ' + targetForm);\n\t\t\t\t\tif(!targetForm || $(targetForm).length == 0)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tvar form = $(targetForm);\n\t\t\t\t\tform.trigger('submit');\n\t\t\t\t\tform.closest('.static').find('.form-status').remove();\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t},\n\t\t\tvalidateForm: function(form) {\n\t\t\t\tvar _this = this;\n\t\t\t\tjQuery.validator.addMethod(\n\t\t\t\t\t'regexp',\n\t\t\t\t\tfunction(value, element, regexp) {\n\t\t\t\t\t\tvar re = new RegExp(regexp);\n\t\t\t\t\t\treturn this.optional(element) || re.test(value);\n\t\t\t\t\t},\n\t\t\t\t\t\"Please check your input.\"\n\t\t\t\t);\n\t\t\t\tform.validate({\n\t\t\t\t\tonfocusout: false,\n\t\t\t\t\tonkeyup: false,\n\t\t\t\t\tonclick: false,\n\t\t\t\t\tfocusInvalid: false,\n\t\t\t\t\tsubmitHandler: function() {\n\t\t\t\t\t\t_this.authorizationSubmitHandler(form);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\trules: {\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tminlength: 3,\n\t\t\t\t\t\t\tregexp: '^[А-яA-zёЁ\\s-]{3,}$'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tphone: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tminlength: 5,\n\t\t\t\t\t\t\tregexp: '[0-9\\\\+\\\\-\\\\s\\\\(\\\\)]{18}$'\n\t\t\t\t\t\t},\n\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\temail: true\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmessages:{\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\trequired: \"Поле обязательно для заполнения\",\n\t\t\t\t\t\t\tminlength: \"Имя не может быть менее 3 символов\",\n\t\t\t\t\t\t\tregexp: \"Имя указано не верно\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tphone: {\n\t\t\t\t\t\t\trequired: \"Поле обязательно для заполнения\",\n\t\t\t\t\t\t\tminlength: \"Телефон не может сожержать менее 5 символов\",\n\t\t\t\t\t\t\tregexp: \"Телефон указан не верно\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\temail: \"Введите корректный адрес\"\n\t\t\t\t\t},\n\t\t\t\t\tshowErrors: function(errorMap, errorList) {\n\t\t\t\t\t\tif (errorList.length < 1) {\n\t\t\t\t\t\t\tform.removeClass('has-error');\n\t\t\t\t\t\t\tform.find('input').removeClass('error').parent().removeClass('has-error');\n\t\t\t\t\t\t\tform.find('i.fa').remove();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$.each(errorList, function(index, error) {\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').next('i.fa').remove();\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').addClass('error').parent().addClass('has-error');\n\t\t\t\t\t\t\tform.addClass('has-error');\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').after('<i class=\"fa fa-exclamation-triangle tooltip\" data-toggle=\"tooltip\" title=\"' + error.message + '\"></i>');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tauthorizationProcess: function(data,callback) {\n\t\t\t\tconsole.log('[AUTHORIZATION] Send form data to server:');\n\t\t\t\tconsole.log(data);\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response = {\n\t\t\t\t\t\tmessage: 'Неверно указан номер',\n\t\t\t\t\t\tstatus: false, // example phone error\n\t\t\t\t\t};\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 1500);\n\t\t\t},\n\t\t\tauthorizationSubmitHandler: function(form) {\n\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t\t\t\tvar data = form.serializeArray();\n\t\t\t\tvar step = form.closest('.static');\n\t\t\t\tform.css('opacity', 0);\n\t\t\t\tajaxloader.local({\n\t\t\t\t\telement: form,\n\t\t\t\t\tto: '.static',\n\t\t\t\t\ttitle: lang.processAuthorization\n\t\t\t\t});\n\t\t\t\tthis.authorizationProcess(data, function(response) {\n\t\t\t\t\tif(response.status != true)\n\t\t\t\t\t{\n\n\t\t\t\t\t\tvar message = $('<div />').addClass('table form-status')\n\t\t\t\t\t\t\t.css('width', step.outerWidth())\n\t\t\t\t\t\t\t.css('height', step.outerHeight())\n\t\t\t\t\t\t\t.append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t\t\t\t\t\tstep.prepend(message);\n\n\t\t\t\t\t\tajaxloader.finish();\n\n\t\t\t\t\t\tform.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tmessage.css('background-color', 'transparent');\n\t\t\t\t\t\t\tmessage.css('height', 'auto');\n\t\t\t\t\t\t\tmessage.find('span').addClass('inline');\n\n\t\t\t\t\t\t\tvar h = message.height();\n\t\t\t\t\t\t\tvar offset = form.offset().top;\n\t\t\t\t\t\t\tvar pos = 0;\n\t\t\t\t\t\t\tif(device.windowHeight < 900)\n\t\t\t\t\t\t\t\tpos = -20\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tpos = -80\n\t\t\t\t\t\t\tmessage.transition({\n\t\t\t\t\t\t\t\ty: pos,\n\t\t\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\t\t\tmessage.css('z-index', 0);\n\t\t\t\t\t\t\t\t\tform.fadeTo(200, 1);\n\t\t\t\t\t\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 700)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.location = \"/\";\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t}\n\t};\n\n\n\tajaxloader = {\n\t\tlocal: function(params) {\n\t\t\tif(!params.element)\n\t\t\t\treturn;\n\n\t\t\tvar element = params.element;\n\n\n\t\t\tvar ajaxloader = $('<div />').addClass('ajax-loader-local')\n\t\t\t\t.css('width', element.outerWidth())\n\t\t\t\t.css('height', element.outerHeight());\n\n\t\t\tif(params.title && params.title.length > 0)\n\t\t\t{\n\t\t\t\tvar title = $('<div />').addClass('title').html(params.title);\n\t\t\t\tajaxloader.append(title);\n\t\t\t}\n\n\t\t\tif(params.image && params.image.length > 0)\n\t\t\t{\n\t\t\t\tvar image = $('<img />').addClass('image')\n\t\t\t\t\t.attr('src', params.image);\n\t\t\t\tajaxloader.append(image);\n\t\t\t} else {\n\t\t\t\tvar icon = $('<div />').addClass('icon')\n\t\t\t\t\t.attr('src', params.image);\n\t\t\t\tajaxloader.append(icon);\n\t\t\t}\n\n\t\t\tif(params.to && params.to != '') {\n\t\t\t\tvar to = element.closest(params.to);\n\t\t\t\tajaxloader.css('width', to.outerWidth())\n\t\t\t\t\t.css('height', to.outerHeight());\n\t\t\t\tto.prepend(ajaxloader);\n\t\t\t} else\n\t\t\t\telement.prepend(ajaxloader);\n\t\t\tajaxloader.fadeIn(200);\n\t\t\tthis.ajaxloader = ajaxloader;\n\t\t},\n\t\tfinish: function(callback) {\n\t\t\tif(!this.ajaxloader)\n\t\t\t\treturn\n\t\t\tvar _this = this;\n\t\t\tthis.ajaxloader.fadeOut(200, function() {\n\t\t\t\t_this.ajaxloader.remove();\n\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\tcallback();\n\t\t\t});\n\n\t\t}\n\t};\n\n\tapp.profile = {\n\t    init: function() {\n\t        this.bind();\n\t    },\n\t    bind: function() {\n\t        $('#edit-personal-data').submit(function(e) {\n\t            console.log(e);\n\t            e.preventDefault();\n\t            app.profile.personal.save($(this));\n\t            return false;\n\t        });\n\t\n\t        $('#edit-personal-data input[type=\"text\"]').on('keydown', function(e) {\n\t            $('button[data-to-slide=\"personal\"]').removeAttr('disabled');\n\t            var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t            bottom.find('.button-group').removeClass('one-button').addClass('two-button');\n\t            bottom.find('button.btn-dismiss').removeClass('hide');\n\t        });\n\t\n\t        $('body').on('click', 'button[type=\"dismiss\"]', function(e) {\n\t            e.preventDefault();\n\t            var form = $('#edit-personal-data');\n\t            form[0].reset();\n\t            var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t            bottom.find('.button-group').removeClass('two-button').addClass('one-button');\n\t            bottom.find('button.btn-dismiss').addClass('hide');\n\t            var input = form.find('input[name=\"phone\"]');\n\t            input.attr('disabled', 'disabled');\n\t            input.parent().addClass('disabled');\n\t            input.parents('.form-group').find('button.edit-phone').hide();\n\t        });\n\t\n\t        $('body').on('click', 'button[type=\"delete-card\"]', function(e) {\n\t            e.preventDefault();\n\t            var cardId = $(this).parents('li[data-card-id]').data('card-id');\n\t            var cartName = $(this).parents('div.creditcard').find('.creditcard-name').html();\n\t            var str = String.template(lang.creditcardquestdelete, cartName);\n\t            if(cardId) {\n\t                app.modal.dialog({\n\t                    content: str,\n\t                    buttons: {\n\t                        yes: {\n\t                            title: lang.dialogDeleteButton,\n\t                            class: 'delete',\n\t                            action: function(){\n\t                                if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                                app.profile.creditcard.del(cardId);\n\t                            }\n\t                        },\n\t                        no: {\n\t                            title: lang.dialogDismissButton,\n\t                            class: 'dismiss',\n\t                            action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                        }\n\t                    }\n\t                });\n\t            } else {\n\t                console.error('Not found creditcard id');\n\t            }\n\t        });\n\t        $('button[type=\"add-card\"]').on('click', function(e) {\n\t            e.preventDefault();\n\t            var title = ($(this).data('title')?$(this).data('title'):'');\n\t            var content = ($(this).data('content')?$(this).data('content'):'');\n\t            app.modal.dialog({\n\t                title: title,\n\t                content: content,\n\t                type: 'form',\n\t                popupClass: 'add-card-popup',\n\t                afterRender: function(obj) {\n\t                    obj.find('#cardnumber').validateCreditCard(function(result) {\n\t                        $(this).removeClass();\n\t                        if (result.card_type == null)\n\t                            return;\n\t\n\t                        $(this).addClass(result.card_type.name);\n\t                        $(this).closest('form').find('input[name=\"cardtype\"]').val(result.card_type.name);\n\t\n\t                        if (result.valid) {\n\t                            return $(this).addClass('valid');\n\t                        } else {\n\t                            return $(this).removeClass('valid');\n\t                        }\n\t                    }, {\n\t                        accept: ['visa', 'visa_electron', 'mastercard', 'maestro']\n\t                    });\n\t                    obj.find('#cardholder').keypress(function(event){\n\t                        if(!((event.which >= 65 && event.which  <= 90) ||\n\t                            (event.which >= 97 && event.which <= 122) || event.which == 32)) {\n\t                            event.preventDefault();\n\t                        }\n\t                    });\n\t                },\n\t                buttons: {\n\t                    yes: {\n\t                        title: 'Добавить',\n\t                        class: 'edit',\n\t                        beforeAction: function(form) { // jQuery object\n\t                            // validate\n\t                            var valid = true;\n\t                            var data = form.serializeArray();\n\t                            form.find('input').each(function() {\n\t                                if(!$(this).val()) {\n\t                                    valid = false;\n\t                                    console.log('Поле ' + $(this).attr('name') + ' не заполнено');\n\t                                }\n\t                            });\n\t\n\t                            return valid;\n\t                        },\n\t                        action: function(form){ // jQuery object\n\t                            if(settings.env == 'dev') console.log('[Dialog (add credit card)] Confirmed');\n\t                            app.profile.creditcard.add(form);\n\t                        }\n\t                    },\n\t                    no: {\n\t                        title: lang.dialogDismissButton,\n\t                        class: 'dismiss',\n\t                        action: function(){ if(settings.env == 'dev') console.log('[Dialog (add credit card)] Not confirmed');  }\n\t                    }\n\t                }\n\t            });\n\t        });\n\t\n\t        $('body').on('click', 'button[type=\"delete-address\"]', function(e) {\n\t            console.log(e);\n\t            var addressId = $(this).parents('li[data-address-id]').data('address-id');\n\t            var address = $(this).prev().html();\n\t            var str = String.template(lang.deliveryaddressrequestdelete, address);\n\t            if(addressId) {\n\t                app.modal.dialog({\n\t                    content: str,\n\t                    buttons: {\n\t                        yes: {\n\t                            title: lang.dialogDeleteButton,\n\t                            class: 'delete',\n\t                            action: function(){\n\t                                if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                                app.profile.delivery.del(addressId);\n\t                            }\n\t                        },\n\t                        no: {\n\t                            title: lang.dialogDismissButton,\n\t                            class: 'dismiss',\n\t                            action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                        }\n\t                    }\n\t                });\n\t            } else {\n\t                console.error('Not found delivery address id');\n\t            }\n\t        });\n\t\n\t        $('button[data-toggle=\"edit-phone\"]').on('click', function() {\n\t            app.modal.dialog({\n\t                content: lang.dialogChangePhoneAlert,\n\t                buttons: {\n\t                    yes: {\n\t                        title: lang.dialogEditButton,\n\t                        class: 'edit',\n\t                        action: function(){\n\t                            if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                            var input = $('#slider-content input[name=\"phone\"]');\n\t                            input.removeAttr('disabled');\n\t                            input.parent().removeClass('disabled');\n\t                            input.parents('.form-group').find('button.edit-phone').hide();\n\t\n\t                        }\n\t                    },\n\t                    no: {\n\t                        title: lang.dialogDismissButton,\n\t                        class: 'dismiss',\n\t                        action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                    }\n\t                }\n\t            });\n\t        });\n\t\n\t        $('.creditcard .tooltip').tooltipster('option', 'position', 'left');\n\t        $('.creditcard .tooltip').tooltipster('option', 'arrow', true);\n\t\n\t    },\n\t    creditcard: {\n\t        obj: {},\n\t        add: function(form) {\n\t            try {\n\t                var _data = form.serializeObject();\n\t\n\t                var tmpId = 'card_' + guid();\n\t                var data = {\n\t                    cardname: _data.cardname,\n\t                    cardtype: _data.cardtype,\n\t                    cardnumber: _data.cardnumber.substr(-4)\n\t                };\n\t\n\t                var cardtemplate = tmpl(\n\t                    document.getElementById(\"tmpl-creditcard\").innerHTML,\n\t                    data\n\t                );\n\t\n\t                var li = $('<li />')\n\t                    .append(cardtemplate)\n\t                    .attr('data-card-id', tmpId).hide(); // After ajax change card-id attribute\n\t\n\t                var list = $('ul.creditcard-list');\n\t                if(list.find('li.notfound').length)\n\t                    list.find('li.notfound').remove();\n\t\n\t                li.find('.creditcard .tooltip').tooltipster({\n\t                    animation: 'grow',\n\t                    position: 'left'\n\t                });\n\t                list.append(li);\n\t\n\t                this.process.add(function(response) {\n\t                    $('#slider-content .owl-height').css('height', list.outerHeight() + li.height());\n\t                    $('ul.creditcard-list li[data-card-id=\"' + tmpId +'\"]').fadeIn(300, 'easeOutQuad', function() {\n\t                        $(this).data('card-id', response.newId).attr('data-card-id', newId);\n\t                    });\n\t                });\n\t\n\t            } catch (e) {\n\t                console.log('Creditcard add failed', e);\n\t            }\n\t        },\n\t        del: function(id) {\n\t            if(settings.env == 'dev')\n\t                console.log('Remove card with id #' + id);\n\t\n\t            this.process.del(function(response) {\n\t                var cnt = $('ul.creditcard-list li').length;\n\t                $('ul.creditcard-list li[data-card-id=\"' + id +'\"]').slideUp(300, 'easeOutQuad', function() {\n\t                    $(this).remove();\n\t                    if(cnt == 0) {\n\t                        $('<li />')\n\t                            .appendTo(\"ul.creditcard-list\")\n\t                            .html(lang.creditcardNotFound)\n\t                            .addClass('notfound')\n\t                            .fadeIn(200);\n\t                    }\n\t                    var list = $('ul.creditcard-list');\n\t                    $('#slider-content .owl-height').css('height', list.outerHeight());\n\t                });\n\t            });\n\t\n\t        },\n\t        process: {\n\t            del: function(callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function () {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function () {\n\t                        var response = [];\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t\n\t                }, 1000);\n\t\n\t            },\n\t            add: function(callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                        var response = {'newId': 4};\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t                }, 1000);\n\t            }\n\t        }\n\t    },\n\t    personal: {\n\t        save: function(form) {\n\t            if(settings.env == 'dev')\n\t                console.log('Save personal data');\n\t\n\t            var data = form.serializeArray();\n\t            this.process(data, function(response) {\n\t                console.log('Personal data saved');\n\t                $('button[data-to-slide=\"personal\"]').attr('disabled', 'disabled');\n\t                var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t                bottom.find('.button-group').removeClass('two-button').addClass('one-button');\n\t                bottom.find('button.btn-dismiss').addClass('hide');\n\t            });\n\t\n\t\n\t        },\n\t        process: function(data, callback) {\n\t            console.log(data);\n\t            $(\"#ajax-loader\").fadeIn(200);\n\t            // Ajax simulation\n\t            setTimeout(function() {\n\t                $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                    var response = [];\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                });\n\t\n\t\n\t\n\t            }, 1000);\n\t        }\n\t    },\n\t    delivery: {\n\t        del: function(addressId) {\n\t            this.process.del(addressId, function(response) {\n\t                var cnt = $('ul.creditcard-list li').length;\n\t                console.log('Address removed');\n\t                $('ul.delivery-list li[data-address-id=\"'+addressId+'\"]').remove();\n\t                if(cnt == 0) {\n\t                    $('<li />')\n\t                        .appendTo(\"ul.delivery-list\")\n\t                        .html(lang.deliveryaddressNotFound)\n\t                        .addClass('notfound')\n\t                        .fadeIn(200);\n\t                }\n\t                var list = $('ul.delivery-list');\n\t                $('#slider-content .owl-height').css('height', list.outerHeight());\n\t            });\n\t        },\n\t        process: {\n\t            del: function(addressId, callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                        $('button[data-to-slide=\"personal\"]').attr('disabled', 'disabled');\n\t                        var response = [];\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t\n\t                }, 1000);\n\t            }\n\t        }\n\t    }\n\t};\n\t\n\tvar _checkout = {\n\t    init: function() {\n\t        var _this = this;\n\t        $('#checkout .content-panel .bottom button[type=\"submit\"]').on('click', function(e) {\n\t            var targetForm = $(this).data('to-form');\n\t\n\t            if(settings.env == 'dev')\n\t                console.log('Click bottom button with target form ' + targetForm);\n\t            if(!targetForm || $(targetForm).length == 0)\n\t                return;\n\t\n\t            var form = $(targetForm);\n\t            form.trigger('submit');\n\t            form.closest('.step1').find('.form-status').remove();\n\t            return false;\n\t        });\n\t\n\t        $('#checkout .content-panel .bottom button[type=\"dismiss\"]').on('click', function(e) {\n\t            _this.goToStep(8); // last step\n\t            return false;\n\t        });\n\t\n\t        $('#checkout *[data-toggle=\"gotostep\"]').on('click', function() {\n\t            var step = $(this).data('to-step');\n\t            if(step)\n\t                _this.goToStep(step);\n\t        });\n\t\n\t        if(device.type == 'smallmobile' || device.type == 'mobile') {\n\t            $('#checkout-step #result ul > li').on('click', function (e) {\n\t                var target = $(e.target);\n\t                if(!target.is('button')) {\n\t                    var step = $(this).find('button[data-toggle=\"gotostep\"]').data('to-step');\n\t                    if(step)\n\t                        _this.goToStep(step);\n\t                    else\n\t                        app.popup.show('#widget-calendar', false);\n\t                }\n\t            });\n\t\n\t            $('button[data-toggle=\"devided-slider-back\"]').on('click', function() {\n\t                _this.goToStep(8);\n\t            });\n\t        }\n\t\n\t        if(!app.checkout.loadLastStep())\n\t            app.checkout.goToStep(1);\n\t    },\n\t    step: {\n\t        1: {\n\t            loaded: false,\n\t            load: function() {\n\t                var form_step__1 = $('#checkout-auth');\n\t                this.validateForm(form_step__1);\n\t                form_step__1.find('input').on('keyup', function() {\n\t                    $(this).removeClass('error').parent().removeClass('has-error');\n\t                    $(this).next('i.fa').remove();\n\t                    form_step__1.closest('.step1').find('.form-status').remove();\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t\n\t            },\n\t            validateForm: function(form) {\n\t                var _this = this;\n\t                jQuery.validator.addMethod(\n\t                    'regexp',\n\t                    function(value, element, regexp) {\n\t                        var re = new RegExp(regexp);\n\t                        return this.optional(element) || re.test(value);\n\t                    },\n\t                    \"Please check your input.\"\n\t                );\n\t                form.validate({\n\t                    onfocusout: false,\n\t                    onkeyup: false,\n\t                    onclick: false,\n\t                    focusInvalid: false,\n\t                    submitHandler: function() {\n\t                        _this.registrationSubmitHandler(form);\n\t                        return false;\n\t                    },\n\t                    rules: {\n\t                        name: {\n\t                            required: true,\n\t                            minlength: 3,\n\t                            regexp: '^[А-яA-zёЁ\\s-]{3,}$'\n\t                        },\n\t                        phone: {\n\t                            required: true,\n\t                            minlength: 5,\n\t                            regexp: '[0-9\\\\+\\\\-\\\\s\\\\(\\\\)]{18}$'\n\t                        },\n\t                        email: {\n\t                            required: true,\n\t                            email: true\n\t                        }\n\t                    },\n\t                    messages:{\n\t                        name: {\n\t                            required: \"Поле обязательно для заполнения\",\n\t                            minlength: \"Имя не может быть менее 3 символов\",\n\t                            regexp: \"Имя указано не верно\"\n\t                        },\n\t                        phone: {\n\t                            required: \"Поле обязательно для заполнения\",\n\t                            minlength: \"Телефон не может сожержать менее 5 символов\",\n\t                            regexp: \"Телефон указан не верно\"\n\t                        },\n\t                        email: \"Введите корректный адрес\"\n\t                    },\n\t                    showErrors: function(errorMap, errorList) {\n\t                        if (errorList.length < 1) {\n\t                            form.removeClass('has-error');\n\t                            form.find('input').removeClass('error').parent().removeClass('has-error');\n\t                            form.find('i.fa').remove();\n\t                            return;\n\t                        }\n\t                        $.each(errorList, function(index, error) {\n\t                            form.find('input[name=\"'+error.element.name+'\"]').next('i.fa').remove();\n\t                            form.find('input[name=\"'+error.element.name+'\"]').addClass('error').parent().addClass('has-error');\n\t                            form.addClass('has-error');\n\t                            form.find('input[name=\"'+error.element.name+'\"]').after('<i class=\"fa fa-exclamation-triangle tooltip\" data-toggle=\"tooltip\" title=\"' + error.message + '\"></i>');\n\t                        });\n\t                    }\n\t                });\n\t            },\n\t            registrationProcess: function(data,callback) {\n\t                console.log('[REGISTRATION] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        message: 'Неверно указан номер',\n\t                        status: true, // example phone error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            registrationSubmitHandler: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t                var data = form.serializeArray();\n\t                var step = form.closest('.step1');\n\t                form.css('opacity', 0);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step1',\n\t                    title: lang.processPhoneCheck\n\t                });\n\t                this.registrationProcess(data, function(response) {\n\t                    if(response.status != true)\n\t                    {\n\t\n\t                        var message = $('<div />').addClass('table form-status')\n\t                            .css('width', step.outerWidth())\n\t                            .css('height', step.outerHeight())\n\t                            .append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t                        step.prepend(message);\n\t\n\t                        ajaxloader.finish();\n\t\n\t                        form.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\t\n\t                        setTimeout(function() {\n\t                            message.css('background-color', 'transparent');\n\t                            message.find('span').addClass('inline');\n\t                            message.transition({\n\t                                y: -250,\n\t                                complete: function() {\n\t                                    message.css('z-index', 0);\n\t                                    form.fadeTo(200, 1);\n\t                                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t                                }\n\t                            });\n\t                        }, 700)\n\t                    }\n\t                    else\n\t                    {\n\t\n\t                        app.checkout.goToStep(2);\n\t                    }\n\t                });\n\t            },\n\t        },\n\t        2: {\n\t            loaded: false,\n\t            load: function() {\n\t                var form_step__2 = $('#checkout-auth-confirm-phone');\n\t                var _this = this;\n\t\n\t                form_step__2.find('input').on('keyup', function() {\n\t                    form_step__2.closest('.step2').find('.form-status').remove();\n\t                    if($(this).attr('name') == 'checkcode')\n\t                    {\n\t                        console.log($(this).val().length)\n\t                        if($(this).val().length == 4)\n\t                            $('button[data-to-form=\"#' + form_step__2.attr('id') + '\"]').removeAttr('disabled').removeClass('btn-bordered').addClass('btn-primary');\n\t                        else\n\t                            $('button[data-to-form=\"#' + form_step__2.attr('id') + '\"]').attr('disabled', 'disabled').removeClass('btn-primary').addClass('btn-bordered');\n\t                    } else {\n\t                        $('button[data-to-form=\"#' + form_step__2.attr('id') + '\"]').removeAttr('disabled').removeClass('btn-bordered').addClass('btn-primary');\n\t                    }\n\t                });\n\t\n\t                form_step__2.on('submit', function() {\n\t                    _this.confirmSubmitHander($(this));\n\t                    return false;\n\t                });\n\t\n\t                $('#checkout-step').on('click', 'button[data-toggle=\"resendConfirmCode\"]', function() {\n\t                   _this.resendCode();\n\t                });\n\t\n\t                this.loaded = true;\n\t            },\n\t            resendCode: function() {\n\t                // Ajax simulation\n\t                console.log('Resend activation code');\n\t                $('#timeout').fadeOut(200, function() {\n\t                    $('#timein').fadeIn(200);\n\t                });\n\t                countDown({\n\t                    time: settings.timeoutResendConfirmPhoneCode, // in seconds\n\t                    display:  $('#timein span'),\n\t                    showMinutes: true,\n\t                    afterFinish: function() {\n\t                        $('#timein').fadeOut(200, function() {\n\t                            $('#timeout').fadeIn(200);\n\t                        })\n\t                    }\n\t                });\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        message: 'Отправить новый код',\n\t                        status: true, // example code error\n\t                    };\n\t                }, 2000);\n\t            },\n\t            init: function() {\n\t                countDown({\n\t                    time: settings.timeoutResendConfirmPhoneCode, // in seconds\n\t                    display:  $('#timein span'),\n\t                    showMinutes: true,\n\t                    afterFinish: function() {\n\t                        $('#timein').fadeOut(200, function() {\n\t                            $('#timeout').fadeIn(200);\n\t                        })\n\t                    }\n\t                });\n\t            },\n\t            confirmProcess: function(data, callback) {\n\t                console.log('[CONFIRM] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        message: 'Неверный код',\n\t                        status: true, // example code error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            confirmSubmitHander: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t                var data = form.serializeArray();\n\t                var step = form.closest('.step2');\n\t                form.css('opacity', 0);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step2',\n\t                    title: lang.processConfirmCheck\n\t                });\n\t                this.confirmProcess(data, function(response) {\n\t                    if(response.status != true)\n\t                    {\n\t\n\t                        var message = $('<div />').addClass('table form-status')\n\t                            .css('width', step.outerWidth())\n\t                            .css('height', step.outerHeight())\n\t                            .append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t                        step.prepend(message);\n\t\n\t                        ajaxloader.finish();\n\t\n\t                        form.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\t\n\t                        setTimeout(function() {\n\t                            message.css('background-color', 'transparent');\n\t                            message.find('span').addClass('inline');\n\t                            message.transition({\n\t                                y: -150,\n\t                                complete: function() {\n\t                                    message.css('z-index', 0);\n\t                                    form.fadeTo(200, 1);\n\t                                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t                                }\n\t                            });\n\t                        }, 700)\n\t                    }\n\t                    else\n\t                    {\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                });\n\t            }\n\t        },\n\t        3: {\n\t            loaded: false,\n\t            map: null,\n\t            map_created: false,\n\t            load: function() {\n\t                $('#map').height($('#checkout .content-panel').height());\n\t                ymaps.ready(this.loadMap);\n\t                this.loadKladr();\n\t\n\t                var _this = this;\n\t\n\t                $('#delivery-address-form').on('submit', function() {\n\t                    _this.deliverySubmitHandler($(this));\n\t                    return false;\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t\n\t            },\n\t            deliveryProcess: function(data, callback) {\n\t                console.log('[DELIVERY ADDRESS] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        status: true, // example code error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 500);\n\t            },\n\t            deliverySubmitHandler: function(form) {\n\t                var data = form.serializeArray();\n\t                var dataObj = form.serializeObject();\n\t                var step = form.closest('.step3');\n\t                this.deliveryProcess(data, function(response) {\n\t                    if (response.status != true) {\n\t                        console.log('Change address error');\n\t                    } else {\n\t                        app.checkout.delivery.address = dataObj;\n\t                        $(document).trigger('raketa.checkout.update');\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                })\n\t            },\n\t            loadMap: function() {\n\t                    if (this.map_created) return;\n\t                    this.map_created = true;\n\t\n\t                    this.map = new ymaps.Map('map', {\n\t                            center: [59.9382558321876,30.308662213671802],\n\t                            zoom: 12,\n\t                            controls: []\n\t                        }),\n\t                        ZoomLayout = ymaps.templateLayoutFactory.createClass(\"<div>\" +\n\t                            \"<div id='zoom-in' class='map-btn zoom-in'></div>\" +\n\t                            \"<div id='zoom-out' class='map-btn zoom-out'></div>\" +\n\t                            \"</div>\", {\n\t\n\t                            build: function () {\n\t                                ZoomLayout.superclass.build.call(this);\n\t                                this.zoomInCallback = ymaps.util.bind(this.zoomIn, this);\n\t                                this.zoomOutCallback = ymaps.util.bind(this.zoomOut, this);\n\t                                $('#zoom-in').bind('click', this.zoomInCallback);\n\t                                $('#zoom-out').bind('click', this.zoomOutCallback);\n\t                            },\n\t                            clear: function () {\n\t                                $('#zoom-in').unbind('click', this.zoomInCallback);\n\t                                $('#zoom-out').unbind('click', this.zoomOutCallback);\n\t                                ZoomLayout.superclass.clear.call(this);\n\t                            },\n\t                            zoomIn: function () {\n\t                                var map = this.getData().control.getMap();\n\t                                this.events.fire('zoomchange', {\n\t                                    oldZoom: map.getZoom(),\n\t                                    newZoom: map.getZoom() + 1\n\t                                });\n\t                            },\n\t                            zoomOut: function () {\n\t                                var map = this.getData().control.getMap();\n\t                                this.events.fire('zoomchange', {\n\t                                    oldZoom: map.getZoom(),\n\t                                    newZoom: map.getZoom() - 1\n\t                                });\n\t                            }\n\t                        }),\n\t                        zoomControl = new ymaps.control.ZoomControl({ options: { layout: ZoomLayout } });\n\t\n\t                    map.controls.add(zoomControl, {\n\t                        position: {\n\t                            left: 10,\n\t                            bottom: 180\n\t                        }\n\t                    });\n\t\n\t                    var geoLayout = ymaps.templateLayoutFactory.createClass(\"<div>\" +\n\t                        \"<div id='geolocation' class='map-btn geo'></div>\" +\n\t                        \"</div>\", {\n\t\n\t                        build: function () {\n\t                            geoLayout.superclass.build.call(this);\n\t                            this.geolocation = ymaps.util.bind(this.geolocation, this);\n\t                            this.zoomOutCallback = ymaps.util.bind(this.zoomOut, this);\n\t                            $('#geolocation').bind('click', this.geolocation);\n\t                            $('#zoom-out').bind('click', this.zoomOutCallback);\n\t                        },\n\t                        clear: function () {\n\t                            $('#zoom-in').unbind('click', this.zoomInCallback);\n\t                            $('#zoom-out').unbind('click', this.zoomOutCallback);\n\t                            geoLayout.superclass.clear.call(this);\n\t                        },\n\t                        geolocation: function () {\n\t                            var map = this.getData().control.getMap();\n\t                            this.events.fire('zoomchange', {\n\t                                oldZoom: map.getZoom(),\n\t                                newZoom: map.getZoom() + 1\n\t                            });\n\t                        }\n\t                    });\n\t\n\t                    var geolocationControl = new ymaps.control.GeolocationControl({\n\t                        options: {\n\t                            //layout: geoLayout\n\t                            //noPlacemark: true\n\t                        }\n\t                    });\n\t\n\t                    map.controls.add(geolocationControl, {\n\t                        position: {\n\t                            left: 10,\n\t                            bottom: 144\n\t                        }\n\t                    });\n\t            },\n\t            loadKladr: function() {\n\t                var $kladr_form = $('#delivery-address-form');\n\t\n\t                $kladr_form.find('input').on('keyup', function() {\n\t                    if($(this).val())\n\t                        $('button[data-to-form=\"#' + $kladr_form.attr('id') + '\"]').removeAttr('disabled').removeClass('white');\n\t                    else\n\t                        $('button[data-to-form=\"#' + $kladr_form.attr('id') + '\"]').attr('disabled','disabled').addClass('white');\n\t                });\n\t\n\t                var $region = $kladr_form.find('[name=\"region\"]'),\n\t                    $district = $kladr_form.find('[name=\"district\"]'),\n\t                    $city = $kladr_form.find('[name=\"city\"]'),\n\t                    $street = $kladr_form.find('[name=\"street\"]'),\n\t                    $building = $kladr_form.find('[name=\"building\"]');\n\t\n\t                $()\n\t                    .add($region)\n\t                    .add($district)\n\t                    .add($city)\n\t                    .add($street)\n\t                    .add($building)\n\t                    .kladr({\n\t                        parentInput: '.kladr-form',\n\t                        verify: true,\n\t                        spinner: false,\n\t                        labelFormat: function (obj, query) {\n\t                            var label = '';\n\t\n\t                            var name = obj.name.toLowerCase();\n\t                            query = query.name.toLowerCase();\n\t\n\t                            var start = name.indexOf(query);\n\t                            start = start > 0 ? start : 0;\n\t\n\t                            if (obj.typeShort) {\n\t                                label += obj.typeShort + '. ';\n\t                            }\n\t\n\t                            if (query.length < obj.name.length) {\n\t                                label += obj.name.substr(0, start);\n\t                                label += '<strong>' + obj.name.substr(start, query.length) + '</strong>';\n\t                                label += obj.name.substr(start + query.length, obj.name.length - query.length - start);\n\t                            } else {\n\t                                label += '<strong>' + obj.name + '</strong>';\n\t                            }\n\t\n\t                            if (obj.parents) {\n\t                                for (var k = obj.parents.length - 1; k > -1; k--) {\n\t                                    var parent = obj.parents[k];\n\t                                    if (parent.name) {\n\t                                        if (label) label += '<small>, </small>';\n\t                                        label += '<small>' + parent.name + ' ' + parent.typeShort + '.</small>';\n\t                                    }\n\t                                }\n\t                            }\n\t\n\t                            return label;\n\t                        },\n\t                        change: function (obj) {\n\t                            if (obj) {\n\t\n\t                                setLabel($(this), obj.type);\n\t                            }\n\t                            addressUpdate();\n\t                            mapUpdate();\n\t                        },\n\t                        openBefore: function () {\n\t                            // Проверяем если выбран пользовательский адрес, прекращаем работу kladr\n\t                            //return false;\n\t                        },\n\t                        checkBefore: function () {\n\t                            var $input = $(this);\n\t\n\t                            if (!$.trim($input.val())) {\n\t\n\t                                addressUpdate();\n\t                                mapUpdate();\n\t                                return false;\n\t                            }\n\t                        }\n\t                    });\n\t\n\t                $street.kladr({\n\t                    labelFormat: function (obj, query) {\n\t                        var label = '';\n\t\n\t                        var name = obj.name.toLowerCase();\n\t                        query = query.name.toLowerCase();\n\t\n\t                        var start = name.indexOf(query);\n\t                        start = start > 0 ? start : 0;\n\t\n\t                        if (obj.typeShort) {\n\t                            label += obj.typeShort + '. ';\n\t                        }\n\t\n\t                        if (query.length < obj.name.length) {\n\t                            label += obj.name.substr(0, start);\n\t                            label += '<strong>' + obj.name.substr(start, query.length) + '</strong>';\n\t                            label += obj.name.substr(start + query.length, obj.name.length - query.length - start);\n\t                        } else {\n\t                            label += '<strong>' + obj.name + '</strong>';\n\t                        }\n\t\n\t                        if (obj.parents) {\n\t                            for (var k = obj.parents.length - 1; k > -1; k--) {\n\t                                var parent = obj.parents[k];\n\t                                if (parent.name && parent.contentType == 'city') {\n\t                                    if (label) label += '<small>, </small>';\n\t                                    label += '<small>' + parent.typeShort + '. ' + parent.name + '</small>';\n\t                                }\n\t                            }\n\t                        }\n\t\n\t                        return label;\n\t                    }\n\t                });\n\t                $region.kladr('type', $.kladr.type.region);\n\t                $district.kladr('type', $.kladr.type.district);\n\t                $city.kladr('type', $.kladr.type.city);\n\t                $street.kladr('type', $.kladr.type.street);\n\t                $building.kladr('type', $.kladr.type.building);\n\t\n\t                $.kladr.setValues({\n\t                    region: 7800000000000,\n\t                    city: 7800000000000\n\t                }, '.kladr-form');\n\t\n\t                // Включаем получение родительских объектов для населённых пунктов\n\t                $city.kladr('withParents', true);\n\t                $street.kladr('withParents', true);\n\t\n\t                // Отключаем проверку введённых данных для строений\n\t                $building.kladr('verify', false);\n\t\n\t                function setLabel($input, text) {\n\t                    text = text.charAt(0).toUpperCase() + text.substr(1).toLowerCase();\n\t                    $input.parent().find('label').text(text);\n\t                }\n\t\n\t                function mapUpdate() {\n\t                    var zoom = 4;\n\t                    var address = $.kladr.getAddress($kladr_form, function (objs) {\n\t                        var result = '';\n\t                        $.each(objs, function (i, obj) {\n\t                            var name = '',\n\t                                type = '';\n\t\n\t                            if ($.type(obj) === 'object') {\n\t                                name = obj.name;\n\t                                type = obj.type + ' ';\n\t\n\t                                switch (obj.contentType) {\n\t                                    case $.kladr.type.region:\n\t                                        zoom = 4;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.district:\n\t                                        zoom = 7;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.city:\n\t                                        zoom = 10;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.street:\n\t                                        zoom = 13;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.building:\n\t                                        zoom = 16;\n\t                                        break;\n\t                                }\n\t                            }\n\t                            else {\n\t                                name = obj;\n\t                            }\n\t\n\t                            if (result) result += ', ';\n\t                            result += type + name;\n\t                        });\n\t\n\t                        return result;\n\t                    });\n\t\n\t                    if (address && this.map_created) {\n\t                        var geocode = ymaps.geocode(address);\n\t                        geocode.then(function (res) {\n\t                            this.map.geoObjects.each(function (geoObject) {\n\t                                map.geoObjects.remove(geoObject);\n\t                            });\n\t\n\t                            var position = res.geoObjects.get(0).geometry.getCoordinates(),\n\t                                placemark = new ymaps.Placemark(position, {}, {});\n\t\n\t                            this.map.geoObjects.add(placemark);\n\t                            this.map.setCenter(position, zoom);\n\t                        });\n\t                    }\n\t                }\n\t\n\t                function addressUpdate() {\n\t                    var address = $.kladr.getAddress($kladr_form);\n\t                    $kladr_form.find('input[name=\"fulladdress\"]').val(address);\n\t                }\n\t            },\n\t\n\t        },\n\t        4: {\n\t            loaded: false,\n\t            load: function(){\n\t                var form = $('#who-delivery-product');\n\t                var userlist = this.getUserList();\n\t\n\t                form.find('select[name=\"who\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                    dropdownDirection: 'down',\n\t                    plugins: {\n\t                        dropdown_footer: {\n\t                            title: 'Мы можем доставить цветы вам или поздравить кого-нибудь от вас'\n\t                        }\n\t                    },\n\t                });\n\t                form.find('select[name=\"reason\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                    plugins: {\n\t                        dropdown_footer: {\n\t                            title: 'Вы можете изменить или добавить новые поводы <a href=\"reasons.html\">здесь</a>'\n\t                        }\n\t                    }\n\t                });\n\t                userlist.done(function(response){\n\t                    console.log('Get user list');\n\t                    console.log(response);\n\t                    form.find('select[name=\"fromme_to_name\"]').selectize({\n\t                        allowEmptyOption: false,\n\t                        valueField: 'id',\n\t                        labelField: 'name',\n\t                        searchField: ['name', 'phone'],\n\t                        options: response,\n\t                        addPrecedence: 'Добавить',\n\t                        render: {\n\t                            item: function(item, escape) {\n\t                                return '<div>' +\n\t                                    (item.name ? '<span class=\"name\">' + escape(item.name) + '</span>' : '')\n\t                                    '</div>';\n\t                            },\n\t                            option: function(item, escape) {\n\t                                var label = item.name || item.phone;\n\t                                var caption = item.name ? item.phone : null;\n\t                                return '<div>' +\n\t                                    '<span class=\"label\">' + escape(label) + '</span>' +\n\t                                    (caption ? ' <span class=\"caption\">' + escape(caption) + '</span>' : '') +\n\t                                    '</div>';\n\t                            }\n\t                        },\n\t                        onChange: function(value) {\n\t                            var dp = this.$dropdown_content.find('[data-value=\"' + value +'\"]');\n\t                            var caption = dp.find('.caption').text();\n\t                            form.find('input[type=\"tel\"]').val(caption);\n\t                        },\n\t                        plugins: {\n\t                            'dropdown_footer': {\n\t                                title: 'Если вы еще никого не поздравляли от своего имени, просто укажите имя получателя'\n\t                            }\n\t                        },\n\t                        create: true,\n\t                    });\n\t                });\n\t\n\t                form.find('select[name=\"who\"]').on('change', function(e) {\n\t                    if($(this).val() == 'fromme')\n\t                    {\n\t                        form.find('.fromme .raketa-select').css('width', form.width());\n\t                        form.find('.fromme').removeClass('hide').hide().slideDown(150);\n\t                    } else {\n\t                        form.find('.fromme').slideUp(200).addClass('hide');\n\t                    }\n\t                });\n\t                form.find('select').on('change', function() {\n\t                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').removeClass('btn-bordered').addClass('btn-primary').removeAttr('disabled');\n\t                });\n\t                var _this = this;\n\t                form.on('submit', function() {\n\t                    var formObject = $(this).serializeObject();\n\t                    var dataObject = {};\n\t                    $.each(formObject, function(index, value) {\n\t                        if(index != 'csrf') {\n\t                            dataObject[index] = {\n\t                                index: index,\n\t                                value: value,\n\t                                textValue: form.find('[name=\"' + index + '\"] option[value=\"' + value +'\"]').text()\n\t                            }\n\t                        }\n\t                    });\n\t                    app.checkout.for = dataObject;\n\t                    _this.submitHandler($(this));\n\t                    return false;\n\t                });\n\t                this.loaded = true;\n\t            },\n\t\n\t            init: function() {\n\t                $('#checkout-step').parent().removeClass('middle');\n\t\n\t            },\n\t            close: function() {\n\t                $('#checkout-step').parent().addClass('middle');\n\t            },\n\t            getUserList: function() {\n\t                return $.Deferred(function () {\n\t                    var self = this;\n\t                    //Ajax simulation\n\t                    var userlist = [];\n\t                    setTimeout(function () {\n\t                        userlist = [\n\t                            {id: 1, name: 'Екатерина', phone: '+7(956)000-0011'},\n\t                            {id: 2, name: 'Мария', phone: '+7(956)111-0022'},\n\t                            {id: 3, name: 'Иван', phone: '+7(956)222-0033'}\n\t                        ];\n\t                        self.resolve(userlist);\n\t                    }, 2000);\n\t                });\n\t            },\n\t            submitProcess: function(data, callback) {\n\t                console.log('[FOR DELIVERY] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        status: true\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            submitHandler: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').closest('.bottom').removeClass('show');\n\t                var data = form.serializeArray();\n\t                var step = app.checkout.getCurrentStep();\n\t                step.closest('.content-panel').addClass('middle');\n\t                form.hide();\n\t                console.log(step);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step4',\n\t                    title: lang.processSave\n\t                });\n\t                this.submitProcess(data, function(response) {\n\t                    ajaxloader.finish();\n\t                    form.show();\n\t                    step.closest('.content-panel').removeClass('middle');\n\t                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').closest('.bottom').addClass('show');\n\t                    if(response.status == true)\n\t                    {\n\t                        $(document).trigger('raketa.checkout.update');\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                });\n\t            },\n\t        },\n\t        5: {\n\t            loaded: false,\n\t            init: function() {\n\t\n\t            }\n\t        },\n\t        6: {\n\t            loaded: false,\n\t            init: function() {\n\t\n\t            }\n\t        },\n\t        7: {\n\t            loaded: false,\n\t            load: function() {\n\t                this.step = $('#checkout-step > div[data-step=\"7\"]');\n\t                var list = this.step.find('.creditcard-list li');\n\t                var _this = this;\n\t                list.on('click', function() {\n\t\n\t                    var card = {\n\t                        id: $(this).data('card-id'),\n\t                        lastdiggit: $(this).data('card-lastdiggit'),\n\t                        type: $(this).data('card-type')\n\t                    };\n\t                    list.not(this).removeClass('active');\n\t                    $(this).toggleClass('active');\n\t                    if(card && $(this).hasClass('active'))\n\t                        _this.checkedCardId = card;\n\t                    else\n\t                        _this.checkedCardId = 0;\n\t\n\t                });\n\t\n\t                $('button[data-toggle=\"setcard\"]').on('click', function() {\n\t                    console.log(_this.checkedCardId);\n\t                    if(_this.checkedCardId)\n\t                        _this.cardProcess(_this.checkedCardId);\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t\n\t            },\n\t            cardProcess: function(card) {\n\t                console.log('User set card #' + card.id);\n\t                $('#ajax-loader').fadeIn(100);\n\t                // Object {id: 2, lastdiggit: 4454, type: \"visa\"}\n\t                //Save card to session\n\t                //Ajax\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        status: true\n\t                    };\n\t                    if(response.status) {\n\t                       // Card approved\n\t                       app.checkout.card = card;\n\t                       $(document).trigger('raketa.checkout.update');\n\t                       app.checkout.goToStep(8);\n\t                    } else {\n\t                        // card not approved  - not save\n\t                        app.modal.dialog({\n\t                            content: lang.cardNotApprovedStatus,\n\t                            buttons: {\n\t                                no: {\n\t                                    title: 'OK',\n\t                                    class: 'dismiss',\n\t                                    action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                                }\n\t                            }\n\t                        });\n\t                    }\n\t                    $('#ajax-loader').fadeOut(100);\n\t                }, 1000);\n\t\n\t            }\n\t        },\n\t        8: {\n\t            loaded: false,\n\t            load: function() {\n\t                var _this = this;\n\t                $(document).on('raketa.checkout.update', function() {\n\t                    _this.updateHtml();\n\t                });\n\t\n\t                $('button[type=\"checkout\"]').on('click', function() {\n\t                    ajaxloader.local({\n\t                        element: $('#result'),\n\t                        to: '.step8',\n\t                        title: lang.loading\n\t                    });\n\t                    $(this).hide();\n\t                    app.checkout.save(function(response) {\n\t                        ajaxloader.finish();\n\t                        if(response.status == true)\n\t                        {\n\t                            window.location = response.paymentUrl;\n\t                        }\n\t                        $(this).show();\n\t                    });\n\t                    return false;\n\t                });\n\t\n\t                if(device.type == 'smallmobile' || device.type == 'mobile') {\n\t                    var params = {\n\t                        items: 1,\n\t                        margin: 0,\n\t                        lazyLoad: false,\n\t                        loop: true,\n\t                        autoplay: true,\n\t                        animateOut:'fadeOut',\n\t                        animateIn: 'fadeIn',\n\t                        autoplayTimeout: 4000,\n\t                        autoplayHoverPause: true\n\t                    };\n\t\n\t                    $('#checkout-step .step8 .owl-carousel').owlCarousel(params);\n\t                }\n\t\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t                $('.layout.devided.checkout>div.menu-wrapper').css('height', 'auto').show();\n\t\n\t                if(\n\t                    app.checkout.basket.length &&\n\t                    app.checkout.delivery.address &&\n\t                    app.checkout.delivery.timeofday &&\n\t                    app.checkout.delivery.date &&\n\t                    app.checkout.for &&\n\t                    app.checkout.card\n\t                )\n\t                {\n\t                    $('button[type=\"checkout\"]').removeAttr('disabled').removeClass('btn-bordered').addClass('btn-primary');\n\t                } else {\n\t                    $('button[type=\"checkout\"]').attr('disabled', 'disabled').removeClass('btn-primary').addClass('btn-bordered');\n\t                }\n\t\n\t\n\t\n\t\n\t                this.updateHtml();\n\t            },\n\t            updateHtml: function() {\n\t                var result = $('#result');\n\t\n\t                if(app.checkout.for)\n\t                {\n\t                    var recipient = app.checkout.for;\n\t                    if(recipient.who.value != \"me\") {\n\t                        var text = recipient.fromme_to_name.textValue;\n\t                        var phone = recipient.fromme_to_phone.value;\n\t                        var reason = recipient.reason.textValue;\n\t                        result.find('li.who span').html(text + '<br><b>'+phone+',</b>' + ' <i>' + reason + '</i>');\n\t                    } else {\n\t                        result.find('li.who span').html(app.checkout.for.who.textValue);\n\t                    }\n\t                    console.log(app.checkout.for);\n\t\n\t                }\n\t\n\t\n\t                if(app.checkout.delivery.address)\n\t                {\n\t                    var fulladdress = app.checkout.delivery.address.fulladdress;\n\t                    var address = fulladdress.split(',');\n\t                    console.log(app.checkout.delivery.address);\n\t                    var strAddress = [\n\t                        address[2],\n\t                        (address[3]?address[3]:app.checkout.delivery.address.building),\n\t                        (app.checkout.delivery.address.apartment?'кв ' + app.checkout.delivery.address.apartment:'')\n\t                    ];\n\t                    result.find('li.address span').html(strAddress.join(', ')).parent().removeClass('empty');\n\t                }\n\t                else\n\t                {\n\t                    result.find('li.address span').html('Адрес').parent().addClass('empty');\n\t                }\n\t\n\t\n\t                if(app.checkout.delivery.date &&\n\t                    app.checkout.delivery.timeofday)\n\t                {\n\t                    var date = app.checkout.delivery.date;\n\t                    date = moment(date, 'DD.MM.YYYY').format('D MMMM');\n\t                    var timeofday = lang[app.checkout.delivery.timeofday];\n\t                    result.find('li.delivery-date span').html(timeofday + ' '+date);\n\t                }\n\t\n\t                if(app.checkout.card) {\n\t                    var row = result.find('li.credit');\n\t                    row.removeClass('error');\n\t                    row.find('span').html('Карта <b>' + app.checkout.card.lastdiggit + '</b>');\n\t                    row.find('.creditcard-type').addClass(app.checkout.card.type);\n\t                    if(device.type == 'smallmobile' || device.type == 'mobile') {\n\t                        var card = $('#checkout .content-panel .bottom .credit');\n\t                        card.removeClass('error');\n\t                        card.find('b').html(app.checkout.card.lastdiggit)\n\t                        card.find('.creditcard-type').addClass(app.checkout.card.type);\n\t                    }\n\t                }\n\t            }\n\t        }\n\t    },\n\t    loadLastStep: function() {\n\t        var step = Cookies.get('raketa_checkout__step');\n\t        if(step)\n\t        {\n\t            this.goToStep(step);\n\t            return true\n\t        } else\n\t            return false\n\t    },\n\t    getCurrentStep: function() {\n\t        return this.currentStep;\n\t    },\n\t    goToStep: function(step) {\n\t        Cookies.set('raketa_checkout__step', step, { expires: 365, path: '/' });\n\t\n\t        var checkout = $('#checkout-step');\n\t        var currentStep = checkout.find('.step.active');\n\t        if(currentStep.length)\n\t            this.currentStep = currentStep;\n\t        else\n\t            this.currentStep = $('#checkout-step .step[data-step=\"'+ step +'\"]');\n\t\n\t        var stepItem = (currentStep.data('step') ? currentStep.data('step') : step);\n\t        currentStep.trigger('close');\n\t        if(this.step[stepItem] && this.step[stepItem].close)\n\t            this.step[stepItem].close();\n\t        currentStep.removeClass('active');\n\t\n\t        if(settings.env == 'dev')\n\t            console.log('[STEP] Go to checkout step #' + step);\n\t\n\t        checkout.find('.step.step' + step).addClass('active').trigger('open');\n\t        checkout.parent().find('.bottom[data-to-step]').removeClass('show');\n\t        checkout.parent().find('.bottom[data-to-step=\"step' + step + '\"]').addClass('show');\n\t\n\t        if(this.step[step]\n\t            && !this.step[step].loaded\n\t            && (typeof this.step[step].load === \"function\")\n\t        )\n\t            this.step[step].load()\n\t\n\t        if(this.step[step]\n\t            && this.step[step].loaded\n\t            && (typeof this.step[step].init === \"function\")\n\t        )\n\t            this.step[step].init()\n\t\n\t        if(device.type == 'smallmobile' || device.type == 'mobile') {\n\t            console.log(step);\n\t            if(step == 8) {\n\t                $('#header .navbar-toggle').show();\n\t                $('#header .back').hide();\n\t            } else if(step != 1 && step != 2) {\n\t                $('#header .navbar-toggle').hide();\n\t                $('#header .back').show();\n\t            }\n\t            var title = checkout.find('.step.step' + step + ' .mobile.hide.mobtitle').text();\n\t            if(title)\n\t                $('#header .mobile.title').html(title);\n\t            else\n\t                $('#header .mobile.title').html($('title').text());\n\t        }\n\t    },\n\t};\n\t\n\t$.extend( app.checkout, _checkout );\n\t// full trash // It's last spagetty code! because of the small amount of time for the project\n\tvar _reasons = {\n\t    onboardClosed: false,\n\t    init: function() {\n\t        var _this = this;\n\t        this.defaultStep = 'congratulate';\n\t\n\t        if(device.type == 'smallmobile' || device.type == 'mobile') {\n\t            $('#header .basket').hide();\n\t            $('#header .mobile.add-reason').show();\n\t\n\t        }\n\t\n\t        $('#reasons .content-panel .bottom button[type=\"submit\"]').on('click', function(e) {\n\t            var targetForm = $(this).data('to-form');\n\t\n\t            if(settings.env == 'dev')\n\t                console.log('Click bottom button with target form ' + targetForm);\n\t            if(!targetForm || $(targetForm).length == 0)\n\t                return;\n\t\n\t            var form = $(targetForm);\n\t            form.trigger('submit');\n\t            return false;\n\t        });\n\t\n\t        $('#reasons-step form').on('submit', function(e) {\n\t            var data = $(this).serializeObject();\n\t            // Ajax?\n\t        });\n\t\n\t        $('button[type=\"edit\"]').on('click', function(e) {\n\t\n\t            _this.goToStep('editreason', e);\n\t            if(device.type == 'smallmobile' || device.type == 'mobile') {\n\t                $('#reasons').css('overflow', 'auto');\n\t                $('#reasons').find('.menu-wrapper').transition({\n\t                    x: -device.windowWidth, complete: function () {\n\t                    }\n\t                });\n\t                $('#header .navbar-toggle').hide();\n\t                $('#header .back').show();\n\t                var title = $('#reasons-step div.step.active .title').text();\n\t                $('#header .mobile.title').html(title);\n\t            }\n\t            return false;\n\t        });\n\t\n\t        $('button[type=\"delete\"]').on('click', function(e) {\n\t            var id = $(this).data('id');\n\t            if(id) {\n\t                app.modal.dialog({\n\t                    content: lang.reasonquestdelete,\n\t                    buttons: {\n\t                        yes: {\n\t                            title: lang.dialogDeleteButton,\n\t                            class: 'delete',\n\t                            action: function(){\n\t                                if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                                window.location = window.location + '?action=delete&id='+ id;\n\t                            }\n\t                        },\n\t                        no: {\n\t                            title: lang.dialogDismissButton,\n\t                            class: 'dismiss',\n\t                            action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                        }\n\t                    }\n\t                });\n\t            }\n\t\n\t            return false;\n\t        });\n\t\n\t        $('#reasons .content-panel .bottom button[type=\"dismiss\"]').on('click', function(e) {\n\t            _this.goToStep(_this.defaultStep);\n\t            $('#reasons-step form.edit-reason-form')[0].reset();\n\t            return false;\n\t        });\n\t\n\t        if(device.type == 'smallmobile' || device.type == 'mobile') {\n\t            $('#reasons .reasons-list li').on('click', function(e) {\n\t                var $target = $(e.target);\n\t                if($target.is('button[data-toggle=\"gotostep\"]'))\n\t                    return;\n\t                $('#reasons .reasons-list li').not(this).removeClass('mobile-menu');\n\t                $(this).toggleClass('mobile-menu');\n\t            });\n\t        }\n\t\n\t        $('button[data-toggle=\"gotostep\"]').on('click', function(e) {\n\t            var step = $(this).data('to-step');\n\t            var parentStep = $(this).closest('.bottom');\n\t\n\t            if(device.type == 'smallmobile' || device.type == 'mobile' && parentStep.data('to-step') != 'onboard') {\n\t                $('#reasons').css('overflow', 'auto');\n\t                $('#reasons').find('.menu-wrapper').transition({\n\t                    x: -device.windowWidth, complete: function () {\n\t                        $('#reasons').find('.menu-wrapper').hide();\n\t                    }\n\t                });\n\t                $('#header .navbar-toggle').hide();\n\t                $('#header .back').show();\n\t                var title = $('#reasons-step div[data-step=\"' + step + '\"] .title').text();\n\t                $('#header .mobile.title').html(title);\n\t            } else if(device.type == 'smallmobile' || device.type == 'mobile' && parentStep.data('to-step') == 'onboard') {\n\t                Cookies.set('raketa_reasons__board', false, { expire: 365, path: '/' });\n\t                app.reasons.onboardClosed = true;\n\t                $('#reasons-step').find('div[data-step=\"onboard\"]').fadeOut(200, function() {\n\t                    $(this).removeClass('overlayed');\n\t                    $('#reasons-step').find('.onboard.overlay').remove();\n\t                });\n\t                $('#reasons').find('.bottom[data-to-step=\"onboard\"]').removeClass('show');\n\t                return;\n\t            }\n\t\n\t\n\t\n\t            if(_this.currentStep && _this.currentStep.data('step') == 'onboard') {\n\t                Cookies.set('raketa_reasons__board', false, { expire: 365, path: '/' });\n\t                _this.currentStep.find('img').removeClass('zoomIn').addClass('zoomOutDown');\n\t                _this.currentStep.find('img').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function() {\n\t                    _this.goToStep(step);\n\t                });\n\t            } else {\n\t                _this.goToStep(step, e);\n\t            }\n\t\n\t        });\n\t\n\t\n\t        if(device.type != 'smallmobile' && device.type != 'mobile')\n\t        {\n\t            var hash = Hash.get();\n\t            var board = Cookies.get('raketa_reasons__board');\n\t            console.log(board);\n\t            if(board) {\n\t                if (hash.step) {\n\t                    this.goToStep(hash.step);\n\t                } else {\n\t                    this.goToStep(this.defaultStep);\n\t                }\n\t            } else {\n\t                this.goToStep('onboard');\n\t            }\n\t        }\n\t\n\t    },\n\t\n\t    goToStep: function(step, e) {\n\t\n\t        var reasons = $('#reasons-step');\n\t        var $currentStep = this.currentStep = reasons.find('.step[data-step=\"'+ step +'\"]');\n\t        var openedStep = reasons.find('.step.active');\n\t\n\t        if(step != 'congratulate' && $currentStep.data('step') == openedStep.data('step') && (device.type != 'smallmobile'&& device.type != 'mobile'))\n\t            return;\n\t\n\t        var hash = Hash.get();\n\t\n\t        switch (step) {\n\t            case 'editreason':\n\t                if(hash.id)\n\t                    Hash.add('id', hash.id);\n\t                else\n\t                    Hash.add('id', $(e.currentTarget).data('id'));\n\t                break;\n\t            case 'congratulate':\n\t                if(device.type == 'smallmobile' || device.type == 'mobile')\n\t                {\n\t                    var board = Cookies.get('raketa_reasons__board');\n\t\n\t                    $(document).on('raketa_reason__loaded', function() {\n\t                        if(!board && !app.reasons.onboardClosed) {\n\t                            setTimeout(function(){\n\t                                reasons.find('div[data-step=\"onboard\"]').before($('<div />').addClass('onboard overlay'));\n\t                                reasons.find('div[data-step=\"onboard\"]').fadeIn(200, function() {\n\t                                    $(this).addClass('overlayed');\n\t                                });\n\t                                $('#reasons').find('.bottom[data-to-step=\"onboard\"]').addClass('show');\n\t                            },600);\n\t                        }\n\t                    });\n\t\n\t                }\n\t                break;\n\t            default:\n\t                Hash.remove('id');\n\t                break;\n\t        }\n\t\n\t        Hash.add('step', step);\n\t\n\t        if(settings.env == 'dev')\n\t            console.log('[STEP] Go to reasons step #' + step);\n\t\n\t        reasons.parent().find('.bottom[data-to-step]').removeClass('show');\n\t\n\t        openedStep.removeClass('active');\n\t        openedStep.trigger('step-close');\n\t\n\t        this.currentStep.addClass('active').trigger('step-open');\n\t        reasons.parent().find('.bottom[data-to-step=\"' + step + '\"]').addClass('show');\n\t\n\t        if(this.step[step]\n\t            && !this.step[step].loaded\n\t            && (typeof this.step[step].load === \"function\")\n\t        )\n\t            this.step[step].load(e);\n\t\n\t        if(this.step[step]\n\t            && this.step[step].loaded\n\t            && (typeof this.step[step].init === \"function\")\n\t        )\n\t            this.step[step].init(e);\n\t    },\n\t    getCurrentStep: function() {\n\t        return this.currentStep;\n\t    },\n\t    step: {\n\t        newreason: {\n\t            load: function() {\n\t                var form = $('#reasons-step form');\n\t                form.find('input.datetimepicker').each(function() {\n\t                    var _this = $(this);\n\t                   $(this).datetimepicker({\n\t                       timepicker:false,\n\t                       todayButton: false,\n\t                       yearStart: '2016',\n\t                       yearEnd: '2035',\n\t                       dayOfWeekStart: 1,\n\t                       scrollMonth: false,\n\t                       prevButton: false,\n\t                       nextButton: false,\n\t                       className: 'reason-datepicker',\n\t                       parentID: _this.parent(),\n\t                       minDate:new Date(),\n\t                       format:'d.m.Y'\n\t                   });\n\t                });\n\t\n\t\n\t                var date = new Date();\n\t                var stringTitle = 'К примеру: вы выбрали ' + moment(date).format('DD.MM.YYYY') + '<br>' +\n\t                        'Каждую неделю - поздравлять каждый ' + moment(date).format('dddd').toLowerCase() + '<br>' +\n\t                        'Каждый месяц - каждый месяц ' + moment(date).format('DD') + ' числа<br>' +\n\t                        'Каждую год - каждый год ' + moment(date).format('MMMM Do');\n\t\n\t                form.find('select[name=\"repeat\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                    plugins: {\n\t                        'dropdown_footer': {\n\t                            title: stringTitle\n\t                        }\n\t                    },\n\t                });\n\t\n\t                form.find('select[name=\"who\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                });\n\t\n\t                form.find('select[name=\"reason\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: true,\n\t                    plugins: {\n\t                        'restore_on_backspace' : {},\n\t                        'dropdown_footer': {\n\t                            title: 'Вы можете выбрать уже существущий повод и отредактировать его(клавиша Backspace) или добавить новый повод просто указав название'\n\t                        }\n\t                    }\n\t                });\n\t\n\t                form.find('input').on('keyup', function() {\n\t                    var buttons = $('#reasons .content-panel .bottom[data-to-step*=\"reason\"]');\n\t                    buttons.find('button').removeAttr('disabled');\n\t                    buttons.find('button[type=\"submit\"]').removeClass('btn-bordered').addClass('btn-primary');\n\t                });\n\t\n\t                form.find('select').on('change', function() {\n\t                    var buttons = $('#reasons .content-panel .bottom[data-to-step*=\"reason\"]');\n\t                    buttons.find('button').removeAttr('disabled');\n\t                    buttons.find('button[type=\"submit\"]').removeClass('btn-bordered').addClass('btn-primary');\n\t                });\n\t\n\t                this.loaded = true;\n\t            },\n\t        },\n\t        congratulate: {\n\t            load: function() {\n\t                $('#reasons-step div[data-step=\"congratulate\"]').on('step-close', function() {\n\t                    $('#reasons-step').parent().removeClass('middle');\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function(e) {\n\t                $('#reasons-step').parent().addClass('middle');\n\t                if(e && $(e.currentTarget)) {\n\t                    var id = $(e.currentTarget).closest('li').data('id');\n\t                    var buttons = $('#reasons-step').parent().find('.bottom[data-to-step=\"congratulate\"]');\n\t                    buttons.find('button[type=\"edit\"]').data('id', id).attr('data-id', id); // its fucking shit...save id to data attr for further editing\n\t                    buttons.removeClass('show');\n\t                    if(device.type != 'smallmobile' && device.type != 'mobile')\n\t                    {\n\t                        ajaxloader.local({\n\t                            element: $('#reasons-step div[data-step=\"congratulate\"]')\n\t                        });\n\t                    }\n\t                    else\n\t                    {\n\t                        ajaxloader.local({\n\t                            element: $('#reasons-step').parent()\n\t                        });\n\t\n\t                    }\n\t                    var data = this.getData(id, function(response) {\n\t                        ajaxloader.finish();\n\t                        buttons.addClass('show');\n\t                        var template = tmpl(\n\t                            document.getElementById(\"tmpl-congratulations-to\").innerHTML,\n\t                            response\n\t                        );\n\t                        $(document).trigger('raketa_reason__loaded');\n\t                        $('#reasons-step div[data-step=\"congratulate\"]').html(template);\n\t\n\t                    })\n\t                }\n\t            },\n\t            getData: function(id, callback) {\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    if(id == 1) {\n\t                        var response = {\n\t                            photo: 'img/reason-1b.png',\n\t                            name: 'Маша Петрова',\n\t                            reason: 'День рождения',\n\t                            repeat: 'Напоминать каждый год',\n\t                        };\n\t                    } else {\n\t                        var response = {\n\t                            name: 'Международный женский день',\n\t                            reason: 'Праздники',\n\t                            repeat: 'Напоминать каждый год',\n\t                        };\n\t                    }\n\t\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 1000);\n\t            }\n\t        },\n\t        editreason: {\n\t            model: {\n\t                id: 1\n\t            },\n\t            load: function() {\n\t                if(!app.reasons.step.newreason.loaded)\n\t                    app.reasons.step.newreason.load(); // bind selectize in form\n\t\n\t                // Ajax get object of reason, save to this.model\n\t                // bind data to form\n\t\n\t                this.loaded = true;\n\t            },\n\t            init: function(e) {\n\t                var form = $('#edit-reason-form');\n\t                form[0].reset();\n\t                form.find('select').each(function() {\n\t                    $(this)[0].selectize.clear();\n\t                });\n\t                form.find('input[name=\"reasonId\"]').val(this.model.id);\n\t            }\n\t        }\n\t    }\n\t};\n\t\n\t\n\t$.extend( app.reasons, _reasons );\n\tapp.promocode = {\n\t    init: function() {\n\t\n\t        if(device.type == 'smallmobile' || device.type == 'mobile') {\n\t            $('#header .basket').hide();\n\t            $('#header .mobile.add-promocode').show();\n\t\n\t\n\t            $('button[data-toggle=\"new-promocode\"]').on('click', function(e) {\n\t                $('#promocodes').find('.menu-wrapper').transition({\n\t                    x: -device.windowWidth, complete: function () {\n\t                        $(window).scrollTop(0);\n\t                        $('#promocodes').find('.menu-wrapper').hide();\n\t                    }\n\t                });\n\t                $('#header .navbar-toggle').hide();\n\t                $('#header .back').show();\n\t            });\n\t        }\n\t\n\t\n\t        $('#promocodes .content-panel .bottom button[type=\"submit\"]').on('click', function(e) {\n\t            var targetForm = $(this).data('to-form');\n\t\n\t            if(settings.env == 'dev')\n\t                console.log('Click bottom button with target form ' + targetForm);\n\t\n\t            if(!targetForm || $(targetForm).length == 0)\n\t                return;\n\t\n\t            var form = $(targetForm);\n\t            form.trigger('submit');\n\t            return false;\n\t        });\n\t\n\t        $('#promocode-add input').on('keyup', function() {\n\t            if($(this).val())\n\t                $('button[data-to-form=\"#promocode-add\"]').addClass('btn-primary').removeClass('btn-bordered').removeAttr('disabled');\n\t            else\n\t                $('button[data-to-form=\"#promocode-add\"]').addClass('btn-bordered').removeClass('btn-primary').attr('disabled', 'disabled');\n\t        });\n\t\n\t\n\t        $('#promocode-add').submit(function(e) {\n\t            e.preventDefault();\n\t            app.promocode.add($(this));\n\t            return false;\n\t        });\n\t    },\n\t    add: function(form) {\n\t        $('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t        var data = form.serializeArray();\n\t        ajaxloader.local({\n\t            element: form,\n\t            to: '#promocodes .content-panel .static',\n\t            title: lang.processConfirmCheck\n\t        });\n\t        form.find('input').blur();\n\t        var _h = $('#promocodes .content-panel .static').outerHeight();\n\t        this.process(data, function(response) {\n\t            $('#promocodes .content-panel .static').css('height', $('#promocodes').height());\n\t            form.hide();\n\t            ajaxloader.finish();\n\t\n\t            var status = 'error';\n\t\n\t            if(response.status) {\n\t                status = 'success';\n\t                var promo = tmpl(\n\t                    document.getElementById(\"tmpl-promocode\").innerHTML,\n\t                    response.promocode\n\t                );\n\t                var list = $(\"#promocodes-list\");\n\t\n\t                if(list.find('li.notfound').length > 0)\n\t                    list.find('li.notfound').remove();\n\t                list.append(promo);\n\t\n\t            }\n\t\n\t            $('#callback-order-' + status).css('height', $('#promocodes').height()).fadeIn(200);\n\t\n\t            countDown({\n\t                time: 5, // in seconds\n\t                display:  $('#callback-order-' + status + ' .timer'),\n\t                afterFinish: function() {\n\t                    $('#callback-order-' + status).fadeOut(200, function() {\n\t                        form[0].reset();\n\t                        $('#promocodes .content-panel .static').css('height', _h);\n\t                        form.fadeIn(200);\n\t                        $('button[data-to-form=\"#promocode-add\"]').addClass('btn-bordered').removeClass('btn-primary').attr('disabled', 'disabled');\n\t                        $('button[data-to-form=\"#' + form.attr('id') + '\"]').show();\n\t                    });\n\t\n\t                }\n\t            });\n\t\n\t        });\n\t\n\t\n\t    },\n\t    process: function(data, callback) {\n\t        // Ajax simulation\n\t        setTimeout(function() {\n\t            var response = {\n\t                status: true,\n\t                promocode: {\n\t                    name: 'Скидка 500₽ на первый заказ',\n\t                    period: 'до 31 декабря 2016'\n\t                }\n\t            };\n\t            if(typeof callback === \"function\")\n\t                callback(response);\n\t        }, 1000);\n\t    }\n\t};\n\n\t$w.scroll(function () {\n\t\tapp.scroll();\n\t});\n\t$w.resize(function () {\n\t\tapp.resize();\n\t});\n\n\n\tapp.init();\n\n\n\n});\n\n\nHash = {\n\tget: function() {\n\t\tvar vars = {}, hash, splitter, hashes;\n\t\tif (!this.oldbrowser()) {\n\t\t\tvar pos = window.location.href.indexOf('?');\n\t\t\thashes = (pos != -1) ? decodeURIComponent(window.location.href.substr(pos + 1)) : '';\n\t\t\tsplitter = '&';\n\t\t}\n\t\telse {\n\t\t\thashes = decodeURIComponent(window.location.hash.substr(1));\n\t\t\tsplitter = '/';\n\t\t}\n\n\t\tif (hashes.length == 0) {return vars;}\n\t\telse {hashes = hashes.split(splitter);}\n\n\t\tfor (var i in hashes) {\n\t\t\tif (hashes.hasOwnProperty(i)) {\n\t\t\t\thash = hashes[i].split('=');\n\t\t\t\tif (typeof hash[1] == 'undefined') {\n\t\t\t\t\tvars['anchor'] = hash[0];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvars[hash[0]] = hash[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn vars;\n\t},\n\tset: function(vars) {\n\t\tvar hash = '';\n\t\tfor (var i in vars) {\n\t\t\tif (vars.hasOwnProperty(i)) {\n\t\t\t\thash += '&' + i + '=' + vars[i];\n\t\t\t}\n\t\t}\n\n\t\tif (!this.oldbrowser()) {\n\t\t\tif (hash.length != 0) {\n\t\t\t\thash = '?' + hash.substr(1);\n\t\t\t}\n\t\t\twindow.history.pushState(hash, document.title, document.location.pathname + hash);\n\t\t}\n\t\telse {\n\t\t\twindow.location.hash = hash.substr(1);\n\t\t}\n\t},\n\tadd: function(key, val) {\n\t\tvar hash = this.get();\n\t\thash[key] = val;\n\t\tthis.set(hash);\n\t},\n\tremove: function(key) {\n\t\tvar hash = this.get();\n\t\tdelete hash[key];\n\t\tthis.set(hash);\n\t},\n\tclear: function() {\n\t\tthis.set({});\n\t},\n\toldbrowser: function() {\n\t\treturn !(window.history && history.pushState);\n\t},\n};\nfunction getImageLightness(imageSrc) {\n    var deferred = $.Deferred();\n    var img = document.createElement(\"img\");\n    img.src = imageSrc;\n    img.style.display = \"none\";\n    document.body.appendChild(img);\n\n    var colorSum = 0;\n\n    img.onload = function () {\n        // create canvas\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = this.width;\n        canvas.height = this.height;\n\n        var ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(this, 0, 0);\n\n        var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n        var data = imageData.data;\n        var r, g, b, avg;\n\n        for (var x = 0, len = data.length; x < len; x += 4) {\n            r = data[x];\n            g = data[x + 1];\n            b = data[x + 2];\n\n            avg = Math.floor((r + g + b) / 3);\n            colorSum += avg;\n        }\n\n        var brightness = Math.floor(colorSum / (this.width * this.height));\n        deferred.resolve(brightness);\n        this.remove();\n    }\n    img.onerror = function () {\n        console.log('Error loading image: ' + imageSrc);\n        deferred.fail();\n    }\n    return deferred.promise();\n}\n\nString.template = function () {\n    var str = arguments[0];\n    for (var i = 1; i < arguments.length; i++) {\n        str = str.replace(RegExp(\"\\\\{\" + i + \"\\\\}\", \"gm\"), arguments[i]);\n    }\n    return str;\n};\nString.prototype.capitalizeFirstLetter = function () {\n    return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\nObject.size = function (obj) {\n    var size = 0, key;\n    for (key in obj) {\n        if (obj.hasOwnProperty(key)) size++;\n    }\n    return size;\n};\n\n/**\n * Number.prototype.format(n, x, s, c)\n *\n * @param integer n: length of decimal\n * @param integer x: length of whole part\n * @param mixed   s: sections delimiter\n * @param mixed   c: decimal delimiter\n */\nNumber.prototype.format = function (n, x, s, c) {\n    var re = '\\\\d(?=(\\\\d{' + (x || 3) + '})+' + (n > 0 ? '\\\\D' : '$') + ')',\n        num = this.toFixed(Math.max(0, ~~n));\n\n    return (c ? num.replace('.', c) : num).replace(new RegExp(re, 'g'), '$&' + (s || ','));\n};\n\nfunction guid() {\n    function s4() {\n        return Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1);\n    }\n\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n        s4() + '-' + s4() + s4() + s4();\n}\n\nfunction countDown(params) {\n    var duration = params.time;\n    var display = params.display;\n    var showMinutes = params.showMinutes;\n\n    if (!duration)\n        return;\n\n    var start = Date.now(),\n        diff,\n        minutes,\n        seconds;\n\n    function timer() {\n        diff = duration - (((Date.now() - start) / 1000) | 0);\n        minutes = (diff / 60) | 0;\n        seconds = (diff % 60) | 0;\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n        if (display && showMinutes)\n            display.text(minutes + \":\" + seconds);\n        else if (display)\n            display.text((minutes != 0 ? minutes + \":\" : \"\") + seconds);\n\n        if (diff <= 0) {\n            clearInterval(interval);\n            if (typeof params.afterFinish === 'function')\n                params.afterFinish();\n        }\n    }\n\n    timer();\n    var interval = setInterval(timer, 1000);\n}\n\n\n(function ($, undefined) {\n    $.fn.serializeObject = function () {\n        var obj = {};\n\n        $.each(this.serializeArray(), function (i, o) {\n            var n = o.name,\n                v = o.value;\n\n            obj[n] = obj[n] === undefined ? v\n                : $.isArray(obj[n]) ? obj[n].concat(v)\n                : [obj[n], v];\n        });\n\n        return obj;\n    };\n})(jQuery);\n\n\nfunction getNumEnding(iNumber, aEndings) {\n    var sEnding, i;\n    iNumber = iNumber % 100;\n    if (iNumber >= 11 && iNumber <= 19) {\n        sEnding = aEndings[2];\n    }\n    else {\n        i = iNumber % 10;\n        switch (i) {\n            case (1):\n                sEnding = aEndings[0];\n                break;\n            case (2):\n            case (3):\n            case (4):\n                sEnding = aEndings[1];\n                break;\n            default:\n                sEnding = aEndings[2];\n        }\n    }\n    return sEnding;\n}\n\nfunction is_iOS() {\n    var iDevices = [\n        'iPad Simulator',\n        'iPhone Simulator',\n        'iPod Simulator',\n        'iPad',\n        'iPhone',\n        'iPod'\n    ];\n    while (iDevices.length) {\n        if (navigator.platform === iDevices.pop()) {\n            return true;\n        }\n    }\n    return false;\n}"],"sourceRoot":"/source/"}