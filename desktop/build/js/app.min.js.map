{"version":3,"sources":["app.min.js"],"names":["getImageLightness","imageSrc","deferred","$","Deferred","img","document","createElement","src","style","display","body","appendChild","colorSum","onload","canvas","width","this","height","ctx","getContext","drawImage","r","g","b","avg","imageData","getImageData","data","x","len","length","Math","floor","brightness","resolve","remove","onerror","console","log","fail","promise","guid","s4","random","toString","substring","countDown","params","timer","diff","duration","Date","now","start","minutes","seconds","showMinutes","text","clearInterval","interval","afterFinish","time","setInterval","getNumEnding","iNumber","aEndings","sEnding","i","lang","basketProductAddError","basketProductAddSuccess","basketProductClear","basketProductClearError","basketRequestDelete","buttonTextInBasket","product","currencySymbol","DeliveryDate","DeliveryFormattedString","morning","afternoon","evening","creditcardquestdelete","creditcardNotFound","dialogChangePhoneAlert","dialogEditButton","dialogDismissButton","dialogDeleteButton","dialogCloseButton","deliveryaddressrequestdelete","deliveryaddressNotFound","processCallbackTitle","processPhoneCheck","processConfirmCheck","processSave","processAuthorization","loading","bouquet","bouquetNotFound","bouquetInBasketPopupCart","app","ajaxloader","settings","device","$w","window","env","loadBouquets","imageBouquetsBrightnessThreshold","timeoutResendConfirmPhoneCode","datetimePicker","format","value","timepicker","inline","todayButton","prevButton","nextButton","scrollMonth","dayOfWeekStart","yearStart","defaultSelect","yearEnd","minDate","maxDate","onChangeDateTime","dp","$input","obj","closest","find","removeAttr","html","widgets","calendar","getDateString","datetimepicker","undefined","checkout","delivery","type","hide","removeClass","show","addClass","onGenerate","ct","_month","each","index","tr","$tr","month","td","hasClass","$month","moment","before","calendarInitialized","trigger","init","locale","setLocale","getInfo","layout","initStyle","content","bind","forms","buttons","sidebar","load","ob","orientation","subtype","windowHeight","windowWidth","resize","popup","isOpened","loaded","setPosition","scroll","ready","mask","keyup","e","keyCode","swipe","swipeRight","event","direction","distance","fingerCount","target","is","swipeLeft","tooltipster","animation","on","order","magnificPopup","close","preventDefault","stopPropagation","basket","add","clear","open","items","removalDelay","showCloseBtn","callbacks","beforeOpen","st","mainClass","midClick","title","modal","dialog","yes","class","action","lastConfirmed","no","opened","_this","sidebarObj","one","offset","outerHeight","top","css","bottom","sh","posB","position","delay","fadeIn","orderred","zindex","appendTo","attr","initialized","fadeOut","off","_buttons","tmpId","buttonHTML","template","id","indexOf","name","tmpl","getElementById","innerHTML","afterRender","eq","form","beforeAction","bouquets","get","defaults","to","limit","after","response","options","extend","self","setTimeout","bouquetsList","call","buildListHtml","list","isEmptyObject","emptyData","append","lastItem","key","item","imgSrc","done","lightness","render","store","$this","currentTarget","bid","productObi","Error","filter","count","indexes","map","push","saveBasket","updateHtml","productcart","openedObj","step","destroyBasket","JSON","stringify","basketButton","productInBasket","productId","getProductFromBasket","removeProductFromBasket","callback","splice","error","reasons","getBasketData","getDeliveryDate","price","availableData","label","size","dia","composition","info","date","Cookies","timeofday","currentDate","settedDate","isBefore","path","save","for","status","paymentUrl","button","_w","_h","button_offset","right","left","outerWidth","localInit","formTarget","process","clearDate","_str","val","String","toLowerCase","capitalizeFirstLetter","reset","pos","transition","y","complete","serializeObject","set","expire","startPosition","startTitle","hashProcess","when","then","hash","Hash","anchor","location","toggleClass","fadeToggle","indexed","gallery","w","h","margin","lazyLoad","loop","autoplay","autoplayTimeout","autoplayHoverPause","element","owlCarousel","slideUp","loadStep3","ceil","focus","slideDown","history","pushState","pathname","inBasket","_str2","spinner","newVal","oldVal","currentLayout","setStyleLayout","container","loadLayout","newH","owl","current","parent","autoHeight","URLhashListener","animateOut","smartSpeed","animateIn","afterInit","elem","parents","slide","scrollTop","serializeArray","local","finish","auth","auth_form","validateForm","next","targetForm","jQuery","validator","addMethod","regexp","re","RegExp","optional","test","validate","onfocusout","onkeyup","onclick","focusInvalid","submitHandler","authorizationSubmitHandler","rules","required","minlength","phone","email","messages","showErrors","errorMap","errorList","message","authorizationProcess","prepend","fadeTo","image","icon","profile","submit","personal","input","cardId","cartName","str","creditcard","del","popupClass","validateCreditCard","result","card_type","valid","accept","keypress","which","addressId","address","prev","_data","cardname","cardtype","cardnumber","substr","cardtemplate","li","newId","cnt","_checkout","goToStep","loadLastStep",1,"form_step__1","registrationSubmitHandler","registrationProcess",2,"form_step__2","confirmSubmitHander","confirmProcess",3,"map_created","ymaps","loadMap","loadKladr","deliverySubmitHandler","deliveryProcess","dataObj","Map","center","zoom","controls","ZoomLayout","templateLayoutFactory","createClass","build","superclass","zoomInCallback","util","zoomIn","zoomOutCallback","zoomOut","unbind","getData","control","getMap","events","fire","oldZoom","getZoom","newZoom","zoomControl","ZoomControl","geoLayout","geolocation","geolocationControl","GeolocationControl","setLabel","charAt","toUpperCase","mapUpdate","kladr","getAddress","$kladr_form","objs","contentType","region","district","city","street","building","geocode","res","geoObjects","geoObject","geometry","getCoordinates","placemark","Placemark","setCenter","addressUpdate","$region","$district","$city","$street","$building","parentInput","verify","labelFormat","query","typeShort","k","change","openBefore","checkBefore","trim","setValues",4,"userlist","getUserList","selectize","allowEmptyOption","create","plugins","dropdown_footer","valueField","labelField","searchField","addPrecedence","escape","option","caption","onChange","$dropdown_content","formObject","dataObject","textValue","submitProcess","getCurrentStep",5,6,7,8,"recipient","who","fromme_to_name","fromme_to_phone","reason","fulladdress","split","strAddress","apartment","join","currentStep","expires","stepItem","_reasons","defaultStep","board","$currentStep","openedStep","newreason","className","parentID","stringTitle","restore_on_backspace","congratulate","photo","repeat","editreason","splitter","hashes","vars","oldbrowser","decodeURIComponent","href","hasOwnProperty","arguments","replace","prototype","slice","Object","Number","n","s","c","num","toFixed","max","fn","o","v","isArray","concat"],"mappings":"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","file":"app.min.js","sourcesContent":["/*\n * App JS\n */\nvar lang = {\n    basketProductAddError: ' .       .',\n    basketProductAddSuccess: '    .',\n    basketProductClear: ' ',\n    basketProductClearError: '    .     .',\n    basketRequestDelete: '       ?',\n    buttonTextInBasket: ' ',\n    product: '',\n    currencySymbol: '&#x20bd;',\n    DeliveryDate: ' ',\n    DeliveryFormattedString: '  {1} {2}',\n    morning: '',\n    afternoon: '',\n    evening: '',\n    creditcardquestdelete: '      \"{1}\"?',\n    creditcardNotFound: '      ',\n    dialogChangePhoneAlert: '         ',\n    dialogEditButton: '',\n    dialogDismissButton: '',\n    dialogDeleteButton: '',\n    dialogCloseButton: '',\n    deliveryaddressrequestdelete: '       \"{1}\"?',\n    deliveryaddressNotFound: '       .        ',\n    processCallbackTitle: '<br>',\n    processPhoneCheck: '<br> ',\n    processConfirmCheck: '<br>',\n    processSave: ' ',\n    processAuthorization: '<br>',\n    loading: '',\n    bouquet: '',\n    bouquetNotFound: '   ',\n    bouquetInBasketPopupCart: '  {1}  {2}'\n};\nvar app;\nvar ajaxloader;\nvar settings;\nvar device = {};\n\n$(function() {\n\tvar $w = $(window);\n\tsettings = {\n\t    env: 'dev', // clear to production\n\t    loadBouquets: 6,\n\t    imageBouquetsBrightnessThreshold: 110,\n\t    timeoutResendConfirmPhoneCode: 60 //seconds\n\t};\n\t\n\tdatetimePicker = {\n\t    format:'d.m.Y',\n\t    value: 0,\n\t    timepicker:false,\n\t    inline:true,\n\t    todayButton: false,\n\t    prevButton: false,\n\t    nextButton: false,\n\t    scrollMonth: false,\n\t    dayOfWeekStart: 1,\n\t    yearStart: '2016',\n\t    defaultSelect: false,\n\t    yearEnd: '2020',\n\t    minDate:new Date(),\n\t    maxDate: new Date(+new Date + 12096e5), // magic number is 14 days in ms\n\t    onChangeDateTime:function(dp,$input){\n\t        var obj = $input.closest('.widget').length ? $input.closest('.widget') : $input.closest('.product-cart');\n\t        obj.find('button[type=\"submit\"]').removeAttr('disabled');\n\t        obj.find('input[name=\"timeofday\"]').removeAttr('disabled');\n\t        obj.find('button[data-toggle=\"clear-date\"]').removeAttr('disabled');\n\t        $('#selectedDate').html(app.widgets.calendar.getDateString());\n\t        $('input[name=\"date\"].datetime-picker').datetimepicker({value: dp});\n\t\n\t        if(app.checkout.delivery !== undefined && (device.type == 'smallmobile' || device.type == 'mobile'))\n\t            obj.find('.warning').hide().removeClass('hidden').show().addClass('opened');\n\t\n\t\n\t    },\n\t    onGenerate: function(ct) {\n\t        var calendar = $(this).find('.xdsoft_calendar');\n\t        var _month = 0;\n\t        $.each(calendar.find('tbody tr'), function( index, tr ) {\n\t            var i = 0;\n\t            var $tr = $(tr);\n\t            var month = 0;\n\t            $.each($tr.find('td'), function (index, td) {\n\t                if($(td).hasClass('xdsoft_disabled'))\n\t                    i++;\n\t\n\t                month = $(td).data('month');\n\t            });\n\t\n\t            if(i == 7)\n\t                $tr.hide();\n\t            else if(_month != month){\n\t                var $month = $('<div/>').addClass('month').html(moment(month+1, 'MM').format('MMM'));\n\t                $tr.before($month);\n\t                _month = month;\n\t            }\n\t\n\t        });\n\t\n\t        if(\n\t            $('button[data-target=\"#widget-calendar\"]').length > 0\n\t            && app.widgets.calendar.calendarInitialized == false ) {\n\t            $(document).trigger('init.xdsoft');\n\t        }\n\t    }\n\t}\n\n\tapp = {\n\t\tinit: function() {\n\t\t\tmoment.locale('ru');\n\t\t\t$.datetimepicker.setLocale('ru');\n\n\t\t\tapp.device.getInfo();\n\t\t\tapp.layout.initStyle();\n\t\t\tapp.content.initStyle();\n\n\t\t\tapp.bind.document();\n\t\t\tapp.bind.forms();\n\t\t\tapp.bind.buttons();\n\t\t\tapp.sidebar.init();\n\t\t\tapp.widgets.load();\n\n\t\t\tapp.checkout.load(); // Get Basket info\n\t\t},\n\t\tdevice: {\n\t\t\tgetInfo: function() {\n\t\t\t\tvar ob = $('body');\n\t\t\t\tvar height = $w.height();\n\t\t\t\tvar width = $w.width();\n\t\t\t\tif( width > height ) {\n\t\t\t\t\tdevice.orientation = 'landscape';\n\t\t\t\t\tif (ob.hasClass('portrait')) {\n\t\t\t\t\t\tob.removeClass('portrait').addClass('landscape');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tob.addClass('landscape');\n\t\t\t\t} else {\n\t\t\t\t\tdevice.orientation = 'portrait';\n\t\t\t\t\tif (ob.hasClass('landscape')) {\n\t\t\t\t\t\tob.removeClass('landscape').addClass('portrait');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tob.addClass('portrait');\n\t\t\t\t}\n\n\t\t\t\tif(width >= 1441){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'fullhd';\n\t\t\t\t}\n\n\t\t\t\tif( width >= 1281 && width <= 1440 ){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'hd';\n\t\t\t\t}\n\n\t\t\t\tif( width >= 1024 && width <= 1280 ){\n\t\t\t\t\tdevice.type = 'desktop';\n\t\t\t\t\tdevice.subtype = 'small';\n\t\t\t\t}\n\n\t\t\t\tif(width >= 768 && width <= 1023)\n\t\t\t\t\tdevice.type = 'planshet';\n\t\t\t\tif(width < 768)\n\t\t\t\t\tdevice.type = 'mobile';\n\t\t\t\tif(width < 320)\n\t\t\t\t\tdevice.type = 'smallmobile';\n\n\t\t\t\tdevice.windowHeight = height;\n\t\t\t\tdevice.windowWidth = width;\n\n\t\t\t\tif(settings.env  == 'dev') {\n\t\t\t\t\tconsole.log('[DEVICE] Get device data')\n\t\t\t\t\tconsole.log(device);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tresize: function() {\n\t\t\tif(settings.env  == 'dev')\n\t\t\t\tconsole.log('[APP] Window size is changed')\n\n\t\t\tif(app.popup.isOpened())\n\t\t\t\tapp.popup.hide();\n\n\t\t\tapp.device.getInfo();\n\t\t\tapp.sidebar.initStyle();\n\t\t\tapp.content.initStyle();\n\t\t\tapp.layout.initStyle();\n\n\t\t\tif(app.widgets.calendar && app.widgets.calendar.loaded)\n\t\t\t\tapp.widgets.calendar.setPosition();\n\t\t},\n\t\tscroll: function() {\n\n\t\t},\n\t\tbind: {\n\t\t\tdocument: function() {\n\t\t\t\t$(document).ready(function(){\n\t\t\t\t\t$('input[type=\"tel\"]').mask('+7(999)999-9999');\n\t\t\t\t\t$('input[name=\"phone\"]').mask('+7(999)999-9999');\n\t\t\t\t});\n\t\t\t\t$(document).keyup(function(e) {\n\t\t\t\t\tif (e.keyCode == 27 && app.popup.isOpened())\n\t\t\t\t\t\tapp.popup.hide();   // esc\n\t\t\t\t});\n\t\t\t\t$('body').swipe( {\n\t\t\t\t\tswipeRight:function(event, direction, distance, duration, fingerCount) {\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('TouchSwipe Right Event');\n\n\t\t\t\t\t\tvar target = $(event.target);\n\t\t\t\t\t\tif( (device.type == 'desktop' && device.subtype == 'small') || device.type != 'desktop') {\n\t\t\t\t\t\t\t//console.log(target);\n\t\t\t\t\t\t\t//console.log(!target.is('body'));\n\t\t\t\t\t\t\t//console.log(target.closest('div[class^=\"owl-item\"]').length == 0);\n\t\t\t\t\t\t\t//console.log((target.closest('div[class^=\"modal\"]').length == 0 && !target.hasClass('modal')));\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!target.is('body') &&\n\t\t\t\t\t\t\t\ttarget.closest('div[class^=\"owl-item\"]').length == 0 &&\n\t\t\t\t\t\t\t\t(target.closest('div[class^=\"modal\"]').length == 0 && !target.hasClass('modal'))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tapp.popup.show('#sidebar');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t},\n\t\t\t\t\tswipeLeft:function(event, direction, distance, duration, fingerCount) {\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('TouchSwipe Left Event');\n\t\t\t\t\t\tif(app.sidebar.isOpened())\n\t\t\t\t\t\t\tapp.popup.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$('.tooltip').tooltipster({\n\t\t\t\t\tanimation: 'grow'\n\t\t\t\t});\n\n\n\t\t\t\t// Popup\n\t\t\t\t$(document).on('click', '*[data-toggle=\"popup\"]', function(e) {\n\t\t\t\t\tvar order = $(this).data('order') ? $(this).data('order') : false;\n\t\t\t\t\tapp.popup.show($(this).data('target'), order);\n\t\t\t\t});\n\t\t\t\t$(document).on('click', '#popup-bg', function() {\n\t\t\t\t\tapp.popup.hide();\n\t\t\t\t});\n\t\t\t\t$(document).on('click', 'button.popup-close', function() {\n\t\t\t\t\tapp.popup.hide();\n\t\t\t\t});\n\n\t\t\t\t// Modal\n\t\t\t\t$(document).on('click', 'button.modal-close', function(e) {\n\t\t\t\t\tif($.magnificPopup)\n\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t});\n\n\t\t\t\t// Basket\n\t\t\t\t$(document).on('click', 'button[data-toggle=\"to-basket\"]', function(e) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tapp.basket.add(e);\n\t\t\t\t});\n\t\t\t\t$(document).on('click', 'button[data-toggle=\"clear-basket\"]', function() {\n\t\t\t\t\tapp.basket.clear();\n\t\t\t\t});\n\n\n\t\t\t},\n\t\t\tforms: function() {\n\n\t\t\t},\n\t\t\tbuttons: function() {\n\t\t\t\t$('button[data-toggle=\"modal\"]').on('click', function() {\n\t\t\t\t\t$.magnificPopup.open({\n\t\t\t\t\t\ttype:'inline',\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\tsrc: $(this).data('target')\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremovalDelay: 500,\n\t\t\t\t\t\tshowCloseBtn: false,\n\t\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\t\tbeforeOpen: function() {\n\t\t\t\t\t\t\t\tthis.st.mainClass = 'mfp-zoom-in';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmidClick: true\n\t\t\t\t\t});\n\t\t\t\t})\n\n\t\t\t\t$('button[data-toggle=\"dialog\"]').on('click', function() {\n\t\t\t\t\tvar title = ($(this).data('title')?$(this).data('title'):'');\n\t\t\t\t\tvar content = ($(this).data('content')?$(this).data('content'):'');\n\t\t\t\t\tapp.modal.dialog({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\tcontent: content,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tyes: {\n\t\t\t\t\t\t\t\ttitle: '',\n\t\t\t\t\t\t\t\tclass: 'edit',\n\t\t\t\t\t\t\t\taction: function(){\n\t\t\t\t\t\t\t\t\tif(settings.env == 'dev') console.log('[Dialog (default)] Confirmed');\n\t\t\t\t\t\t\t\t\tapp.modal.lastConfirmed = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tno: {\n\t\t\t\t\t\t\t\ttitle: lang.dialogCloseButton,\n\t\t\t\t\t\t\t\tclass: 'dismiss',\n\t\t\t\t\t\t\t\taction: function(){ if(settings.env == 'dev') console.log('[Dialog (default)] Not confirmed'); app.modal.lastConfirmed = false; }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\tsidebar: {\n\t\t\topened: false,\n\t\t\tisOpened: function() {\n\t\t\t\treturn this.opened;\n\t\t\t},\n\t\t\tinit: function() {\n\t\t\t\tvar _this = this;\n\t\t\t\tvar sidebar;\n\t\t\t\tthis.sidebarObj = sidebar = $('#sidebar');\n\n\t\t\t\tsidebar.on('open', function() {\n\t\t\t\t\t_this.open();\n\t\t\t\t});\n\t\t\t\tsidebar.on('close', function() {\n\t\t\t\t\t_this.close();\n\t\t\t\t});\n\t\t\t\t$('button[data-toggle=\"close-sidebar\"]').on('click', function() {\n\t\t\t\t\t$(this).addClass('closing');\n\t\t\t\t\t$(this).one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\n\t\t\t\t\t});\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t\tapp.sidebar.close();\n\t\t\t\t});\n\n\t\t\t\tthis.initStyle();\n\n\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\tvar offset = 0;\n\t\t\t\t\tvar content = $(\"#bouquet-list\");\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[SIDEBAR] Bouquets new loaded check style sidebar');\n\t\t\t\t\tif(\n\t\t\t\t\t\tcontent.length &&\n\t\t\t\t\t\t(content.outerHeight() + $('#header').height()) < device.windowHeight - sidebar.find('.sidebar-bottom').height()\n\t\t\t\t\t) {\n\t\t\t\t\t\tconsole.log(offset);\n\t\t\t\t\t\toffset = (device.windowHeight - content.height()) - content.offset().top - sidebar.find('.sidebar-bottom').height();\n\t\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: offset});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: 0});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tinitStyle: function() {\n\t\t\t\tvar sidebar = this.sidebarObj;\n\t\t\t\tif(device.type == 'desktop' && (device.subtype == 'hd' || device.subtype == 'fullhd'))\n\t\t\t\t\tsidebar.removeClass('collapsed');\n\t\t\t\telse\n\t\t\t\t\tsidebar.addClass('collapsed');\n\n\t\t\t\tvar sh = sidebar.find('.sidebar-top').outerHeight() + sidebar.find('.sidebar-bottom').height();\n\t\t\t\tvar posB = $w.height() < sh? 'relative': 'absolute';\n\t\t\t\tvar posS = $w.height() < sh? 'absolute': 'fixed';\n\t\t\t\tvar offset = 0;\n\t\t\t\tvar content = $(\"#bouquet-list\"); // mainpage content\n\n\t\t\t\tif(\n\t\t\t\t\tdevice.windowHeight > 1000 &&\n\t\t\t\t\tcontent.length > 0 &&\n\t\t\t\t\tcontent.find('li').length > 0 &&\n\t\t\t\t\t(content.outerHeight() + $('#header').height()) < device.windowHeight - sidebar.find('.sidebar-bottom').height()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\toffset = (device.windowHeight - content.height()) - content.offset().top - sidebar.find('.sidebar-bottom').height();\n\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: offset});\n\t\t\t\t} else {\n\t\t\t\t\tsidebar.find('.sidebar-bottom').css({bottom: 0});\n\t\t\t\t}\n\t\t\t\tsidebar.find('.sidebar-bottom').css({position: posB});\n\t\t\t},\n\t\t\topen: function() {\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[SIDEBAR] Open navbar');\n\t\t\t\tvar sidebar = $('#sidebar');\n\n\t\t\t\ttry {\n\t\t\t\t\tsidebar.addClass('open');\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.log('Popup open error: ' + e);\n\t\t\t\t}\n\n\t\t\t\tsidebar.find('.popup-close').hide().delay(200).fadeIn(200, function() {\n\t\t\t\t\t$(this).addClass('closing');\n\t\t\t\t});\n\t\t\t\tsidebar.find('.popup-close').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t});\n\t\t\t\tthis.opened = true;\n\t\t\t},\n\t\t\tclose: function() {\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[SIDEBAR] Close navbar')\n\t\t\t\tvar sidebar = $('#sidebar');\n\t\t\t\tsidebar.removeClass('open');\n\n\t\t\t\tsidebar.find('.popup-close').addClass('closing');\n\t\t\t\tsidebar.find('.popup-close').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {\n\t\t\t\t\tif($(this).hasClass('closing'))\n\t\t\t\t\t\t$(this).removeClass('closing');\n\t\t\t\t});\n\t\t\t\t$('button[data-toggle=\"sidebar\"]').removeClass('opened');\n\t\t\t\tthis.opened = false;\n\t\t\t}\n\t\t},\n\t\tpopup: {\n\t\t\tisOpened: function() {\n\t\t\t\tif(this.opened && this.opened.length)\n\t\t\t\t\treturn true\n\t\t\t\telse\n\t\t\t\t\treturn false\n\t\t\t},\n\t\t\tshow: function(target, orderred) {\n\t\t\t\tif(this.isOpened() && !orderred)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar target = $(target);\n\n\t\t\t\tif(!orderred) {\n\t\t\t\t\tvar zindex = target.css('z-index');\n\t\t\t\t\t$('<div />')\n\t\t\t\t\t\t.appendTo(\"#wrapper\")\n\t\t\t\t\t\t.attr('id', 'popup-bg')\n\t\t\t\t\t\t.addClass((target.hasClass('product-cart') ? 'gray': 'default'))\n\t\t\t\t\t\t.css('z-index', --zindex)\n\t\t\t\t\t\t.fadeIn(200);\n\n\t\t\t\t\t$('body').css('overflow', 'hidden').on('touchmove', function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttarget.trigger('open');\n\t\t\t\t$(document).trigger('popup-show');\n\n\t\t\t\tthis.opened = target;\n\t\t\t\tthis.initialized = true;\n\t\t\t},\n\t\t\thide: function() {\n\t\t\t\tif(this.opened) {\n\t\t\t\t\tthis.opened.trigger('close');\n\t\t\t\t\t$('#popup-bg').fadeOut(200, function() {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t});\n\t\t\t\t\t$('body').css('overflow', 'auto').off('touchmove');\n\t\t\t\t\tdelete this.opened;\n\t\t\t\t\t$(document).trigger('popup-close');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmodal: {\n\t\t\tlastConfirmed: false,\n\t\t\tdialog: function(params) {\n\t\t\t\tthis.lastConfirmed = false;\n\n\t\t\t\tvar _buttons = params.buttons;\n\n\t\t\t\tvar tmpId = 'dialog_' + guid(),\n\t\t\t\t\tbuttonHTML = '',\n\t\t\t\t\ttemplate = '';\n\n\t\t\t\tparams.id = tmpId;\n\n\t\t\t\tif(params.content.indexOf('#') === 0)\n\t\t\t\t\tparams.content = $(params.content).html();\n\n\t\t\t\t$.each(_buttons, function(name,obj){\n\t\t\t\t\tif(!obj.class)\n\t\t\t\t\t\tobj.class = '';\n\n\t\t\t\t\tbuttonHTML += '<button class=\"'+ obj.class +'\">'+ (!obj.title?name:obj.title)+'</button>' + \"\\n\";\n\n\t\t\t\t\tif(!obj.action)\n\t\t\t\t\t\tobj.action = function(){};\n\t\t\t\t});\n\n\t\t\t\tparams.buttons = buttonHTML;\n\n\t\t\t\ttry {\n\t\t\t\t\ttemplate = tmpl(\n\t\t\t\t\t\tdocument.getElementById(\"tmpl-dialog\").innerHTML,\n\t\t\t\t\t\tparams\n\t\t\t\t\t);\n\t\t\t\t\tvar obj = $(template).appendTo('body');\n\n\t\t\t\t\tif(typeof params.afterRender === \"function\")\n\t\t\t\t\t\tparams.afterRender(obj);\n\n\t\t\t\t\tvar buttons = $('#' + tmpId + ' button'),\n\t\t\t\t\t\ti = 0;\n\n\t\t\t\t\t$.each(_buttons, function(name,obj) {\n\t\t\t\t\t\tbuttons.eq(i++).on('click', function(){\n\t\t\t\t\t\t\tif(params.type == 'form') {\n\t\t\t\t\t\t\t\tvar form = $('#' + tmpId).find('form');\n\t\t\t\t\t\t\t\tif(obj.beforeAction && typeof obj.beforeAction === \"function\" ) {\n\t\t\t\t\t\t\t\t\tform.on('submit', function() {\n\t\t\t\t\t\t\t\t\t\tif(obj.beforeAction(form)) {\n\t\t\t\t\t\t\t\t\t\t\tobj.action($(this));\n\t\t\t\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tform.trigger('submit');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tobj.action();\n\t\t\t\t\t\t\t\t$.magnificPopup.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t$.magnificPopup.open({\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\tsrc: '#' + tmpId\n\t\t\t\t\t\t},\n\t\t\t\t\t\tshowCloseBtn: false,\n\t\t\t\t\t\tremovalDelay: 500,\n\t\t\t\t\t\tmainClass: 'mfp-zoom-in',\n\t\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\t\tclose: function() {\n\t\t\t\t\t\t\t\t$('#' + tmpId).remove();\n\t\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\t\tconsole.log('Popup is completely closed');\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttype: 'inline'\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('Template dialog rendering and open failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcontent: {\n\t\t\tinitStyle: function() {\n\t\t\t\t$(\"#content\").css('height', ($w.height() - $('#header').height()) + 'px');\n\t\t\t}\n\t\t},\n\t\tbouquets: {\n\t\t\tdata: [],\n\t\t\tget: function(params) {\n\t\t\t\t$(\"#ajax-loader\").fadeIn(200);\n\t\t\t\tvar defaults = {\n\t\t\t\t\tstart: 0,\n\t\t\t\t\tto: null,\n\t\t\t\t\tlimit: settings.loadBouquets,\n\t\t\t\t\ttype: 'json',\n\t\t\t\t\tafter: function(response) {}\n\t\t\t\t};\n\n\t\t\t\tthis.options = $.extend({}, defaults, params);\n\n\t\t\t\t// Ajax simulation\n\t\t\t\t// example server response = var bouquetsList\n\t\t\t\tvar self = this;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response;\n\t\t\t\t\tapp.bouquets.data = response = bouquetsList;\n\t\t\t\t\t// callback function After\n\t\t\t\t\tself.options.after.call(self, response); // callback\n\t\t\t\t\tapp.bouquets.buildListHtml(bouquetsList);\n\t\t\t\t\t$(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\n\t\t\t\t\t});\n\n\t\t\t\t}, 1000);\n\t\t\t},\n\t\t\tbuildListHtml: function(data) {\n\t\t\t\tvar list = $(\"#bouquet-list\");\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log(\"[FLOWERS] Load flowers\");\n\n\t\t\t\tif(!data || $.isEmptyObject(data)) {\n\t\t\t\t\tvar emptyData = $('<div />').hide().addClass('not-found').html(lang.bouquetNotFound)\n\t\t\t\t\t$('#content').append(emptyData);\n\t\t\t\t\temptyData.fadeIn();\n\t\t\t\t\tconsole.log(\"[FLOWERS] Data is empty\");\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\t$('#content > .not-found').remove();\n\t\t\t\t}\n\t\t\t\tvar lastItem = 0;\n\t\t\t\t$.each(data, function(key, value) {\n\t\t\t\t\tvar item = $('<li />').attr('data-bouquet-id', value.id);\n\n\t\t\t\t\tgetImageLightness(value.imgSrc)\n\t\t\t\t\t\t.done(function(brightness) {\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log(\"[IMAGE => LIGHNESS] Bouquet #\" + value.id );\n\n\t\t\t\t\t\t\tvar lightness = 'dark';\n\n\t\t\t\t\t\t\tif(brightness > settings.imageBouquetsBrightnessThreshold)\n\t\t\t\t\t\t\t\tlightness = 'light';\n\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log(' -> Bouquet #' + value.id + ': ' + value.imgSrc + ': ' + brightness + '(' + lightness + ')');\n\n\t\t\t\t\t\t\tlist.find('li[data-bouquet-id=\"'+ value.id +'\"] > div.bouquet').addClass(lightness);\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\titem.append(app.bouquets.render('tmpl-bouquet-list-item', value));\n\t\t\t\t\titem.append(app.bouquets.render('tmpl-bouquet-list-item-popup', value));\n\t\t\t\t\tlist.append(item);\n\t\t\t\t\tlastItem++;\n\t\t\t\t});\n\t\t\t\tlist.find(\".bouquet\").each(function(i) {\n\t\t\t\t\t$(this).delay(i*100).fadeIn(300, function() {\n\t\t\t\t\t\tif(i==(lastItem-1))\n\t\t\t\t\t\t\t$(document).trigger('raketa.bouquets.loaded');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t},\n\t\t\trender: function(template, data) {\n\t\t\t\tvar item = '';\n\t\t\t\ttry {\n\t\t\t\t\titem = tmpl(\n\t\t\t\t\t\tdocument.getElementById(template).innerHTML,\n\t\t\t\t\t\tdata\n\t\t\t\t\t);\n\t\t\t\t\treturn item;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('Template rendering failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tbasket: {\n\t\t\tstore: [],\n\t\t\tget: function() {\n\n\t\t\t},\n\t\t\tadd: function(e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tvar $this = $(e.currentTarget);\n\n\t\t\t\tvar bid = $this.data('product-id');\n\t\t\t\tvar productObi = $('#bouquet-list li[data-bouquet-id=\"' + bid + '\"]');\n\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[BASKET] Add product with ID #' + bid + ' to basket');\n\n\t\t\t\tif(!productObi.length)\n\t\t\t\t\tthrow Error(\"  DOM  \");\n\n\t\t\t\t$this.addClass('added');\n\t\t\t\t$this.find('span.icon').html(lang.buttonTextInBasket);\n\n\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\tconsole.log('[BASKET] [ID #' + bid + '] Get product details');\n\n\t\t\t\tvar product = app.bouquets.data.filter(function (bouquet) { return bouquet.id == bid })[0];\n\t\t\t\tif(product.length == 0)\n\t\t\t\t\tthrow Error(\"   c id \" + bid );\n\n\n\t\t\t\tproduct.count = 1;\n\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj.id == product.id) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t{\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('Find in basket product with the same ID');\n\t\t\t\t\tapp.checkout.basket[indexes[0]]['count'] += product.count;\n\t\t\t\t\tproduct.count = app.checkout.basket[indexes[0]]['count'];\n\t\t\t\t} else {\n\t\t\t\t\tapp.checkout.basket.push(product);\n\t\t\t\t}\n\n\t\t\t\tthis.saveBasket();\n\t\t\t\tthis.updateHtml();\n\n\t\t\t\t//   productcart ,   , popup ,     \n\t\t\t\tif(app.widgets.productcart\n\t\t\t\t\t&& app.widgets.productcart.openedObj\n\t\t\t\t\t&& app.popup.isOpened())\n\t\t\t\t{\n\t\t\t\t\tif($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t{\n\t\t\t\t\t\t//     -   2\n\t\t\t\t\t\tapp.widgets.productcart.step('delivaryDate');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t//        \n\t\t\t\t\t\tapp.widgets.productcart.step('orderInfo');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tclear: function() {\n\t\t\t\tif(this.destroyBasket()) {\n\n\n\t\t\t\t} else {\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tdestroyBasket: function() {\n\t\t\t\t// Remove basket from Cookie or session\n\t\t\t\t// Ajax\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tsaveBasket: function() {\n\t\t\t\t// SAVE TO SESSION ? or cookie? Async!\n\t\t\t\tvar data = JSON.stringify(app.checkout.basket); // JSON ???\n\t\t\t\tconsole.log('SAVE data basket');\n\t\t\t\tconsole.log(app.checkout.basket);\n\t\t\t\t// Ajax\n\t\t\t},\n\t\t\tupdateHtml: function() {\n\t\t\t\tvar basketButton = $('#header a.basket');\n\t\t\t\tbasketButton.addClass('notempty').html('<span>' + app.checkout.basket.length + '</span>');\n\t\t\t},\n\t\t\tproductInBasket: function(productId) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t\treturn indexes;\n\t\t\t\telse\n\t\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetProductFromBasket: function(productId) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t\treturn app.checkout.basket[indexes];\n\t\t\t\telse\n\t\t\t\t\treturn false;\n\t\t\t},\n\t\t\tremoveProductFromBasket: function(productId, callback) {\n\t\t\t\tvar indexes = $.map(app.checkout.basket, function(obj, index) { if(obj.id == productId) return index; });\n\t\t\t\tif(indexes.length > 0)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log(indexes);\n\t\t\t\t\t\tapp.checkout.basket.splice(indexes[0], 1);\n\t\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Failed to delete product from basket with error: ' + e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treasons: {},\n\t\tcheckout: {\n\t\t\tbasket: [],\n\t\t\tdelivery: {},\n\t\t\tload: function() {\n\t\t\t\tif(this.basket.length && !$.isEmptyObject(this.delivery))\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.getBasketData();\n\t\t\t\tthis.getDeliveryDate();\n\t\t\t},\n\t\t\tgetBasketData: function() {\n\t\t\t\tif(this.basket.length)\n\t\t\t\t\treturn;\n\t\t\t\t// Get basket from cookies or session from server, maybe store in html as JS var\n\t\t\t\t// See app.widget.productcart.hashProcess()\n\t\t\t\t// This deffered object. Ajax must be return \"return ajax({.....}) ...\"\n\t\t\t\t// Ajax Simulation\n\t\t\t\treturn $.Deferred(function() {\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tconsole.log('Get basket from session or cookies');\n\t\t\t\t\tsetTimeout(function() { // <-- example of some async operation\n\t\t\t\t\t\t// Server Response\n\t\t\t\t\t\tvar response = [{\n\t\t\t\t\t\t\tid: 2,\n\t\t\t\t\t\t\tcount: 3,\n\t\t\t\t\t\t\timgSrc: 'img/b2.jpg',\n\t\t\t\t\t\t\tprice: 2800,\n\t\t\t\t\t\t\tname: ' ',\n\t\t\t\t\t\t\tavailableData: ' 28 ',\n\t\t\t\t\t\t\tlabel: 'autumn',\n\t\t\t\t\t\t\tsize: {\n\t\t\t\t\t\t\t\tdia: '60 ',\n\t\t\t\t\t\t\t\theight: '30 '\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcomposition: ' ,  , ,   , , ',\n\t\t\t\t\t\t\tinfo: ': 60<br>: 30<hr><p> ,  , ,   , , </p>'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid: 3,\n\t\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t\t\timgSrc: 'img/b3.jpg',\n\t\t\t\t\t\t\t\tprice: 1900,\n\t\t\t\t\t\t\t\tname: ' ',\n\t\t\t\t\t\t\t\tavailableData: ' 14 ',\n\t\t\t\t\t\t\t\tsize: {\n\t\t\t\t\t\t\t\t\tdia: '60 ',\n\t\t\t\t\t\t\t\t\theight: '30 '\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcomposition: ' ,  , ,   , , ',\n\t\t\t\t\t\t\t\tinfo: ': 60<br>: 30<hr><p> ,  , ,   , , </p>'\n\t\t\t\t\t\t\t}];\n\t\t\t\t\t\tapp.checkout.basket = response;\n\t\t\t\t\t\tapp.basket.updateHtml();\n\t\t\t\t\t\t$(document).trigger('raketa.basket.get-data');\n\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t},500);\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetDeliveryDate: function() {\n\t\t\t\t// Get from cookie\n\t\t\t\tvar date =  Cookies.get('raketa_delivary__date');\n\t\t\t\tvar timeofday =  Cookies.get('raketa_delivary__timeofday');\n\t\t\t\tif(date)\n\t\t\t\t\tthis.delivery.date = date;\n\t\t\t\tif(timeofday)\n\t\t\t\t\tthis.delivery.timeofday = timeofday;\n\n\t\t\t\tif(date && timeofday) {\n\t\t\t\t\tvar currentDate = new Date();\n\t\t\t\t\tcurrentDate = moment(currentDate).format('YYYY-MM-DD');\n\t\t\t\t\tvar settedDate = moment(date, \"DD.MM.YYYY\").format('YYYY-MM-DD');\n\n\t\t\t\t\tif (moment(settedDate).isBefore(currentDate)) {\n\t\t\t\t\t\tdelete app.checkout.delivery;\n\t\t\t\t\t\tCookies.remove('raketa_delivary__date', { path: '/' });\n\t\t\t\t\t\tCookies.remove('raketa_delivary__timeofday', { path: '/' });\n\t\t\t\t\t} else if (app.widgets.calendar && app.widgets.calendar.loaded) {\n\t\t\t\t\t\tvar obj = $('#widget-calendar');\n\t\t\t\t\t\t$('.radio-group input[name=\"timeofday\"]').removeAttr('disabled');\n\t\t\t\t\t\t$('.radio-group input[name=\"timeofday\"]:checked').attr('checked', false);\n\t\t\t\t\t\t$('.radio-group input[value=\"' + timeofday + '\"]').attr('checked', true);\n\t\t\t\t\t\t$('input[name=\"date\"].datetime-picker').datetimepicker({value: date});\n\t\t\t\t\t\tobj.find('button[type=\"submit\"]').removeAttr('disabled');\n\t\t\t\t\t\tobj.find('button[data-toggle=\"clear-date\"]').removeAttr('disabled');\n\t\t\t\t\t\t$('#selectedDate').html(app.widgets.calendar.getDateString());\n\t\t\t\t\t\t$('button[data-target=\"#widget-calendar\"]').html(app.widgets.calendar.getDateString());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tsave: function(callback) {\n\t\t\t\tconsole.log('[FOR DELIVERY] Send form data to server:');\n\n\t\t\t\t//\n\t\t\t\tvar data = {\n\t\t\t\t\tbasket : this.basket,\n\t\t\t\t\tdelivery: this.delivery,\n\t\t\t\t\tfor: this.for\n\t\t\t\t};\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response = {\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tpaymentUrl: 'order_success.html'\n\t\t\t\t\t};\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t},\n\t\twidgets: {\n\t\t\tload: function() {\n\t\t\t\t$.each(this, function(index, value) {\n\t\t\t\t\tif(index !== 'load') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvalue.load();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error('Error loading widget @' + index + ' with error: ' + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tcalendar: {\n\t\t\t\tobj: {},\n\t\t\t\tloaded: false,\n\t\t\t\topened: false,\n\t\t\t\tcalendarInitialized: false,\n\t\t\t\tposition: {},\n\t\t\t\tsetPosition: function() {\n\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]'); // setting the position relative to the element\n\t\t\t\t\tvar obj = $('#widget-calendar');\n\t\t\t\t\tif(button.length) {\n\t\t\t\t\t\tvar _w = obj.width();\n\t\t\t\t\t\tvar _h = obj.height() ;\n\t\t\t\t\t\tconsole.log(_h);\n\t\t\t\t\t\tvar button_offset = button.offset();\n\t\t\t\t\t\tvar right = device.windowWidth - (button_offset.left + button.outerWidth()) - 20;\n\n\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\t\tobj.css('top', 'auto');\n\t\t\t\t\t\t\tobj.css('bottom', - (_h + 40) + 'px');// box shadow\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tobj.css('top', - (_h + 40) + 'px');// box shadow\n\t\t\t\t\t\t\tobj.css('right', Math.floor(right) + 'px');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//obj.css('height', _h + 'px');\n\t\t\t\t\t\tthis.position.width = _w;\n\t\t\t\t\t\tthis.position.height = _h;\n\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\t\tthis.position.bottom = 0;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthis.position.top = - _h;\n\t\t\t\t\t\tthis.position.right = - right;\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tlocalInit: function(obj) {\n\t\t\t\t\tthis.obj = obj;\n\t\t\t\t},\n\t\t\t\tload: function() {\n\t\t\t\t\tthis.obj = $(\"#widget-calendar\");\n\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]');\n\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\t$('input[name=\"date\"].datetime-picker').each(function() {\n\t\t\t\t\t\t$(this).datetimepicker(datetimePicker)\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\t\t$('input[name=\"date\"].datetime-picker').each(function() {\n\t\t\t\t\t\t\t$(this).datetimepicker('destroy');\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$('input[name=\"date\"].datetime-picker').each(function() {\n\t\t\t\t\t\t\t$(this).datetimepicker(datetimePicker);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('click', 'button[data-toggle=\"setDelivaryDate\"]', function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tvar formTarget = $(this).data('to-form');\n\t\t\t\t\t\tvar form = $(formTarget);\n\t\t\t\t\t\t_this.process(form);\n\t\t\t\t\t\tif($(this).data('hide') == true)\n\t\t\t\t\t\t\tapp.popup.hide();\n\n\t\t\t\t\t\t//   productcart ,   , popup ,     \n\t\t\t\t\t\tif(app.widgets.productcart\n\t\t\t\t\t\t\t&& app.widgets.productcart.openedObj\n\t\t\t\t\t\t\t&& app.popup.isOpened())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tapp.widgets.productcart.step('orderInfo');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('change', 'input[name=\"timeofday\"]', function() {\n\t\t\t\t\t\tif(_this.obj && _this.obj.hasClass('widget'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('#selectedDate').html(_this.getDateString());\n\t\t\t\t\t\t\tif(app.checkout.delivery !== undefined)\n\t\t\t\t\t\t\t\tbutton.html(_this.getDateString());\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tbutton.html(lang.DeliveryDate);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('click', 'button[data-toggle=\"clear-date\"]', function(e) {\n\t\t\t\t\t\t$(this).attr('disabled', 'disabled');\n\t\t\t\t\t\t_this.clearDate($(this));\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('open', \"#widget-calendar\", function() {\n\t\t\t\t\t\t_this.open();\n\t\t\t\t\t});\n\t\t\t\t\t$(document).on('close', \"#widget-calendar\", function() {\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('init.xdsoft', function() {\n\t\t\t\t\t\t_this.setPosition();\n\t\t\t\t\t\t_this.calendarInitialized = true;\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.loaded = true;\n\t\t\t\t},\n\t\t\t\tgetDateString: function() {\n\t\t\t\t\tvar _str = lang.DeliveryFormattedString;\n\t\t\t\t\tvar timeofday = this.obj.find('input[name=\"timeofday\"]:checked').val();\n\t\t\t\t\tvar date = this.obj.find('input[name=\"date\"]').val();\n\t\t\t\t\tif(date)\n\t\t\t\t\t\tdate = moment(date, 'DD.MM.YYYY').format('D MMMM');\n\t\t\t\t\telse\n\t\t\t\t\t\tdate = '';\n\t\t\t\t\t_str = String.template(_str, (lang[timeofday] ? lang[timeofday] : ''), date);\n\t\t\t\t\t_str = _str.toLowerCase().capitalizeFirstLetter();\n\t\t\t\t\treturn _str;\n\t\t\t\t},\n\t\t\t\tclearDate: function(button) {\n\t\t\t\t\tvar form = button.closest('form');\n\t\t\t\t\tform.find('.xdsoft_current').removeClass('xdsoft_current');\n\t\t\t\t\tform.find('input[name=\"date\"].delivery-date').val(new Date());\n\t\t\t\t\tform[0].reset();\n\t\t\t\t\t$('#selectedDate').html(lang.DeliveryDate);\n\t\t\t\t\t$('button[data-target=\"#widget-calendar\"]').html(lang.DeliveryDate);\n\t\t\t\t\t$('button[data-toggle=\"setDelivaryDate\"]').attr('disabled', 'disabled');\n\t\t\t\t\tform.find('input[name=\"timeofday\"]:checked').attr('checked', false);\n\t\t\t\t\tform.find('input[name=\"timeofday\"]').attr('disabled', 'disabled');\n\t\t\t\t\tdelete app.checkout.delivery;\n\t\t\t\t\tCookies.remove('raketa_delivary__date', { path: '/' });\n\t\t\t\t\tCookies.remove('raketa_delivary__timeofday', { path: '/' });\n\t\t\t\t\tapp.popup.hide();\n\t\t\t\t},\n\t\t\t\topen: function() {\n\t\t\t\t\tthis.obj = $(\"#widget-calendar\");\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Open widget @calendar');\n\n\t\t\t\t\tif($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t\tthis.obj.find('.xdsoft_current').removeClass('xdsoft_current');\n\n\t\t\t\t\tthis.obj.addClass('animation');\n\n\t\t\t\t\tvar pos = this.obj.height() + 40;\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tpos = - this.obj.height() - 40;\n\n\t\t\t\t\tthis.obj.transition({ y: Math.floor(pos) }); //box shadow\n\n\t\t\t\t\tvar _this = this;\n\t\t\t\t\tthis.obj.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {\n\t\t\t\t\t\t_this.obj.removeClass('animation').addClass('opened');\n\t\t\t\t\t});\n\n\t\t\t\t\t_this.opened = true;\n\t\t\t\t},\n\t\t\t\tclose: function() {\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Close widget @calendar');\n\n\t\t\t\t\tthis.obj.removeClass('opened').addClass('animation');\n\t\t\t\t\tvar pos = this.position.top;\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tpos = this.position.bottom;\n\n\t\t\t\t\tthis.obj.find('.warning').removeClass('opened');\n\n\t\t\t\t\tthis.obj.transition({ y: pos, complete: function() {\n\t\t\t\t\t\tthis.opened = false;\n\t\t\t\t\t}});\n\n\t\t\t\t},\n\t\t\t\tprocess: function(form) {\n\t\t\t\t\tvar button = $('button[data-target=\"#widget-calendar\"]');\n\t\t\t\t\tvar data = form.serializeObject();\n\t\t\t\t\tapp.checkout.delivery = data;\n\t\t\t\t\tif(app.checkout.delivery !== undefined)\n\t\t\t\t\t\tbutton.html(this.getDateString());\n\t\t\t\t\telse\n\t\t\t\t\t\tbutton.html(lang.DeliveryDate);\n\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t// Save to cookie or maybe ajax?\n\t\t\t\t\tCookies.set('raketa_delivary__date', data.date, { expire: 14, path: '/' });\n\t\t\t\t\tCookies.set('raketa_delivary__timeofday', data.timeofday, { expire: 14, path: '/' });\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tproductcart: {\n\t\t\t\tloaded: false,\n\t\t\t\tstartPosition: {},\n\t\t\t\tstartTitle: '',\n\t\t\t\thashProcess: function() {\n\t\t\t\t\t//$('#bouquet-list').on('raketa.bouquets.loaded raketa.basket.get', function() {\n\t\t\t\t\tvar bouquets = $.Deferred(function() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tvar basket = $.Deferred(function() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t$(document).on('raketa.basket.get-data', function() {\n\t\t\t\t\t\t\tself.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t$.when(basket, bouquets).then(function() {\n\t\t\t\t\t\tvar hash = Hash.get();\n\t\t\t\t\t\tvar obj;\n\t\t\t\t\t\tif (hash.anchor) {\n\t\t\t\t\t\t\twindow.location.hash = hash.anchor;\n\t\t\t\t\t\t} else if (hash.bouquet) {\n\t\t\t\t\t\t\tobj = $('#bouquet-list li[data-bouquet-id=\"' + hash.bouquet + '\"] > div[data-toggle=\"popup\"]')\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(obj)\n\t\t\t\t\t\t\tobj.trigger('click');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tload: function() {\n\t\t\t\t\tthis.obj = $('.product-cart');\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\tthis.hashProcess();\n\n\t\t\t\t\t$(document).on('open', '.product-cart', function(e) {\n\t\t\t\t\t\t_this.open(e);\n\t\t\t\t\t});\n\t\t\t\t\t$(document).on('close', '.product-cart', function() {\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t});\n\n\t\t\t\t\t// Show product info\n\t\t\t\t\t$(document).on('click', '.product-cart button[data-toggle=\"show-product-info\"]', function() {\n\t\t\t\t\t\tvar id = $(this).data('product-id');\n\t\t\t\t\t\t$(this).toggleClass('active');\n\t\t\t\t\t\t$('#popup-product-' + id + ' .product-info').fadeToggle(300, function() {\n\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// Open next/prev product cart\n\t\t\t\t\t$(document).on('click', '.product-cart button.direction', function(e) {\n\t\t\t\t\t\tvar direction = $(this).data('direction');\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart - change current cart (' + direction + ')');\n\n\t\t\t\t\t\tvar currentIndex = index = _this.openedObj.closest('li[data-bouquet-id]').index();\n\t\t\t\t\t\tconsole.log('Opened index element ' + index);\n\n\t\t\t\t\t\tswitch (direction) {\n\t\t\t\t\t\t\tcase 'prev':\n\t\t\t\t\t\t\t\tindex = (index - 1 < 0 ? $('#bouquet-list li:last-child').index() : index - 1);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'next':\n\t\t\t\t\t\t\t\tindex = (index + 1 > $('#bouquet-list li').length - 1 ? 0 : index + 1);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this.close();\n\t\t\t\t\t\tvar indexed = $('#bouquet-list li').eq(index);\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tindexed.find('div[data-toggle=\"popup\"]').data('order', true).trigger('click');\n\t\t\t\t\t\t}, 300);\n\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$(document).on('raketa.bouquets.loaded', function() {\n\t\t\t\t\t\tvar gallery = $('.product-cart').find('.gallery-list');\n\t\t\t\t\t\tvar w = $('.product-cart').width();\n\t\t\t\t\t\tvar h = $('.product-cart').height();\n\t\t\t\t\t\tif(gallery.length > 0) {\n\t\t\t\t\t\t\tgallery.css('height', h);\n\t\t\t\t\t\t\tgallery.find('.owl-lazy').css('height', h);\n\t\t\t\t\t\t\tgallery.find('.owl-lazy').css('width', w/2);\n\t\t\t\t\t\t\tgallery.find('.owl-height').css('height', $('.product-cart').height());\n\t\t\t\t\t\t\tgallery.css('width', w/2);\n\n\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\titems: 1,\n\t\t\t\t\t\t\t\tmargin: 0,\n\t\t\t\t\t\t\t\tlazyLoad:true,\n\t\t\t\t\t\t\t\tloop:true,\n\t\t\t\t\t\t\t\tautoplay: true,\n\t\t\t\t\t\t\t\tautoplayTimeout: 5000,\n\t\t\t\t\t\t\t\tautoplayHoverPause: true\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart Found gallery in product cart');\n\n\t\t\t\t\t\t\tgallery.on('initialized.owl.carousel', function(event) {\n\t\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tgallery.find('.owl-lazy').on('click', function() {\n\t\t\t\t\t\t\t\tgallery.trigger('next.owl.carousel');\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tgallery.owlCarousel(params);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.loaded = true;\n\t\t\t\t},\n\t\t\t\topen: function(e) {\n\t\t\t\t\tvar obj = $(e.target);\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Open widget @productcart with id #' + obj.attr('id'));\n\n\t\t\t\t\t$('#bouquet-list li[data-bouquet-id=\"' + obj.data('product-id') + '\"] > div[data-toggle=\"popup\"]').data('order', false);\n\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\t$('#header button[data-target=\"#widget-calendar\"]').slideUp(200);\n\n\t\t\t\t\t//var height = ($w.height() - $('#header').height()) - 50;\n\n\t\t\t\t\tvar height = obj.height();\n\t\t\t\t\tvar width = obj.width();\n\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\tobj.css('top', 'auto');\n\t\t\t\t\t\tobj.css('bottom', -height).css('visibility', 'visible');\n\t\t\t\t\t\tthis.startPosition.bottom = 0;\n\t\t\t\t\t\tobj.find('.product-info').show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.css('top', -height).css('visibility', 'visible');\n\t\t\t\t\t\tthis.startPosition.top = -height;\n\t\t\t\t\t}\n\n\t\t\t\t\t//         ,   3\n\t\t\t\t\tvar index;\n\t\t\t\t\tif(app.basket.productInBasket(obj.data('product-id')) && !$.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t{\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step 3');\n\n\t\t\t\t\t\tthis.loadStep3(obj, app.basket.productInBasket(obj.data('product-id')));\n\t\t\t\t\t}\n\t\t\t\t\telse if(app.basket.productInBasket(obj.data('product-id')) && $.isEmptyObject(app.checkout.delivery)) //         -  2\n\t\t\t\t\t{\n\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step 2');\n\t\t\t\t\t\tapp.widgets.calendar.localInit(obj.find('.step2'));\n\t\t\t\t\t\tif($.isEmptyObject(app.checkout.delivery))\n\t\t\t\t\t\t\tobj.find('.xdsoft_current').removeClass('xdsoft_current');\n\n\t\t\t\t\t\tobj.find('.step').hide().removeClass('active');\n\t\t\t\t\t\tobj.find('.step2').addClass('active').show();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar width = obj.outerWidth();\n\t\t\t\t\tobj.css('margin-left', Math.ceil(-width/2));\n\n\t\t\t\t\tobj.addClass('transition');\n\n\t\t\t\t\tif(device.type == 'desktop' && (device.subtype == 'fullhd' || device.subtype == 'hd'))\n\t\t\t\t\t\tobj.transition({ y: Math.floor(device.windowHeight - (device.windowHeight - height)/2) });\n\t\t\t\t\telse if (device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tobj.transition({ y: Math.floor(- height)});\n\t\t\t\t\telse\n\t\t\t\t\t\tobj.transition({ y: Math.floor(height + $('#header').height())});\n\n\t\t\t\t\tobj.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {\n\t\t\t\t\t\tobj.removeClass('transition').addClass('opened');\n\t\t\t\t\t\tobj.find('.bottom button:first-child').focus();\n\t\t\t\t\t});\n\t\t\t\t\t// History add\n\t\t\t\t\tthis.startTitle = document.title;\n\t\t\t\t\tdocument.title = lang.bouquet + ' ' + obj.data('title');\n\t\t\t\t\tHash.add('bouquet', obj.data('product-id'));\n\t\t\t\t\tthis.openedObj = obj;\n\t\t\t\t},\n\t\t\t\tclose: function() {\n\t\t\t\t\tvar obj = this.openedObj;\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] Close widget @productcart');\n\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\t$('#header button[data-target=\"#widget-calendar\"]').slideDown(200);\n\t\t\t\t\t\t$('#content .mobile.notify').removeClass('open');\n\t\t\t\t\t}\n\n\t\t\t\t\tobj.removeClass('opened').addClass('animation');\n\t\t\t\t\tvar pos = this.startPosition.top;\n\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\t\tpos = this.startPosition.bottom;\n\t\t\t\t\tobj.transition({ y: pos });\n\t\t\t\t\twindow.location.hash = '';\n\t\t\t\t\thistory.pushState('', document.title, window.location.pathname);\n\t\t\t\t\tdocument.title = this.startTitle;\n\t\t\t\t\tdelete this.openedObj;\n\t\t\t\t},\n\t\t\t\tstep: function(step) {\n\t\t\t\t\tif(!step)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('[WIDGET] @productcart go to step - ' + step);\n\n\t\t\t\t\tvar obj = this.openedObj;\n\t\t\t\t\tswitch (step) {\n\t\t\t\t\t\tcase 'delivaryDate':\n\t\t\t\t\t\t\tconsole.log(obj);\n\t\t\t\t\t\t\tobj.find('.step.active').fadeOut('fast', function() {\n\t\t\t\t\t\t\t\tobj.find('.step.step2').fadeIn('fast');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'orderInfo':\n\t\t\t\t\t\t\tthis.loadStep3(obj, app.basket.productInBasket(obj.data('product-id')));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadStep3: function(obj, index) {\n\t\t\t\t\tobj.find('.step').hide().removeClass('active');\n\t\t\t\t\tobj.find('.step3').addClass('active').show();\n\t\t\t\t\t$('#content .mobile.notify').addClass('open');\n\t\t\t\t\tvar inBasket = app.basket.getProductFromBasket(obj.data('product-id'));\n\n\t\t\t\t\tvar _str = lang.bouquetInBasketPopupCart;\n\t\t\t\t\tvar _str2 = inBasket.count + ' ' + lang.bouquet + getNumEnding(inBasket.count, ['', '', '']);\n\n\t\t\t\t\tvar price = inBasket.count * inBasket.price;\n\t\t\t\t\tif(price > 10000)\n\t\t\t\t\t\tprice = price.format(0, 3, ' ', '.');\n\n\t\t\t\t\t_str = String.template(_str, _str2.toLowerCase(), price + lang.currencySymbol);\n\n\t\t\t\t\t$('#in-basket-product-' + obj.data('product-id')).html('<span class=\"icon-basket\"></span> ' + _str);\n\t\t\t\t\t$('#p' + obj.data('product-id') + '-count').val(inBasket.count);\n\n\t\t\t\t\t$('[data-trigger=\"spinner\"]')\n\t\t\t\t\t\t.spinner('max', 99)\n\t\t\t\t\t\t.spinner('changing', function(e, newVal, oldVal) {\n\t\t\t\t\t\t\tvar name = $(this).attr('name');\n\n\t\t\t\t\t\t\tif(newVal < 0)\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tapp.checkout.basket[index[0]].count = newVal;\n\n\t\t\t\t\t\t\tvar _str = lang.bouquetInBasketPopupCart;\n\t\t\t\t\t\t\tvar _str2 = newVal + ' ' + lang.bouquet + getNumEnding(inBasket.count, ['', '', '']);\n\n\t\t\t\t\t\t\tvar price = newVal * inBasket.price;\n\t\t\t\t\t\t\tif(price > 10000)\n\t\t\t\t\t\t\t\tprice = price.format(0, 3, ' ', '.');\n\n\t\t\t\t\t\t\t_str = String.template(_str, _str2.toLowerCase(), price + lang.currencySymbol);\n\n\t\t\t\t\t\t\t$('#in-basket-product-' + obj.data('product-id')).html('<span class=\"icon-basket\"></span> ' + _str);\n\n\t\t\t\t\t\t\tapp.basket.saveBasket();\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlayout: {\n\t\t\tcurrentLayout: {},\n\t\t\tinitStyle: function() {\n\t\t\t\tif($.isEmptyObject(this.currentLayout)) return;\n\n\t\t\t\tif(settings.env == 'dev') console.log('Set layout('+this.currentLayout.name+') template style');\n\t\t\t\tthis.setStyleLayout(this.currentLayout.name, this.currentLayout.container);\n\t\t\t},\n\t\t\tinit: function(container, callback) {\n\t\t\t\tif(!container)\n\t\t\t\t\tcontainer = $('div[data-layout]');\n\n\t\t\t\tvar layout = container.data('layout');\n\n\t\t\t\tif (!layout){\n\t\t\t\t\tconsole.error('Layout attribute not found');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.currentLayout.name = layout;\n\t\t\t\tthis.currentLayout.container = container;\n\t\t\t\tthis.currentLayout.callback = callback;\n\t\t\t\tif(settings.env == 'dev') console.log('Initialize layout('+layout+')');\n\t\t\t\tthis.loadLayout(layout, container, callback);\n\t\t\t},\n\t\t\tsetStyleLayout: function(layout, container) {\n\t\t\t\tif(layout != 'devided-slider' && (device.type == 'smallmobile' || device.type == 'mobile'))\n\t\t\t\t\treturn;\n\t\t\t\tvar currentH = container.outerHeight();\n\t\t\t\tvar newH = ($w.height() - $('#header').height()) - 50;\n\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile')\n\t\t\t\t\tnewH += 50;\n\n\t\t\t\tcontainer.css('height', newH + 'px');\n\n\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\tcontainer.find('.menu-wrapper').css('height', newH + 'px');\n\t\t\t\t\tcontainer.find('.content-panel').css('min-height', newH + 'px');\n\t\t\t\t\tcontainer.css('min-height', newH + 'px');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcontainer.css('height', newH + 'px');\n\t\t\t\t}\n\t\t\t},\n\t\t\tloadLayout: function(layout, container, callback) {\n\t\t\t\tswitch (layout) {\n\t\t\t\t\tcase 'devided-slider':\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile'){\n\t\t\t\t\t\t\t$('.layout-menu li.active').removeClass('active');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar w = $(\"#content\").width();\n\t\t\t\t\t\tvar owl = $('#slider-content');\n\t\t\t\t\t\tif(device.type != 'smallmobile' && device.type != 'mobile')\n\t\t\t\t\t\t\towl.css('width', w/2);\n\n\t\t\t\t\t\towl.on('initialized.owl.carousel', function(event) {\n\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\t\t\t\t\t\t\tvar hash = current.data('hash');\n\t\t\t\t\t\t\tif(device.type != 'smallmobile' && device.type != 'mobile') {\n\t\t\t\t\t\t\t\tcontainer.find('.layout-menu li.active').removeClass('active');\n\t\t\t\t\t\t\t\tcontainer.find('.layout-menu a[href=\"#' + hash + '\"]').parent().addClass('active');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[OWL Carousel] Event initialized.owl.carousel');\n\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom').hide();\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom[data-to-slide=\"'+ hash +'\"]').fadeIn(200);\n\t\t\t\t\t\t});\n\t\t\t\t\t\towl.on('changed.owl.carousel', function(event) {\n\t\t\t\t\t\t\tvar element = $(event.target);\n\t\t\t\t\t\t\tvar item = event.item.index;\n\t\t\t\t\t\t\tvar current = element.find('.owl-item').eq(item).find('.item');\n\t\t\t\t\t\t\tvar hash = current.data('hash');\n\t\t\t\t\t\t\tif(device.type != 'smallmobile' && device.type != 'mobile') {\n\t\t\t\t\t\t\t\tcontainer.find('.layout-menu li.active').removeClass('active');\n\t\t\t\t\t\t\t\tcontainer.find('.layout-menu a[href=\"#' + hash + '\"]').parent().addClass('active');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(hash)\n\t\t\t\t\t\t\t\twindow.location.hash = hash;\n\t\t\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\t\t\tconsole.log('[OWL Carousel] Event changed.owl.carousel');\n\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom').hide();\n\t\t\t\t\t\t\tcontainer.find('.content-panel > .bottom[data-to-slide=\"'+ hash +'\"]').fadeIn(300);\n\t\t\t\t\t\t});\n\t\t\t\t\t\towl.owlCarousel({\n\t\t\t\t\t\t\tautoHeight: true,\n\t\t\t\t\t\t\titems:1,\n\t\t\t\t\t\t\tURLhashListener:true,\n\t\t\t\t\t\t\tstartPosition: 'URLHash',\n\t\t\t\t\t\t\tanimateOut: 'fadeOut',\n\t\t\t\t\t\t\tsmartSpeed:450,\n\t\t\t\t\t\t\tanimateIn: 'fadeIn',\n\t\t\t\t\t\t\tafterInit: function(elem){\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(\"#content ul.layout-menu a\").on('click', function(e) {\n\t\t\t\t\t\t\tif(!$(this).parent().hasClass('active')) {\n\t\t\t\t\t\t\t\t$(this).parents('.layout-menu').find('li.active').removeClass('active');\n\t\t\t\t\t\t\t\t$(this).parent().addClass('active');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile'){\n\t\t\t\t\t\t\t\t$('.layout.devided-slider').css('overflow', 'auto');\n\t\t\t\t\t\t\t\t$('.layout.devided-slider .menu-wrapper').transition({ x: -320, complete: function() {\n\t\t\t\t\t\t\t\t}});\n\t\t\t\t\t\t\t\t$('#header .navbar-toggle').hide();\n\t\t\t\t\t\t\t\t$('#header .back').show();\n\t\t\t\t\t\t\t\tvar title = $(this).text();\n\t\t\t\t\t\t\t\t$('#header .mobile.title').html(title);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\towl.find('button,input,select').addClass('not-draggable').on(\"touchstart mousedown\", function(e) {\n\t\t\t\t\t\t\t// Prevent carousel swipe\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\towl.parent().find('button[type=\"submit\"]').on('click', function() {\n\t\t\t\t\t\t\tvar slide = owl.find('.item[data-hash=\"' + $(this).data('to-slide') +'\"]');\n\t\t\t\t\t\t\tslide.find('form').trigger('submit');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif(device.type == 'smallmobile' || device.type == 'mobile') {\n\t\t\t\t\t\t\tvar hash = window.location.hash;\n\t\t\t\t\t\t\tif(hash){\n\t\t\t\t\t\t\t\t$('.layout.devided-slider').css('overflow', 'auto');\n\t\t\t\t\t\t\t\t$('.layout.devided-slider .menu-wrapper').transition({ x: -320, complete: function() {\n\t\t\t\t\t\t\t\t\t$(window).scrollTop();\n\t\t\t\t\t\t\t\t}});\n\t\t\t\t\t\t\t\t$('#header .navbar-toggle').hide();\n\t\t\t\t\t\t\t\t$('#header .back').show();\n\n\t\t\t\t\t\t\t\tvar title = $('#content ul.layout-menu a[href=\"'+hash+'\"]').text();\n\t\t\t\t\t\t\t\t$('#header .mobile.title').html(title);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$('button[data-toggle=\"devided-slider-back\"]').on('click', function() {\n\t\t\t\t\t\t\t\twindow.location.hash = '';\n\t\t\t\t\t\t\t\t$('.layout.devided-slider').height($(window).height() - 65);\n\t\t\t\t\t\t\t\t$('.layout.devided-slider').css('overflow', 'hidden');\n\t\t\t\t\t\t\t\t$('.layout.devided-slider .menu-wrapper').transition({ x: 0, complete: function() {\n\t\t\t\t\t\t\t\t\t$(window).scrollTop();\n\t\t\t\t\t\t\t\t}});\n\t\t\t\t\t\t\t\t$('#header .back').hide();\n\t\t\t\t\t\t\t\t$('#header .mobile.title').html($('title').text());\n\t\t\t\t\t\t\t\t$('#header .navbar-toggle').show();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'default':\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'devided':\n\t\t\t\t\t\tthis.setStyleLayout(layout, container);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif(typeof callback === 'function')\n\t\t\t\t\tcallback(container);\n\t\t\t}\n\t\t},\n\t\tcallback: {\n\t\t\torder: function(form) {\n\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t\t\t\tvar data = form.serializeArray();\n\t\t\t\tajaxloader.local({\n\t\t\t\t\telement: form,\n\t\t\t\t\tto: '.item[data-hash=\"callback\"]',\n\t\t\t\t\ttitle: lang.processPhoneCheck\n\t\t\t\t});\n\t\t\t\tthis.process(data, function(response) {\n\t\t\t\t\tajaxloader.finish();\n\t\t\t\t\tform.hide();\n\t\t\t\t\t$('#slider-content .owl-height').css('height', $('#support').height());\n\t\t\t\t\t$('#callback-order-success').css('height', $('#support').height()).fadeIn(200);\n\n\t\t\t\t\tcountDown({\n\t\t\t\t\t\ttime: 10, // in seconds\n\t\t\t\t\t\tdisplay:  $('#callback-order-success .timer'),\n\t\t\t\t\t\tafterFinish: function() {\n\t\t\t\t\t\t\t$('#callback-order-success').fadeOut(200, function() {\n\t\t\t\t\t\t\t\tform[0].reset();\n\t\t\t\t\t\t\t\tform.fadeIn(200);\n\t\t\t\t\t\t\t\t$('#slider-content .owl-height').css('height', form.outerHeight());\n\t\t\t\t\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').show();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t},\n\t\t\tprocess: function(data, callback) {\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\n\t\t\t\t\tvar response = [];\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t},\n\t\tauth: {\n\t\t\tinit: function() {\n\t\t\t\tvar auth_form = $('#auth-form');\n\t\t\t\tthis.validateForm(auth_form);\n\t\t\t\tauth_form.find('input').on('keyup', function() {\n\t\t\t\t\t$(this).removeClass('error').parent().removeClass('has-error');\n\t\t\t\t\t$(this).next('i.fa').remove();\n\t\t\t\t});\n\n\t\t\t\tauth_form.closest('.content-panel').find('.bottom button[type=\"submit\"]').on('click', function(e) {\n\t\t\t\t\tvar targetForm = $(this).data('to-form');\n\n\t\t\t\t\tif(settings.env == 'dev')\n\t\t\t\t\t\tconsole.log('Click bottom button with target form ' + targetForm);\n\t\t\t\t\tif(!targetForm || $(targetForm).length == 0)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tvar form = $(targetForm);\n\t\t\t\t\tform.trigger('submit');\n\t\t\t\t\tform.closest('.static').find('.form-status').remove();\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t},\n\t\t\tvalidateForm: function(form) {\n\t\t\t\tvar _this = this;\n\t\t\t\tjQuery.validator.addMethod(\n\t\t\t\t\t'regexp',\n\t\t\t\t\tfunction(value, element, regexp) {\n\t\t\t\t\t\tvar re = new RegExp(regexp);\n\t\t\t\t\t\treturn this.optional(element) || re.test(value);\n\t\t\t\t\t},\n\t\t\t\t\t\"Please check your input.\"\n\t\t\t\t);\n\t\t\t\tform.validate({\n\t\t\t\t\tonfocusout: false,\n\t\t\t\t\tonkeyup: false,\n\t\t\t\t\tonclick: false,\n\t\t\t\t\tfocusInvalid: false,\n\t\t\t\t\tsubmitHandler: function() {\n\t\t\t\t\t\t_this.authorizationSubmitHandler(form);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\trules: {\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tminlength: 3,\n\t\t\t\t\t\t\tregexp: '^[-A-z\\s-]{3,}$'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tphone: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tminlength: 5,\n\t\t\t\t\t\t\tregexp: '^\\\\+[0-9\\\\+\\\\-()\\s]{14,16}$'\n\t\t\t\t\t\t},\n\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\temail: true\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmessages:{\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\trequired: \"   \",\n\t\t\t\t\t\t\tminlength: \"     3 \",\n\t\t\t\t\t\t\tregexp: \"   \"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tphone: {\n\t\t\t\t\t\t\trequired: \"   \",\n\t\t\t\t\t\t\tminlength: \"     5 \",\n\t\t\t\t\t\t\tregexp: \"   \"\n\t\t\t\t\t\t},\n\t\t\t\t\t\temail: \"  \"\n\t\t\t\t\t},\n\t\t\t\t\tshowErrors: function(errorMap, errorList) {\n\t\t\t\t\t\tif (errorList.length < 1) {\n\t\t\t\t\t\t\tform.removeClass('has-error');\n\t\t\t\t\t\t\tform.find('input').removeClass('error').parent().removeClass('has-error');\n\t\t\t\t\t\t\tform.find('i.fa').remove();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$.each(errorList, function(index, error) {\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').next('i.fa').remove();\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').addClass('error').parent().addClass('has-error');\n\t\t\t\t\t\t\tform.addClass('has-error');\n\t\t\t\t\t\t\tform.find('input[name=\"'+error.element.name+'\"]').after('<i class=\"fa fa-exclamation-triangle tooltip\" data-toggle=\"tooltip\" title=\"' + error.message + '\"></i>');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tauthorizationProcess: function(data,callback) {\n\t\t\t\tconsole.log('[AUTHORIZATION] Send form data to server:');\n\t\t\t\tconsole.log(data);\n\t\t\t\t// Ajax simulation\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar response = {\n\t\t\t\t\t\tmessage: '  ',\n\t\t\t\t\t\tstatus: false, // example phone error\n\t\t\t\t\t};\n\t\t\t\t\tif(typeof callback === \"function\")\n\t\t\t\t\t\tcallback(response);\n\t\t\t\t}, 1500);\n\t\t\t},\n\t\t\tauthorizationSubmitHandler: function(form) {\n\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t\t\t\tvar data = form.serializeArray();\n\t\t\t\tvar step = form.closest('.static');\n\t\t\t\tform.css('opacity', 0);\n\t\t\t\tajaxloader.local({\n\t\t\t\t\telement: form,\n\t\t\t\t\tto: '.static',\n\t\t\t\t\ttitle: lang.processAuthorization\n\t\t\t\t});\n\t\t\t\tthis.authorizationProcess(data, function(response) {\n\t\t\t\t\tif(response.status != true)\n\t\t\t\t\t{\n\n\t\t\t\t\t\tvar message = $('<div />').addClass('table form-status')\n\t\t\t\t\t\t\t.css('width', step.outerWidth())\n\t\t\t\t\t\t\t.css('height', step.outerHeight())\n\t\t\t\t\t\t\t.append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t\t\t\t\t\tstep.prepend(message);\n\n\t\t\t\t\t\tajaxloader.finish();\n\n\t\t\t\t\t\tform.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tmessage.css('background-color', 'transparent');\n\t\t\t\t\t\t\tmessage.find('span').addClass('inline');\n\t\t\t\t\t\t\tmessage.transition({\n\t\t\t\t\t\t\t\ty: -250,\n\t\t\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\t\t\tmessage.css('z-index', 0);\n\t\t\t\t\t\t\t\t\tform.fadeTo(200, 1);\n\t\t\t\t\t\t\t\t\t$('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 700)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.location = \"/\";\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t}\n\t};\n\n\n\tajaxloader = {\n\t\tlocal: function(params) {\n\t\t\tif(!params.element)\n\t\t\t\treturn;\n\n\t\t\tvar element = params.element;\n\n\n\t\t\tvar ajaxloader = $('<div />').addClass('ajax-loader-local')\n\t\t\t\t.css('width', element.outerWidth())\n\t\t\t\t.css('height', element.outerHeight());\n\n\t\t\tif(params.title && params.title.length > 0)\n\t\t\t{\n\t\t\t\tvar title = $('<div />').addClass('title').html(params.title);\n\t\t\t\tajaxloader.append(title);\n\t\t\t}\n\n\t\t\tif(params.image && params.image.length > 0)\n\t\t\t{\n\t\t\t\tvar image = $('<img />').addClass('image')\n\t\t\t\t\t.attr('src', params.image);\n\t\t\t\tajaxloader.append(image);\n\t\t\t} else {\n\t\t\t\tvar icon = $('<div />').addClass('icon')\n\t\t\t\t\t.attr('src', params.image);\n\t\t\t\tajaxloader.append(icon);\n\t\t\t}\n\n\t\t\tif(params.to && params.to != '') {\n\t\t\t\tvar to = element.closest(params.to);\n\t\t\t\tajaxloader.css('width', to.outerWidth())\n\t\t\t\t\t.css('height', to.outerHeight());\n\t\t\t\tto.prepend(ajaxloader);\n\t\t\t} else\n\t\t\t\telement.prepend(ajaxloader);\n\t\t\tajaxloader.fadeIn(200);\n\t\t\tthis.ajaxloader = ajaxloader;\n\t\t},\n\t\tfinish: function() {\n\t\t\tif(!this.ajaxloader)\n\t\t\t\treturn\n\t\t\tvar _this = this;\n\t\t\tthis.ajaxloader.fadeOut(200, function() {\n\t\t\t\t_this.ajaxloader.remove();\n\t\t\t});\n\n\t\t}\n\t};\n\n\tapp.profile = {\n\t    init: function() {\n\t        this.bind();\n\t    },\n\t    bind: function() {\n\t        $('#edit-personal-data').submit(function(e) {\n\t            console.log(e);\n\t            e.preventDefault();\n\t            app.profile.personal.save($(this));\n\t            return false;\n\t        });\n\t\n\t        $('#edit-personal-data input[type=\"text\"]').on('keydown', function(e) {\n\t            $('button[data-to-slide=\"personal\"]').removeAttr('disabled');\n\t            var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t            bottom.find('.button-group').removeClass('one-button').addClass('two-button');\n\t            bottom.find('button.btn-dismiss').removeClass('hide');\n\t        });\n\t\n\t        $(document).on('click', 'button[type=\"dismiss\"]', function(e) {\n\t            e.preventDefault();\n\t            var form = $('#edit-personal-data');\n\t            form[0].reset();\n\t            var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t            bottom.find('.button-group').removeClass('two-button').addClass('one-button');\n\t            bottom.find('button.btn-dismiss').addClass('hide');\n\t            var input = form.find('input[name=\"phone\"]');\n\t            input.attr('disabled', 'disabled');\n\t            input.parent().addClass('disabled');\n\t            input.parents('.form-group').find('button.edit-phone').hide();\n\t        });\n\t\n\t        $(document).on('click', 'button[type=\"delete-card\"]', function(e) {\n\t            e.preventDefault();\n\t            var cardId = $(this).parents('li[data-card-id]').data('card-id');\n\t            var cartName = $(this).parents('div.creditcard').find('.creditcard-name').html();\n\t            var str = String.template(lang.creditcardquestdelete, cartName);\n\t            if(cardId) {\n\t                app.modal.dialog({\n\t                    content: str,\n\t                    buttons: {\n\t                        yes: {\n\t                            title: lang.dialogDeleteButton,\n\t                            class: 'delete',\n\t                            action: function(){\n\t                                if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                                app.profile.creditcard.del(cardId);\n\t                            }\n\t                        },\n\t                        no: {\n\t                            title: lang.dialogDismissButton,\n\t                            class: 'dismiss',\n\t                            action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                        }\n\t                    }\n\t                });\n\t            } else {\n\t                console.error('Not found creditcard id');\n\t            }\n\t        });\n\t        $('button[type=\"add-card\"]').on('click', function(e) {\n\t            e.preventDefault();\n\t            var title = ($(this).data('title')?$(this).data('title'):'');\n\t            var content = ($(this).data('content')?$(this).data('content'):'');\n\t            app.modal.dialog({\n\t                title: title,\n\t                content: content,\n\t                type: 'form',\n\t                popupClass: 'add-card-popup',\n\t                afterRender: function(obj) {\n\t                    obj.find('#cardnumber').validateCreditCard(function(result) {\n\t                        $(this).removeClass();\n\t                        if (result.card_type == null)\n\t                            return;\n\t\n\t                        $(this).addClass(result.card_type.name);\n\t                        $(this).closest('form').find('input[name=\"cardtype\"]').val(result.card_type.name);\n\t\n\t                        if (result.valid) {\n\t                            return $(this).addClass('valid');\n\t                        } else {\n\t                            return $(this).removeClass('valid');\n\t                        }\n\t                    }, {\n\t                        accept: ['visa', 'visa_electron', 'mastercard', 'maestro']\n\t                    });\n\t                    obj.find('#cardholder').keypress(function(event){\n\t                        if(!((event.which >= 65 && event.which  <= 90) ||\n\t                            (event.which >= 97 && event.which <= 122) || event.which == 32)) {\n\t                            event.preventDefault();\n\t                        }\n\t                    });\n\t                },\n\t                buttons: {\n\t                    yes: {\n\t                        title: '',\n\t                        class: 'edit',\n\t                        beforeAction: function(form) { // jQuery object\n\t                            // validate\n\t                            var valid = true;\n\t                            var data = form.serializeArray();\n\t                            form.find('input').each(function() {\n\t                                if(!$(this).val()) {\n\t                                    valid = false;\n\t                                    console.log(' ' + $(this).attr('name') + '  ');\n\t                                }\n\t                            });\n\t\n\t                            return valid;\n\t                        },\n\t                        action: function(form){ // jQuery object\n\t                            if(settings.env == 'dev') console.log('[Dialog (add credit card)] Confirmed');\n\t                            app.profile.creditcard.add(form);\n\t                        }\n\t                    },\n\t                    no: {\n\t                        title: lang.dialogDismissButton,\n\t                        class: 'dismiss',\n\t                        action: function(){ if(settings.env == 'dev') console.log('[Dialog (add credit card)] Not confirmed');  }\n\t                    }\n\t                }\n\t            });\n\t        });\n\t\n\t        $(document).on('click', 'button[type=\"delete-address\"]', function(e) {\n\t            e.preventDefault();\n\t            var addressId = $(this).parents('li[data-address-id]').data('address-id');\n\t            var address = $(this).prev().html();\n\t            var str = String.template(lang.deliveryaddressrequestdelete, address);\n\t            if(addressId) {\n\t                app.modal.dialog({\n\t                    content: str,\n\t                    buttons: {\n\t                        yes: {\n\t                            title: lang.dialogDeleteButton,\n\t                            class: 'delete',\n\t                            action: function(){\n\t                                if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                                app.profile.delivery.del(addressId);\n\t                            }\n\t                        },\n\t                        no: {\n\t                            title: lang.dialogDismissButton,\n\t                            class: 'dismiss',\n\t                            action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                        }\n\t                    }\n\t                });\n\t            } else {\n\t                console.error('Not found delivery address id');\n\t            }\n\t        });\n\t\n\t        $('button[data-toggle=\"edit-phone\"]').on('click', function() {\n\t            app.modal.dialog({\n\t                content: lang.dialogChangePhoneAlert,\n\t                buttons: {\n\t                    yes: {\n\t                        title: lang.dialogEditButton,\n\t                        class: 'edit',\n\t                        action: function(){\n\t                            if(settings.env == 'dev') console.log('[Dialog] Confirmed');\n\t                            var input = $('#slider-content input[name=\"phone\"]');\n\t                            input.removeAttr('disabled');\n\t                            input.parent().removeClass('disabled');\n\t                            input.parents('.form-group').find('button.edit-phone').hide();\n\t\n\t                        }\n\t                    },\n\t                    no: {\n\t                        title: lang.dialogDismissButton,\n\t                        class: 'dismiss',\n\t                        action: function(){ if(settings.env == 'dev') console.log('[Dialog] Not confirmed'); }\n\t                    }\n\t                }\n\t            });\n\t        });\n\t\n\t        $('.creditcard .tooltip').tooltipster('option', 'position', 'left');\n\t        $('.creditcard .tooltip').tooltipster('option', 'arrow', true);\n\t\n\t    },\n\t    creditcard: {\n\t        obj: {},\n\t        add: function(form) {\n\t            try {\n\t                var _data = form.serializeObject();\n\t\n\t                var tmpId = 'card_' + guid();\n\t                var data = {\n\t                    cardname: _data.cardname,\n\t                    cardtype: _data.cardtype,\n\t                    cardnumber: _data.cardnumber.substr(-4)\n\t                };\n\t\n\t                var cardtemplate = tmpl(\n\t                    document.getElementById(\"tmpl-creditcard\").innerHTML,\n\t                    data\n\t                );\n\t\n\t                var li = $('<li />')\n\t                    .append(cardtemplate)\n\t                    .attr('data-card-id', tmpId).hide(); // After ajax change card-id attribute\n\t\n\t                var list = $('ul.creditcard-list');\n\t                if(list.find('li.notfound').length)\n\t                    list.find('li.notfound').remove();\n\t\n\t                li.find('.creditcard .tooltip').tooltipster({\n\t                    animation: 'grow',\n\t                    position: 'left'\n\t                });\n\t                list.append(li);\n\t\n\t                this.process.add(function(response) {\n\t                    $('#slider-content .owl-height').css('height', list.outerHeight() + li.height());\n\t                    $('ul.creditcard-list li[data-card-id=\"' + tmpId +'\"]').fadeIn(300, 'easeOutQuad', function() {\n\t                        $(this).data('card-id', response.newId).attr('data-card-id', newId);\n\t                    });\n\t                });\n\t\n\t            } catch (e) {\n\t                console.log('Creditcard add failed', e);\n\t            }\n\t        },\n\t        del: function(id) {\n\t            if(settings.env == 'dev')\n\t                console.log('Remove card with id #' + id);\n\t\n\t            this.process.del(function(response) {\n\t                var cnt = $('ul.creditcard-list li').length;\n\t                $('ul.creditcard-list li[data-card-id=\"' + id +'\"]').slideUp(300, 'easeOutQuad', function() {\n\t                    $(this).remove();\n\t                    if(cnt == 0) {\n\t                        $('<li />')\n\t                            .appendTo(\"ul.creditcard-list\")\n\t                            .html(lang.creditcardNotFound)\n\t                            .addClass('notfound')\n\t                            .fadeIn(200);\n\t                    }\n\t                    var list = $('ul.creditcard-list');\n\t                    $('#slider-content .owl-height').css('height', list.outerHeight());\n\t                });\n\t            });\n\t\n\t        },\n\t        process: {\n\t            del: function(callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function () {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function () {\n\t                        var response = [];\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t\n\t                }, 1000);\n\t\n\t            },\n\t            add: function(callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                        var response = {'newId': 4};\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t                }, 1000);\n\t            }\n\t        }\n\t    },\n\t    personal: {\n\t        save: function(form) {\n\t            if(settings.env == 'dev')\n\t                console.log('Save personal data');\n\t\n\t            var data = form.serializeArray();\n\t            this.process(data, function(response) {\n\t                console.log('Personal data saved');\n\t                $('button[data-to-slide=\"personal\"]').attr('disabled', 'disabled');\n\t                var bottom = $('#profile .content-panel > *[data-to-slide=\"personal\"]');\n\t                bottom.find('.button-group').removeClass('two-button').addClass('one-button');\n\t                bottom.find('button.btn-dismiss').addClass('hide');\n\t            });\n\t\n\t\n\t        },\n\t        process: function(data, callback) {\n\t            console.log(data);\n\t            $(\"#ajax-loader\").fadeIn(200);\n\t            // Ajax simulation\n\t            setTimeout(function() {\n\t                $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                    var response = [];\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                });\n\t\n\t\n\t\n\t            }, 1000);\n\t        }\n\t    },\n\t    delivery: {\n\t        del: function(addressId) {\n\t            this.process.del(addressId, function(response) {\n\t                var cnt = $('ul.creditcard-list li').length;\n\t                console.log('Address removed');\n\t                $('ul.delivery-list li[data-address-id=\"'+addressId+'\"]').remove();\n\t                if(cnt == 0) {\n\t                    $('<li />')\n\t                        .appendTo(\"ul.delivery-list\")\n\t                        .html(lang.deliveryaddressNotFound)\n\t                        .addClass('notfound')\n\t                        .fadeIn(200);\n\t                }\n\t                var list = $('ul.delivery-list');\n\t                $('#slider-content .owl-height').css('height', list.outerHeight());\n\t            });\n\t        },\n\t        process: {\n\t            del: function(addressId, callback) {\n\t                $(\"#ajax-loader\").fadeIn(200);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    $(\"#ajax-loader\").delay(500).fadeOut(300, function() {\n\t                        $('button[data-to-slide=\"personal\"]').attr('disabled', 'disabled');\n\t                        var response = [];\n\t                        if(typeof callback === \"function\")\n\t                            callback(response);\n\t                    });\n\t\n\t                }, 1000);\n\t            }\n\t        }\n\t    }\n\t};\n\t\n\tvar _checkout = {\n\t    init: function() {\n\t        var _this = this;\n\t        $('#checkout .content-panel .bottom button[type=\"submit\"]').on('click', function(e) {\n\t            var targetForm = $(this).data('to-form');\n\t\n\t            if(settings.env == 'dev')\n\t                console.log('Click bottom button with target form ' + targetForm);\n\t            if(!targetForm || $(targetForm).length == 0)\n\t                return;\n\t\n\t            var form = $(targetForm);\n\t            form.trigger('submit');\n\t            form.closest('.step1').find('.form-status').remove();\n\t            return false;\n\t        });\n\t\n\t        $('#checkout .content-panel .bottom button[type=\"dismiss\"]').on('click', function(e) {\n\t            _this.goToStep(8); // last step\n\t            return false;\n\t        });\n\t\n\t        $('#checkout-step button[data-toggle=\"gotostep\"]').on('click', function() {\n\t            var step = $(this).data('to-step');\n\t            _this.goToStep(step);\n\t        });\n\t\n\t        if(!app.checkout.loadLastStep())\n\t            app.checkout.goToStep(1);\n\t    },\n\t    step: {\n\t        1: {\n\t            loaded: false,\n\t            load: function() {\n\t                var form_step__1 = $('#checkout-auth');\n\t                this.validateForm(form_step__1);\n\t                form_step__1.find('input').on('keyup', function() {\n\t                    $(this).removeClass('error').parent().removeClass('has-error');\n\t                    $(this).next('i.fa').remove();\n\t                    form_step__1.closest('.step1').find('.form-status').remove();\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t\n\t            },\n\t            validateForm: function(form) {\n\t                var _this = this;\n\t                jQuery.validator.addMethod(\n\t                    'regexp',\n\t                    function(value, element, regexp) {\n\t                        var re = new RegExp(regexp);\n\t                        return this.optional(element) || re.test(value);\n\t                    },\n\t                    \"Please check your input.\"\n\t                );\n\t                form.validate({\n\t                    onfocusout: false,\n\t                    onkeyup: false,\n\t                    onclick: false,\n\t                    focusInvalid: false,\n\t                    submitHandler: function() {\n\t                        _this.registrationSubmitHandler(form);\n\t                        return false;\n\t                    },\n\t                    rules: {\n\t                        name: {\n\t                            required: true,\n\t                            minlength: 3,\n\t                            regexp: '^[-A-z\\s-]{3,}$'\n\t                        },\n\t                        phone: {\n\t                            required: true,\n\t                            minlength: 5,\n\t                            regexp: '^\\\\+[0-9\\\\+\\\\-()\\s]{14,16}$'\n\t                        },\n\t                        email: {\n\t                            required: true,\n\t                            email: true\n\t                        }\n\t                    },\n\t                    messages:{\n\t                        name: {\n\t                            required: \"   \",\n\t                            minlength: \"     3 \",\n\t                            regexp: \"   \"\n\t                        },\n\t                        phone: {\n\t                            required: \"   \",\n\t                            minlength: \"     5 \",\n\t                            regexp: \"   \"\n\t                        },\n\t                        email: \"  \"\n\t                    },\n\t                    showErrors: function(errorMap, errorList) {\n\t                        if (errorList.length < 1) {\n\t                            form.removeClass('has-error');\n\t                            form.find('input').removeClass('error').parent().removeClass('has-error');\n\t                            form.find('i.fa').remove();\n\t                            return;\n\t                        }\n\t                        $.each(errorList, function(index, error) {\n\t                            form.find('input[name=\"'+error.element.name+'\"]').next('i.fa').remove();\n\t                            form.find('input[name=\"'+error.element.name+'\"]').addClass('error').parent().addClass('has-error');\n\t                            form.addClass('has-error');\n\t                            form.find('input[name=\"'+error.element.name+'\"]').after('<i class=\"fa fa-exclamation-triangle tooltip\" data-toggle=\"tooltip\" title=\"' + error.message + '\"></i>');\n\t                        });\n\t                    }\n\t                });\n\t            },\n\t            registrationProcess: function(data,callback) {\n\t                console.log('[REGISTRATION] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        message: '  ',\n\t                        status: true, // example phone error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            registrationSubmitHandler: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t                var data = form.serializeArray();\n\t                var step = form.closest('.step1');\n\t                form.css('opacity', 0);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step1',\n\t                    title: lang.processPhoneCheck\n\t                });\n\t                this.registrationProcess(data, function(response) {\n\t                    if(response.status != true)\n\t                    {\n\t\n\t                        var message = $('<div />').addClass('table form-status')\n\t                            .css('width', step.outerWidth())\n\t                            .css('height', step.outerHeight())\n\t                            .append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t                        step.prepend(message);\n\t\n\t                        ajaxloader.finish();\n\t\n\t                        form.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\t\n\t                        setTimeout(function() {\n\t                            message.css('background-color', 'transparent');\n\t                            message.find('span').addClass('inline');\n\t                            message.transition({\n\t                                y: -250,\n\t                                complete: function() {\n\t                                    message.css('z-index', 0);\n\t                                    form.fadeTo(200, 1);\n\t                                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t                                }\n\t                            });\n\t                        }, 700)\n\t                    }\n\t                    else\n\t                    {\n\t\n\t                        app.checkout.goToStep(2);\n\t                    }\n\t                });\n\t            },\n\t        },\n\t        2: {\n\t            loaded: false,\n\t            load: function() {\n\t                var form_step__2 = $('#checkout-auth-confirm-phone');\n\t                var _this = this;\n\t\n\t                form_step__2.find('input').on('keyup', function() {\n\t                    form_step__2.closest('.step2').find('.form-status').remove();\n\t                    $('button[data-to-form=\"#' + form_step__2.attr('id') + '\"]').removeAttr('disabled').removeClass('btn-bordered').addClass('btn-primary');\n\t                });\n\t\n\t                form_step__2.on('submit', function() {\n\t                    _this.confirmSubmitHander($(this));\n\t                    return false;\n\t                });\n\t\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t                countDown({\n\t                    time: settings.timeoutResendConfirmPhoneCode, // in seconds\n\t                    display:  $('#timein span'),\n\t                    showMinutes: true,\n\t                    afterFinish: function() {\n\t                        $('#timein').fadeOut(200, function() {\n\t                            $('#timeout').fadeIn(200);\n\t                        })\n\t                    }\n\t                });\n\t\n\t            },\n\t            confirmProcess: function(data, callback) {\n\t                console.log('[CONFIRM] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        message: ' ',\n\t                        status: true, // example code error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            confirmSubmitHander: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').hide();\n\t                var data = form.serializeArray();\n\t                var step = form.closest('.step2');\n\t                form.css('opacity', 0);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step2',\n\t                    title: lang.processConfirmCheck\n\t                });\n\t                this.confirmProcess(data, function(response) {\n\t                    if(response.status != true)\n\t                    {\n\t\n\t                        var message = $('<div />').addClass('table form-status')\n\t                            .css('width', step.outerWidth())\n\t                            .css('height', step.outerHeight())\n\t                            .append('<div class=\"cell middle\"><span class=\"error\">' + response.message + '</span></div>');\n\t                        step.prepend(message);\n\t\n\t                        ajaxloader.finish();\n\t\n\t                        form.find('input[name=\"phone\"]').parent().addClass('has-error'); // Example\n\t\n\t                        setTimeout(function() {\n\t                            message.css('background-color', 'transparent');\n\t                            message.find('span').addClass('inline');\n\t                            message.transition({\n\t                                y: -150,\n\t                                complete: function() {\n\t                                    message.css('z-index', 0);\n\t                                    form.fadeTo(200, 1);\n\t                                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').fadeIn(200);\n\t                                }\n\t                            });\n\t                        }, 700)\n\t                    }\n\t                    else\n\t                    {\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                });\n\t            }\n\t        },\n\t        3: {\n\t            loaded: false,\n\t            map: null,\n\t            map_created: false,\n\t            load: function() {\n\t                $('#map').height($('#checkout .content-panel').height());\n\t                ymaps.ready(this.loadMap);\n\t                this.loadKladr();\n\t\n\t                var _this = this;\n\t\n\t                $('#delivery-address-form').on('submit', function() {\n\t                    _this.deliverySubmitHandler($(this));\n\t                    return false;\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t\n\t            },\n\t            deliveryProcess: function(data, callback) {\n\t                console.log('[DELIVERY ADDRESS] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        status: true, // example code error\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 500);\n\t            },\n\t            deliverySubmitHandler: function(form) {\n\t                var data = form.serializeArray();\n\t                var dataObj = form.serializeObject();\n\t                var step = form.closest('.step3');\n\t                this.deliveryProcess(data, function(response) {\n\t                    if (response.status != true) {\n\t                        console.log('Change address error');\n\t                    } else {\n\t                        app.checkout.delivery.address = dataObj;\n\t                        $(document).trigger('raketa.checkout.update');\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                })\n\t            },\n\t            loadMap: function() {\n\t                    if (this.map_created) return;\n\t                    this.map_created = true;\n\t\n\t                    this.map = new ymaps.Map('map', {\n\t                            center: [59.9382558321876,30.308662213671802],\n\t                            zoom: 12,\n\t                            controls: []\n\t                        }),\n\t                        ZoomLayout = ymaps.templateLayoutFactory.createClass(\"<div>\" +\n\t                            \"<div id='zoom-in' class='map-btn zoom-in'></div>\" +\n\t                            \"<div id='zoom-out' class='map-btn zoom-out'></div>\" +\n\t                            \"</div>\", {\n\t\n\t                            build: function () {\n\t                                ZoomLayout.superclass.build.call(this);\n\t                                this.zoomInCallback = ymaps.util.bind(this.zoomIn, this);\n\t                                this.zoomOutCallback = ymaps.util.bind(this.zoomOut, this);\n\t                                $('#zoom-in').bind('click', this.zoomInCallback);\n\t                                $('#zoom-out').bind('click', this.zoomOutCallback);\n\t                            },\n\t                            clear: function () {\n\t                                $('#zoom-in').unbind('click', this.zoomInCallback);\n\t                                $('#zoom-out').unbind('click', this.zoomOutCallback);\n\t                                ZoomLayout.superclass.clear.call(this);\n\t                            },\n\t                            zoomIn: function () {\n\t                                var map = this.getData().control.getMap();\n\t                                this.events.fire('zoomchange', {\n\t                                    oldZoom: map.getZoom(),\n\t                                    newZoom: map.getZoom() + 1\n\t                                });\n\t                            },\n\t                            zoomOut: function () {\n\t                                var map = this.getData().control.getMap();\n\t                                this.events.fire('zoomchange', {\n\t                                    oldZoom: map.getZoom(),\n\t                                    newZoom: map.getZoom() - 1\n\t                                });\n\t                            }\n\t                        }),\n\t                        zoomControl = new ymaps.control.ZoomControl({ options: { layout: ZoomLayout } });\n\t\n\t                    map.controls.add(zoomControl, {\n\t                        position: {\n\t                            left: 10,\n\t                            bottom: 180\n\t                        }\n\t                    });\n\t\n\t                    var geoLayout = ymaps.templateLayoutFactory.createClass(\"<div>\" +\n\t                        \"<div id='geolocation' class='map-btn geo'></div>\" +\n\t                        \"</div>\", {\n\t\n\t                        build: function () {\n\t                            geoLayout.superclass.build.call(this);\n\t                            this.geolocation = ymaps.util.bind(this.geolocation, this);\n\t                            this.zoomOutCallback = ymaps.util.bind(this.zoomOut, this);\n\t                            $('#geolocation').bind('click', this.geolocation);\n\t                            $('#zoom-out').bind('click', this.zoomOutCallback);\n\t                        },\n\t                        clear: function () {\n\t                            $('#zoom-in').unbind('click', this.zoomInCallback);\n\t                            $('#zoom-out').unbind('click', this.zoomOutCallback);\n\t                            geoLayout.superclass.clear.call(this);\n\t                        },\n\t                        geolocation: function () {\n\t                            var map = this.getData().control.getMap();\n\t                            this.events.fire('zoomchange', {\n\t                                oldZoom: map.getZoom(),\n\t                                newZoom: map.getZoom() + 1\n\t                            });\n\t                        }\n\t                    });\n\t\n\t                    var geolocationControl = new ymaps.control.GeolocationControl({\n\t                        options: {\n\t                            //layout: geoLayout\n\t                            //noPlacemark: true\n\t                        }\n\t                    });\n\t\n\t                    map.controls.add(geolocationControl, {\n\t                        position: {\n\t                            left: 10,\n\t                            bottom: 144\n\t                        }\n\t                    });\n\t            },\n\t            loadKladr: function() {\n\t                var $kladr_form = $('#delivery-address-form');\n\t\n\t                $kladr_form.find('input').on('keyup', function() {\n\t                    if($(this).val())\n\t                        $('button[data-to-form=\"#' + $kladr_form.attr('id') + '\"]').removeAttr('disabled').removeClass('white');\n\t                    else\n\t                        $('button[data-to-form=\"#' + $kladr_form.attr('id') + '\"]').attr('disabled','disabled').addClass('white');\n\t                });\n\t\n\t                var $region = $kladr_form.find('[name=\"region\"]'),\n\t                    $district = $kladr_form.find('[name=\"district\"]'),\n\t                    $city = $kladr_form.find('[name=\"city\"]'),\n\t                    $street = $kladr_form.find('[name=\"street\"]'),\n\t                    $building = $kladr_form.find('[name=\"building\"]');\n\t\n\t                $()\n\t                    .add($region)\n\t                    .add($district)\n\t                    .add($city)\n\t                    .add($street)\n\t                    .add($building)\n\t                    .kladr({\n\t                        parentInput: '.kladr-form',\n\t                        verify: true,\n\t                        spinner: false,\n\t                        labelFormat: function (obj, query) {\n\t                            var label = '';\n\t\n\t                            var name = obj.name.toLowerCase();\n\t                            query = query.name.toLowerCase();\n\t\n\t                            var start = name.indexOf(query);\n\t                            start = start > 0 ? start : 0;\n\t\n\t                            if (obj.typeShort) {\n\t                                label += obj.typeShort + '. ';\n\t                            }\n\t\n\t                            if (query.length < obj.name.length) {\n\t                                label += obj.name.substr(0, start);\n\t                                label += '<strong>' + obj.name.substr(start, query.length) + '</strong>';\n\t                                label += obj.name.substr(start + query.length, obj.name.length - query.length - start);\n\t                            } else {\n\t                                label += '<strong>' + obj.name + '</strong>';\n\t                            }\n\t\n\t                            if (obj.parents) {\n\t                                for (var k = obj.parents.length - 1; k > -1; k--) {\n\t                                    var parent = obj.parents[k];\n\t                                    if (parent.name) {\n\t                                        if (label) label += '<small>, </small>';\n\t                                        label += '<small>' + parent.name + ' ' + parent.typeShort + '.</small>';\n\t                                    }\n\t                                }\n\t                            }\n\t\n\t                            return label;\n\t                        },\n\t                        change: function (obj) {\n\t                            if (obj) {\n\t\n\t                                setLabel($(this), obj.type);\n\t                            }\n\t                            addressUpdate();\n\t                            mapUpdate();\n\t                        },\n\t                        openBefore: function () {\n\t                            //     ,   kladr\n\t                            //return false;\n\t                        },\n\t                        checkBefore: function () {\n\t                            var $input = $(this);\n\t\n\t                            if (!$.trim($input.val())) {\n\t\n\t                                addressUpdate();\n\t                                mapUpdate();\n\t                                return false;\n\t                            }\n\t                        }\n\t                    });\n\t\n\t                $street.kladr({\n\t                    labelFormat: function (obj, query) {\n\t                        var label = '';\n\t\n\t                        var name = obj.name.toLowerCase();\n\t                        query = query.name.toLowerCase();\n\t\n\t                        var start = name.indexOf(query);\n\t                        start = start > 0 ? start : 0;\n\t\n\t                        if (obj.typeShort) {\n\t                            label += obj.typeShort + '. ';\n\t                        }\n\t\n\t                        if (query.length < obj.name.length) {\n\t                            label += obj.name.substr(0, start);\n\t                            label += '<strong>' + obj.name.substr(start, query.length) + '</strong>';\n\t                            label += obj.name.substr(start + query.length, obj.name.length - query.length - start);\n\t                        } else {\n\t                            label += '<strong>' + obj.name + '</strong>';\n\t                        }\n\t\n\t                        if (obj.parents) {\n\t                            for (var k = obj.parents.length - 1; k > -1; k--) {\n\t                                var parent = obj.parents[k];\n\t                                if (parent.name && parent.contentType == 'city') {\n\t                                    if (label) label += '<small>, </small>';\n\t                                    label += '<small>' + parent.typeShort + '. ' + parent.name + '</small>';\n\t                                }\n\t                            }\n\t                        }\n\t\n\t                        return label;\n\t                    }\n\t                });\n\t                $region.kladr('type', $.kladr.type.region);\n\t                $district.kladr('type', $.kladr.type.district);\n\t                $city.kladr('type', $.kladr.type.city);\n\t                $street.kladr('type', $.kladr.type.street);\n\t                $building.kladr('type', $.kladr.type.building);\n\t\n\t                $.kladr.setValues({\n\t                    region: 7800000000000,\n\t                    city: 7800000000000\n\t                }, '.kladr-form');\n\t\n\t                //       \n\t                $city.kladr('withParents', true);\n\t                $street.kladr('withParents', true);\n\t\n\t                //      \n\t                $building.kladr('verify', false);\n\t\n\t                function setLabel($input, text) {\n\t                    text = text.charAt(0).toUpperCase() + text.substr(1).toLowerCase();\n\t                    $input.parent().find('label').text(text);\n\t                }\n\t\n\t                function mapUpdate() {\n\t                    var zoom = 4;\n\t                    var address = $.kladr.getAddress($kladr_form, function (objs) {\n\t                        var result = '';\n\t                        $.each(objs, function (i, obj) {\n\t                            var name = '',\n\t                                type = '';\n\t\n\t                            if ($.type(obj) === 'object') {\n\t                                name = obj.name;\n\t                                type = obj.type + ' ';\n\t\n\t                                switch (obj.contentType) {\n\t                                    case $.kladr.type.region:\n\t                                        zoom = 4;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.district:\n\t                                        zoom = 7;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.city:\n\t                                        zoom = 10;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.street:\n\t                                        zoom = 13;\n\t                                        break;\n\t\n\t                                    case $.kladr.type.building:\n\t                                        zoom = 16;\n\t                                        break;\n\t                                }\n\t                            }\n\t                            else {\n\t                                name = obj;\n\t                            }\n\t\n\t                            if (result) result += ', ';\n\t                            result += type + name;\n\t                        });\n\t\n\t                        return result;\n\t                    });\n\t\n\t                    if (address && this.map_created) {\n\t                        var geocode = ymaps.geocode(address);\n\t                        geocode.then(function (res) {\n\t                            this.map.geoObjects.each(function (geoObject) {\n\t                                map.geoObjects.remove(geoObject);\n\t                            });\n\t\n\t                            var position = res.geoObjects.get(0).geometry.getCoordinates(),\n\t                                placemark = new ymaps.Placemark(position, {}, {});\n\t\n\t                            this.map.geoObjects.add(placemark);\n\t                            this.map.setCenter(position, zoom);\n\t                        });\n\t                    }\n\t                }\n\t\n\t                function addressUpdate() {\n\t                    var address = $.kladr.getAddress($kladr_form);\n\t                    $kladr_form.find('input[name=\"fulladdress\"]').val(address);\n\t                }\n\t            },\n\t\n\t        },\n\t        4: {\n\t            loaded: false,\n\t            load: function(){\n\t                var form = $('#who-delivery-product');\n\t                var userlist = this.getUserList();\n\t\n\t                form.find('select[name=\"who\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                    plugins: {\n\t                        dropdown_footer: {\n\t                            title: '       -  '\n\t                        }\n\t                    },\n\t                });\n\t                form.find('select[name=\"reason\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                    plugins: {\n\t                        dropdown_footer: {\n\t                            title: '       <a href=\"reasons.html\"></a>'\n\t                        }\n\t                    }\n\t                });\n\t                userlist.done(function(response){\n\t                    console.log('Get user list');\n\t                    console.log(response);\n\t                    form.find('select[name=\"fromme_to_name\"]').selectize({\n\t                        allowEmptyOption: false,\n\t                        valueField: 'id',\n\t                        labelField: 'name',\n\t                        searchField: ['name', 'phone'],\n\t                        options: response,\n\t                        addPrecedence: '',\n\t                        render: {\n\t                            item: function(item, escape) {\n\t                                return '<div>' +\n\t                                    (item.name ? '<span class=\"name\">' + escape(item.name) + '</span>' : '')\n\t                                    '</div>';\n\t                            },\n\t                            option: function(item, escape) {\n\t                                var label = item.name || item.phone;\n\t                                var caption = item.name ? item.phone : null;\n\t                                return '<div>' +\n\t                                    '<span class=\"label\">' + escape(label) + '</span>' +\n\t                                    (caption ? ' <span class=\"caption\">' + escape(caption) + '</span>' : '') +\n\t                                    '</div>';\n\t                            }\n\t                        },\n\t                        onChange: function(value) {\n\t                            var dp = this.$dropdown_content.find('[data-value=\"' + value +'\"]');\n\t                            var caption = dp.find('.caption').text();\n\t                            form.find('input[type=\"tel\"]').val(caption);\n\t                        },\n\t                        plugins: {\n\t                            'dropdown_footer': {\n\t                                title: '        ,    '\n\t                            }\n\t                        },\n\t                        create: true,\n\t                    });\n\t                });\n\t\n\t                form.find('select[name=\"who\"]').on('change', function(e) {\n\t                    if($(this).val() == 'fromme')\n\t                    {\n\t                        form.find('.fromme .raketa-select').css('width', form.width());\n\t                        form.find('.fromme').removeClass('hide').hide().slideDown(150);\n\t                    } else {\n\t                        form.find('.fromme').slideUp(200).addClass('hide');\n\t                    }\n\t                });\n\t                form.find('select').on('change', function() {\n\t                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').removeClass('btn-bordered').addClass('btn-primary').removeAttr('disabled');\n\t                });\n\t                var _this = this;\n\t                form.on('submit', function() {\n\t                    var formObject = $(this).serializeObject();\n\t                    var dataObject = {};\n\t                    $.each(formObject, function(index, value) {\n\t                        if(index != 'csrf') {\n\t                            dataObject[index] = {\n\t                                index: index,\n\t                                value: value,\n\t                                textValue: form.find('[name=\"' + index + '\"] option[value=\"' + value +'\"]').text()\n\t                            }\n\t                        }\n\t                    });\n\t                    app.checkout.for = dataObject;\n\t                    _this.submitHandler($(this));\n\t                    return false;\n\t                });\n\t                this.loaded = true;\n\t            },\n\t\n\t            init: function() {\n\t                $('#checkout-step').parent().removeClass('middle');\n\t\n\t            },\n\t            close: function() {\n\t                $('#checkout-step').parent().addClass('middle');\n\t            },\n\t            getUserList: function() {\n\t                return $.Deferred(function () {\n\t                    var self = this;\n\t                    //Ajax simulation\n\t                    var userlist = [];\n\t                    setTimeout(function () {\n\t                        userlist = [\n\t                            {id: 1, name: '', phone: '+7(956)000-0011'},\n\t                            {id: 2, name: '', phone: '+7(956)111-0022'},\n\t                            {id: 3, name: '', phone: '+7(956)222-0033'}\n\t                        ];\n\t                        self.resolve(userlist);\n\t                    }, 2000);\n\t                });\n\t            },\n\t            submitProcess: function(data, callback) {\n\t                console.log('[FOR DELIVERY] Send form data to server:');\n\t                console.log(data);\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    var response = {\n\t                        status: true\n\t                    };\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 2000);\n\t            },\n\t            submitHandler: function(form) {\n\t                $('button[data-to-form=\"#' + form.attr('id') + '\"]').closest('.bottom').removeClass('show');\n\t                var data = form.serializeArray();\n\t                var step = app.checkout.getCurrentStep();\n\t                step.closest('.content-panel').addClass('middle');\n\t                form.hide();\n\t                console.log(step);\n\t                ajaxloader.local({\n\t                    element: form,\n\t                    to: '.step4',\n\t                    title: lang.processSave\n\t                });\n\t                this.submitProcess(data, function(response) {\n\t                    ajaxloader.finish();\n\t                    form.show();\n\t                    step.closest('.content-panel').removeClass('middle');\n\t                    $('button[data-to-form=\"#' + form.attr('id') + '\"]').closest('.bottom').addClass('show');\n\t                    if(response.status == true)\n\t                    {\n\t                        $(document).trigger('raketa.checkout.update');\n\t                        app.checkout.goToStep(8);\n\t                    }\n\t                });\n\t            },\n\t        },\n\t        5: {\n\t            loaded: false,\n\t            init: function() {\n\t\n\t            }\n\t        },\n\t        6: {\n\t            loaded: false,\n\t            init: function() {\n\t\n\t            }\n\t        },\n\t        7: {\n\t            loaded: false,\n\t            init: function() {\n\t\n\t            }\n\t        },\n\t        8: {\n\t            loaded: false,\n\t            load: function() {\n\t                var _this = this;\n\t                $(document).on('raketa.checkout.update', function() {\n\t                    _this.updateHtml();\n\t                });\n\t\n\t                $('button[type=\"checkout\"]').on('click', function() {\n\t                    ajaxloader.local({\n\t                        element: $('#result'),\n\t                        to: '.step8',\n\t                        title: lang.loading\n\t                    });\n\t                    $(this).hide();\n\t                    app.checkout.save(function(response) {\n\t                        ajaxloader.finish();\n\t                        if(response.status == true)\n\t                        {\n\t                            window.location = response.paymentUrl;\n\t                        }\n\t                        $(this).show();\n\t                    });\n\t                    return false;\n\t                });\n\t\n\t                this.loaded = true;\n\t            },\n\t            init: function() {\n\t                if(\n\t                    app.checkout.basket.length &&\n\t                    app.checkout.delivery.address &&\n\t                    app.checkout.delivery.timeofday &&\n\t                    app.checkout.delivery.date &&\n\t                    app.checkout.for\n\t                )\n\t                {\n\t                    $('button[type=\"checkout\"]').removeAttr('disabled');\n\t                } else {\n\t                    $('button[type=\"checkout\"]').attr('disabled', 'disabled');\n\t                }\n\t\n\t\n\t                this.updateHtml();\n\t            },\n\t            updateHtml: function() {\n\t                var result = $('#result');\n\t\n\t                if(app.checkout.for)\n\t                {\n\t                    var recipient = app.checkout.for;\n\t                    if(recipient.who.value != \"me\") {\n\t                        var text = recipient.fromme_to_name.textValue;\n\t                        var phone = recipient.fromme_to_phone.value;\n\t                        var reason = recipient.reason.textValue;\n\t                        result.find('li.who span').html(text + '<br><b>'+phone+',</b>' + ' <i>' + reason + '</i>');\n\t                    } else {\n\t                        result.find('li.who span').html(app.checkout.for.who.textValue);\n\t                    }\n\t                    console.log(app.checkout.for);\n\t\n\t                }\n\t\n\t\n\t                if(app.checkout.delivery.address)\n\t                {\n\t                    var fulladdress = app.checkout.delivery.address.fulladdress;\n\t                    var address = fulladdress.split(',');\n\t                    console.log(app.checkout.delivery.address);\n\t                    var strAddress = [\n\t                        address[2],\n\t                        (address[3]?address[3]:app.checkout.delivery.address.building),\n\t                        (app.checkout.delivery.address.apartment?' ' + app.checkout.delivery.address.apartment:'')\n\t                    ];\n\t                    result.find('li.address span').html(strAddress.join(', ')).parent().removeClass('empty');\n\t                }\n\t                else\n\t                {\n\t                    result.find('li.address span').html('').parent().addClass('empty');\n\t                }\n\t\n\t\n\t                if(app.checkout.delivery.date &&\n\t                    app.checkout.delivery.timeofday)\n\t                {\n\t                    var date = app.checkout.delivery.date;\n\t                    date = moment(date, 'DD.MM.YYYY').format('D MMMM');\n\t                    var timeofday = lang[app.checkout.delivery.timeofday];\n\t                    result.find('li.delivery-date span').html(timeofday + ' '+date);\n\t                }\n\t            }\n\t        }\n\t    },\n\t    loadLastStep: function() {\n\t        var step = Cookies.get('reketa_checkout__step');\n\t        if(step)\n\t        {\n\t            this.goToStep(step);\n\t            return true\n\t        } else\n\t            return false\n\t    },\n\t    getCurrentStep: function() {\n\t        return this.currentStep;\n\t    },\n\t    goToStep: function(step) {\n\t        Cookies.set('reketa_checkout__step', step, { expires: 365, path: '/' });\n\t        var checkout = $('#checkout-step');\n\t        var currentStep = checkout.find('.step.active');\n\t        if(currentStep.length)\n\t            this.currentStep = currentStep;\n\t        else\n\t            this.currentStep = $('#checkout-step .step[data-step=\"'+ step +'\"]');\n\t\n\t        var stepItem = (currentStep.data('step') ? currentStep.data('step') : step);\n\t        currentStep.trigger('close');\n\t        if(this.step[stepItem] && this.step[stepItem].close)\n\t            this.step[stepItem].close();\n\t        currentStep.removeClass('active');\n\t\n\t        if(settings.env == 'dev')\n\t            console.log('[STEP] Go to checkout step #' + step);\n\t\n\t        checkout.find('.step.step' + step).addClass('active').trigger('open');\n\t        checkout.parent().find('.bottom[data-to-step]').removeClass('show');\n\t        checkout.parent().find('.bottom[data-to-step=\"step' + step + '\"]').addClass('show');\n\t\n\t        if(this.step[step]\n\t            && !this.step[step].loaded\n\t            && (typeof this.step[step].load === \"function\")\n\t        )\n\t            this.step[step].load()\n\t\n\t        if(this.step[step]\n\t            && this.step[step].loaded\n\t            && (typeof this.step[step].init === \"function\")\n\t        )\n\t            this.step[step].init()\n\t    },\n\t};\n\t\n\t$.extend( app.checkout, _checkout );\n\t// full trash // It's last spagetty code! because of the small amount of time for the project\n\tvar _reasons = {\n\t    init: function() {\n\t        var _this = this;\n\t        this.defaultStep = 'congratulate';\n\t\n\t        $('#reasons .content-panel .bottom button[type=\"submit\"]').on('click', function(e) {\n\t            var targetForm = $(this).data('to-form');\n\t\n\t            if(settings.env == 'dev')\n\t                console.log('Click bottom button with target form ' + targetForm);\n\t            if(!targetForm || $(targetForm).length == 0)\n\t                return;\n\t\n\t            var form = $(targetForm);\n\t            form.trigger('submit');\n\t            return false;\n\t        });\n\t\n\t        $('#reasons-step form').on('submit', function(e) {\n\t            var data = $(this).serializeObject();\n\t        });\n\t\n\t        $('#reasons .content-panel .bottom button[type=\"edit\"]').on('click', function(e) {\n\t            _this.goToStep('editreason', e);\n\t            return false;\n\t        })\n\t\n\t        $('#reasons .content-panel .bottom button[type=\"dismiss\"]').on('click', function(e) {\n\t            _this.goToStep(_this.defaultStep);\n\t            $('#reasons-step form.edit-reason-form')[0].reset();\n\t            return false;\n\t        });\n\t\n\t        $('#reasons button[data-toggle=\"gotostep\"]').on('click', function(e) {\n\t            var step = $(this).data('to-step');\n\t            if(_this.currentStep.data('step') == 'onboard') {\n\t                Cookies.set('reketa_reasons__board', true, { expire: 365, path: '/' });\n\t                _this.currentStep.find('img').removeClass('zoomIn').addClass('zoomOutDown');\n\t                _this.currentStep.find('img').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function() {\n\t                    _this.goToStep(step);\n\t                });\n\t            } else {\n\t                _this.goToStep(step, e);\n\t            }\n\t\n\t        });\n\t\n\t\n\t        var hash = Hash.get();\n\t        var board = Cookies.get('reketa_reasons__board');\n\t        if(board) {\n\t            if (hash.anchor) {\n\t                window.location.hash = hash.anchor;\n\t                this.goToStep(hash.anchor);\n\t            } else {\n\t                this.goToStep(this.defaultStep);\n\t            }\n\t        } else {\n\t            this.goToStep('onboard');\n\t        }\n\t    },\n\t\n\t    goToStep: function(step, e) {\n\t\n\t        var reasons = $('#reasons-step');\n\t        var $currentStep = this.currentStep = reasons.find('.step[data-step=\"'+ step +'\"]');\n\t        var openedStep = reasons.find('.step.active');\n\t\n\t        if(step != 'congratulate' && $currentStep.data('step') == openedStep.data('step'))\n\t            return;\n\t\n\t        if(step != 'onboard')\n\t            Hash.add('step', step);\n\t\n\t        if(settings.env == 'dev')\n\t            console.log('[STEP] Go to reasons step #' + step);\n\t\n\t        reasons.parent().find('.bottom[data-to-step]').removeClass('show');\n\t\n\t        openedStep.removeClass('active');\n\t        openedStep.trigger('step-close');\n\t\n\t        this.currentStep.addClass('active').trigger('step-open');\n\t        reasons.parent().find('.bottom[data-to-step=\"' + step + '\"]').addClass('show');\n\t\n\t        if(this.step[step]\n\t            && !this.step[step].loaded\n\t            && (typeof this.step[step].load === \"function\")\n\t        )\n\t            this.step[step].load(e);\n\t\n\t        if(this.step[step]\n\t            && this.step[step].loaded\n\t            && (typeof this.step[step].init === \"function\")\n\t        )\n\t            this.step[step].init(e);\n\t    },\n\t    getCurrentStep: function() {\n\t        return this.currentStep;\n\t    },\n\t    step: {\n\t        newreason: {\n\t            load: function() {\n\t                var form = $('#reasons-step form');\n\t                form.find('input.datetimepicker').each(function() {\n\t                    var _this = $(this);\n\t                   $(this).datetimepicker({\n\t                       timepicker:false,\n\t                       todayButton: false,\n\t                       yearStart: '2016',\n\t                       yearEnd: '2035',\n\t                       dayOfWeekStart: 1,\n\t                       scrollMonth: false,\n\t                       prevButton: false,\n\t                       nextButton: false,\n\t                       className: 'reason-datepicker',\n\t                       parentID: _this.parent(),\n\t                       minDate:new Date(),\n\t                       format:'d.m.Y'\n\t                   });\n\t                });\n\t\n\t\n\t                var date = new Date();\n\t                var stringTitle = ' :   ' + moment(date).format('DD.MM.YYYY') + '<br>' +\n\t                        '  -   ' + moment(date).format('dddd').toLowerCase() + '<br>' +\n\t                        '  -   ' + moment(date).format('DD') + ' <br>' +\n\t                        '  -   ' + moment(date).format('MMMM Do');\n\t\n\t                form.find('select[name=\"repeat\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                    plugins: {\n\t                        'dropdown_footer': {\n\t                            title: stringTitle\n\t                        }\n\t                    },\n\t                });\n\t\n\t                form.find('select[name=\"who\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: false,\n\t                });\n\t\n\t                form.find('select[name=\"reason\"]').selectize({\n\t                    allowEmptyOption: false,\n\t                    create: true,\n\t                    plugins: {\n\t                        'restore_on_backspace' : {},\n\t                        'dropdown_footer': {\n\t                            title: '        ( Backspace)       '\n\t                        }\n\t                    }\n\t                });\n\t\n\t                form.find('input').on('keyup', function() {\n\t                    var buttons = $('#reasons .content-panel .bottom[data-to-step*=\"reason\"]');\n\t                    buttons.find('button').removeAttr('disabled');\n\t                    buttons.find('button[type=\"submit\"]').removeClass('btn-bordered').addClass('btn-primary');\n\t                });\n\t\n\t                form.find('select').on('change', function() {\n\t                    var buttons = $('#reasons .content-panel .bottom[data-to-step*=\"reason\"]');\n\t                    buttons.find('button').removeAttr('disabled');\n\t                    buttons.find('button[type=\"submit\"]').removeClass('btn-bordered').addClass('btn-primary');\n\t                });\n\t\n\t                this.loaded = true;\n\t            },\n\t        },\n\t        congratulate: {\n\t            load: function() {\n\t                $('#reasons-step div[data-step=\"congratulate\"]').on('step-close', function() {\n\t                    $('#reasons-step').parent().removeClass('middle');\n\t                });\n\t                this.loaded = true;\n\t            },\n\t            init: function(e) {\n\t                $('#reasons-step').parent().addClass('middle');\n\t                if(e && $(e.currentTarget)) {\n\t                    var id = $(e.currentTarget).closest('li').data('id');\n\t                    var buttons = $('#reasons-step').parent().find('.bottom[data-to-step=\"congratulate\"]');\n\t                    buttons.find('button[type=\"edit\"]').data('id', id).attr('data-id', id); // its fucking shit...save id to data attr for further editing\n\t                    buttons.removeClass('show');\n\t                    ajaxloader.local({\n\t                        element: $('#reasons-step div[data-step=\"congratulate\"]')\n\t                    });\n\t                    var data = this.getData(id, function(response) {\n\t                        ajaxloader.finish();\n\t                        buttons.addClass('show');\n\t                        var template = tmpl(\n\t                            document.getElementById(\"tmpl-congratulations-to\").innerHTML,\n\t                            response\n\t                        );\n\t                        $('#reasons-step div[data-step=\"congratulate\"]').html(template);\n\t\n\t                    })\n\t                }\n\t            },\n\t            getData: function(id, callback) {\n\t                // Ajax simulation\n\t                setTimeout(function() {\n\t                    if(id == 1) {\n\t                        var response = {\n\t                            photo: 'img/reason-1b.png',\n\t                            name: ' ',\n\t                            reason: ' ',\n\t                            repeat: '  ',\n\t                        };\n\t                    } else {\n\t                        var response = {\n\t                            name: '  ',\n\t                            reason: '',\n\t                            repeat: '  ',\n\t                        };\n\t                    }\n\t\n\t                    if(typeof callback === \"function\")\n\t                        callback(response);\n\t                }, 1000);\n\t            }\n\t        },\n\t        editreason: {\n\t            load: function() {\n\t                if(!app.reasons.step.newreason.loaded)\n\t                    app.reasons.step.newreason.load();\n\t\n\t\n\t                this.loaded = true;\n\t            },\n\t            init: function(e) {\n\t                var form = $('#edit-reason-form');\n\t                form[0].reset();\n\t                form.find('select').each(function() {\n\t                    $(this)[0].selectize.clear();\n\t                });\n\t                form.find('input[name=\"reasonId\"]').val($(e.currentTarget).data('id'));\n\t            }\n\t        }\n\t    }\n\t};\n\t\n\t\n\t$.extend( app.reasons, _reasons );\n\n\t$w.scroll(function () {\n\t\tapp.scroll();\n\t});\n\t$w.resize(function () {\n\t\tapp.resize();\n\t});\n\n\tapp.init();\n\n\n\n});\n\n\nHash = {\n\tget: function() {\n\t\tvar vars = {}, hash, splitter, hashes;\n\t\tif (!this.oldbrowser()) {\n\t\t\tvar pos = window.location.href.indexOf('?');\n\t\t\thashes = (pos != -1) ? decodeURIComponent(window.location.href.substr(pos + 1)) : '';\n\t\t\tsplitter = '&';\n\t\t}\n\t\telse {\n\t\t\thashes = decodeURIComponent(window.location.hash.substr(1));\n\t\t\tsplitter = '/';\n\t\t}\n\n\t\tif (hashes.length == 0) {return vars;}\n\t\telse {hashes = hashes.split(splitter);}\n\n\t\tfor (var i in hashes) {\n\t\t\tif (hashes.hasOwnProperty(i)) {\n\t\t\t\thash = hashes[i].split('=');\n\t\t\t\tif (typeof hash[1] == 'undefined') {\n\t\t\t\t\tvars['anchor'] = hash[0];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvars[hash[0]] = hash[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn vars;\n\t},\n\tset: function(vars) {\n\t\tvar hash = '';\n\t\tfor (var i in vars) {\n\t\t\tif (vars.hasOwnProperty(i)) {\n\t\t\t\thash += '&' + i + '=' + vars[i];\n\t\t\t}\n\t\t}\n\n\t\tif (!this.oldbrowser()) {\n\t\t\tif (hash.length != 0) {\n\t\t\t\thash = '?' + hash.substr(1);\n\t\t\t}\n\t\t\twindow.history.pushState(hash, document.title, document.location.pathname + hash);\n\t\t}\n\t\telse {\n\t\t\twindow.location.hash = hash.substr(1);\n\t\t}\n\t},\n\tadd: function(key, val) {\n\t\tvar hash = this.get();\n\t\thash[key] = val;\n\t\tthis.set(hash);\n\t},\n\tremove: function(key) {\n\t\tvar hash = this.get();\n\t\tdelete hash[key];\n\t\tthis.set(hash);\n\t},\n\tclear: function() {\n\t\tthis.set({});\n\t},\n\toldbrowser: function() {\n\t\treturn !(window.history && history.pushState);\n\t},\n};\nfunction getImageLightness(imageSrc) {\n    var deferred = $.Deferred();\n    var img = document.createElement(\"img\");\n    img.src = imageSrc;\n    img.style.display = \"none\";\n    document.body.appendChild(img);\n\n    var colorSum = 0;\n\n    img.onload = function() {\n        // create canvas\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = this.width;\n        canvas.height = this.height;\n\n        var ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(this,0,0);\n\n        var imageData = ctx.getImageData(0,0,canvas.width,canvas.height);\n        var data = imageData.data;\n        var r,g,b,avg;\n\n        for(var x = 0, len = data.length; x < len; x+=4) {\n            r = data[x];\n            g = data[x+1];\n            b = data[x+2];\n\n            avg = Math.floor((r+g+b)/3);\n            colorSum += avg;\n        }\n\n        var brightness = Math.floor(colorSum / (this.width*this.height));\n        deferred.resolve(brightness);\n        this.remove();\n    }\n    img.onerror = function() {\n        console.log('Error loading image: ' + imageSrc);\n        deferred.fail();\n    }\n    return deferred.promise();\n}\n\nString.template = function () {\n    var str = arguments[0];\n    for (var i = 1; i < arguments.length; i++) {\n        str = str.replace(RegExp(\"\\\\{\" + i + \"\\\\}\", \"gm\"), arguments[i]);\n    }\n    return str;\n};\nString.prototype.capitalizeFirstLetter = function() {\n    return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\nObject.size = function(obj) {\n    var size = 0, key;\n    for (key in obj) {\n        if (obj.hasOwnProperty(key)) size++;\n    }\n    return size;\n};\n\n/**\n * Number.prototype.format(n, x, s, c)\n *\n * @param integer n: length of decimal\n * @param integer x: length of whole part\n * @param mixed   s: sections delimiter\n * @param mixed   c: decimal delimiter\n */\nNumber.prototype.format = function(n, x, s, c) {\n    var re = '\\\\d(?=(\\\\d{' + (x || 3) + '})+' + (n > 0 ? '\\\\D' : '$') + ')',\n        num = this.toFixed(Math.max(0, ~~n));\n\n    return (c ? num.replace('.', c) : num).replace(new RegExp(re, 'g'), '$&' + (s || ','));\n};\n\nfunction guid() {\n    function s4() {\n        return Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1);\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n        s4() + '-' + s4() + s4() + s4();\n}\n\nfunction countDown(params) {\n    var duration = params.time;\n    var display = params.display;\n    var showMinutes = params.showMinutes;\n\n    if(!duration)\n        return;\n\n    var start = Date.now(),\n        diff,\n        minutes,\n        seconds;\n\n    function timer() {\n        diff = duration - (((Date.now() - start) / 1000) | 0);\n        minutes = (diff / 60) | 0;\n        seconds = (diff % 60) | 0;\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n        if(display && showMinutes)\n            display.text( minutes + \":\" + seconds);\n        else if(display)\n            display.text((minutes != 0 ? minutes + \":\" : \"\")    + seconds);\n\n        if (diff <= 0) {\n            clearInterval(interval);\n            if(typeof params.afterFinish === 'function' )\n                params.afterFinish();\n        }\n    }\n\n    timer();\n    var interval = setInterval(timer, 1000);\n}\n\n\n(function($,undefined){\n    $.fn.serializeObject = function(){\n        var obj = {};\n\n        $.each( this.serializeArray(), function(i,o){\n            var n = o.name,\n                v = o.value;\n\n            obj[n] = obj[n] === undefined ? v\n                : $.isArray( obj[n] ) ? obj[n].concat( v )\n                : [ obj[n], v ];\n        });\n\n        return obj;\n    };\n})(jQuery);\n\n\nfunction getNumEnding(iNumber, aEndings)\n{\n    var sEnding, i;\n    iNumber = iNumber % 100;\n    if (iNumber>=11 && iNumber<=19) {\n        sEnding=aEndings[2];\n    }\n    else {\n        i = iNumber % 10;\n        switch (i)\n        {\n            case (1): sEnding = aEndings[0]; break;\n            case (2):\n            case (3):\n            case (4): sEnding = aEndings[1]; break;\n            default: sEnding = aEndings[2];\n        }\n    }\n    return sEnding;\n}"],"sourceRoot":"/source/"}