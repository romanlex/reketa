function getImageLightness(t){var e=$.Deferred(),o=document.createElement("img");o.src=t,o.style.display="none",document.body.appendChild(o);var a=0;return o.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var o=t.getContext("2d");o.drawImage(this,0,0);for(var n,i,s,d,r=o.getImageData(0,0,t.width,t.height),l=r.data,c=0,u=l.length;u>c;c+=4)n=l[c],i=l[c+1],s=l[c+2],d=Math.floor((n+i+s)/3),a+=d;var p=Math.floor(a/(this.width*this.height));e.resolve(p),this.remove()},o.onerror=function(){console.log("Error loading image: "+t),e.fail()},e.promise()}function guid(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function countDown(t){function e(){i=o-((Date.now()-r)/1e3|0),s=i/60|0,d=i%60|0,s=10>s?"0"+s:s,d=10>d?"0"+d:d,a&&n?a.text(s+":"+d):a&&a.text((0!=s?s+":":"")+d),0>=i&&(clearInterval(l),"function"==typeof t.afterFinish&&t.afterFinish())}var o=t.time,a=t.display,n=t.showMinutes;if(o){var i,s,d,r=Date.now();e();var l=setInterval(e,1e3)}}function getNumEnding(t,e){var o,a;if(t%=100,t>=11&&19>=t)o=e[2];else switch(a=t%10){case 1:o=e[0];break;case 2:case 3:case 4:o=e[1];break;default:o=e[2]}return o}var lang={basketProductAddError:"Произошла ошибка. Товар не может быть добавлен в корзину.",basketProductAddSuccess:"Товар успешно добавлен в корзину.",basketProductClear:"Корзина очищена",basketProductClearError:"Произошла ошибка при очистке корзины. Обновите страницу и попробуйте снова.",basketRequestDelete:"Вы уверены что хотите удалить товар из корзины?",buttonTextInBasket:"В корзине",product:"товар",currencySymbol:"&#x20bd;",DeliveryDate:"Дата доставки",DeliveryFormattedString:"Доставка на {1} {2}",morning:"Утро",afternoon:"День",evening:"Вечер",creditcardquestdelete:'Вы уверены что хотите удалить карту "{1}"?',creditcardNotFound:"У вас не привязано ни одной карты",dialogChangePhoneAlert:"Изменение телефонного номера привяжет вашу историю заказов к новому номеру",dialogEditButton:"Редактировать",dialogDismissButton:"Отмена",dialogDeleteButton:"Удалить",dialogCloseButton:"Закрыть",deliveryaddressrequestdelete:'Вы уверены что хотите удалить адрес доставки "{1}"?',deliveryaddressNotFound:"У вас не привязано ни одного адреса доставки. Чтобы привязать адрес вам необходимо создать любой заказ",processCallbackTitle:"Заказ<br>звонка",processPhoneCheck:"Проверка<br>номера телефона",processConfirmCheck:"Проверка<br>кода",processSave:"Сохранение данных",processAuthorization:"Пожалуйста<br>подождите",loading:"Ожидайте",bouquet:"Букет",bouquetNotFound:"Доступных букетов не найдено",bouquetInBasketPopupCart:"В корзине {1} на {2}"},app,ajaxloader,settings,device={};$(function(){var t=$(window);settings={env:"dev",loadBouquets:6,imageBouquetsBrightnessThreshold:110,timeoutResendConfirmPhoneCode:60},app={init:function(){moment.locale("ru"),app.device.getInfo(),app.layout.initStyle(),app.content.initStyle(),app.bind.document(),app.bind.forms(),app.bind.buttons(),app.sidebar.init(),app.widgets.load(),app.checkout.load()},device:{getInfo:function(){var e=$("body"),o=t.height(),a=t.width();a>o?(device.orientation="landscape",e.hasClass("portrait")?e.removeClass("portrait").addClass("landscape"):e.addClass("landscape")):(device.orientation="portrait",e.hasClass("landscape")?e.removeClass("landscape").addClass("portrait"):e.addClass("portrait")),a>=1441&&(device.type="desktop",device.subtype="fullhd"),a>=1281&&1440>=a&&(device.type="desktop",device.subtype="hd"),a>=1024&&1280>=a&&(device.type="desktop",device.subtype="small"),a>=768&&1023>=a&&(device.type="planshet"),768>a&&(device.type="mobile"),320>=a&&(device.type="smallmobile"),device.windowHeight=o,device.windowWidth=a,"dev"==settings.env&&(console.log("[DEVICE] Get device data"),console.log(device))}},resize:function(){"dev"==settings.env&&console.log("[APP] Window size is changed"),app.popup.isOpened()&&app.popup.hide(),app.device.getInfo(),app.sidebar.initStyle(),app.content.initStyle(),app.layout.initStyle(),app.widgets.calendar&&app.widgets.calendar.loaded&&app.widgets.calendar.setPosition()},scroll:function(){},bind:{document:function(){$(document).ready(function(){$('input[type="tel"]').mask("+7(999)999-9999"),$('input[name="phone"]').mask("+7(999)999-9999")}),$(document).keyup(function(t){27==t.keyCode&&app.popup.isOpened()&&app.popup.hide()}),$("body").swipe({swipeRight:function(t,e,o,a,n){"dev"==settings.env&&console.log("TouchSwipe Right Event");var i=$(t.target);("desktop"==device.type&&"small"==device.subtype||"desktop"!=device.type)&&(i.is("body")||0!=i.closest('div[class^="owl-item"]').length||0!=i.closest('div[class^="modal"]').length||i.hasClass("modal")||app.popup.show("#sidebar"))},swipeLeft:function(t,e,o,a,n){"dev"==settings.env&&console.log("TouchSwipe Left Event"),app.sidebar.isOpened()&&app.popup.hide()}}),$(".tooltip").tooltipster({animation:"grow"}),$(document).on("click",'*[data-toggle="popup"]',function(t){var e=$(this).data("order")?$(this).data("order"):!1;app.popup.show($(this).data("target"),e)}),$(document).on("click","#popup-bg",function(){app.popup.hide()}),$(document).on("click","button.popup-close",function(){app.popup.hide()}),$(document).on("click","button.modal-close",function(t){$.magnificPopup&&$.magnificPopup.close()}),$(document).on("click",'button[data-toggle="to-basket"]',function(t){event.preventDefault(),t.stopPropagation(),app.basket.add(t)}),$(document).on("click",'button[data-toggle="clear-basket"]',function(){app.basket.clear()})},forms:function(){},buttons:function(){$('button[data-toggle="modal"]').on("click",function(){$.magnificPopup.open({type:"inline",items:{src:$(this).data("target")},removalDelay:500,showCloseBtn:!1,callbacks:{beforeOpen:function(){this.st.mainClass="mfp-zoom-in"}},midClick:!0})}),$('button[data-toggle="dialog"]').on("click",function(){var t=$(this).data("title")?$(this).data("title"):"",e=$(this).data("content")?$(this).data("content"):"";app.modal.dialog({title:t,content:e,buttons:{yes:{title:"ОК","class":"edit",action:function(){"dev"==settings.env&&console.log("[Dialog (default)] Confirmed"),app.modal.lastConfirmed=!0}},no:{title:lang.dialogCloseButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog (default)] Not confirmed"),app.modal.lastConfirmed=!1}}}})})}},sidebar:{opened:!1,isOpened:function(){return this.opened},init:function(){var t,e=this;this.sidebarObj=t=$("#sidebar"),t.on("open",function(){e.open()}),t.on("close",function(){e.close()}),$('button[data-toggle="close-sidebar"]').on("click",function(){$(this).addClass("closing"),$(this).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(t){}),$(this).hasClass("closing")&&$(this).removeClass("closing"),app.sidebar.close()}),this.initStyle(),$(document).on("raketa.bouquets.loaded",function(){var e=0,o=$("#bouquet-list");"dev"==settings.env&&console.log("[SIDEBAR] Bouquets new loaded check style sidebar"),o.length&&o.outerHeight()+$("#header").height()<device.windowHeight-t.find(".sidebar-bottom").height()?(console.log(e),e=device.windowHeight-o.height()-o.offset().top-t.find(".sidebar-bottom").height(),t.find(".sidebar-bottom").css({bottom:e})):t.find(".sidebar-bottom").css({bottom:0})})},initStyle:function(){var e=this.sidebarObj;"desktop"!=device.type||"hd"!=device.subtype&&"fullhd"!=device.subtype?e.addClass("collapsed"):e.removeClass("collapsed");var o=e.find(".sidebar-top").outerHeight()+e.find(".sidebar-bottom").height(),a=t.height()<o?"relative":"absolute",n=(t.height()<o?"absolute":"fixed",0),i=$("#bouquet-list");device.windowHeight>1e3&&i.length>0&&i.find("li").length>0&&i.outerHeight()+$("#header").height()<device.windowHeight-e.find(".sidebar-bottom").height()?(n=device.windowHeight-i.height()-i.offset().top-e.find(".sidebar-bottom").height(),e.find(".sidebar-bottom").css({bottom:n})):e.find(".sidebar-bottom").css({bottom:0}),e.find(".sidebar-bottom").css({position:a})},open:function(){"dev"==settings.env&&console.log("[SIDEBAR] Open navbar");var t=$("#sidebar");try{t.addClass("open")}catch(e){console.log("Popup open error: "+e)}t.find(".popup-close").hide().delay(200).fadeIn(200,function(){$(this).addClass("closing")}),t.find(".popup-close").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(t){$(this).hasClass("closing")&&$(this).removeClass("closing")}),this.opened=!0},close:function(){"dev"==settings.env&&console.log("[SIDEBAR] Close navbar");var t=$("#sidebar");t.removeClass("open"),t.find(".popup-close").addClass("closing"),t.find(".popup-close").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(t){$(this).hasClass("closing")&&$(this).removeClass("closing")}),$('button[data-toggle="sidebar"]').removeClass("opened"),this.opened=!1}},popup:{isOpened:function(){return this.opened&&this.opened.length?!0:!1},show:function(t,e){if(!this.isOpened()||e){var t=$(t);if(!e){var o=t.css("z-index");$("<div />").appendTo("#wrapper").attr("id","popup-bg").addClass(t.hasClass("product-cart")?"gray":"default").css("z-index",--o).fadeIn(200),$("body").css("overflow","hidden").on("touchmove",function(t){t.preventDefault()})}t.trigger("open"),$(document).trigger("popup-show"),this.opened=t,this.initialized=!0}},hide:function(){this.opened&&(this.opened.trigger("close"),$("#popup-bg").fadeOut(200,function(){$(this).remove()}),$("body").css("overflow","auto").off("touchmove"),delete this.opened,$(document).trigger("popup-close"))}},modal:{lastConfirmed:!1,dialog:function(t){this.lastConfirmed=!1;var e=t.buttons,o="dialog_"+guid(),a="",n="";t.id=o,0===t.content.indexOf("#")&&(t.content=$(t.content).html()),$.each(e,function(t,e){e["class"]||(e["class"]=""),a+='<button class="'+e["class"]+'">'+(e.title?e.title:t)+"</button>\n",e.action||(e.action=function(){})}),t.buttons=a;try{n=tmpl(document.getElementById("tmpl-dialog").innerHTML,t);var i=$(n).appendTo("body");"function"==typeof t.afterRender&&t.afterRender(i);var s=$("#"+o+" button"),d=0;$.each(e,function(e,a){s.eq(d++).on("click",function(){if("form"==t.type){var e=$("#"+o).find("form");a.beforeAction&&"function"==typeof a.beforeAction?(e.on("submit",function(){return a.beforeAction(e)&&(a.action($(this)),$.magnificPopup.close()),!1}),e.trigger("submit")):$.magnificPopup.close()}else a.action(),$.magnificPopup.close();return!1})}),$.magnificPopup.open({items:{src:"#"+o},showCloseBtn:!1,removalDelay:500,mainClass:"mfp-zoom-in",callbacks:{close:function(){$("#"+o).remove(),"dev"==settings.env&&console.log("Popup is completely closed")}},type:"inline"})}catch(r){console.log("Template dialog rendering and open failed",r)}}},content:{initStyle:function(){$("#content").css("height",t.height()-$("#header").height()+"px")}},bouquets:{data:[],get:function(t){$("#ajax-loader").fadeIn(200);var e={start:0,to:null,limit:settings.loadBouquets,type:"json",after:function(t){}};this.options=$.extend({},e,t);var o=this;setTimeout(function(){var t;app.bouquets.data=t=bouquetsList,o.options.after.call(o,t),app.bouquets.buildListHtml(bouquetsList),$("#ajax-loader").delay(500).fadeOut(300,function(){})},1e3)},buildListHtml:function(t){var e=$("#bouquet-list");if("dev"==settings.env&&console.log("[FLOWERS] Load flowers"),!t||$.isEmptyObject(t)){var o=$("<div />").hide().addClass("not-found").html(lang.bouquetNotFound);return $("#content").append(o),o.fadeIn(),void console.log("[FLOWERS] Data is empty")}$("#content > .not-found").remove();var a=0;$.each(t,function(t,o){var n=$("<li />").attr("data-bouquet-id",o.id);getImageLightness(o.imgSrc).done(function(t){"dev"==settings.env&&console.log("[IMAGE => LIGHNESS] Bouquet #"+o.id);var a="dark";t>settings.imageBouquetsBrightnessThreshold&&(a="light"),"dev"==settings.env&&console.log(" -> Bouquet #"+o.id+": "+o.imgSrc+": "+t+"("+a+")"),e.find('li[data-bouquet-id="'+o.id+'"] > div.bouquet').addClass(a)}),n.append(app.bouquets.render("tmpl-bouquet-list-item",o)),n.append(app.bouquets.render("tmpl-bouquet-list-item-popup",o)),e.append(n),a++}),e.find(".bouquet").each(function(t){$(this).delay(100*t).fadeIn(300,function(){t==a-1&&$(document).trigger("raketa.bouquets.loaded")})})},render:function(t,e){var o="";try{return o=tmpl(document.getElementById(t).innerHTML,e)}catch(a){console.log("Template rendering failed",a)}}},basket:{store:[],get:function(){},add:function(t){console.log(t);var e=$(t.currentTarget),o=e.data("product-id"),a=$('#bouquet-list li[data-bouquet-id="'+o+'"]');if("dev"==settings.env&&console.log("[BASKET] Add product with ID #"+o+" to basket"),!a.length)throw Error("Невозможно найти DOM объект товара");e.addClass("added"),e.find("span.icon").html(lang.buttonTextInBasket),"dev"==settings.env&&console.log("[BASKET] [ID #"+o+"] Get product details");var n=app.bouquets.data.filter(function(t){return t.id==o})[0];if(0==n.length)throw Error("Невозможно найти товар c id "+o);n.count=1;var i=$.map(app.checkout.basket,function(t,e){return t.id==n.id?e:void 0});i.length>0?("dev"==settings.env&&console.log("Find in basket product with the same ID"),app.checkout.basket[i[0]].count+=n.count,n.count=app.checkout.basket[i[0]].count):app.checkout.basket.push(n),this.saveBasket(),this.updateHtml(),app.widgets.productcart&&app.widgets.productcart.openedObj&&app.popup.isOpened()&&($.isEmptyObject(app.checkout.delivery)?app.widgets.productcart.step("delivaryDate"):app.widgets.productcart.step("orderInfo"))},clear:function(){this.destroyBasket()},destroyBasket:function(){return!0},saveBasket:function(){JSON.stringify(app.checkout.basket);console.log("SAVE data basket"),console.log(app.checkout.basket)},updateHtml:function(){var t=$("#header a.basket");t.addClass("notempty").html("<span>"+app.checkout.basket.length+"</span>")},productInBasket:function(t){var e=$.map(app.checkout.basket,function(e,o){return e.id==t?o:void 0});return e.length>0?e:!1},getProductFromBasket:function(t){var e=$.map(app.checkout.basket,function(e,o){return e.id==t?o:void 0});return e.length>0?app.checkout.basket[e]:!1},removeProductFromBasket:function(t,e){var o=$.map(app.checkout.basket,function(e,o){return e.id==t?o:void 0});if(o.length>0)try{console.log(o),app.checkout.basket.splice(o[0],1),"function"==typeof e&&e()}catch(a){console.error("Failed to delete product from basket with error: "+a)}}},checkout:{basket:[],delivery:{},load:function(){(!this.basket.length||$.isEmptyObject(this.delivery))&&(this.getBasketData(),this.getDeliveryDate())},getBasketData:function(){return this.basket.length?void 0:$.Deferred(function(){var t=this;console.log("Get basket from session or cookies"),setTimeout(function(){var e=[{id:2,count:3,imgSrc:"img/b2.jpg",price:2800,name:"Черничный пирог",availableData:"с 28 октября",label:"autumn",size:{dia:"60 см",height:"30 см"},composition:"Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента",info:"Диаметр: 60см<br>Высота: 30см<hr><p>Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента</p>"},{id:3,count:1,imgSrc:"img/b3.jpg",price:1900,name:"Свет добра",availableData:"с 14 марта",size:{dia:"60 см",height:"30 см"},composition:"Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента",info:"Диаметр: 60см<br>Высота: 30см<hr><p>Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента</p>"}];app.checkout.basket=e,app.basket.updateHtml(),$(document).trigger("raketa.basket.get-data"),t.resolve()},500)})},getDeliveryDate:function(){var t=Cookies.get("raketa_delivary__date"),e=Cookies.get("raketa_delivary__timeofday");if(t&&(this.delivery.date=t),e&&(this.delivery.timeofday=e),app.widgets.calendar&&app.widgets.calendar.loaded&&e&&t){var o=$("#widget-calendar");o.find('.radio-group input[name="timeofday"]:checked').attr("checked",!1),o.find("#tod_"+e).attr("checked",!0),$("#delivery-date").datetimepicker({value:t}),o.find('button[type="submit"]').removeAttr("disabled"),o.find('button[data-toggle="clear-date"]').removeAttr("disabled"),$("#selectedDate").html(app.widgets.calendar.getDateString()),$('button[data-target="#widget-calendar"]').html(app.widgets.calendar.getDateString())}},save:function(t){console.log("[FOR DELIVERY] Send form data to server:");({basket:this.basket,delivery:this.delivery,"for":this["for"]});setTimeout(function(){var e={status:!0,paymentUrl:"order_success.html"};"function"==typeof t&&t(e)},2e3)}},widgets:{load:function(){$.each(this,function(t,e){if("load"!==t)try{e.load()}catch(o){console.error("Error loading widget @"+t+" with error: "+o)}})},calendar:{obj:{},loaded:!1,cleared:!1,opened:!1,position:{},setPosition:function(){var t=$('button[data-target="#widget-calendar"]');if(t.length){var e=this.obj.width(),o=this.obj.height(),a=t.offset(),n=device.windowWidth-(a.left+t.outerWidth())-20;this.obj.css("top",-(o+40)+"px"),this.obj.css("right",Math.floor(n)+"px"),this.obj.css("height",o+"px"),this.position.width=e,this.position.height=o,this.position.top=-o,this.position.right=-n}},load:function(){this.obj=$("#widget-calendar");var t=$('button[data-target="#widget-calendar"]'),e=this;$.datetimepicker.setLocale("ru"),$("#delivery-date").datetimepicker({format:"d.m.Y",value:0,timepicker:!1,inline:!0,todayButton:!1,prevButton:!1,nextButton:!1,scrollMonth:!1,dayOfWeekStart:1,yearStart:"2016",yearEnd:"2020",minDate:new Date,maxDate:new Date(+new Date+12096e5),onChangeDateTime:function(t,o){e.obj.find('button[type="submit"]').removeAttr("disabled"),e.obj.find('input[name="timeofday"]').removeAttr("disabled");var a=o.parents(".widget");a.find('button[data-toggle="clear-date"]').removeAttr("disabled");var n=o.data("targetdate");$("#"+n).html(e.getDateString())},onGenerate:function(o){$(this).find(".xdsoft_calendar");!(t.length>0)||e.position.width&&e.position.height&&e.position.top&&e.position.right||e.setPosition()}}),this.obj.find('button[type="submit"]').on("click",function(t){t.preventDefault(),e.cleared||e.process(),app.popup.hide()}),this.obj.find('input[name="timeofday"]').on("change",function(){$("#selectedDate").html(e.getDateString()),void 0!==app.checkout.delivery?t.html(e.getDateString()):t.html(lang.DeliveryDate)}),this.obj.find('button[data-toggle="clear-date"]').on("click",function(o){e.obj.find("#delivery-date").val(new Date),e.obj.find(".xdsoft_current").removeClass("xdsoft_current"),$("#delivery-date").datetimepicker({value:new Date}),$("#"+e.obj.find("#delivery-date").data("targetdate")).html(lang.DeliveryDate),t.html(lang.DeliveryDate),$(this).attr("disabled","disabled"),e.obj.find('button[type="submit"]').attr("disabled","disabled"),e.obj.find('input[name="timeofday"]:checked').attr("checked",!1),e.obj.find('input[name="timeofday"]').attr("disabled","disabled"),e.cleared=!0,delete app.checkout.delivery,Cookies.remove("raketa_delivary__date",{path:"/"}),Cookies.remove("raketa_delivary__timeofday",{path:"/"}),app.popup.hide()}),$(document).on("open","#widget-calendar",function(){e.open()}),$(document).on("close","#widget-calendar",function(){e.close()}),this.loaded=!0},getDateString:function(){var t=lang.DeliveryFormattedString,e=this.obj.find('input[name="timeofday"]:checked').val(),o=this.obj.find('input[name="date"]').val();return o=o?moment(o,"DD.MM.YYYY").format("D MMMM"):"",t=String.template(t,lang[e]?lang[e]:"",o),t=t.toLowerCase().capitalizeFirstLetter()},open:function(){"dev"==settings.env&&console.log("[WIDGET] Open widget @calendar"),$.isEmptyObject(app.checkout.delivery)&&this.obj.find(".xdsoft_current").removeClass("xdsoft_current"),this.obj.addClass("animation"),this.obj.transition({y:Math.floor(this.obj.height()+40)});var t=this;this.obj.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(e){t.obj.removeClass("animation").addClass("opened")}),t.cleared=!1,t.opened=!0},close:function(){"dev"==settings.env&&console.log("[WIDGET] Close widget @calendar"),this.obj.removeClass("opened").addClass("animation"),this.obj.transition({y:this.position.top,complete:function(){this.opened=!1}})},process:function(){var t=$('button[data-target="#widget-calendar"]'),e=this.obj.find("form").serializeObject();app.checkout.delivery=e,void 0!==app.checkout.delivery?t.html(this.getDateString()):t.html(lang.DeliveryDate),console.log(e),Cookies.set("raketa_delivary__date",e.date,{expires:1,path:"/"}),Cookies.set("raketa_delivary__timeofday",e.timeofday,{expires:1,path:"/"})}},productcart:{loaded:!1,cleared:!1,startPosition:{},startTitle:"",hashProcess:function(){var t=$.Deferred(function(){var t=this;$(document).on("raketa.bouquets.loaded",function(){t.resolve()})}),e=$.Deferred(function(){var t=this;$(document).on("raketa.basket.get-data",function(){t.resolve()})});$.when(e,t).then(function(){var t,e=Hash.get();e.anchor?window.location.hash=e.anchor:e.bouquet&&(t=$('#bouquet-list li[data-bouquet-id="'+e.bouquet+'"] > div[data-toggle="popup"]')),t&&t.trigger("click")})},load:function(){this.obj=$(".product-cart");var t=this;this.hashProcess(),$(document).on("open",".product-cart",function(e){t.open(e)}),$(document).on("close",".product-cart",function(){t.close()}),$(document).on("click",'.product-cart button[data-toggle="show-product-info"]',function(){var t=$(this).data("product-id");$(this).toggleClass("active"),$("#popup-product-"+t+" .product-info").fadeToggle(300,function(){})}),$(document).on("click",".product-cart button.direction",function(e){var o=$(this).data("direction");"dev"==settings.env&&console.log("[WIDGET] @productcart - change current cart ("+o+")");index=t.openedObj.closest("li[data-bouquet-id]").index();switch(console.log("Opened index element "+index),o){case"prev":index=index-1<0?$("#bouquet-list li:last-child").index():index-1;break;case"next":index=index+1>$("#bouquet-list li").length-1?0:index+1}t.close();var a=$("#bouquet-list li").eq(index);setTimeout(function(){a.find('div[data-toggle="popup"]').data("order",!0).trigger("click")},300)}),$(document).on("raketa.bouquets.loaded",function(){var t=$(".product-cart").find(".gallery-list"),e=$(".product-cart").width(),o=$(".product-cart").height();if(t.length>0){t.css("height",o),t.find(".owl-lazy").css("height",o),t.find(".owl-lazy").css("width",e/2),t.find(".owl-height").css("height",$(".product-cart").height()),t.css("width",e/2),t.magnificPopup({delegate:"a.owl-lazy",type:"image",mainClass:"mfp-no-margins mfp-zoom-in",closeOnContentClick:!0,closeBtnInside:!1,fixedContentPos:!0,image:{verticalFit:!0}});var a={items:1,margin:0,lazyLoad:!0,loop:!0,autoplay:!0,autoplayTimeout:5e3,autoplayHoverPause:!0};"dev"==settings.env&&console.log("[WIDGET] @productcart Found gallery in product cart"),t.on("initialized.owl.carousel",function(t){var e=$(t.target),o=t.item.index;e.find(".owl-item").eq(o).find(".item")}),t.owlCarousel(a)}}),this.loaded=!0},open:function(t){var e=$(t.target);"dev"==settings.env&&console.log("[WIDGET] Open widget @productcart with id #"+e.attr("id")),$('#bouquet-list li[data-bouquet-id="'+e.data("product-id")+'"] > div[data-toggle="popup"]').data("order",!1);var o=e.height(),a=e.width();e.css("top",-o).css("visibility","visible"),this.startPosition.top=-o;app.basket.productInBasket(e.data("product-id"))&&!$.isEmptyObject(app.checkout.delivery)?("dev"==settings.env&&console.log("[WIDGET] @productcart go to step 3"),this.loadStep3(e,app.basket.productInBasket(e.data("product-id")))):app.basket.productInBasket(e.data("product-id"))&&$.isEmptyObject(app.checkout.delivery)&&("dev"==settings.env&&console.log("[WIDGET] @productcart go to step 2"),e.find(".step").hide().removeClass("active"),e.find(".step2").addClass("active").show());var a=e.outerWidth();e.css("margin-left",Math.ceil(-a/2)),e.addClass("transition"),"desktop"!=device.type||"fullhd"!=device.subtype&&"hd"!=device.subtype?e.transition({y:Math.floor(o+$("#header").height())}):e.transition({y:Math.floor(device.windowHeight-(device.windowHeight-o)/2)}),e.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(t){e.removeClass("transition").addClass("opened"),e.find(".bottom button:first-child").focus()}),this.startTitle=document.title,document.title=lang.bouquet+" "+e.data("title"),Hash.add("bouquet",e.data("product-id")),this.openedObj=e,this.cleared=!1},close:function(){var t=this.openedObj;"dev"==settings.env&&console.log("[WIDGET] Close widget @productcart"),t.removeClass("opened").addClass("animation"),t.transition({y:this.startPosition.top}),window.location.hash="",history.pushState("",document.title,window.location.pathname),document.title=this.startTitle,delete this.openedObj},step:function(t){if(t){"dev"==settings.env&&console.log("[WIDGET] @productcart go to step - "+t);var e=this.openedObj;switch(t){case"delivaryDate":console.log(e),e.find(".step.active").fadeOut("fast",function(){e.find(".step.step2").fadeIn("fast")});break;case"orderInfo":e.find(".step.active").fadeOut("fast",function(){e.find(".step.step3").fadeIn("fast")})}}},loadStep3:function(t,e){t.find(".step").hide().removeClass("active"),t.find(".step3").addClass("active").show(),console.log(e);var o=app.basket.getProductFromBasket(t.data("product-id")),a=lang.bouquetInBasketPopupCart,n=o.count+" "+lang.bouquet+getNumEnding(o.count,["","а","ов"]),i=o.count*o.price;i>1e4&&(i=i.format(0,3," ",".")),a=String.template(a,n.toLowerCase(),i+lang.currencySymbol),$("#in-basket-product-"+t.data("product-id")).html('<span class="icon-basket"></span> '+a),$("#p"+t.data("product-id")+"-count").val(o.count),$('[data-trigger="spinner"]').spinner("max",99).spinner("changing",function(a,n,i){$(this).attr("name");if(!(0>n)){app.checkout.basket[e[0]].count=n;var s=lang.bouquetInBasketPopupCart,d=n+" "+lang.bouquet+getNumEnding(o.count,["","а","ов"]),r=n*o.price;r>1e4&&(r=r.format(0,3," ",".")),s=String.template(s,d.toLowerCase(),r+lang.currencySymbol),$("#in-basket-product-"+t.data("product-id")).html('<span class="icon-basket"></span> '+s),app.basket.saveBasket()}})}}},layout:{currentLayout:{},initStyle:function(){$.isEmptyObject(this.currentLayout)||("dev"==settings.env&&console.log("Set layout("+this.currentLayout.name+") template style"),this.setStyleLayout(this.currentLayout.name,this.currentLayout.container))},init:function(t,e){t||(t=$("div[data-layout]"));var o=t.data("layout");return o?(this.currentLayout.name=o,this.currentLayout.container=t,this.currentLayout.callback=e,"dev"==settings.env&&console.log("Initialize layout("+o+")"),void this.loadLayout(o,t,e)):void console.error("Layout attribute not found")},setStyleLayout:function(e,o){var a=(o.outerHeight(),t.height()-$("#header").height()-50);o.css("height",a+"px")},loadLayout:function(t,e,o){switch(t){case"devided-slider":this.setStyleLayout(t,e);var a=$("#content").width(),n=$("#slider-content");n.css("width",a/2),n.on("initialized.owl.carousel",function(t){var o=$(t.target),a=t.item.index,n=o.find(".owl-item").eq(a).find(".item"),i=n.data("hash");e.find(".layout-menu li.active").removeClass("active"),e.find('.layout-menu a[href="#'+i+'"]').parent().addClass("active"),"dev"==settings.env&&console.log("[OWL Carousel] Event initialized.owl.carousel"),e.find(".content-panel > .bottom").hide(),e.find('.content-panel > .bottom[data-to-slide="'+i+'"]').fadeIn(200)}),n.on("changed.owl.carousel",function(t){var o=$(t.target),a=t.item.index,n=o.find(".owl-item").eq(a).find(".item"),i=n.data("hash");e.find(".layout-menu li.active").removeClass("active"),e.find('.layout-menu a[href="#'+i+'"]').parent().addClass("active"),i&&(window.location.hash=i),"dev"==settings.env&&console.log("[OWL Carousel] Event changed.owl.carousel"),e.find(".content-panel > .bottom").hide(),e.find('.content-panel > .bottom[data-to-slide="'+i+'"]').fadeIn(300)}),n.owlCarousel({autoHeight:!0,items:1,URLhashListener:!0,startPosition:"URLHash",animateOut:"fadeOut",smartSpeed:450,animateIn:"fadeIn",afterInit:function(t){}}),$("#content ul.layout-menu a").on("click",function(t){$(this).parent().hasClass("active")||($(this).parents(".layout-menu").find("li.active").removeClass("active"),$(this).parent().addClass("active"))}),n.find("button,input,select").addClass("not-draggable").on("touchstart mousedown",function(t){t.stopPropagation()}),n.parent().find('button[type="submit"]').on("click",function(){var t=n.find('.item[data-hash="'+$(this).data("to-slide")+'"]');t.find("form").trigger("submit")});break;case"default":this.setStyleLayout(t,e);break;case"devided":this.setStyleLayout(t,e)}"function"==typeof o&&o(e)}},callback:{order:function(t){$('button[data-to-form="#'+t.attr("id")+'"]').hide();var e=t.serializeArray();ajaxloader.local({element:t,to:'.item[data-hash="callback"]',title:lang.processPhoneCheck}),this.process(e,function(e){ajaxloader.finish(),t.hide(),$("#slider-content .owl-height").css("height",$("#support").height()),$("#callback-order-success").css("height",$("#support").height()).fadeIn(200),countDown({time:10,display:$("#callback-order-success .timer"),afterFinish:function(){$("#callback-order-success").fadeOut(200,function(){t[0].reset(),t.fadeIn(200),$("#slider-content .owl-height").css("height",t.outerHeight()),$('button[data-to-form="#'+t.attr("id")+'"]').show()})}})})},process:function(t,e){setTimeout(function(){var t=[];"function"==typeof e&&e(t)},2e3)}},auth:{init:function(){var t=$("#auth-form");this.validateForm(t),t.find("input").on("keyup",function(){$(this).removeClass("error").parent().removeClass("has-error"),$(this).next("i.fa").remove()}),t.closest(".content-panel").find('.bottom button[type="submit"]').on("click",function(t){var e=$(this).data("to-form");if("dev"==settings.env&&console.log("Click bottom button with target form "+e),e&&0!=$(e).length){var o=$(e);return o.trigger("submit"),o.closest(".static").find(".form-status").remove(),!1}})},validateForm:function(t){var e=this;jQuery.validator.addMethod("regexp",function(t,e,o){var a=new RegExp(o);return this.optional(e)||a.test(t)},"Please check your input."),t.validate({onfocusout:!1,onkeyup:!1,onclick:!1,focusInvalid:!1,submitHandler:function(){return e.authorizationSubmitHandler(t),!1},rules:{name:{required:!0,minlength:3,regexp:"^[А-яA-zёЁs-]{3,}$"},phone:{required:!0,minlength:5,regexp:"^\\+[0-9\\+\\-()s]{14,16}$"},email:{required:!0,email:!0}},messages:{name:{required:"Поле обязательно для заполнения",minlength:"Имя не может быть менее 3 символов",regexp:"Имя указано не верно"},phone:{required:"Поле обязательно для заполнения",minlength:"Телефон не может сожержать менее 5 символов",regexp:"Телефон указан не верно"},email:"Введите корректный адрес"},showErrors:function(e,o){return o.length<1?(t.removeClass("has-error"),t.find("input").removeClass("error").parent().removeClass("has-error"),void t.find("i.fa").remove()):void $.each(o,function(e,o){t.find('input[name="'+o.element.name+'"]').next("i.fa").remove(),t.find('input[name="'+o.element.name+'"]').addClass("error").parent().addClass("has-error"),t.addClass("has-error"),t.find('input[name="'+o.element.name+'"]').after('<i class="fa fa-exclamation-triangle tooltip" data-toggle="tooltip" title="'+o.message+'"></i>')})}})},authorizationProcess:function(t,e){console.log("[AUTHORIZATION] Send form data to server:"),console.log(t),setTimeout(function(){var t={message:"Неверно указан номер",status:!1};"function"==typeof e&&e(t)},1500)},authorizationSubmitHandler:function(t){$('button[data-to-form="#'+t.attr("id")+'"]').hide();var e=t.serializeArray(),o=t.closest(".static");t.css("opacity",0),ajaxloader.local({element:t,to:".static",title:lang.processAuthorization}),this.authorizationProcess(e,function(e){if(1!=e.status){var a=$("<div />").addClass("table form-status").css("width",o.outerWidth()).css("height",o.outerHeight()).append('<div class="cell middle"><span class="error">'+e.message+"</span></div>");o.prepend(a),ajaxloader.finish(),t.find('input[name="phone"]').parent().addClass("has-error"),setTimeout(function(){a.css("background-color","transparent"),a.find("span").addClass("inline"),a.transition({y:-250,complete:function(){a.css("z-index",0),t.fadeTo(200,1),$('button[data-to-form="#'+t.attr("id")+'"]').fadeIn(200);
}})},700)}else window.location="/"})}}},ajaxloader={local:function(t){if(t.element){var e=t.element,o=$("<div />").addClass("ajax-loader-local").css("width",e.outerWidth()).css("height",e.outerHeight());if(t.title&&t.title.length>0){var a=$("<div />").addClass("title").html(t.title);o.append(a)}if(t.image&&t.image.length>0){var n=$("<img />").addClass("image").attr("src",t.image);o.append(n)}else{var i=$("<div />").addClass("icon").attr("src",t.image);o.append(i)}if(t.to&&""!=t.to){var s=e.closest(t.to);o.css("width",s.outerWidth()).css("height",s.outerHeight()),s.prepend(o)}else e.prepend(o);o.fadeIn(200),this.ajaxloader=o}},finish:function(){if(this.ajaxloader){var t=this;this.ajaxloader.fadeOut(200,function(){t.ajaxloader.remove()})}}},app.profile={init:function(){this.bind()},bind:function(){$("#edit-personal-data").submit(function(t){return console.log(t),t.preventDefault(),app.profile.personal.save($(this)),!1}),$('#edit-personal-data input[type="text"]').on("keydown",function(t){$('button[data-to-slide="personal"]').removeAttr("disabled");var e=$('#profile .content-panel > *[data-to-slide="personal"]');e.find(".button-group").removeClass("one-button").addClass("two-button"),e.find("button.btn-dismiss").removeClass("hide")}),$(document).on("click",'button[type="dismiss"]',function(t){t.preventDefault();var e=$("#edit-personal-data");e[0].reset();var o=$('#profile .content-panel > *[data-to-slide="personal"]');o.find(".button-group").removeClass("two-button").addClass("one-button"),o.find("button.btn-dismiss").addClass("hide");var a=e.find('input[name="phone"]');a.attr("disabled","disabled"),a.parent().addClass("disabled"),a.parents(".form-group").find("button.edit-phone").hide()}),$(document).on("click",'button[type="delete-card"]',function(t){t.preventDefault();var e=$(this).parents("li[data-card-id]").data("card-id"),o=$(this).parents("div.creditcard").find(".creditcard-name").html(),a=String.template(lang.creditcardquestdelete,o);e?app.modal.dialog({content:a,buttons:{yes:{title:lang.dialogDeleteButton,"class":"delete",action:function(){"dev"==settings.env&&console.log("[Dialog] Confirmed"),app.profile.creditcard.del(e)}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog] Not confirmed")}}}}):console.error("Not found creditcard id")}),$('button[type="add-card"]').on("click",function(t){t.preventDefault();var e=$(this).data("title")?$(this).data("title"):"",o=$(this).data("content")?$(this).data("content"):"";app.modal.dialog({title:e,content:o,type:"form",popupClass:"add-card-popup",afterRender:function(t){t.find("#cardnumber").validateCreditCard(function(t){return $(this).removeClass(),null!=t.card_type?($(this).addClass(t.card_type.name),$(this).closest("form").find('input[name="cardtype"]').val(t.card_type.name),t.valid?$(this).addClass("valid"):$(this).removeClass("valid")):void 0},{accept:["visa","visa_electron","mastercard","maestro"]}),t.find("#cardholder").keypress(function(t){t.which>=65&&t.which<=90||t.which>=97&&t.which<=122||32==t.which||t.preventDefault()})},buttons:{yes:{title:"Добавить","class":"edit",beforeAction:function(t){var e=!0;t.serializeArray();return t.find("input").each(function(){$(this).val()||(e=!1,console.log("Поле "+$(this).attr("name")+" не заполнено"))}),e},action:function(t){"dev"==settings.env&&console.log("[Dialog (add credit card)] Confirmed"),app.profile.creditcard.add(t)}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog (add credit card)] Not confirmed")}}}})}),$(document).on("click",'button[type="delete-address"]',function(t){t.preventDefault();var e=$(this).parents("li[data-address-id]").data("address-id"),o=$(this).prev().html(),a=String.template(lang.deliveryaddressrequestdelete,o);e?app.modal.dialog({content:a,buttons:{yes:{title:lang.dialogDeleteButton,"class":"delete",action:function(){"dev"==settings.env&&console.log("[Dialog] Confirmed"),app.profile.delivery.del(e)}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog] Not confirmed")}}}}):console.error("Not found delivery address id")}),$('button[data-toggle="edit-phone"]').on("click",function(){app.modal.dialog({content:lang.dialogChangePhoneAlert,buttons:{yes:{title:lang.dialogEditButton,"class":"edit",action:function(){"dev"==settings.env&&console.log("[Dialog] Confirmed");var t=$('#slider-content input[name="phone"]');t.removeAttr("disabled"),t.parent().removeClass("disabled"),t.parents(".form-group").find("button.edit-phone").hide()}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog] Not confirmed")}}}})}),$(".creditcard .tooltip").tooltipster("option","position","left"),$(".creditcard .tooltip").tooltipster("option","arrow",!0)},creditcard:{obj:{},add:function(t){try{var e=t.serializeObject(),o="card_"+guid(),a={cardname:e.cardname,cardtype:e.cardtype,cardnumber:e.cardnumber.substr(-4)},n=tmpl(document.getElementById("tmpl-creditcard").innerHTML,a),i=$("<li />").append(n).attr("data-card-id",o).hide(),s=$("ul.creditcard-list");s.find("li.notfound").length&&s.find("li.notfound").remove(),i.find(".creditcard .tooltip").tooltipster({animation:"grow",position:"left"}),s.append(i),this.process.add(function(t){$("#slider-content .owl-height").css("height",s.outerHeight()+i.height()),$('ul.creditcard-list li[data-card-id="'+o+'"]').fadeIn(300,"easeOutQuad",function(){$(this).data("card-id",t.newId).attr("data-card-id",newId)})})}catch(d){console.log("Creditcard add failed",d)}},del:function(t){"dev"==settings.env&&console.log("Remove card with id #"+t),this.process.del(function(e){var o=$("ul.creditcard-list li").length;$('ul.creditcard-list li[data-card-id="'+t+'"]').slideUp(300,"easeOutQuad",function(){$(this).remove(),0==o&&$("<li />").appendTo("ul.creditcard-list").html(lang.creditcardNotFound).addClass("notfound").fadeIn(200);var t=$("ul.creditcard-list");$("#slider-content .owl-height").css("height",t.outerHeight())})})},process:{del:function(t){$("#ajax-loader").fadeIn(200),setTimeout(function(){$("#ajax-loader").delay(500).fadeOut(300,function(){var e=[];"function"==typeof t&&t(e)})},1e3)},add:function(t){$("#ajax-loader").fadeIn(200),setTimeout(function(){$("#ajax-loader").delay(500).fadeOut(300,function(){var e={newId:4};"function"==typeof t&&t(e)})},1e3)}}},personal:{save:function(t){"dev"==settings.env&&console.log("Save personal data");var e=t.serializeArray();this.process(e,function(t){console.log("Personal data saved"),$('button[data-to-slide="personal"]').attr("disabled","disabled");var e=$('#profile .content-panel > *[data-to-slide="personal"]');e.find(".button-group").removeClass("two-button").addClass("one-button"),e.find("button.btn-dismiss").addClass("hide")})},process:function(t,e){console.log(t),$("#ajax-loader").fadeIn(200),setTimeout(function(){$("#ajax-loader").delay(500).fadeOut(300,function(){var t=[];"function"==typeof e&&e(t)})},1e3)}},delivery:{del:function(t){this.process.del(t,function(e){var o=$("ul.creditcard-list li").length;console.log("Address removed"),$('ul.delivery-list li[data-address-id="'+t+'"]').remove(),0==o&&$("<li />").appendTo("ul.delivery-list").html(lang.deliveryaddressNotFound).addClass("notfound").fadeIn(200);var a=$("ul.delivery-list");$("#slider-content .owl-height").css("height",a.outerHeight())})},process:{del:function(t,e){$("#ajax-loader").fadeIn(200),setTimeout(function(){$("#ajax-loader").delay(500).fadeOut(300,function(){$('button[data-to-slide="personal"]').attr("disabled","disabled");var t=[];"function"==typeof e&&e(t)})},1e3)}}}};var e={init:function(){var t=this;$('#checkout .content-panel .bottom button[type="submit"]').on("click",function(t){var e=$(this).data("to-form");if("dev"==settings.env&&console.log("Click bottom button with target form "+e),e&&0!=$(e).length){var o=$(e);return o.trigger("submit"),o.closest(".step1").find(".form-status").remove(),!1}}),$('#checkout .content-panel .bottom button[type="dismiss"]').on("click",function(e){return t.goToStep(8),!1}),$('#checkout-step button[data-toggle="gotostep"]').on("click",function(){var e=$(this).data("to-step");t.goToStep(e)}),app.checkout.loadLastStep()||app.checkout.goToStep(1)},step:{1:{loaded:!1,load:function(){var t=$("#checkout-auth");this.validateForm(t),t.find("input").on("keyup",function(){$(this).removeClass("error").parent().removeClass("has-error"),$(this).next("i.fa").remove(),t.closest(".step1").find(".form-status").remove()}),this.loaded=!0},init:function(){},validateForm:function(t){var e=this;jQuery.validator.addMethod("regexp",function(t,e,o){var a=new RegExp(o);return this.optional(e)||a.test(t)},"Please check your input."),t.validate({onfocusout:!1,onkeyup:!1,onclick:!1,focusInvalid:!1,submitHandler:function(){return e.registrationSubmitHandler(t),!1},rules:{name:{required:!0,minlength:3,regexp:"^[А-яA-zёЁs-]{3,}$"},phone:{required:!0,minlength:5,regexp:"^\\+[0-9\\+\\-()s]{14,16}$"},email:{required:!0,email:!0}},messages:{name:{required:"Поле обязательно для заполнения",minlength:"Имя не может быть менее 3 символов",regexp:"Имя указано не верно"},phone:{required:"Поле обязательно для заполнения",minlength:"Телефон не может сожержать менее 5 символов",regexp:"Телефон указан не верно"},email:"Введите корректный адрес"},showErrors:function(e,o){return o.length<1?(t.removeClass("has-error"),t.find("input").removeClass("error").parent().removeClass("has-error"),void t.find("i.fa").remove()):void $.each(o,function(e,o){t.find('input[name="'+o.element.name+'"]').next("i.fa").remove(),t.find('input[name="'+o.element.name+'"]').addClass("error").parent().addClass("has-error"),t.addClass("has-error"),t.find('input[name="'+o.element.name+'"]').after('<i class="fa fa-exclamation-triangle tooltip" data-toggle="tooltip" title="'+o.message+'"></i>')})}})},registrationProcess:function(t,e){console.log("[REGISTRATION] Send form data to server:"),console.log(t),setTimeout(function(){var t={message:"Неверно указан номер",status:!0};"function"==typeof e&&e(t)},2e3)},registrationSubmitHandler:function(t){$('button[data-to-form="#'+t.attr("id")+'"]').hide();var e=t.serializeArray(),o=t.closest(".step1");t.css("opacity",0),ajaxloader.local({element:t,to:".step1",title:lang.processPhoneCheck}),this.registrationProcess(e,function(e){if(1!=e.status){var a=$("<div />").addClass("table form-status").css("width",o.outerWidth()).css("height",o.outerHeight()).append('<div class="cell middle"><span class="error">'+e.message+"</span></div>");o.prepend(a),ajaxloader.finish(),t.find('input[name="phone"]').parent().addClass("has-error"),setTimeout(function(){a.css("background-color","transparent"),a.find("span").addClass("inline"),a.transition({y:-250,complete:function(){a.css("z-index",0),t.fadeTo(200,1),$('button[data-to-form="#'+t.attr("id")+'"]').fadeIn(200)}})},700)}else app.checkout.goToStep(2)})}},2:{loaded:!1,load:function(){var t=$("#checkout-auth-confirm-phone"),e=this;t.find("input").on("keyup",function(){t.closest(".step2").find(".form-status").remove(),$('button[data-to-form="#'+t.attr("id")+'"]').removeAttr("disabled").removeClass("btn-bordered").addClass("btn-primary")}),t.on("submit",function(){return e.confirmSubmitHander($(this)),!1}),this.loaded=!0},init:function(){countDown({time:settings.timeoutResendConfirmPhoneCode,display:$("#timein span"),showMinutes:!0,afterFinish:function(){$("#timein").fadeOut(200,function(){$("#timeout").fadeIn(200)})}})},confirmProcess:function(t,e){console.log("[CONFIRM] Send form data to server:"),console.log(t),setTimeout(function(){var t={message:"Неверный код",status:!0};"function"==typeof e&&e(t)},2e3)},confirmSubmitHander:function(t){$('button[data-to-form="#'+t.attr("id")+'"]').hide();var e=t.serializeArray(),o=t.closest(".step2");t.css("opacity",0),ajaxloader.local({element:t,to:".step2",title:lang.processConfirmCheck}),this.confirmProcess(e,function(e){if(1!=e.status){var a=$("<div />").addClass("table form-status").css("width",o.outerWidth()).css("height",o.outerHeight()).append('<div class="cell middle"><span class="error">'+e.message+"</span></div>");o.prepend(a),ajaxloader.finish(),t.find('input[name="phone"]').parent().addClass("has-error"),setTimeout(function(){a.css("background-color","transparent"),a.find("span").addClass("inline"),a.transition({y:-150,complete:function(){a.css("z-index",0),t.fadeTo(200,1),$('button[data-to-form="#'+t.attr("id")+'"]').fadeIn(200)}})},700)}else app.checkout.goToStep(8)})}},3:{loaded:!1,map:null,map_created:!1,load:function(){$("#map").height($("#checkout .content-panel").height()),ymaps.ready(this.loadMap),this.loadKladr();var t=this;$("#delivery-address-form").on("submit",function(){return t.deliverySubmitHandler($(this)),!1}),this.loaded=!0},init:function(){},deliveryProcess:function(t,e){console.log("[DELIVERY ADDRESS] Send form data to server:"),console.log(t),setTimeout(function(){var t={status:!0};"function"==typeof e&&e(t)},500)},deliverySubmitHandler:function(t){var e=t.serializeArray(),o=t.serializeObject();t.closest(".step3");this.deliveryProcess(e,function(t){1!=t.status?console.log("Change address error"):(app.checkout.delivery.address=o,$(document).trigger("raketa.checkout.update"),app.checkout.goToStep(8))})},loadMap:function(){if(!this.map_created){this.map_created=!0,this.map=new ymaps.Map("map",{center:[59.9382558321876,30.308662213671802],zoom:12,controls:[]}),ZoomLayout=ymaps.templateLayoutFactory.createClass("<div><div id='zoom-in' class='map-btn zoom-in'></div><div id='zoom-out' class='map-btn zoom-out'></div></div>",{build:function(){ZoomLayout.superclass.build.call(this),this.zoomInCallback=ymaps.util.bind(this.zoomIn,this),this.zoomOutCallback=ymaps.util.bind(this.zoomOut,this),$("#zoom-in").bind("click",this.zoomInCallback),$("#zoom-out").bind("click",this.zoomOutCallback)},clear:function(){$("#zoom-in").unbind("click",this.zoomInCallback),$("#zoom-out").unbind("click",this.zoomOutCallback),ZoomLayout.superclass.clear.call(this)},zoomIn:function(){var t=this.getData().control.getMap();this.events.fire("zoomchange",{oldZoom:t.getZoom(),newZoom:t.getZoom()+1})},zoomOut:function(){var t=this.getData().control.getMap();this.events.fire("zoomchange",{oldZoom:t.getZoom(),newZoom:t.getZoom()-1})}}),zoomControl=new ymaps.control.ZoomControl({options:{layout:ZoomLayout}}),map.controls.add(zoomControl,{position:{left:10,bottom:180}});var t=ymaps.templateLayoutFactory.createClass("<div><div id='geolocation' class='map-btn geo'></div></div>",{build:function(){t.superclass.build.call(this),this.geolocation=ymaps.util.bind(this.geolocation,this),this.zoomOutCallback=ymaps.util.bind(this.zoomOut,this),$("#geolocation").bind("click",this.geolocation),$("#zoom-out").bind("click",this.zoomOutCallback)},clear:function(){$("#zoom-in").unbind("click",this.zoomInCallback),$("#zoom-out").unbind("click",this.zoomOutCallback),t.superclass.clear.call(this)},geolocation:function(){var t=this.getData().control.getMap();this.events.fire("zoomchange",{oldZoom:t.getZoom(),newZoom:t.getZoom()+1})}}),e=new ymaps.control.GeolocationControl({options:{}});map.controls.add(e,{position:{left:10,bottom:144}})}},loadKladr:function(){function t(t,e){e=e.charAt(0).toUpperCase()+e.substr(1).toLowerCase(),t.parent().find("label").text(e)}function e(){var t=4,e=$.kladr.getAddress(a,function(e){var o="";return $.each(e,function(e,a){var n="",i="";if("object"===$.type(a))switch(n=a.name,i=a.type+" ",a.contentType){case $.kladr.type.region:t=4;break;case $.kladr.type.district:t=7;break;case $.kladr.type.city:t=10;break;case $.kladr.type.street:t=13;break;case $.kladr.type.building:t=16}else n=a;o&&(o+=", "),o+=i+n}),o});if(e&&this.map_created){var o=ymaps.geocode(e);o.then(function(e){this.map.geoObjects.each(function(t){map.geoObjects.remove(t)});var o=e.geoObjects.get(0).geometry.getCoordinates(),a=new ymaps.Placemark(o,{},{});this.map.geoObjects.add(a),this.map.setCenter(o,t)})}}function o(){var t=$.kladr.getAddress(a);a.find('input[name="fulladdress"]').val(t)}var a=$("#delivery-address-form");a.find("input").on("keyup",function(){$(this).val()?$('button[data-to-form="#'+a.attr("id")+'"]').removeAttr("disabled").removeClass("white"):$('button[data-to-form="#'+a.attr("id")+'"]').attr("disabled","disabled").addClass("white")});var n=a.find('[name="region"]'),i=a.find('[name="district"]'),s=a.find('[name="city"]'),d=a.find('[name="street"]'),r=a.find('[name="building"]');$().add(n).add(i).add(s).add(d).add(r).kladr({parentInput:".kladr-form",verify:!0,spinner:!1,labelFormat:function(t,e){var o="",a=t.name.toLowerCase();e=e.name.toLowerCase();var n=a.indexOf(e);if(n=n>0?n:0,t.typeShort&&(o+=t.typeShort+". "),e.length<t.name.length?(o+=t.name.substr(0,n),o+="<strong>"+t.name.substr(n,e.length)+"</strong>",o+=t.name.substr(n+e.length,t.name.length-e.length-n)):o+="<strong>"+t.name+"</strong>",t.parents)for(var i=t.parents.length-1;i>-1;i--){var s=t.parents[i];s.name&&(o&&(o+="<small>, </small>"),o+="<small>"+s.name+" "+s.typeShort+".</small>")}return o},change:function(a){a&&t($(this),a.type),o(),e()},openBefore:function(){},checkBefore:function(){var t=$(this);return $.trim(t.val())?void 0:(o(),e(),!1)}}),d.kladr({labelFormat:function(t,e){var o="",a=t.name.toLowerCase();e=e.name.toLowerCase();var n=a.indexOf(e);if(n=n>0?n:0,t.typeShort&&(o+=t.typeShort+". "),e.length<t.name.length?(o+=t.name.substr(0,n),o+="<strong>"+t.name.substr(n,e.length)+"</strong>",o+=t.name.substr(n+e.length,t.name.length-e.length-n)):o+="<strong>"+t.name+"</strong>",t.parents)for(var i=t.parents.length-1;i>-1;i--){var s=t.parents[i];s.name&&"city"==s.contentType&&(o&&(o+="<small>, </small>"),o+="<small>"+s.typeShort+". "+s.name+"</small>")}return o}}),n.kladr("type",$.kladr.type.region),i.kladr("type",$.kladr.type.district),s.kladr("type",$.kladr.type.city),d.kladr("type",$.kladr.type.street),r.kladr("type",$.kladr.type.building),$.kladr.setValues({region:78e11,city:78e11},".kladr-form"),s.kladr("withParents",!0),d.kladr("withParents",!0),r.kladr("verify",!1)}},4:{loaded:!1,load:function(){var t=$("#who-delivery-product"),e=this.getUserList();t.find('select[name="who"]').selectize({allowEmptyOption:!1,create:!1,plugins:{dropdown_footer:{title:"Мы можем доставить цветы вам,\u2028или поздравить кого-нибудь от вас"}}}),t.find('select[name="reason"]').selectize({allowEmptyOption:!1,create:!1,plugins:{dropdown_footer:{title:'Вы можете изменить или добавить новые поводы <a href="reasons.html">здесь</a>'}}}),e.done(function(e){console.log("Get user list"),console.log(e),t.find('select[name="fromme_to_name"]').selectize({allowEmptyOption:!1,valueField:"id",labelField:"name",searchField:["name","phone"],options:e,addPrecedence:"Добавить",render:{item:function(t,e){return"<div>"+(t.name?'<span class="name">'+e(t.name)+"</span>":"")},option:function(t,e){var o=t.name||t.phone,a=t.name?t.phone:null;return'<div><span class="label">'+e(o)+"</span>"+(a?' <span class="caption">'+e(a)+"</span>":"")+"</div>"}},onChange:function(e){var o=this.$dropdown_content.find('[data-value="'+e+'"]'),a=o.find(".caption").text();t.find('input[type="tel"]').val(a)},plugins:{dropdown_footer:{title:"Если вы еще никого не поздравляли от своего имени, просто укажите имя получателя"}},create:!0})}),t.find('select[name="who"]').on("change",function(e){"fromme"==$(this).val()?(t.find(".fromme .raketa-select").css("width",t.width()),t.find(".fromme").removeClass("hide").hide().slideDown(150)):t.find(".fromme").slideUp(200).addClass("hide")}),t.find("select").on("change",function(){$('button[data-to-form="#'+t.attr("id")+'"]').removeClass("btn-bordered").addClass("btn-primary").removeAttr("disabled")});var o=this;t.on("submit",function(){var e=$(this).serializeObject(),a={};return $.each(e,function(e,o){"csrf"!=e&&(a[e]={index:e,value:o,textValue:t.find('[name="'+e+'"] option[value="'+o+'"]').text()})}),app.checkout["for"]=a,o.submitHandler($(this)),!1}),this.loaded=!0},init:function(){$("#checkout-step").parent().removeClass("middle")},close:function(){$("#checkout-step").parent().addClass("middle")},getUserList:function(){return $.Deferred(function(){var t=this,e=[];setTimeout(function(){e=[{id:1,name:"Екатерина",phone:"+7(956)000-0011"},{id:2,name:"Мария",phone:"+7(956)111-0022"},{id:3,name:"Иван",phone:"+7(956)222-0033"}],t.resolve(e)},2e3)})},submitProcess:function(t,e){console.log("[FOR DELIVERY] Send form data to server:"),console.log(t),setTimeout(function(){var t={status:!0};"function"==typeof e&&e(t)},2e3)},submitHandler:function(t){$('button[data-to-form="#'+t.attr("id")+'"]').closest(".bottom").removeClass("show");var e=t.serializeArray(),o=app.checkout.getCurrentStep();o.closest(".content-panel").addClass("middle"),t.hide(),console.log(o),ajaxloader.local({element:t,to:".step4",title:lang.processSave}),this.submitProcess(e,function(e){ajaxloader.finish(),t.show(),o.closest(".content-panel").removeClass("middle"),$('button[data-to-form="#'+t.attr("id")+'"]').closest(".bottom").addClass("show"),1==e.status&&($(document).trigger("raketa.checkout.update"),app.checkout.goToStep(8))})}},5:{loaded:!1,init:function(){}},6:{loaded:!1,init:function(){}},7:{loaded:!1,init:function(){}},8:{loaded:!1,load:function(){var t=this;$(document).on("raketa.checkout.update",function(){t.updateHtml()}),$('button[type="checkout"]').on("click",function(){return ajaxloader.local({element:$("#result"),to:".step8",title:lang.loading}),$(this).hide(),app.checkout.save(function(t){ajaxloader.finish(),1==t.status&&(window.location=t.paymentUrl),$(this).show()}),!1}),this.loaded=!0},init:function(){app.checkout.basket.length&&app.checkout.delivery.address&&app.checkout.delivery.timeofday&&app.checkout.delivery.date&&app.checkout["for"]?$('button[type="checkout"]').removeAttr("disabled"):$('button[type="checkout"]').attr("disabled","disabled"),this.updateHtml()},updateHtml:function(){var t=$("#result");if(app.checkout["for"]){var e=app.checkout["for"];if("me"!=e.who.value){var o=e.fromme_to_name.textValue,a=e.fromme_to_phone.value,n=e.reason.textValue;t.find("li.who span").html(o+"<br><b>"+a+",</b> <i>"+n+"</i>")}else t.find("li.who span").html(app.checkout["for"].who.textValue);console.log(app.checkout["for"])}if(app.checkout.delivery.address){var i=app.checkout.delivery.address.fulladdress,s=i.split(",");console.log(app.checkout.delivery.address);var d=[s[2],s[3]?s[3]:app.checkout.delivery.address.building,app.checkout.delivery.address.apartment?"кв "+app.checkout.delivery.address.apartment:""];t.find("li.address span").html(d.join(", ")).parent().removeClass("empty")}else t.find("li.address span").html("Адрес").parent().addClass("empty");if(app.checkout.delivery.date&&app.checkout.delivery.timeofday){var r=app.checkout.delivery.date;r=moment(r,"DD.MM.YYYY").format("D MMMM");var l=lang[app.checkout.delivery.timeofday];t.find("li.delivery-date span").html(l+" "+r)}}}},loadLastStep:function(){var t=Cookies.get("reketa_checkout__step");return t?(this.goToStep(t),!0):!1},getCurrentStep:function(){return this.currentStep},goToStep:function(t){Cookies.set("reketa_checkout__step",t,{expires:365,path:"/"});var e=$("#checkout-step"),o=e.find(".step.active");o.length?this.currentStep=o:this.currentStep=$('#checkout-step .step[data-step="'+t+'"]');var a=o.data("step")?o.data("step"):t;o.trigger("close"),this.step[a]&&this.step[a].close&&this.step[a].close(),o.removeClass("active"),"dev"==settings.env&&console.log("[STEP] Go to checkout step #"+t),e.find(".step.step"+t).addClass("active").trigger("open"),e.parent().find(".bottom[data-to-step]").removeClass("show"),e.parent().find('.bottom[data-to-step="step'+t+'"]').addClass("show"),this.step[t]&&!this.step[t].loaded&&"function"==typeof this.step[t].load&&this.step[t].load(),this.step[t]&&this.step[t].loaded&&"function"==typeof this.step[t].init&&this.step[t].init()}};$.extend(app.checkout,e),t.scroll(function(){app.scroll()}),t.resize(function(){app.resize()}),app.init()}),Hash={get:function(){var t,e,o,a={};if(this.oldbrowser())o=decodeURIComponent(window.location.hash.substr(1)),e="/";else{var n=window.location.href.indexOf("?");o=-1!=n?decodeURIComponent(window.location.href.substr(n+1)):"",e="&"}if(0==o.length)return a;o=o.split(e);for(var i in o)o.hasOwnProperty(i)&&(t=o[i].split("="),"undefined"==typeof t[1]?a.anchor=t[0]:a[t[0]]=t[1]);return a},set:function(t){var e="";for(var o in t)t.hasOwnProperty(o)&&(e+="&"+o+"="+t[o]);this.oldbrowser()?window.location.hash=e.substr(1):(0!=e.length&&(e="?"+e.substr(1)),window.history.pushState(e,document.title,document.location.pathname+e))},add:function(t,e){var o=this.get();o[t]=e,this.set(o)},remove:function(t){var e=this.get();delete e[t],this.set(e)},clear:function(){this.set({})},oldbrowser:function(){return!(window.history&&history.pushState)}},String.template=function(){for(var t=arguments[0],e=1;e<arguments.length;e++)t=t.replace(RegExp("\\{"+e+"\\}","gm"),arguments[e]);return t},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Object.size=function(t){var e,o=0;for(e in t)t.hasOwnProperty(e)&&o++;return o},Number.prototype.format=function(t,e,o,a){var n="\\d(?=(\\d{"+(e||3)+"})+"+(t>0?"\\D":"$")+")",i=this.toFixed(Math.max(0,~~t));return(a?i.replace(".",a):i).replace(new RegExp(n,"g"),"$&"+(o||","))},function(t,e){t.fn.serializeObject=function(){var o={};return t.each(this.serializeArray(),function(a,n){var i=n.name,s=n.value;o[i]=o[i]===e?s:t.isArray(o[i])?o[i].concat(s):[o[i],s]}),o}}(jQuery);
//# sourceMappingURL=app.min.js.map
