function getImageLightness(e){var t=$.Deferred(),o=document.createElement("img");o.src=e,o.style.display="none",document.body.appendChild(o);var a=0;return o.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var o=e.getContext("2d");o.drawImage(this,0,0);for(var i,n,s,d,r=o.getImageData(0,0,e.width,e.height),l=r.data,c=0,p=l.length;p>c;c+=4)i=l[c],n=l[c+1],s=l[c+2],d=Math.floor((i+n+s)/3),a+=d;var u=Math.floor(a/(this.width*this.height));t.resolve(u),this.remove()},o.onerror=function(){console.log("Error loading image: "+e),t.fail()},t.promise()}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function countDown(e){function t(){n=o-((Date.now()-r)/1e3|0),s=n/60|0,d=n%60|0,s=10>s?"0"+s:s,d=10>d?"0"+d:d,a&&i?a.text(s+":"+d):a&&a.text((0!=s?s+":":"")+d),0>=n&&(clearInterval(l),"function"==typeof e.afterFinish&&e.afterFinish())}var o=e.time,a=e.display,i=e.showMinutes;if(o){var n,s,d,r=Date.now();t();var l=setInterval(t,1e3)}}function getNumEnding(e,t){var o,a;if(e%=100,e>=11&&19>=e)o=t[2];else switch(a=e%10){case 1:o=t[0];break;case 2:case 3:case 4:o=t[1];break;default:o=t[2]}return o}function is_iOS(){for(var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];e.length;)if(navigator.platform===e.pop())return!0;return!1}var lang={basketProductAddError:"Произошла ошибка. Товар не может быть добавлен в корзину.",basketProductAddSuccess:"Товар успешно добавлен в корзину.",basketProductClear:"Корзина очищена",basketProductClearError:"Произошла ошибка при очистке корзины. Обновите страницу и попробуйте снова.",basketRequestDelete:"Вы уверены что хотите удалить товар из корзины?",buttonTextInBasket:"В корзине",product:"товар",currencySymbol:"&#x20bd;",DeliveryDate:"Дата доставки",DeliveryFormattedString:"Доставка на {1} {2}",morning:"Утро",afternoon:"День",evening:"Вечер",creditcardquestdelete:'Вы уверены что хотите удалить карту "{1}"?',creditcardNotFound:"У вас не привязано ни одной карты",dialogChangePhoneAlert:"Изменение телефонного номера привяжет вашу историю заказов к новому номеру",dialogEditButton:"Редактировать",dialogDismissButton:"Отмена",dialogDeleteButton:"Удалить",dialogCloseButton:"Закрыть",deliveryaddressrequestdelete:'Вы уверены что хотите удалить адрес доставки "{1}"?',deliveryaddressNotFound:"У вас не привязано ни одного адреса доставки. Чтобы привязать адрес вам необходимо создать любой заказ",processCallbackTitle:"Заказ<br>звонка",processPhoneCheck:"Проверка<br>номера телефона",processConfirmCheck:"Проверка<br>кода",processSave:"Сохранение данных",processAuthorization:"Пожалуйста<br>подождите",loading:"Ожидайте",bouquet:"Букет",bouquetNotFound:"Доступных букетов не найдено",bouquetInBasketPopupCart:"В корзине {1} на {2}",reasonquestdelete:"Вы уверены что хотите удалить повод?",cardNotApprovedStatus:"Карта которую вы выбрали не активна. Выберите другую карту.",soldout:"Полностью распродано",soldoutModalTitle:"Букет продан",soldoutModalMessage:"Данный букет был продан. Выберите другой букет."},app,ajaxloader,settings,device={};$(function(){var e=$(window);settings={env:"dev",loadBouquets:6,imageBouquetsBrightnessThreshold:110,timeoutResendConfirmPhoneCode:60},datetimePicker={format:"d.m.Y",value:0,timepicker:!1,inline:!0,todayButton:!1,prevButton:!1,nextButton:!1,scrollMonth:!1,dayOfWeekStart:1,yearStart:"2016",defaultSelect:!1,yearEnd:"2020",minDate:new Date,maxDate:new Date(+new Date+12096e5),onChangeDateTime:function(e,t){var o=t.closest(".widget").length?t.closest(".widget"):t.closest(".product-cart");o.find('button[type="submit"]').removeAttr("disabled"),o.find('input[name="timeofday"]').removeAttr("disabled"),o.find('button[data-toggle="clear-date"]').removeAttr("disabled"),$("#selectedDate").html(app.widgets.calendar.getDateString()),$('input[name="date"].datetime-picker').datetimepicker({value:e}),void 0===app.checkout.delivery||"smallmobile"!=device.type&&"mobile"!=device.type||o.find(".warning").hide().removeClass("hidden").show().addClass("opened")},onGenerate:function(e){var t=$(this).find(".xdsoft_calendar"),o=0;$.each(t.find("tbody tr"),function(e,t){var a=0,i=$(t),n=0;if($.each(i.find("td"),function(e,t){$(t).hasClass("xdsoft_disabled")&&a++,n=$(t).data("month")}),7==a)i.hide();else if(o!=n){var s=$("<div/>").addClass("month").html(moment(n+1,"MM").format("MMM"));i.before(s),o=n}}),$('button[data-target="#widget-calendar"]').length>0&&0==app.widgets.calendar.calendarInitialized&&$(document).trigger("init.xdsoft")}},app={init:function(){moment.locale("ru"),$.datetimepicker.setLocale("ru"),app.device.getInfo(),app.layout.initStyle(),app.content.initStyle(),app.bind.document(),app.bind.forms(),app.bind.buttons(),app.sidebar.init(),app.widgets.load(),app.checkout.load()},device:{getInfo:function(){var t=$("body"),o=e.height(),a=e.width();a>o?(device.orientation="landscape",t.hasClass("portrait")?t.removeClass("portrait").addClass("landscape"):t.addClass("landscape")):(device.orientation="portrait",t.hasClass("landscape")?t.removeClass("landscape").addClass("portrait"):t.addClass("portrait")),a>=1441&&(device.type="desktop",device.subtype="fullhd"),a>=1281&&1440>=a&&(device.type="desktop",device.subtype="hd"),a>=1024&&1280>=a&&(device.type="desktop",device.subtype="small"),a>=768&&1023>=a&&(device.type="planshet"),768>a&&(device.type="mobile"),320>a&&(device.type="smallmobile"),device.windowHeight=o,device.windowWidth=a,"dev"==settings.env&&(console.log("[DEVICE] Get device data"),console.log(device))}},resize:function(){"dev"==settings.env&&console.log("[APP] Window size is changed"),app.popup.isOpened()&&app.popup.hide(),app.device.getInfo(),app.sidebar.initStyle(),app.content.initStyle(),app.layout.initStyle(),app.widgets.calendar&&app.widgets.calendar.loaded&&app.widgets.calendar.setPosition()},scroll:function(){this.scrollPos=$(document).scrollTop(),this.savedScrollPos=this.scrollPos},bind:{document:function(){$(document).ready(function(){$('input[type="tel"]').mask("+7(999)999-9999"),$('input[name="phone"]').mask("+7(999)999-9999")}),$(document).keyup(function(e){27==e.keyCode&&app.popup.isOpened()&&app.popup.hide()}),$("body").swipe({swipeRight:function(e,t,o,a,i,n){"dev"==settings.env&&console.log("TouchSwipe Right Event");var s=$(e.target);console.log("desktop"==device.type&&"small"==device.subtype||"desktop"!=device.type),("desktop"==device.type&&"small"==device.subtype||"desktop"!=device.type)&&(console.log(s),console.log(!s.is("body")),console.log(0==s.closest('div[class^="owl-item"]').length),console.log(0==s.closest('div[class^="modal"]').length&&!s.hasClass("modal")),s.is("body")||0!=s.closest('div[class^="owl-item"]').length||0!=s.closest('div[class^="modal"]').length||s.hasClass("modal")||app.popup.show("#sidebar"))},swipeLeft:function(e,t,o,a,i){"dev"==settings.env&&console.log("TouchSwipe Left Event"),app.sidebar.isOpened()&&app.popup.hide()},allowPageScroll:"vertical",preventDefaultEvents:!1}),$(".tooltip").tooltipster({animation:"grow"}),$(document).on("click tap",'*[data-toggle="popup"]',function(e){e.stopPropagation();var t=$(this).data("status");if(0==t)return app.modal.dialog({title:lang.soldoutModalTitle,content:lang.soldoutModalMessage,buttons:{no:{title:lang.dialogCloseButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog (default)] Not confirmed"),app.modal.lastConfirmed=!1}}}}),!1;var o=$(this).data("order")?$(this).data("order"):!1;app.popup.show($(this).data("target"),o)}),$(document).on("click tap","#popup-bg",function(){console.log("popup bg click"),app.popup.hide()}),$(document).on("click tap","button.popup-close",function(e){console.log(e),app.popup.hide()}),$(document).on("click tap","button.modal-close",function(e){console.log(e),$.magnificPopup&&$.magnificPopup.close()}),$(document).on("click tap",'button[data-toggle="to-basket"]',function(e){e.preventDefault(),e.stopPropagation(),0!=$(this).data("status")&&app.basket.add(e)}),$(document).on("click tap",'button[data-toggle="clear-basket"]',function(e){app.basket.clear()}),$(document).on("click tap",'button[data-toggle="remove-from-basket"]',function(e){var t=$(this).data("product-id");t&&app.basket.removeProductFromBasket(t,function(){app.widgets.productcart&&app.widgets.productcart.openedObj&&app.popup.isOpened()&&app.widgets.productcart.step("cart")})})},forms:function(){},buttons:function(){$('button[data-toggle="modal"]').on("click tap",function(){$.magnificPopup.open({type:"inline",items:{src:$(this).data("target")},removalDelay:500,showCloseBtn:!1,callbacks:{beforeOpen:function(){this.st.mainClass="mfp-zoom-in"}},midClick:!0})}),$('button[data-toggle="dialog"]').on("click tap",function(){console.log("Dialog init");var e=$(this).data("title")?$(this).data("title"):"",t=$(this).data("content")?$(this).data("content"):"";app.modal.dialog({title:e,content:t,buttons:{yes:{title:"ОК","class":"edit",action:function(){"dev"==settings.env&&console.log("[Dialog (default)] Confirmed"),app.modal.lastConfirmed=!0}},no:{title:lang.dialogCloseButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog (default)] Not confirmed"),app.modal.lastConfirmed=!1}}}})})}},sidebar:{opened:!1,isOpened:function(){return this.opened},init:function(){var e,t=this;this.sidebarObj=e=$("#sidebar"),e.on("open",function(){t.open()}),e.on("close",function(){t.close()}),$('button[data-toggle="close-sidebar"]').on("click tap",function(){$(this).addClass("closing"),$(this).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(e){}),$(this).hasClass("closing")&&$(this).removeClass("closing"),app.sidebar.close()}),this.initStyle(),$(document).on("raketa.bouquets.loaded",function(){var t=0,o=$("#bouquet-list");"dev"==settings.env&&console.log("[SIDEBAR] Bouquets new loaded check style sidebar"),o.length&&o.outerHeight()+$("#header").height()<device.windowHeight-e.find(".sidebar-bottom").height()?(console.log(t),t=device.windowHeight-o.height()-o.offset().top-e.find(".sidebar-bottom").height(),e.find(".sidebar-bottom").css({bottom:t})):e.find(".sidebar-bottom").css({bottom:0})})},initStyle:function(){var t=this.sidebarObj;"desktop"!=device.type||"hd"!=device.subtype&&"fullhd"!=device.subtype?t.addClass("collapsed"):t.removeClass("collapsed");var o=t.find(".sidebar-top").outerHeight()+t.find(".sidebar-bottom").height(),a=e.height()<o?"relative":"absolute",i=(e.height()<o?"absolute":"fixed",0),n=$("#bouquet-list");device.windowHeight>1e3&&n.length>0&&n.find("li").length>0&&n.outerHeight()+$("#header").height()<device.windowHeight-t.find(".sidebar-bottom").height()?(i=device.windowHeight-n.height()-n.offset().top-t.find(".sidebar-bottom").height(),t.find(".sidebar-bottom").css({bottom:i})):t.find(".sidebar-bottom").css({bottom:0}),t.find(".sidebar-bottom").css({position:a})},open:function(){"dev"==settings.env&&console.log("[SIDEBAR] Open navbar");var e=$("#sidebar");try{e.addClass("open")}catch(t){console.log("Popup open error: "+t)}e.find(".popup-close").hide().delay(200).fadeIn(200,function(){$(this).addClass("closing")}),e.find(".popup-close").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(e){$(this).hasClass("closing")&&$(this).removeClass("closing")}),this.opened=!0},close:function(){"dev"==settings.env&&console.log("[SIDEBAR] Close navbar");var e=$("#sidebar");e.removeClass("open"),e.find(".popup-close").addClass("closing"),e.find(".popup-close").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(e){$(this).hasClass("closing")&&$(this).removeClass("closing")}),$('button[data-toggle="sidebar"]').removeClass("opened"),this.opened=!1}},popup:{isOpened:function(){return!(!this.opened||!this.opened.length)},show:function(e,t){if(!this.isOpened()||t){var e=$(e);if(!t){var o=e.css("z-index");$("<div />").appendTo("#wrapper").attr("id","popup-bg").addClass(e.hasClass("product-cart")?"gray":"default").css("z-index",--o).fadeIn(200),$("body").css("overflow","hidden").on("touchmove",function(e){e.preventDefault()})}e.trigger("open"),$(document).trigger("popup-show"),this.opened=e,this.initialized=!0}},hide:function(){console.log("Hide popup"),this.opened&&(this.opened.trigger("close"),$("#popup-bg").fadeOut(200,function(){$(this).remove()}),$("body").css("overflow","auto").off("touchmove"),delete this.opened,$(document).trigger("popup-close"))}},modal:{lastConfirmed:!1,dialog:function(e){this.lastConfirmed=!1;var t=e.buttons,o="dialog_"+guid(),a="",i="";e.id=o,0===e.content.indexOf("#")&&(e.content=$(e.content).html()),$.each(t,function(e,t){t["class"]||(t["class"]=""),a+='<button class="'+t["class"]+'">'+(t.title?t.title:e)+"</button>\n",t.action||(t.action=function(){})}),e.buttons=a;try{i=tmpl(document.getElementById("tmpl-dialog").innerHTML,e);var n=$(i).appendTo("body");"function"==typeof e.afterRender&&e.afterRender(n);var s=$("#"+o+" button"),d=0;$.magnificPopup.open({items:{src:"#"+o},showCloseBtn:!1,removalDelay:500,mainClass:"mfp-zoom-in",callbacks:{close:function(){$("#"+o).remove(),"dev"==settings.env&&console.log("Popup is completely closed")}},type:"inline"}),$.each(t,function(t,a){s.eq(d++).on("click",function(){if("form"==e.type){var t=$("#"+o).find("form");a.beforeAction&&"function"==typeof a.beforeAction?(t.on("submit",function(){return a.beforeAction(t)&&(a.action($(this)),$.magnificPopup.close()),!1}),t.trigger("submit")):$.magnificPopup.close()}else a.action(),$.magnificPopup.close();return!1})})}catch(r){console.log("Template dialog rendering and open failed",r)}}},content:{initStyle:function(){"smallmobile"!=device.type&&"mobile"!=device.type&&$("#content").css("min-height",e.height()-$("#header").height()+"px")}},bouquets:{data:[],get:function(e){$("#ajax-loader").fadeIn(200);var t={start:0,to:null,limit:settings.loadBouquets,type:"json",after:function(e){}};this.options=$.extend({},t,e);var o=this;setTimeout(function(){var e;app.bouquets.data=e=bouquetsList,o.options.after.call(o,e),app.bouquets.buildListHtml(bouquetsList),$("#ajax-loader").delay(500).fadeOut(300,function(){})},1e3)},buildListHtml:function(e){var t=$("#bouquet-list");if("dev"==settings.env&&console.log("[FLOWERS] Load flowers"),!e||$.isEmptyObject(e)){var o=$("<div />").hide().addClass("not-found").html(lang.bouquetNotFound);return $("#content").append(o),o.fadeIn(),void console.log("[FLOWERS] Data is empty")}$("#content > .not-found").remove();var a=0;$.each(e,function(e,o){var i=$("<li />").attr("data-bouquet-id",o.id);getImageLightness(o.imgSrc).done(function(e){"dev"==settings.env&&console.log("[IMAGE => LIGHNESS] Bouquet #"+o.id);var a="dark";e>settings.imageBouquetsBrightnessThreshold&&(a="light"),"dev"==settings.env&&console.log(" -> Bouquet #"+o.id+": "+o.imgSrc+": "+e+"("+a+")"),t.find('li[data-bouquet-id="'+o.id+'"] > div.bouquet').addClass(a),t.find('li[data-bouquet-id="'+o.id+'"] > div.product-cart').addClass(a),t.find('li[data-bouquet-id="'+o.id+'"] > div.product-cart').data("lightness",a).attr("data-lightness",a)}),i.append(app.bouquets.render("tmpl-bouquet-list-item",o)),i.append(app.bouquets.render("tmpl-bouquet-list-item-popup",o)),"soldout"==o.status&&t.append($("<li />").addClass("soldout-group").html(lang.soldout)),t.append(i),a++}),t.find(".bouquet").each(function(e){$(this).delay(100*e).fadeIn(300,function(){e==a-1&&$(document).trigger("raketa.bouquets.loaded")})})},render:function(e,t){var o="";try{return o=tmpl(document.getElementById(e).innerHTML,t)}catch(a){console.log("Template rendering failed",a)}}},basket:{store:[],get:function(){},add:function(e){var t=$(e.currentTarget),o=t.data("product-id"),a=$('#bouquet-list li[data-bouquet-id="'+o+'"]');if("dev"==settings.env&&console.log("[BASKET] Add product with ID #"+o+" to basket"),!a.length)throw Error("Невозможно найти DOM объект товара");t.addClass("added"),t.find("span.icon").html(lang.buttonTextInBasket),"dev"==settings.env&&console.log("[BASKET] [ID #"+o+"] Get product details");var i=app.bouquets.data.filter(function(e){return e.id==o})[0];if(0==i.length)throw Error("Невозможно найти товар c id "+o);i.count=1;var n=$.map(app.checkout.basket,function(e,t){return e.id==i.id?t:void 0});n.length>0?("dev"==settings.env&&console.log("Find in basket product with the same ID"),app.checkout.basket[n[0]].count+=i.count,i.count=app.checkout.basket[n[0]].count):app.checkout.basket.push(i),this.saveBasket(),this.updateHtml(),app.widgets.productcart&&app.widgets.productcart.openedObj&&app.popup.isOpened()&&($.isEmptyObject(app.checkout.delivery)?app.widgets.productcart.step("delivaryDate"):app.widgets.productcart.step("orderInfo"))},clear:function(){this.destroyBasket()&&(app.widgets.productcart&&app.widgets.productcart.openedObj&&app.popup.isOpened()&&app.popup.hide(),this.updateHtml())},destroyBasket:function(){return this.store=[],!0},saveBasket:function(){JSON.stringify(app.checkout.basket);console.log("SAVE data basket"),console.log(app.checkout.basket)},updateHtml:function(){var e=$("#header a.basket");e.addClass("notempty").html("<span>"+app.checkout.basket.length+"</span>")},productInBasket:function(e){var t=$.map(app.checkout.basket,function(t,o){return t.id==e?o:void 0});return t.length>0?t:!1},getProductFromBasket:function(e){var t=$.map(app.checkout.basket,function(t,o){return t.id==e?o:void 0});return t.length>0?app.checkout.basket[t]:!1},removeProductFromBasket:function(e,t){var o=$.map(app.checkout.basket,function(t,o){return t.id==e?o:void 0});if(o.length>0)try{console.log(o),app.checkout.basket.splice(o[0],1),"function"==typeof t&&t(),app.basket.saveBasket(),app.basket.updateHtml()}catch(a){console.error("Failed to delete product from basket with error: "+a)}}},reasons:{},checkout:{basket:[],delivery:{},load:function(){this.basket.length&&!$.isEmptyObject(this.delivery)||(this.getBasketData(),this.getDeliveryDate())},getBasketData:function(){return this.basket.length?void 0:$.Deferred(function(){var e=this;console.log("Get basket from session or cookies"),setTimeout(function(){var t=[{id:5,count:3,imgSrc:"img/b2.jpg",price:2800,name:"Черничный пирог",availableData:"с 28 октября",label:"autumn",size:{dia:"60 см",height:"30 см"},composition:"Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента",info:"Диаметр: 60см<br>Высота: 30см<hr><p>Роза свитнесс, Гербера мини, Салал, Эвкалипт Бэби Блю, Хлопок, Лента</p>"}];app.checkout.basket=t,app.basket.updateHtml(),$(document).trigger("raketa.basket.get-data"),e.resolve()},500)})},getDeliveryDate:function(){var e=Cookies.get("raketa_delivary__date"),t=Cookies.get("raketa_delivary__timeofday");if(e&&(this.delivery.date=e),t&&(this.delivery.timeofday=t),e&&t){var o=new Date;o=moment(o).format("YYYY-MM-DD");var a=moment(e,"DD.MM.YYYY").format("YYYY-MM-DD");if(moment(a).isBefore(o))delete app.checkout.delivery,Cookies.remove("raketa_delivary__date",{path:"/"}),Cookies.remove("raketa_delivary__timeofday",{path:"/"});else if(app.widgets.calendar&&app.widgets.calendar.loaded){var i=$("#widget-calendar");$('.radio-group input[name="timeofday"]').removeAttr("disabled"),$('.radio-group input[name="timeofday"]:checked').attr("checked",!1),$('.radio-group input[value="'+t+'"]').attr("checked",!0),$('input[name="date"].datetime-picker').datetimepicker({value:e}),i.find('button[type="submit"]').removeAttr("disabled"),i.find('button[data-toggle="clear-date"]').removeAttr("disabled"),$("#selectedDate").html(app.widgets.calendar.getDateString());var n=$('button[data-target="#widget-calendar"]');n.data("label-to")&&(n=$(n.data("label-to"))),n.html(app.widgets.calendar.getDateString())}}},save:function(e){console.log("[FOR DELIVERY] Send form data to server:");({basket:this.basket,delivery:this.delivery,"for":this["for"]});setTimeout(function(){var t={status:!0,paymentUrl:"order_success.html"};"function"==typeof e&&e(t)},2e3)}},widgets:{load:function(){$.each(this,function(e,t){if("load"!==e)try{t.load()}catch(o){console.error("Error loading widget @"+e+" with error: "+o)}})},calendar:{obj:{},loaded:!1,opened:!1,calendarInitialized:!1,position:{},setPosition:function(){var e=$('button[data-target="#widget-calendar"]'),t=$("#widget-calendar");if(e.length){var o=t.width(),a=t.height(),i=e.offset(),n=device.windowWidth-(i.left+e.outerWidth())-20;"smallmobile"==device.type||"mobile"==device.type?(t.css("top","auto"),t.css("bottom",-(a+40)+"px")):(t.css("top",-(a+40)+"px"),t.css("right",Math.floor(n)+"px")),this.position.width=o,this.position.height=a,"smallmobile"==device.type||"mobile"==device.type?this.position.bottom=0:this.position.top=-a,this.position.right=-n}},localInit:function(e){this.obj=e},load:function(){this.obj=$("#widget-calendar");var e=$('button[data-target="#widget-calendar"]'),t=this;$('input[name="date"].datetime-picker').each(function(){$(this).datetimepicker(datetimePicker)}),$(document).on("raketa.bouquets.loaded",function(){$('input[name="date"].datetime-picker').each(function(){$(this).datetimepicker("destroy")}),$('input[name="date"].datetime-picker').each(function(){$(this).datetimepicker(datetimePicker)})}),$(document).on("click tap",'button[data-toggle="setDelivaryDate"]',function(e){e.stopPropagation();var o=$(this).data("to-form"),a=$(o);return t.process(a),1==$(this).data("hide")&&app.popup.hide(),app.widgets.productcart&&app.widgets.productcart.openedObj&&app.popup.isOpened()&&app.widgets.productcart.step("orderInfo"),!1}),$(document).on("change",'input[name="timeofday"]',function(){t.obj&&t.obj.hasClass("widget")&&($("#selectedDate").html(t.getDateString()),void 0!==e.data("thischange")&&1!=e.data("thischange")||(void 0!==app.checkout.delivery?e.html(t.getDateString()):e.html(lang.DeliveryDate)))}),$(document).on("click tap",'button[data-toggle="clear-date"]',function(e){$(this).attr("disabled","disabled"),t.clearDate($(this))}),$(document).on("open","#widget-calendar",function(){t.open()}),$(document).on("close","#widget-calendar",function(){t.close()}),$(document).on("init.xdsoft",function(){t.setPosition(),t.calendarInitialized=!0}),$("#widget-calendar form").on("submit",function(e){return!1}),this.loaded=!0},getDateString:function(){var e=lang.DeliveryFormattedString,t=this.obj.find('input[name="timeofday"]:checked').val(),o=this.obj.find('input[name="date"]').val();return o=o?moment(o,"DD.MM.YYYY").format("D MMMM"):"",e=String.template(e,lang[t]?lang[t]:"",o),e=e.toLowerCase().capitalizeFirstLetter()},clearDate:function(e){var t=e.closest("form");t.find(".xdsoft_current").removeClass("xdsoft_current"),t.find('input[name="date"].delivery-date').val(new Date),t[0].reset(),$("#selectedDate").html(lang.DeliveryDate);var o=$('button[data-target="#widget-calendar"]');o.data("thischange")||o.html(lang.DeliveryDate),$('button[data-toggle="setDelivaryDate"]').attr("disabled","disabled"),t.find('input[name="timeofday"]:checked').attr("checked",!1),t.find('input[name="timeofday"]').attr("disabled","disabled"),delete app.checkout.delivery,Cookies.remove("raketa_delivary__date",{path:"/"}),Cookies.remove("raketa_delivary__timeofday",{path:"/"}),app.popup.hide()},open:function(){this.obj=$("#widget-calendar"),"dev"==settings.env&&console.log("[WIDGET] Open widget @calendar"),$.isEmptyObject(app.checkout.delivery)&&this.obj.find(".xdsoft_current").removeClass("xdsoft_current"),this.obj.addClass("animation");var e=this.obj.height()+40;"smallmobile"!=device.type&&"mobile"!=device.type||(e=-this.obj.height()-40),this.obj.transition({y:Math.floor(e)});var t=this;this.obj.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(e){t.obj.removeClass("animation").addClass("opened")}),t.opened=!0},close:function(){"dev"==settings.env&&console.log("[WIDGET] Close widget @calendar"),this.obj.removeClass("opened").addClass("animation");var e=this.position.top;"smallmobile"!=device.type&&"mobile"!=device.type||(e=this.position.bottom),this.obj.find(".warning").removeClass("opened"),this.obj.transition({y:e,complete:function(){this.opened=!1}})},process:function(e){var t=$('button[data-target="#widget-calendar"]'),o=e.serializeObject();app.checkout.delivery=o,t.data("label-to")&&(t=$(t.data("label-to"))),void 0!==app.checkout.delivery?t.html(this.getDateString()):t.html(lang.DeliveryDate),console.log(o),Cookies.set("raketa_delivary__date",o.date,{expire:14,path:"/"}),Cookies.set("raketa_delivary__timeofday",o.timeofday,{expire:14,path:"/"})}},productcart:{loaded:!1,startPosition:{},startTitle:"",hashProcess:function(){var e=$.Deferred(function(){var e=this;$(document).on("raketa.bouquets.loaded",function(){e.resolve()})}),t=$.Deferred(function(){var e=this;$(document).on("raketa.basket.get-data",function(){e.resolve()})});$.when(t,e).then(function(){var e,t=Hash.get();t.anchor?window.location.hash=t.anchor:t.bouquet&&(e=$('#bouquet-list li[data-bouquet-id="'+t.bouquet+'"] > div[data-toggle="popup"]')),e&&e.trigger("click")})},load:function(){this.obj=$(".product-cart");var e=this;this.hashProcess(),$(document).on("open",".product-cart",function(t){e.open(t)}),$(document).on("close",".product-cart",function(){e.close()}),$(document).on("click tap",'.product-cart button[data-toggle="show-product-info"]',function(){var e=$(this).data("product-id");$(this).toggleClass("active"),"light"==$("#popup-product-"+e).data("lightness")&&$("#popup-product-"+e).toggleClass("light"),$("#popup-product-"+e+" .product-info").fadeToggle(300,function(){})}),$(document).on("click tap",".product-cart button.direction",function(t){var o=$(this).data("direction");"dev"==settings.env&&console.log("[WIDGET] @productcart - change current cart ("+o+")");index=e.openedObj.closest("li[data-bouquet-id]").index();switch(console.log("Opened index element "+index),o){case"prev":index=index-1<0?$("#bouquet-list li:last-child").index():index-1;break;case"next":index=index+1>$("#bouquet-list li").length-1?0:index+1}e.close();var a=$("#bouquet-list li").eq(index);setTimeout(function(){a.find('div[data-toggle="popup"]').data("order",!0).trigger("click")},300)}),$(document).on("raketa.bouquets.loaded",function(){var e=$(".product-cart").find(".gallery-list"),t=$(".product-cart").width(),o=$(".product-cart").height();if(e.length>0){if("smallmobile"!=device.type&&"mobile"!=device.type)e.css("height",o),e.find(".owl-lazy").css("height",o),e.find(".owl-height").css("height",o),e.find(".owl-lazy").css("width",t/2),e.css("width",t/2);else{var a=$("#header").height();e.css("height",device.windowHeight-a),e.find(".owl-lazy").css("height",device.windowHeight-a),e.find(".owl-height").css("height",device.windowHeight-a),e.find(".owl-lazy").css("width",t),e.css("width",t)}var i={items:1,margin:0,lazyLoad:!0,loop:!0,autoplay:!0,autoplayTimeout:4e3,autoplayHoverPause:!0};"dev"==settings.env&&console.log("[WIDGET] @productcart Found gallery in product cart"),e.on("initialized.owl.carousel",function(e){var t=$(e.target),o=e.item.index;t.find(".owl-item").eq(o).find(".item")}),e.find(".owl-lazy").on("click tap",function(){e.trigger("next.owl.carousel")}),e.owlCarousel(i)}}),"smallmobile"!=device.type&&"mobile"!=device.type||$('button[data-toggle="close-widget"]').on("click tap",function(e){app.popup.hide()}),this.loaded=!0},open:function(e){var t=$(e.target);"dev"==settings.env&&console.log("[WIDGET] Open widget @productcart with id #"+t.attr("id")),$('#bouquet-list li[data-bouquet-id="'+t.data("product-id")+'"] > div[data-toggle="popup"]').data("order",!1),"smallmobile"!=device.type&&"mobile"!=device.type||($('#header button[data-target="#widget-calendar"]').slideUp(200),t.css("height",device.windowHeight-$("#header").height()),$("#header button.navbar-toggle").hide(),$("#header button.mobile.back").show());var o=t.height(),a=t.width();t.find(".bottom").hide(),"smallmobile"==device.type||"mobile"==device.type?(t.css("top","auto"),t.css("bottom",-o).css("visibility","visible"),this.startPosition.bottom=0):(t.css("top",-o).css("visibility","visible"),this.startPosition.top=-o);app.basket.productInBasket(t.data("product-id"))&&!$.isEmptyObject(app.checkout.delivery)?("dev"==settings.env&&console.log("[WIDGET] @productcart go to step 3"),"smallmobile"!=device.type&&"mobile"!=device.type||t.find(".gallery").css("opacity",.2),this.loadStep3(t,app.basket.productInBasket(t.data("product-id")))):app.basket.productInBasket(t.data("product-id"))&&$.isEmptyObject(app.checkout.delivery)&&("dev"==settings.env&&console.log("[WIDGET] @productcart go to step 2"),app.widgets.calendar.localInit(t.find(".step2")),$.isEmptyObject(app.checkout.delivery)&&t.find(".xdsoft_current").removeClass("xdsoft_current"),"smallmobile"!=device.type&&"mobile"!=device.type||t.find(".gallery").css("opacity",.2),t.find(".step").hide().removeClass("active"),t.find(".step2").addClass("active").show());var a=t.outerWidth();t.css("margin-left",Math.ceil(-a/2)),t.addClass("transition"),"desktop"!=device.type||"fullhd"!=device.subtype&&"hd"!=device.subtype?"smallmobile"==device.type||"mobile"==device.type?t.transition({y:Math.floor(-o)}):t.transition({y:Math.floor(o+$("#header").height())}):t.transition({y:Math.floor(device.windowHeight-(device.windowHeight-o)/2)}),t.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(e){t.removeClass("transition").addClass("opened"),t.find(".bottom button:first-child").focus(),t.find(".bottom").fadeIn(200)}),this.startTitle=document.title,document.title=lang.bouquet+" "+t.data("title"),Hash.add("bouquet",t.data("product-id")),this.openedObj=t},close:function(){var e=this.openedObj;"dev"==settings.env&&console.log("[WIDGET] Close widget @productcart"),"smallmobile"!=device.type&&"mobile"!=device.type||e.find(".gallery").css("opacity",1),"smallmobile"!=device.type&&"mobile"!=device.type||($('#header button[data-target="#widget-calendar"]').slideDown(200),$("#content .mobile.notify").removeClass("open"),$('#header button[data-toggle="close-widget"]').hide(),$("#header button.navbar-toggle").show()),e.removeClass("opened").addClass("animation");var t=this.startPosition.top;"smallmobile"!=device.type&&"mobile"!=device.type||(t=this.startPosition.bottom),e.transition({y:t}),window.location.hash="",history.pushState("",document.title,window.location.pathname),document.title=this.startTitle,delete this.openedObj},step:function(e){if(e){"dev"==settings.env&&console.log("[WIDGET] @productcart go to step - "+e);var t=this.openedObj;switch(e){case"cart":t.find(".step.active").fadeOut("fast",function(){$(this).removeClass("active"),t.find(".step.step1").fadeIn("fast").addClass("active")}),"smallmobile"!=device.type&&"mobile"!=device.type||t.find(".gallery").css("opacity",1);break;case"delivaryDate":t.find(".step.active").fadeOut("fast",function(){$(this).removeClass("active"),t.find(".step.step2").fadeIn("fast").addClass("active")}),"smallmobile"!=device.type&&"mobile"!=device.type||t.find(".gallery").css("opacity",.2);break;case"orderInfo":this.loadStep3(t,app.basket.productInBasket(t.data("product-id"))),"smallmobile"!=device.type&&"mobile"!=device.type||t.find(".gallery").css("opacity",.2)}}},loadStep3:function(e,t){e.find(".step").hide().removeClass("active"),e.find(".step3").addClass("active").show(),$("#content .mobile.notify").addClass("open");var o=app.basket.getProductFromBasket(e.data("product-id")),a=lang.bouquetInBasketPopupCart,i=o.count+" "+lang.bouquet+getNumEnding(o.count,["","а","ов"]),n=o.count*o.price;n>1e4&&(n=n.format(0,3," ",".")),a=String.template(a,i.toLowerCase(),n+lang.currencySymbol),$("#in-basket-product-"+e.data("product-id")).html('<span class="icon-basket"></span> '+a),$("#p"+e.data("product-id")+"-count").val(o.count),$('[data-trigger="spinner"]').spinner("max",99).spinner("changing",function(a,i,n){$(this).attr("name");if(!(0>i)){app.checkout.basket[t[0]].count=i;var s=lang.bouquetInBasketPopupCart,d=i+" "+lang.bouquet+getNumEnding(o.count,["","а","ов"]),r=i*o.price;r>1e4&&(r=r.format(0,3," ",".")),s=String.template(s,d.toLowerCase(),r+lang.currencySymbol),
$("#in-basket-product-"+e.data("product-id")).html('<span class="icon-basket"></span> '+s),app.basket.saveBasket()}})}}},layout:{currentLayout:{},initStyle:function(){$.isEmptyObject(this.currentLayout)||("dev"==settings.env&&console.log("Set layout("+this.currentLayout.name+") template style"),this.setStyleLayout(this.currentLayout.name,this.currentLayout.container))},init:function(e,t){e||(e=$("div[data-layout]"));var o=e.data("layout");return o?(this.currentLayout.name=o,this.currentLayout.container=e,this.currentLayout.callback=t,"dev"==settings.env&&console.log("Initialize layout("+o+")"),void this.loadLayout(o,e,t)):void console.error("Layout attribute not found")},setStyleLayout:function(t,o){var a=(o.outerHeight(),Math.ceil(e.height()-$("#header").outerHeight()-50));if("smallmobile"!=device.type&&"mobile"!=device.type||(a+=50),"smallmobile"==device.type||"mobile"==device.type){var i=o.find(".content-panel *:visible"),n=0,s=!1;switch(i.each(function(){$(this).is("div.step")&&(n+=$(this).height()),$(this).is("div.bottom.show")&&(n+=$(this).height()),$(this).is("div#slider-content")&&(s=!0)}),t){case"devided-slider":o.find(".menu-wrapper").css("height",a+"px"),o.find(".content-panel").css("height",a+"px"),o.find(".owl-item").css("height",a+"px");break;case"devided":o.not(".authorization").find(".menu-wrapper").css("min-height",a+"px"),o.not(".checkout.checkout-basket").find(".content-panel").css("min-height",a+"px")}o.css("min-height",a+"px")}else o.css("height",a+"px")},loadLayout:function(e,t,o){switch(e){case"devided-slider":"smallmobile"!=device.type&&"mobile"!=device.type||$(".layout-menu li.active").removeClass("active");var a=$("#content").width(),i=$("#slider-content");"smallmobile"!=device.type&&"mobile"!=device.type&&i.css("width",a/2),i.on("initialized.owl.carousel",function(e){var o=$(e.target),a=e.item.index,i=o.find(".owl-item").eq(a).find(".item"),n=i.data("hash");"smallmobile"!=device.type&&"mobile"!=device.type&&(t.find(".layout-menu li.active").removeClass("active"),t.find('.layout-menu a[href="#'+n+'"]').parent().addClass("active")),"dev"==settings.env&&console.log("[OWL Carousel] Event initialized.owl.carousel"),t.find(".content-panel > .bottom").hide(),t.find('.content-panel > .bottom[data-to-slide="'+n+'"]').fadeIn(200)}),i.on("changed.owl.carousel",function(e){var o=$(e.target),a=e.item.index,i=o.find(".owl-item").eq(a).find(".item"),n=i.data("hash");if("smallmobile"!=device.type&&"mobile"!=device.type||!n)t.find(".layout-menu li.active").removeClass("active"),t.find('.layout-menu a[href="#'+n+'"]').parent().addClass("active");else{var s=t.find('.layout-menu li a[href="#'+n+'"]').text();$("#header .mobile.title").html(s)}n&&(window.location.hash=n),"dev"==settings.env&&console.log("[OWL Carousel] Event changed.owl.carousel #"+n),t.find(".content-panel > .bottom").hide(),t.find('.content-panel > .bottom[data-to-slide="'+n+'"]').fadeIn(300)});var n={items:1,URLhashListener:!0,startPosition:"URLHash",smartSpeed:450,animateOut:"fadeOut",animateIn:"fadeIn",afterInit:function(e){}};if("smallmobile"!=device.type&&"mobile"!=device.type&&(n.autoHeight=!0),i.owlCarousel(n),i.find("button,input,select").addClass("not-draggable").on("touchstart mousedown",function(e){e.stopPropagation()}),i.parent().find('button[type="submit"]').on("click",function(){var e=i.find('.item[data-hash="'+$(this).data("to-slide")+'"]');e.find("form").trigger("submit")}),this.setStyleLayout(e,t),"smallmobile"==device.type||"mobile"==device.type){var s=window.location.hash;if(s){t.find(".content-panel").fadeIn(200),$(".layout.devided-slider .menu-wrapper").transition({x:-device.windowWidth,complete:function(){$(window).scrollTop(0)}}),$("#header .navbar-toggle").hide(),$("#header .back").show();var d=$('#content ul.layout-menu a[href="'+s+'"]').text();$("#header .mobile.title").html(d)}$('button[data-toggle="devided-slider-back"]').on("click tap",function(e){$(this).hide(),$("#header .navbar-toggle").show(),$("#header .mobile.title").html($("title").text()),window.location.hash="",$(".layout.devided-slider .menu-wrapper").transition({x:0,complete:function(){$(window).scrollTop(0),t.find(".content-panel").hide()}}),t.find("input").blur(),t.find("textarea").blur()})}$("#content ul.layout-menu a").on("click",function(e){if($(this).parent().hasClass("active")||($(this).parents(".layout-menu").find("li.active").removeClass("active"),$(this).parent().addClass("active")),"smallmobile"==device.type||"mobile"==device.type){$(".layout.devided-slider .menu-wrapper").transition({x:-device.windowWidth,complete:function(){}}),t.find(".content-panel").show(),$("#header .navbar-toggle").hide(),$("#header .back").show();var o=$(this).text();$("#header .mobile.title").html(o)}});break;case"default":this.setStyleLayout(e,t);break;case"devided":("smallmobile"==device.type||"mobile"==device.type&&t.hasClass("reasons")||t.hasClass("promocodes"))&&$('button[data-toggle="devided-slider-back"]').on("click tap",function(e){Hash.clear(),t.find(".menu-wrapper").show(),t.find(".menu-wrapper").transition({x:0,complete:function(){$(window).scrollTop(0)}}),t.find("input").blur(),t.find("textarea").blur(),$("#header .back").hide(),$("#header .mobile.title").html($("title").text()),$("#header .navbar-toggle").show()}),this.setStyleLayout(e,t)}"function"==typeof o&&o(t)}},callback:{order:function(e){$('button[data-to-form="#'+e.attr("id")+'"]').hide();var t=e.serializeArray();ajaxloader.local({element:e,to:'.item[data-hash="callback"]',title:lang.processPhoneCheck}),this.process(t,function(t){ajaxloader.finish(),e.hide(),$("#slider-content .owl-height").css("height",$("#support").height()),$("#callback-order-success").css("height",$("#support").height()).fadeIn(200),countDown({time:10,display:$("#callback-order-success .timer"),afterFinish:function(){$("#callback-order-success").fadeOut(200,function(){e[0].reset(),e.fadeIn(200),$("#slider-content .owl-height").css("height",e.outerHeght()),$('button[data-to-form="#'+e.attr("id")+'"]').show()})}})})},process:function(e,t){setTimeout(function(){var e=[];"function"==typeof t&&t(e)},2e3)}},auth:{init:function(){var e=$("#auth-form");this.validateForm(e),e.find("input").on("keyup",function(){$(this).removeClass("error").parent().removeClass("has-error"),$(this).next("i.fa").remove()}),e.closest(".content-panel").find('.bottom button[type="submit"]').on("click",function(e){var t=$(this).data("to-form");if("dev"==settings.env&&console.log("Click bottom button with target form "+t),t&&0!=$(t).length){var o=$(t);return o.trigger("submit"),o.closest(".static").find(".form-status").remove(),!1}})},validateForm:function(e){var t=this;jQuery.validator.addMethod("regexp",function(e,t,o){var a=new RegExp(o);return this.optional(t)||a.test(e)},"Please check your input."),e.validate({onfocusout:!1,onkeyup:!1,onclick:!1,focusInvalid:!1,submitHandler:function(){return t.authorizationSubmitHandler(e),!1},rules:{name:{required:!0,minlength:3,regexp:"^[А-яA-zёЁs-]{3,}$"},phone:{required:!0,minlength:5,regexp:"^\\+[0-9\\+\\-()s]{14,16}$"},email:{required:!0,email:!0}},messages:{name:{required:"Поле обязательно для заполнения",minlength:"Имя не может быть менее 3 символов",regexp:"Имя указано не верно"},phone:{required:"Поле обязательно для заполнения",minlength:"Телефон не может сожержать менее 5 символов",regexp:"Телефон указан не верно"},email:"Введите корректный адрес"},showErrors:function(t,o){return o.length<1?(e.removeClass("has-error"),e.find("input").removeClass("error").parent().removeClass("has-error"),void e.find("i.fa").remove()):void $.each(o,function(t,o){e.find('input[name="'+o.element.name+'"]').next("i.fa").remove(),e.find('input[name="'+o.element.name+'"]').addClass("error").parent().addClass("has-error"),e.addClass("has-error"),e.find('input[name="'+o.element.name+'"]').after('<i class="fa fa-exclamation-triangle tooltip" data-toggle="tooltip" title="'+o.message+'"></i>')})}})},authorizationProcess:function(e,t){console.log("[AUTHORIZATION] Send form data to server:"),console.log(e),setTimeout(function(){var e={message:"Неверно указан номер",status:!1};"function"==typeof t&&t(e)},1500)},authorizationSubmitHandler:function(e){$('button[data-to-form="#'+e.attr("id")+'"]').hide();var t=e.serializeArray(),o=e.closest(".static");e.css("opacity",0),ajaxloader.local({element:e,to:".static",title:lang.processAuthorization}),this.authorizationProcess(t,function(t){if(1!=t.status){var a=$("<div />").addClass("table form-status").css("width",o.outerWidth()).css("height",o.outerHeight()).append('<div class="cell middle"><span class="error">'+t.message+"</span></div>");o.prepend(a),ajaxloader.finish(),e.find('input[name="phone"]').parent().addClass("has-error"),setTimeout(function(){a.css("background-color","transparent"),a.find("span").addClass("inline"),a.transition({y:-250,complete:function(){a.css("z-index",0),e.fadeTo(200,1),$('button[data-to-form="#'+e.attr("id")+'"]').fadeIn(200)}})},700)}else window.location="/"})}}},ajaxloader={local:function(e){if(e.element){var t=e.element,o=$("<div />").addClass("ajax-loader-local").css("width",t.outerWidth()).css("height",t.outerHeight());if(e.title&&e.title.length>0){var a=$("<div />").addClass("title").html(e.title);o.append(a)}if(e.image&&e.image.length>0){var i=$("<img />").addClass("image").attr("src",e.image);o.append(i)}else{var n=$("<div />").addClass("icon").attr("src",e.image);o.append(n)}if(e.to&&""!=e.to){var s=t.closest(e.to);o.css("width",s.outerWidth()).css("height",s.outerHeight()),s.prepend(o)}else t.prepend(o);o.fadeIn(200),this.ajaxloader=o}},finish:function(e){if(this.ajaxloader){var t=this;this.ajaxloader.fadeOut(200,function(){t.ajaxloader.remove(),"function"==typeof e&&e()})}}},app.profile={init:function(){this.bind()},bind:function(){$("#edit-personal-data").submit(function(e){return console.log(e),e.preventDefault(),app.profile.personal.save($(this)),!1}),$('#edit-personal-data input[type="text"]').on("keydown",function(e){$('button[data-to-slide="personal"]').removeAttr("disabled");var t=$('#profile .content-panel > *[data-to-slide="personal"]');t.find(".button-group").removeClass("one-button").addClass("two-button"),t.find("button.btn-dismiss").removeClass("hide")}),$("body").on("click",'button[type="dismiss"]',function(e){e.preventDefault();var t=$("#edit-personal-data");t[0].reset();var o=$('#profile .content-panel > *[data-to-slide="personal"]');o.find(".button-group").removeClass("two-button").addClass("one-button"),o.find("button.btn-dismiss").addClass("hide");var a=t.find('input[name="phone"]');a.attr("disabled","disabled"),a.parent().addClass("disabled"),a.parents(".form-group").find("button.edit-phone").hide()}),$("body").on("click",'button[type="delete-card"]',function(e){e.preventDefault();var t=$(this).parents("li[data-card-id]").data("card-id"),o=$(this).parents("div.creditcard").find(".creditcard-name").html(),a=String.template(lang.creditcardquestdelete,o);t?app.modal.dialog({content:a,buttons:{yes:{title:lang.dialogDeleteButton,"class":"delete",action:function(){"dev"==settings.env&&console.log("[Dialog] Confirmed"),app.profile.creditcard.del(t)}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog] Not confirmed")}}}}):console.error("Not found creditcard id")}),$('button[type="add-card"]').on("click",function(e){e.preventDefault();var t=$(this).data("title")?$(this).data("title"):"",o=$(this).data("content")?$(this).data("content"):"";app.modal.dialog({title:t,content:o,type:"form",popupClass:"add-card-popup",afterRender:function(e){e.find("#cardnumber").validateCreditCard(function(e){return $(this).removeClass(),null!=e.card_type?($(this).addClass(e.card_type.name),$(this).closest("form").find('input[name="cardtype"]').val(e.card_type.name),e.valid?$(this).addClass("valid"):$(this).removeClass("valid")):void 0},{accept:["visa","visa_electron","mastercard","maestro"]}),e.find("#cardholder").keypress(function(e){e.which>=65&&e.which<=90||e.which>=97&&e.which<=122||32==e.which||e.preventDefault()})},buttons:{yes:{title:"Добавить","class":"edit",beforeAction:function(e){var t=!0;e.serializeArray();return e.find("input").each(function(){$(this).val()||(t=!1,console.log("Поле "+$(this).attr("name")+" не заполнено"))}),t},action:function(e){"dev"==settings.env&&console.log("[Dialog (add credit card)] Confirmed"),app.profile.creditcard.add(e)}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog (add credit card)] Not confirmed")}}}})}),$("body").on("click",'button[type="delete-address"]',function(e){console.log(e);var t=$(this).parents("li[data-address-id]").data("address-id"),o=$(this).prev().html(),a=String.template(lang.deliveryaddressrequestdelete,o);t?app.modal.dialog({content:a,buttons:{yes:{title:lang.dialogDeleteButton,"class":"delete",action:function(){"dev"==settings.env&&console.log("[Dialog] Confirmed"),app.profile.delivery.del(t)}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog] Not confirmed")}}}}):console.error("Not found delivery address id")}),$('button[data-toggle="edit-phone"]').on("click",function(){app.modal.dialog({content:lang.dialogChangePhoneAlert,buttons:{yes:{title:lang.dialogEditButton,"class":"edit",action:function(){"dev"==settings.env&&console.log("[Dialog] Confirmed");var e=$('#slider-content input[name="phone"]');e.removeAttr("disabled"),e.parent().removeClass("disabled"),e.parents(".form-group").find("button.edit-phone").hide()}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog] Not confirmed")}}}})}),$(".creditcard .tooltip").tooltipster("option","position","left"),$(".creditcard .tooltip").tooltipster("option","arrow",!0)},creditcard:{obj:{},add:function(e){try{var t=e.serializeObject(),o="card_"+guid(),a={cardname:t.cardname,cardtype:t.cardtype,cardnumber:t.cardnumber.substr(-4)},i=tmpl(document.getElementById("tmpl-creditcard").innerHTML,a),n=$("<li />").append(i).attr("data-card-id",o).hide(),s=$("ul.creditcard-list");s.find("li.notfound").length&&s.find("li.notfound").remove(),n.find(".creditcard .tooltip").tooltipster({animation:"grow",position:"left"}),s.append(n),this.process.add(function(e){$("#slider-content .owl-height").css("height",s.outerHeight()+n.height()),$('ul.creditcard-list li[data-card-id="'+o+'"]').fadeIn(300,"easeOutQuad",function(){$(this).data("card-id",e.newId).attr("data-card-id",newId)})})}catch(d){console.log("Creditcard add failed",d)}},del:function(e){"dev"==settings.env&&console.log("Remove card with id #"+e),this.process.del(function(t){var o=$("ul.creditcard-list li").length;$('ul.creditcard-list li[data-card-id="'+e+'"]').slideUp(300,"easeOutQuad",function(){$(this).remove(),0==o&&$("<li />").appendTo("ul.creditcard-list").html(lang.creditcardNotFound).addClass("notfound").fadeIn(200);var e=$("ul.creditcard-list");$("#slider-content .owl-height").css("height",e.outerHeight())})})},process:{del:function(e){$("#ajax-loader").fadeIn(200),setTimeout(function(){$("#ajax-loader").delay(500).fadeOut(300,function(){var t=[];"function"==typeof e&&e(t)})},1e3)},add:function(e){$("#ajax-loader").fadeIn(200),setTimeout(function(){$("#ajax-loader").delay(500).fadeOut(300,function(){var t={newId:4};"function"==typeof e&&e(t)})},1e3)}}},personal:{save:function(e){"dev"==settings.env&&console.log("Save personal data");var t=e.serializeArray();this.process(t,function(e){console.log("Personal data saved"),$('button[data-to-slide="personal"]').attr("disabled","disabled");var t=$('#profile .content-panel > *[data-to-slide="personal"]');t.find(".button-group").removeClass("two-button").addClass("one-button"),t.find("button.btn-dismiss").addClass("hide")})},process:function(e,t){console.log(e),$("#ajax-loader").fadeIn(200),setTimeout(function(){$("#ajax-loader").delay(500).fadeOut(300,function(){var e=[];"function"==typeof t&&t(e)})},1e3)}},delivery:{del:function(e){this.process.del(e,function(t){var o=$("ul.creditcard-list li").length;console.log("Address removed"),$('ul.delivery-list li[data-address-id="'+e+'"]').remove(),0==o&&$("<li />").appendTo("ul.delivery-list").html(lang.deliveryaddressNotFound).addClass("notfound").fadeIn(200);var a=$("ul.delivery-list");$("#slider-content .owl-height").css("height",a.outerHeight())})},process:{del:function(e,t){$("#ajax-loader").fadeIn(200),setTimeout(function(){$("#ajax-loader").delay(500).fadeOut(300,function(){$('button[data-to-slide="personal"]').attr("disabled","disabled");var e=[];"function"==typeof t&&t(e)})},1e3)}}}};var t={init:function(){var e=this;$('#checkout .content-panel .bottom button[type="submit"]').on("click",function(e){var t=$(this).data("to-form");if("dev"==settings.env&&console.log("Click bottom button with target form "+t),t&&0!=$(t).length){var o=$(t);return o.trigger("submit"),o.closest(".step1").find(".form-status").remove(),!1}}),$('#checkout .content-panel .bottom button[type="dismiss"]').on("click",function(t){return e.goToStep(8),!1}),$('#checkout-step button[data-toggle="gotostep"]').on("click",function(){var t=$(this).data("to-step");t&&e.goToStep(t)}),"smallmobile"!=device.type&&"mobile"!=device.type||($("#checkout-step #result ul > li").on("click",function(t){var o=$(t.target);if(!o.is("button")){var a=$(this).find('button[data-toggle="gotostep"]').data("to-step");a?e.goToStep(a):app.popup.show("#widget-calendar",!1)}}),$('button[data-toggle="devided-slider-back"]').on("click",function(){e.goToStep(8)})),app.checkout.loadLastStep()||app.checkout.goToStep(1)},step:{1:{loaded:!1,load:function(){var e=$("#checkout-auth");this.validateForm(e),e.find("input").on("keyup",function(){$(this).removeClass("error").parent().removeClass("has-error"),$(this).next("i.fa").remove(),e.closest(".step1").find(".form-status").remove()}),this.loaded=!0},init:function(){},validateForm:function(e){var t=this;jQuery.validator.addMethod("regexp",function(e,t,o){var a=new RegExp(o);return this.optional(t)||a.test(e)},"Please check your input."),e.validate({onfocusout:!1,onkeyup:!1,onclick:!1,focusInvalid:!1,submitHandler:function(){return t.registrationSubmitHandler(e),!1},rules:{name:{required:!0,minlength:3,regexp:"^[А-яA-zёЁs-]{3,}$"},phone:{required:!0,minlength:5,regexp:"^\\+[0-9\\+\\-()s]{14,16}$"},email:{required:!0,email:!0}},messages:{name:{required:"Поле обязательно для заполнения",minlength:"Имя не может быть менее 3 символов",regexp:"Имя указано не верно"},phone:{required:"Поле обязательно для заполнения",minlength:"Телефон не может сожержать менее 5 символов",regexp:"Телефон указан не верно"},email:"Введите корректный адрес"},showErrors:function(t,o){return o.length<1?(e.removeClass("has-error"),e.find("input").removeClass("error").parent().removeClass("has-error"),void e.find("i.fa").remove()):void $.each(o,function(t,o){e.find('input[name="'+o.element.name+'"]').next("i.fa").remove(),e.find('input[name="'+o.element.name+'"]').addClass("error").parent().addClass("has-error"),e.addClass("has-error"),e.find('input[name="'+o.element.name+'"]').after('<i class="fa fa-exclamation-triangle tooltip" data-toggle="tooltip" title="'+o.message+'"></i>')})}})},registrationProcess:function(e,t){console.log("[REGISTRATION] Send form data to server:"),console.log(e),setTimeout(function(){var e={message:"Неверно указан номер",status:!0};"function"==typeof t&&t(e)},2e3)},registrationSubmitHandler:function(e){$('button[data-to-form="#'+e.attr("id")+'"]').hide();var t=e.serializeArray(),o=e.closest(".step1");e.css("opacity",0),ajaxloader.local({element:e,to:".step1",title:lang.processPhoneCheck}),this.registrationProcess(t,function(t){if(1!=t.status){var a=$("<div />").addClass("table form-status").css("width",o.outerWidth()).css("height",o.outerHeight()).append('<div class="cell middle"><span class="error">'+t.message+"</span></div>");o.prepend(a),ajaxloader.finish(),e.find('input[name="phone"]').parent().addClass("has-error"),setTimeout(function(){a.css("background-color","transparent"),a.find("span").addClass("inline"),a.transition({y:-250,complete:function(){a.css("z-index",0),e.fadeTo(200,1),$('button[data-to-form="#'+e.attr("id")+'"]').fadeIn(200)}})},700)}else app.checkout.goToStep(2)})}},2:{loaded:!1,load:function(){var e=$("#checkout-auth-confirm-phone"),t=this;e.find("input").on("keyup",function(){e.closest(".step2").find(".form-status").remove(),$('button[data-to-form="#'+e.attr("id")+'"]').removeAttr("disabled").removeClass("btn-bordered").addClass("btn-primary")}),e.on("submit",function(){return t.confirmSubmitHander($(this)),!1}),$(document).on("click",'button[data-toggle="resendConfirmCode"]',function(){t.resendCode()}),this.loaded=!0},resendCode:function(){console.log("Resend activation code"),$("#timeout").fadeOut(200,function(){$("#timein").fadeIn(200)}),countDown({time:settings.timeoutResendConfirmPhoneCode,display:$("#timein span"),showMinutes:!0,afterFinish:function(){$("#timein").fadeOut(200,function(){$("#timeout").fadeIn(200)})}}),setTimeout(function(){},2e3)},init:function(){countDown({time:settings.timeoutResendConfirmPhoneCode,display:$("#timein span"),showMinutes:!0,afterFinish:function(){$("#timein").fadeOut(200,function(){$("#timeout").fadeIn(200)})}})},confirmProcess:function(e,t){console.log("[CONFIRM] Send form data to server:"),console.log(e),setTimeout(function(){var e={message:"Неверный код",status:!0};"function"==typeof t&&t(e)},2e3)},confirmSubmitHander:function(e){$('button[data-to-form="#'+e.attr("id")+'"]').hide();var t=e.serializeArray(),o=e.closest(".step2");e.css("opacity",0),ajaxloader.local({element:e,to:".step2",title:lang.processConfirmCheck}),this.confirmProcess(t,function(t){if(1!=t.status){var a=$("<div />").addClass("table form-status").css("width",o.outerWidth()).css("height",o.outerHeight()).append('<div class="cell middle"><span class="error">'+t.message+"</span></div>");o.prepend(a),ajaxloader.finish(),e.find('input[name="phone"]').parent().addClass("has-error"),setTimeout(function(){a.css("background-color","transparent"),a.find("span").addClass("inline"),a.transition({y:-150,complete:function(){a.css("z-index",0),e.fadeTo(200,1),$('button[data-to-form="#'+e.attr("id")+'"]').fadeIn(200)}})},700)}else app.checkout.goToStep(8)})}},3:{loaded:!1,map:null,map_created:!1,load:function(){$("#map").height($("#checkout .content-panel").height()),ymaps.ready(this.loadMap),this.loadKladr();var e=this;$("#delivery-address-form").on("submit",function(){return e.deliverySubmitHandler($(this)),!1}),this.loaded=!0},init:function(){},deliveryProcess:function(e,t){console.log("[DELIVERY ADDRESS] Send form data to server:"),console.log(e),setTimeout(function(){var e={status:!0};"function"==typeof t&&t(e)},500)},deliverySubmitHandler:function(e){var t=e.serializeArray(),o=e.serializeObject();e.closest(".step3");this.deliveryProcess(t,function(e){1!=e.status?console.log("Change address error"):(app.checkout.delivery.address=o,$(document).trigger("raketa.checkout.update"),app.checkout.goToStep(8))})},loadMap:function(){if(!this.map_created){this.map_created=!0,this.map=new ymaps.Map("map",{center:[59.9382558321876,30.308662213671802],zoom:12,controls:[]}),ZoomLayout=ymaps.templateLayoutFactory.createClass("<div><div id='zoom-in' class='map-btn zoom-in'></div><div id='zoom-out' class='map-btn zoom-out'></div></div>",{build:function(){ZoomLayout.superclass.build.call(this),this.zoomInCallback=ymaps.util.bind(this.zoomIn,this),this.zoomOutCallback=ymaps.util.bind(this.zoomOut,this),$("#zoom-in").bind("click",this.zoomInCallback),$("#zoom-out").bind("click",this.zoomOutCallback)},clear:function(){$("#zoom-in").unbind("click",this.zoomInCallback),$("#zoom-out").unbind("click",this.zoomOutCallback),ZoomLayout.superclass.clear.call(this)},zoomIn:function(){var e=this.getData().control.getMap();this.events.fire("zoomchange",{oldZoom:e.getZoom(),newZoom:e.getZoom()+1})},zoomOut:function(){var e=this.getData().control.getMap();this.events.fire("zoomchange",{oldZoom:e.getZoom(),newZoom:e.getZoom()-1})}}),zoomControl=new ymaps.control.ZoomControl({options:{layout:ZoomLayout}}),map.controls.add(zoomControl,{position:{left:10,bottom:180}});var e=ymaps.templateLayoutFactory.createClass("<div><div id='geolocation' class='map-btn geo'></div></div>",{build:function(){e.superclass.build.call(this),this.geolocation=ymaps.util.bind(this.geolocation,this),this.zoomOutCallback=ymaps.util.bind(this.zoomOut,this),$("#geolocation").bind("click",this.geolocation),$("#zoom-out").bind("click",this.zoomOutCallback)},clear:function(){$("#zoom-in").unbind("click",this.zoomInCallback),$("#zoom-out").unbind("click",this.zoomOutCallback),e.superclass.clear.call(this)},geolocation:function(){var e=this.getData().control.getMap();this.events.fire("zoomchange",{oldZoom:e.getZoom(),newZoom:e.getZoom()+1})}}),t=new ymaps.control.GeolocationControl({options:{}});map.controls.add(t,{position:{left:10,bottom:144}})}},loadKladr:function(){function e(e,t){t=t.charAt(0).toUpperCase()+t.substr(1).toLowerCase(),e.parent().find("label").text(t)}function t(){var e=4,t=$.kladr.getAddress(a,function(t){var o="";return $.each(t,function(t,a){var i="",n="";if("object"===$.type(a))switch(i=a.name,n=a.type+" ",a.contentType){case $.kladr.type.region:e=4;break;case $.kladr.type.district:e=7;break;case $.kladr.type.city:e=10;break;case $.kladr.type.street:e=13;break;case $.kladr.type.building:e=16}else i=a;o&&(o+=", "),o+=n+i}),o});if(t&&this.map_created){var o=ymaps.geocode(t);o.then(function(t){this.map.geoObjects.each(function(e){map.geoObjects.remove(e)});var o=t.geoObjects.get(0).geometry.getCoordinates(),a=new ymaps.Placemark(o,{},{});this.map.geoObjects.add(a),this.map.setCenter(o,e)})}}function o(){var e=$.kladr.getAddress(a);a.find('input[name="fulladdress"]').val(e)}var a=$("#delivery-address-form");a.find("input").on("keyup",function(){$(this).val()?$('button[data-to-form="#'+a.attr("id")+'"]').removeAttr("disabled").removeClass("white"):$('button[data-to-form="#'+a.attr("id")+'"]').attr("disabled","disabled").addClass("white")});var i=a.find('[name="region"]'),n=a.find('[name="district"]'),s=a.find('[name="city"]'),d=a.find('[name="street"]'),r=a.find('[name="building"]');$().add(i).add(n).add(s).add(d).add(r).kladr({parentInput:".kladr-form",verify:!0,spinner:!1,labelFormat:function(e,t){var o="",a=e.name.toLowerCase();t=t.name.toLowerCase();var i=a.indexOf(t);if(i=i>0?i:0,e.typeShort&&(o+=e.typeShort+". "),t.length<e.name.length?(o+=e.name.substr(0,i),o+="<strong>"+e.name.substr(i,t.length)+"</strong>",o+=e.name.substr(i+t.length,e.name.length-t.length-i)):o+="<strong>"+e.name+"</strong>",e.parents)for(var n=e.parents.length-1;n>-1;n--){var s=e.parents[n];s.name&&(o&&(o+="<small>, </small>"),o+="<small>"+s.name+" "+s.typeShort+".</small>")}return o},change:function(a){a&&e($(this),a.type),o(),t()},openBefore:function(){},checkBefore:function(){var e=$(this);return $.trim(e.val())?void 0:(o(),t(),!1)}}),d.kladr({labelFormat:function(e,t){var o="",a=e.name.toLowerCase();t=t.name.toLowerCase();var i=a.indexOf(t);if(i=i>0?i:0,e.typeShort&&(o+=e.typeShort+". "),t.length<e.name.length?(o+=e.name.substr(0,i),o+="<strong>"+e.name.substr(i,t.length)+"</strong>",o+=e.name.substr(i+t.length,e.name.length-t.length-i)):o+="<strong>"+e.name+"</strong>",e.parents)for(var n=e.parents.length-1;n>-1;n--){var s=e.parents[n];s.name&&"city"==s.contentType&&(o&&(o+="<small>, </small>"),o+="<small>"+s.typeShort+". "+s.name+"</small>")}return o}}),i.kladr("type",$.kladr.type.region),n.kladr("type",$.kladr.type.district),s.kladr("type",$.kladr.type.city),d.kladr("type",$.kladr.type.street),r.kladr("type",$.kladr.type.building),$.kladr.setValues({region:78e11,city:78e11},".kladr-form"),s.kladr("withParents",!0),d.kladr("withParents",!0),r.kladr("verify",!1)}},4:{loaded:!1,load:function(){var e=$("#who-delivery-product"),t=this.getUserList();e.find('select[name="who"]').selectize({allowEmptyOption:!1,create:!1,plugins:{dropdown_footer:{title:"Мы можем доставить цветы вам или поздравить кого-нибудь от вас"}}}),e.find('select[name="reason"]').selectize({allowEmptyOption:!1,create:!1,plugins:{dropdown_footer:{title:'Вы можете изменить или добавить новые поводы <a href="reasons.html">здесь</a>'}}}),t.done(function(t){console.log("Get user list"),console.log(t),e.find('select[name="fromme_to_name"]').selectize({allowEmptyOption:!1,valueField:"id",labelField:"name",searchField:["name","phone"],options:t,addPrecedence:"Добавить",render:{item:function(e,t){return"<div>"+(e.name?'<span class="name">'+t(e.name)+"</span>":"")},option:function(e,t){var o=e.name||e.phone,a=e.name?e.phone:null;return'<div><span class="label">'+t(o)+"</span>"+(a?' <span class="caption">'+t(a)+"</span>":"")+"</div>"}},onChange:function(t){var o=this.$dropdown_content.find('[data-value="'+t+'"]'),a=o.find(".caption").text();e.find('input[type="tel"]').val(a)},plugins:{dropdown_footer:{title:"Если вы еще никого не поздравляли от своего имени, просто укажите имя получателя"}},create:!0})}),e.find('select[name="who"]').on("change",function(t){"fromme"==$(this).val()?(e.find(".fromme .raketa-select").css("width",e.width()),e.find(".fromme").removeClass("hide").hide().slideDown(150)):e.find(".fromme").slideUp(200).addClass("hide")}),e.find("select").on("change",function(){$('button[data-to-form="#'+e.attr("id")+'"]').removeClass("btn-bordered").addClass("btn-primary").removeAttr("disabled")});var o=this;e.on("submit",function(){var t=$(this).serializeObject(),a={};return $.each(t,function(t,o){"csrf"!=t&&(a[t]={index:t,value:o,textValue:e.find('[name="'+t+'"] option[value="'+o+'"]').text()})}),app.checkout["for"]=a,o.submitHandler($(this)),!1}),this.loaded=!0},init:function(){$("#checkout-step").parent().removeClass("middle")},close:function(){$("#checkout-step").parent().addClass("middle")},getUserList:function(){return $.Deferred(function(){var e=this,t=[];setTimeout(function(){t=[{id:1,name:"Екатерина",phone:"+7(956)000-0011"},{id:2,name:"Мария",phone:"+7(956)111-0022"},{id:3,name:"Иван",phone:"+7(956)222-0033"}],e.resolve(t)},2e3)})},submitProcess:function(e,t){console.log("[FOR DELIVERY] Send form data to server:"),console.log(e),setTimeout(function(){var e={status:!0};"function"==typeof t&&t(e)},2e3)},submitHandler:function(e){$('button[data-to-form="#'+e.attr("id")+'"]').closest(".bottom").removeClass("show");var t=e.serializeArray(),o=app.checkout.getCurrentStep();o.closest(".content-panel").addClass("middle"),e.hide(),console.log(o),ajaxloader.local({element:e,to:".step4",title:lang.processSave}),this.submitProcess(t,function(t){ajaxloader.finish(),e.show(),o.closest(".content-panel").removeClass("middle"),$('button[data-to-form="#'+e.attr("id")+'"]').closest(".bottom").addClass("show"),1==t.status&&($(document).trigger("raketa.checkout.update"),app.checkout.goToStep(8))})}},5:{loaded:!1,init:function(){}},6:{loaded:!1,init:function(){}},7:{loaded:!1,load:function(){this.step=$('#checkout-step > div[data-step="7"]');var e=this.step.find(".creditcard-list li"),t=this;e.on("click",function(){var o={id:$(this).data("card-id"),lastdiggit:$(this).data("card-lastdiggit"),type:$(this).data("card-type")};e.not(this).removeClass("active"),$(this).toggleClass("active"),o&&$(this).hasClass("active")?t.checkedCardId=o:t.checkedCardId=0}),$('button[data-toggle="setcard"]').on("click",function(){console.log(t.checkedCardId),t.checkedCardId&&t.cardProcess(t.checkedCardId)}),this.loaded=!0},init:function(){},cardProcess:function(e){console.log("User set card #"+e.id),$("#ajax-loader").fadeIn(100),setTimeout(function(){var t={status:!0};t.status?(app.checkout.card=e,$(document).trigger("raketa.checkout.update"),app.checkout.goToStep(8)):app.modal.dialog({content:lang.cardNotApprovedStatus,buttons:{no:{title:"OK","class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog] Not confirmed")}}}}),$("#ajax-loader").fadeOut(100)},1e3);
}},8:{loaded:!1,load:function(){var e=this;$(document).on("raketa.checkout.update",function(){e.updateHtml()}),$('button[type="checkout"]').on("click",function(){return ajaxloader.local({element:$("#result"),to:".step8",title:lang.loading}),$(this).hide(),app.checkout.save(function(e){ajaxloader.finish(),1==e.status&&(window.location=e.paymentUrl),$(this).show()}),!1}),this.loaded=!0},init:function(){$(".layout.devided.checkout>div.menu-wrapper").css("height","auto").show(),app.checkout.basket.length&&app.checkout.delivery.address&&app.checkout.delivery.timeofday&&app.checkout.delivery.date&&app.checkout["for"]&&app.checkout.card?$('button[type="checkout"]').removeAttr("disabled"):$('button[type="checkout"]').attr("disabled","disabled"),this.updateHtml()},updateHtml:function(){var e=$("#result");if(app.checkout["for"]){var t=app.checkout["for"];if("me"!=t.who.value){var o=t.fromme_to_name.textValue,a=t.fromme_to_phone.value,i=t.reason.textValue;e.find("li.who span").html(o+"<br><b>"+a+",</b> <i>"+i+"</i>")}else e.find("li.who span").html(app.checkout["for"].who.textValue);console.log(app.checkout["for"])}if(app.checkout.delivery.address){var n=app.checkout.delivery.address.fulladdress,s=n.split(",");console.log(app.checkout.delivery.address);var d=[s[2],s[3]?s[3]:app.checkout.delivery.address.building,app.checkout.delivery.address.apartment?"кв "+app.checkout.delivery.address.apartment:""];e.find("li.address span").html(d.join(", ")).parent().removeClass("empty")}else e.find("li.address span").html("Адрес").parent().addClass("empty");if(app.checkout.delivery.date&&app.checkout.delivery.timeofday){var r=app.checkout.delivery.date;r=moment(r,"DD.MM.YYYY").format("D MMMM");var l=lang[app.checkout.delivery.timeofday];e.find("li.delivery-date span").html(l+" "+r)}if(app.checkout.card){var c=e.find("li.credit");c.removeClass("error"),c.find("span").html("Карта <b>"+app.checkout.card.lastdiggit+"</b>"),c.find(".creditcard-type").addClass(app.checkout.card.type)}}}},loadLastStep:function(){var e=Cookies.get("raketa_checkout__step");return e?(this.goToStep(e),!0):!1},getCurrentStep:function(){return this.currentStep},goToStep:function(e){Cookies.set("raketa_checkout__step",e,{expires:365,path:"/"});var t=$("#checkout-step"),o=t.find(".step.active");o.length?this.currentStep=o:this.currentStep=$('#checkout-step .step[data-step="'+e+'"]');var a=o.data("step")?o.data("step"):e;if(o.trigger("close"),this.step[a]&&this.step[a].close&&this.step[a].close(),o.removeClass("active"),"dev"==settings.env&&console.log("[STEP] Go to checkout step #"+e),t.find(".step.step"+e).addClass("active").trigger("open"),t.parent().find(".bottom[data-to-step]").removeClass("show"),t.parent().find('.bottom[data-to-step="step'+e+'"]').addClass("show"),this.step[e]&&!this.step[e].loaded&&"function"==typeof this.step[e].load&&this.step[e].load(),this.step[e]&&this.step[e].loaded&&"function"==typeof this.step[e].init&&this.step[e].init(),"smallmobile"==device.type||"mobile"==device.type){console.log(e),8==e?($("#header .navbar-toggle").show(),$("#header .back").hide()):1!=e&&2!=e&&($("#header .navbar-toggle").hide(),$("#header .back").show());var i=t.find(".step.step"+e+" .mobile.hide.mobtitle").text();i?$("#header .mobile.title").html(i):$("#header .mobile.title").html($("title").text())}}};$.extend(app.checkout,t);var o={onboardClosed:!1,init:function(){var e=this;if(this.defaultStep="congratulate","smallmobile"!=device.type&&"mobile"!=device.type||($("#header .basket").hide(),$("#header .mobile.add-reason").show()),$('#reasons .content-panel .bottom button[type="submit"]').on("click",function(e){var t=$(this).data("to-form");if("dev"==settings.env&&console.log("Click bottom button with target form "+t),t&&0!=$(t).length){var o=$(t);return o.trigger("submit"),!1}}),$("#reasons-step form").on("submit",function(e){$(this).serializeObject()}),$('button[type="edit"]').on("click",function(t){if(e.goToStep("editreason",t),"smallmobile"==device.type||"mobile"==device.type){$("#reasons").css("overflow","auto"),$("#reasons").find(".menu-wrapper").transition({x:-320,complete:function(){}}),$("#header .navbar-toggle").hide(),$("#header .back").show();var o=$("#reasons-step div.step.active .title").text();$("#header .mobile.title").html(o)}return!1}),$('button[type="delete"]').on("click",function(e){var t=$(this).data("id");return t&&app.modal.dialog({content:lang.reasonquestdelete,buttons:{yes:{title:lang.dialogDeleteButton,"class":"delete",action:function(){"dev"==settings.env&&console.log("[Dialog] Confirmed"),window.location=window.location+"?action=delete&id="+t}},no:{title:lang.dialogDismissButton,"class":"dismiss",action:function(){"dev"==settings.env&&console.log("[Dialog] Not confirmed")}}}}),!1}),$('#reasons .content-panel .bottom button[type="dismiss"]').on("click",function(t){return e.goToStep(e.defaultStep),$("#reasons-step form.edit-reason-form")[0].reset(),!1}),"smallmobile"!=device.type&&"mobile"!=device.type||$("#reasons .reasons-list li").on("click",function(e){var t=$(e.target);t.is('button[data-toggle="gotostep"]')||($("#reasons .reasons-list li").not(this).removeClass("mobile-menu"),$(this).toggleClass("mobile-menu"))}),$('button[data-toggle="gotostep"]').on("click",function(t){var o=$(this).data("to-step"),a=$(this).closest(".bottom");if("smallmobile"==device.type||"mobile"==device.type&&"onboard"!=a.data("to-step")){$("#reasons").css("overflow","auto"),$("#reasons").find(".menu-wrapper").transition({x:-320,complete:function(){$("#reasons").find(".menu-wrapper").hide()}}),$("#header .navbar-toggle").hide(),$("#header .back").show();var i=$('#reasons-step div[data-step="'+o+'"] .title').text();$("#header .mobile.title").html(i)}else if("smallmobile"==device.type||"mobile"==device.type&&"onboard"==a.data("to-step"))return Cookies.set("raketa_reasons__board",!1,{expire:365,path:"/"}),app.reasons.onboardClosed=!0,$("#reasons-step").find('div[data-step="onboard"]').fadeOut(200,function(){$(this).removeClass("overlayed"),$("#reasons-step").find(".onboard.overlay").remove()}),void $("#reasons").find('.bottom[data-to-step="onboard"]').removeClass("show");e.currentStep&&"onboard"==e.currentStep.data("step")?(Cookies.set("raketa_reasons__board",!1,{expire:365,path:"/"}),e.currentStep.find("img").removeClass("zoomIn").addClass("zoomOutDown"),e.currentStep.find("img").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e.goToStep(o)})):e.goToStep(o,t)}),"smallmobile"!=device.type&&"mobile"!=device.type){var t=Hash.get(),o=Cookies.get("raketa_reasons__board");console.log(o),o?t.step?this.goToStep(t.step):this.goToStep(this.defaultStep):this.goToStep("onboard")}},goToStep:function(e,t){var o=$("#reasons-step"),a=this.currentStep=o.find('.step[data-step="'+e+'"]'),i=o.find(".step.active");if("congratulate"==e||a.data("step")!=i.data("step")||"smallmobile"==device.type||"mobile"==device.type){var n=Hash.get();switch(e){case"editreason":n.id?Hash.add("id",n.id):Hash.add("id",$(t.currentTarget).data("id"));break;case"congratulate":if("smallmobile"==device.type||"mobile"==device.type){var s=Cookies.get("raketa_reasons__board");$(document).on("raketa_reason__loaded",function(){s||app.reasons.onboardClosed||setTimeout(function(){o.find('div[data-step="onboard"]').before($("<div />").addClass("onboard overlay")),o.find('div[data-step="onboard"]').fadeIn(200,function(){$(this).addClass("overlayed")}),$("#reasons").find('.bottom[data-to-step="onboard"]').addClass("show")},600)})}break;default:Hash.remove("id")}Hash.add("step",e),"dev"==settings.env&&console.log("[STEP] Go to reasons step #"+e),o.parent().find(".bottom[data-to-step]").removeClass("show"),i.removeClass("active"),i.trigger("step-close"),this.currentStep.addClass("active").trigger("step-open"),o.parent().find('.bottom[data-to-step="'+e+'"]').addClass("show"),this.step[e]&&!this.step[e].loaded&&"function"==typeof this.step[e].load&&this.step[e].load(t),this.step[e]&&this.step[e].loaded&&"function"==typeof this.step[e].init&&this.step[e].init(t)}},getCurrentStep:function(){return this.currentStep},step:{newreason:{load:function(){var e=$("#reasons-step form");e.find("input.datetimepicker").each(function(){var e=$(this);$(this).datetimepicker({timepicker:!1,todayButton:!1,yearStart:"2016",yearEnd:"2035",dayOfWeekStart:1,scrollMonth:!1,prevButton:!1,nextButton:!1,className:"reason-datepicker",parentID:e.parent(),minDate:new Date,format:"d.m.Y"})});var t=new Date,o="К примеру: вы выбрали "+moment(t).format("DD.MM.YYYY")+"<br>Каждую неделю - поздравлять каждый "+moment(t).format("dddd").toLowerCase()+"<br>Каждый месяц - каждый месяц "+moment(t).format("DD")+" числа<br>Каждую год - каждый год "+moment(t).format("MMMM Do");e.find('select[name="repeat"]').selectize({allowEmptyOption:!1,create:!1,plugins:{dropdown_footer:{title:o}}}),e.find('select[name="who"]').selectize({allowEmptyOption:!1,create:!1}),e.find('select[name="reason"]').selectize({allowEmptyOption:!1,create:!0,plugins:{restore_on_backspace:{},dropdown_footer:{title:"Вы можете выбрать уже существущий повод и отредактировать его(клавиша Backspace) или добавить новый повод просто указав название"}}}),e.find("input").on("keyup",function(){var e=$('#reasons .content-panel .bottom[data-to-step*="reason"]');e.find("button").removeAttr("disabled"),e.find('button[type="submit"]').removeClass("btn-bordered").addClass("btn-primary")}),e.find("select").on("change",function(){var e=$('#reasons .content-panel .bottom[data-to-step*="reason"]');e.find("button").removeAttr("disabled"),e.find('button[type="submit"]').removeClass("btn-bordered").addClass("btn-primary")}),this.loaded=!0}},congratulate:{load:function(){$('#reasons-step div[data-step="congratulate"]').on("step-close",function(){$("#reasons-step").parent().removeClass("middle")}),this.loaded=!0},init:function(e){if($("#reasons-step").parent().addClass("middle"),e&&$(e.currentTarget)){var t=$(e.currentTarget).closest("li").data("id"),o=$("#reasons-step").parent().find('.bottom[data-to-step="congratulate"]');o.find('button[type="edit"]').data("id",t).attr("data-id",t),o.removeClass("show"),"smallmobile"!=device.type&&"mobile"!=device.type?ajaxloader.local({element:$('#reasons-step div[data-step="congratulate"]')}):ajaxloader.local({element:$("#reasons-step").parent()});this.getData(t,function(e){ajaxloader.finish(),o.addClass("show");var t=tmpl(document.getElementById("tmpl-congratulations-to").innerHTML,e);$(document).trigger("raketa_reason__loaded"),$('#reasons-step div[data-step="congratulate"]').html(t)})}},getData:function(e,t){setTimeout(function(){if(1==e)var o={photo:"img/reason-1b.png",name:"Маша Петрова",reason:"День рождения",repeat:"Напоминать каждый год"};else var o={name:"Международный женский день",reason:"Праздники",repeat:"Напоминать каждый год"};"function"==typeof t&&t(o)},1e3)}},editreason:{model:{id:1},load:function(){app.reasons.step.newreason.loaded||app.reasons.step.newreason.load(),this.loaded=!0},init:function(e){var t=$("#edit-reason-form");t[0].reset(),t.find("select").each(function(){$(this)[0].selectize.clear()}),t.find('input[name="reasonId"]').val(this.model.id)}}}};$.extend(app.reasons,o),app.promocode={init:function(){"smallmobile"!=device.type&&"mobile"!=device.type||($("#header .basket").hide(),$("#header .mobile.add-promocode").show(),$('button[data-toggle="new-promocode"]').on("click",function(e){$("#promocodes").find(".menu-wrapper").transition({x:-device.windowWidth,complete:function(){$(window).scrollTop(0),$("#promocodes").find(".menu-wrapper").hide()}}),$("#header .navbar-toggle").hide(),$("#header .back").show()})),$('#promocodes .content-panel .bottom button[type="submit"]').on("click",function(e){var t=$(this).data("to-form");if("dev"==settings.env&&console.log("Click bottom button with target form "+t),t&&0!=$(t).length){var o=$(t);return o.trigger("submit"),!1}}),$("#promocode-add input").on("keyup",function(){$(this).val()?$('button[data-to-form="#promocode-add"]').addClass("btn-primary").removeClass("btn-bordered").removeAttr("disabled"):$('button[data-to-form="#promocode-add"]').addClass("btn-bordered").removeClass("btn-primary").attr("disabled","disabled")}),$("#promocode-add").submit(function(e){return e.preventDefault(),app.promocode.add($(this)),!1})},add:function(e){$('button[data-to-form="#'+e.attr("id")+'"]').hide();var t=e.serializeArray();ajaxloader.local({element:e,to:"#promocodes .content-panel .static",title:lang.processConfirmCheck}),e.find("input").blur();var o=$("#promocodes .content-panel .static").outerHeight();this.process(t,function(t){$("#promocodes .content-panel .static").css("height",$("#promocodes").height()),e.hide(),ajaxloader.finish();var a="error";if(t.status){a="success";var i=tmpl(document.getElementById("tmpl-promocode").innerHTML,t.promocode),n=$("#promocodes-list");n.find("li.notfound").length>0&&n.find("li.notfound").remove(),n.append(i)}$("#callback-order-"+a).css("height",$("#promocodes").height()).fadeIn(200),countDown({time:5,display:$("#callback-order-"+a+" .timer"),afterFinish:function(){$("#callback-order-"+a).fadeOut(200,function(){e[0].reset(),$("#promocodes .content-panel .static").css("height",o),e.fadeIn(200),$('button[data-to-form="#promocode-add"]').addClass("btn-bordered").removeClass("btn-primary").attr("disabled","disabled"),$('button[data-to-form="#'+e.attr("id")+'"]').show()})}})})},process:function(e,t){setTimeout(function(){var e={status:!0,promocode:{name:"Скидка 500₽ на первый заказ",period:"до 31 декабря 2016"}};"function"==typeof t&&t(e)},1e3)}},e.scroll(function(){app.scroll()}),e.resize(function(){app.resize()}),app.init()}),Hash={get:function(){var e,t,o,a={};if(this.oldbrowser())o=decodeURIComponent(window.location.hash.substr(1)),t="/";else{var i=window.location.href.indexOf("?");o=-1!=i?decodeURIComponent(window.location.href.substr(i+1)):"",t="&"}if(0==o.length)return a;o=o.split(t);for(var n in o)o.hasOwnProperty(n)&&(e=o[n].split("="),"undefined"==typeof e[1]?a.anchor=e[0]:a[e[0]]=e[1]);return a},set:function(e){var t="";for(var o in e)e.hasOwnProperty(o)&&(t+="&"+o+"="+e[o]);this.oldbrowser()?window.location.hash=t.substr(1):(0!=t.length&&(t="?"+t.substr(1)),window.history.pushState(t,document.title,document.location.pathname+t))},add:function(e,t){var o=this.get();o[e]=t,this.set(o)},remove:function(e){var t=this.get();delete t[e],this.set(t)},clear:function(){this.set({})},oldbrowser:function(){return!(window.history&&history.pushState)}},String.template=function(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=e.replace(RegExp("\\{"+t+"\\}","gm"),arguments[t]);return e},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Object.size=function(e){var t,o=0;for(t in e)e.hasOwnProperty(t)&&o++;return o},Number.prototype.format=function(e,t,o,a){var i="\\d(?=(\\d{"+(t||3)+"})+"+(e>0?"\\D":"$")+")",n=this.toFixed(Math.max(0,~~e));return(a?n.replace(".",a):n).replace(new RegExp(i,"g"),"$&"+(o||","))},function(e,t){e.fn.serializeObject=function(){var o={};return e.each(this.serializeArray(),function(a,i){var n=i.name,s=i.value;o[n]=o[n]===t?s:e.isArray(o[n])?o[n].concat(s):[o[n],s]}),o}}(jQuery);
//# sourceMappingURL=app.min.js.map
